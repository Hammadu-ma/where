<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALIF · Bootstrap medical quiz</title>
    <!-- Bootstrap 5 + Icons + Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #60a5fa;
            --primary-dark: #3b82f6;
            --primary-light: #93c5fd;
            --secondary: #94a3b8;
            --success: #22c55e;
            --error: #ef4444;
            --warning: #eab308;
            --info: #0ea5e9;
            --purple: #8b5cf6;
            --pink: #ec4899;
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
            --radius: 12px;
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
        }
        
        .light-mode {
            --background: #f3f4f6;
            --surface: #ffffff;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --text-tertiary: #9ca3af;
            --border: #d1d5db;
        }
        
        .dark-mode {
            --background: #0f172a;
            --surface: #1e293b;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-tertiary: #6b7280;
            --border: #334155;
        }

        body {
            background-color: var(--background);
            color: var(--text-primary);
            transition: var(--transition);
            min-height: 100vh;
        }

        /* Header gradient matching new design */
        .gradient-header { 
            background: var(--gradient);
            color: white; 
            box-shadow: var(--shadow);
        }

        /* Cards matching new design */
        .subject-card { 
            background-color: var(--surface); 
            border: 1px solid var(--border); 
            transition: var(--transition); 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            border-radius: var(--radius);
        }
        
        .subject-card:hover { 
            transform: translateY(-5px); 
            border-color: var(--primary); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .quiz-list { 
            max-height: 270px; 
            overflow-y: auto; 
            scrollbar-width: thin; 
        }
        
        .quiz-list.expanded { 
            max-height: 700px; 
        }
        
        .quiz-item { 
            border-radius: var(--radius); 
            transition: var(--transition); 
        }
        
        .quiz-item:hover { 
            background-color: rgba(96, 165, 250, 0.1); 
            transform: translateX(5px); 
        }
        
        .quiz-link { 
            text-decoration: none; 
            color: var(--text-primary); 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 0.5rem 0.75rem; 
        }
        
        .quiz-icon { 
            width: 28px; 
            height: 28px; 
            background: var(--surface); 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: var(--primary); 
        }
        
        .quiz-title mark { 
            background: rgba(96, 165, 250, 0.3); 
            color: inherit; 
            padding: 0 2px; 
            border-radius: 4px; 
        }

        .filter-btn { 
            width: 100%; 
            text-align: left; 
            padding: 0.6rem 1rem; 
            border: none; 
            background: transparent; 
            color: var(--text-primary); 
            border-radius: 30px; 
            transition: var(--transition); 
        }
        
        .filter-btn:hover { 
            background: rgba(96, 165, 250, 0.1); 
            color: var(--primary); 
            transform: translateX(4px); 
        }
        
        .filter-btn.active { 
            background: var(--gradient); 
            color: white; 
            font-weight: 500; 
        }
        
        .filter-count { 
            background: var(--border); 
            color: var(--text-secondary); 
            padding: 0.15rem 0.6rem; 
            border-radius: 30px; 
            font-size: 0.75rem; 
        }
        
        .filter-btn.active .filter-count { 
            background: rgba(255,255,255,0.2); 
            color: white; 
        }

        .offcanvas.offcanvas-start { 
            background-color: var(--surface); 
            color: var(--text-primary); 
            width: 280px; 
        }

        .badge-exam { 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white; 
        }
        
        .badge-practice { 
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white; 
        }
        
        .badge-quizlet { 
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            color: white; 
        }

        .stat-card { 
            background: rgba(255,255,255,0.15); 
            border-radius: 20px; 
            padding: 0.4rem 1rem; 
            text-align: center; 
        }
        
        .stat-value { 
            font-size: 1.6rem; 
            font-weight: 700; 
            line-height: 1.2; 
        }

        /* Modal styles matching new design */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .modal-content {
            background: var(--surface);
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
            border: 1px solid var(--border);
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-icon {
            width: 70px;
            height: 70px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
            color: white;
        }
        
        .modal-content h2 {
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-size: 1.75rem;
            font-weight: 700;
        }
        
        .modal-content p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .modal-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-width: 120px;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        
        .modal-btn i {
            font-size: 1.1rem;
        }

        .bg-surface { 
            background-color: var(--surface) !important; 
        }
        
        .text-primary-custom { 
            color: var(--primary) !important; 
        }
        
        .border-custom { 
            border-color: var(--border) !important; 
        }
    </style>
</head>
<body class="dark-mode">
    <!-- Registration Required Modal -->
    <div id="registerModal" class="modal" style="display: flex;">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-user-lock"></i>
            </div>
            <h2>Registration Required</h2>
            <p>You need to register first to access the medical quiz platform. Create an account to unlock all features and track your progress.</p>
            <button class="modal-btn" id="goToRegisterBtn">
                <i class="fas fa-user-plus"></i> Register Now
            </button>
        </div>
    </div>

    <!-- Main Content (Initially Hidden) -->
    <div id="mainApp" style="display: none;">
        <div class="container-lg py-3 py-md-4">
            <!-- Header with stats -->
            <div class="gradient-header rounded-4 p-4 p-md-5 mb-4 position-relative overflow-hidden">
                <div class="position-relative z-1 d-flex flex-wrap align-items-center justify-content-between gap-3">
                    <div class="d-flex align-items-center gap-3" id="logoHome" style="cursor:pointer;">
                        <div class="bg-white bg-opacity-25 rounded-3 p-3 fs-2"><i class="fas fa-stethoscope"></i></div>
                        <div><h1 class="display-6 fw-bold mb-0">ALIF medical</h1><p class="mb-0 opacity-75">smart · adaptive · bootstrap</p></div>
                    </div>
                    <div class="d-flex gap-3" id="statsDisplay"></div>
                </div>
            </div>

            <!-- Mobile filter bar + offcanvas toggle -->
            <div class="d-flex d-lg-none align-items-center gap-3 mb-4">
                <button class="btn btn-outline-secondary d-flex align-items-center gap-2 py-2 px-4 rounded-pill" type="button" data-bs-toggle="offcanvas" data-bs-target="#subjectOffcanvas" aria-controls="subjectOffcanvas">
                    <i class="fas fa-sliders-h"></i> Subjects filter
                </button>
                <span class="text-secondary small" id="mobileActiveFilter">All subjects</span>
            </div>

            <!-- Offcanvas (mobile sidebar) -->
            <div class="offcanvas offcanvas-start" tabindex="-1" id="subjectOffcanvas" aria-labelledby="offcanvasLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title fw-bold" id="offcanvasLabel"><i class="fas fa-filter me-2"></i>Subjects</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="list-unstyled" id="drawerSubjectsList"></ul>
                </div>
            </div>

            <!-- Search + theme toggle row -->
            <div class="row g-3 align-items-center mb-4">
                <div class="col-md-7 col-lg-6">
                    <div class="input-group rounded-pill bg-surface border border-custom">
                        <span class="input-group-text bg-transparent border-0 text-secondary"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control bg-transparent border-0 ps-0" id="smartSearch" placeholder="Search quizzes, topics, years...">
                    </div>
                </div>
                <div class="col-md-5 col-lg-6 text-md-end">
                    <button class="btn btn-outline-secondary rounded-pill px-4 py-2" id="themeToggle">
                        <i class="fas fa-sun"></i><span class="ms-2">Dark Mode</span>
                    </button>
                </div>
            </div>

            <!-- main grid -->
            <div class="row g-4">
                <!-- desktop sidebar -->
                <aside class="col-lg-3 d-none d-lg-block">
                    <div class="bg-surface p-4 rounded-4 border border-custom sticky-top" style="top:1rem;">
                        <h5 class="fw-bold mb-3 text-primary-custom"><i class="fas fa-filter me-2"></i>Subjects</h5>
                        <ul class="list-unstyled" id="sidebarSubjectsList"></ul>
                    </div>
                </aside>

                <!-- quiz cards column -->
                <main class="col-lg-9">
                    <div class="row g-4" id="subjectsGrid"></div>
                    <!-- no results row -->
                    <div class="row" id="noResultsRow" style="display: none;">
                        <div class="col-12">
                            <div class="bg-surface p-5 rounded-4 text-center border border-custom">
                                <i class="fas fa-search fs-1 text-secondary"></i>
                                <p class="mt-3 text-secondary">No matching quizzes — try another term</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- footer -->
            <footer class="text-center text-secondary border-top border-custom mt-5 pt-4">
                <p>ALIF · bootstrap medical quiz · data from JSON</p>
            </footer>
        </div>
    </div>

    <!-- Bootstrap bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        (function() {
            // Check if user is registered
            const checkUserRegistration = () => {
                // Check for registered user in localStorage
                const registeredUser = localStorage.getItem('medicalUser');
                const currentUser = localStorage.getItem('currentUser');
                
                return !!(registeredUser || currentUser);
            };

            // Handle registration modal
            const registerModal = document.getElementById('registerModal');
            const mainApp = document.getElementById('mainApp');
            const goToRegisterBtn = document.getElementById('goToRegisterBtn');

            // Check if user is registered
            if (checkUserRegistration()) {
                // User is registered, hide modal and show app
                registerModal.style.display = 'none';
                mainApp.style.display = 'block';
                initializeApp();
            } else {
                // User is not registered, show modal and hide app
                registerModal.style.display = 'flex';
                mainApp.style.display = 'none';
                
                // Redirect to register page when button is clicked
                goToRegisterBtn.addEventListener('click', () => {
                    window.location.href = 'register.html';
                });
            }

            // App initialization function
            function initializeApp() {
                // ---------- JSON master data ----------
                const quizData = [
                    { subject: "embryology", icon: "fas fa-egg", display: "Embryology", quizzes: [
                        { title: "Embryology Practice 1", href: "quiz.html", qCount: 30, type: "practice" },
                        { title: "Embryology Practice 2", href: "2.html", qCount: 25, type: "practice" },
                        { title: "Embryology Exam 2014", href: "equiz3.html", qCount: 50, type: "exam" },
                        { title: "Embryology Quizlet 1", href: "embryoquizlets1.html", qCount: 40, type: "quizlet" },
                        { title: "Embryology Quizlet 2", href: "embryoquizlets2.html", qCount: 35, type: "quizlet" },
                        { title: "Embryology Quizlet 3", href: "embryoquizlets3.html", qCount: 45, type: "quizlet" }
                    ] },
                    { subject: "anatomy", icon: "fas fa-bone", display: "Anatomy", quizzes: [
                        { title: "JU Anatomy Exam 2013", href: "anatomy2013.html", qCount: 60, type: "exam" },
                        { title: "JU Anatomy Exam 2014", href: "anatomy2014.html", qCount: 55, type: "exam" },
                        { title: "JU Anatomy Exam 2016", href: "anatomy2016.html", qCount: 40, type: "exam" },
                        { title: "Anatomy Exam 2014", href: "anatquiz1.html", qCount: 50, type: "exam" },
                        { title: "CVS Anatomy 1", href: "anatomycvs1.html", qCount: 30, type: "practice" },
                        { title: "CVS Anatomy 2", href: "anatomycvs2.html", qCount: 35, type: "practice" },
                        { title: "Anatomy Dhaba", href: "anatomydhaba.html", qCount: 25, type: "practice" },
                        { title: "Anatomy Introduction", href: "anatomyintro1.html", qCount: 20, type: "practice" },
                        { title: "NS Medicoinfo", href: "anatomymedicoinfo1.html", qCount: 40, type: "quizlet" },
                        { title: "NS DILAB Part 1", href: "anatomynsdilabpart1.html", qCount: 30, type: "quizlet" },
                        { title: "NS Full Topic 1", href: "anatomynsfultopic1.html", qCount: 45, type: "quizlet" },
                        { title: "NS Full Topic 2", href: "anatomynsfultopic2.html", qCount: 40, type: "quizlet" },
                        { title: "NS Part 1", href: "anatomynspart1.html", qCount: 35, type: "quizlet" },
                        { title: "NS Part 2", href: "anatomynspart2.html", qCount: 35, type: "quizlet" },
                        { title: "NS Part 3", href: "anatomynspart3.html", qCount: 35, type: "quizlet" },
                        { title: "NS Part 4", href: "anatomynspart4.html", qCount: 35, type: "quizlet" },
                        { title: "Skeletal Anatomy 1", href: "anatomyskeletal1.html", qCount: 40, type: "practice" },
                        { title: "CVS Quizlet 1", href: "cvsquizlets1.html", qCount: 25, type: "quizlet" },
                        { title: "Simple CVS", href: "cvsquizlets2.html", qCount: 20, type: "quizlet" },
                        { title: "Medium CVS", href: "cvsquizlets3.html", qCount: 30, type: "quizlet" },
                        { title: "Challenging CVS", href: "cvsquizlets4.html", qCount: 35, type: "quizlet" },
                        { title: "Master NS Part 1", href: "masterplexus.html", qCount: 50, type: "quizlet" }
                    ] },
                    { subject: "physiology", icon: "fas fa-heartbeat", display: "Physiology", quizzes: [
                        { title: "Physiology NS 1", href: "physions1.html", qCount: 40, type: "quizlet" },
                        { title: "Physiology NS 2", href: "physions2.html", qCount: 35, type: "quizlet" },
                        { title: "Physiology NS 3", href: "physions3.html", qCount: 45, type: "quizlet" },
                        { title: "Physiology Exam 2016", href: "PHYSIO2016.html", qCount: 50, type: "exam" },
                        { title: "Physiology Unique 2015-2016", href: "PHYSIOuniqueto 2015 and 2016.html", qCount: 30, type: "exam" }
                    ] },
                    { subject: "biochemistry", icon: "fas fa-flask", display: "Biochemistry", quizzes: [
                        { title: "Biochemistry Enzymes 1", href: "biochemEN1.html", qCount: 30, type: "practice" },
                        { title: "Biochemistry Enzymes 2", href: "biochemEN2.html", qCount: 28, type: "practice" },
                        { title: "Enzymes Concept 3", href: "biochemENCONC3.html", qCount: 25, type: "practice" },
                        { title: "Enzymes Concept 4", href: "biochemENCONC4.html", qCount: 25, type: "practice" },
                        { title: "Enzymes Concept 5", href: "biochemENCONC5.html", qCount: 25, type: "practice" },
                        { title: "Enzymes Page 24", href: "biochemEpage24.html", qCount: 15, type: "exam" },
                        { title: "Enzymes Page 24.1", href: "biochemEpage24.1.html", qCount: 15, type: "exam" },
                        { title: "Enzymes Page 50", href: "biochemEpage50.html", qCount: 20, type: "exam" },
                        { title: "Nucleic Acids 1", href: "biochemNA1.html", qCount: 35, type: "quizlet" },
                        { title: "Nucleic Acids 2", href: "biochemNA2.html", qCount: 30, type: "quizlet" },
                        { title: "Nucleic Acids 3", href: "biochemNA3.html", qCount: 25, type: "quizlet" },
                        { title: "Carbohydrates 1", href: "biochemcarbohydrate1.html", qCount: 30, type: "practice" },
                        { title: "Carbohydrates 2", href: "biochemcarbohydrate2.html", qCount: 30, type: "practice" },
                        { title: "Carbohydrates 60", href: "BIOcarbohydrate60.html", qCount: 60, type: "practice" },
                        { title: "Chatterjea Carbohydrates", href: "chatterjeacarbohydrate.html", qCount: 40, type: "quizlet" },
                        { title: "Proteins 1", href: "biochemprotein1.html", qCount: 35, type: "quizlet" },
                        { title: "Proteins 2", href: "biochemprotein2.html", qCount: 30, type: "quizlet" },
                        { title: "Proteins 3", href: "biochemprotein3.html", qCount: 28, type: "quizlet" },
                        { title: "Proteins 4", href: "biochemprotein4.html", qCount: 25, type: "quizlet" },
                        { title: "Proteins 5", href: "biochemprotein5.html", qCount: 30, type: "quizlet" },
                        { title: "Proteins 6", href: "biochemprotein6.html", qCount: 30, type: "quizlet" },
                        { title: "Proteins 7", href: "biochemprotein7.html", qCount: 30, type: "quizlet" },
                        { title: "Proteins 8", href: "biochemprotein8.html", qCount: 30, type: "quizlet" },
                        { title: "Proteins 9", href: "biochemprotein9.html", qCount: 30, type: "quizlet" }
                    ] },
                    { subject: "histopathology", icon: "fas fa-microscope", display: "Histopathology", quizzes: [
                        { title: "Histopathology Quiz 1", href: "histoquiz1.html", qCount: 25, type: "practice" }
                    ] },
                    { subject: "renal", icon: "fas fa-tint", display: "Renal", quizzes: [
                        { title: "Renal Physiology Quiz", href: "renal.html", qCount: 30, type: "practice" }
                    ] }
                ];

                // stats
                const totalQuizzes = quizData.reduce((acc, s) => acc + s.quizzes.length, 0);
                const totalQuestions = quizData.reduce((acc, s) => acc + s.quizzes.reduce((qacc, q) => qacc + q.qCount, 0), 0);
                document.getElementById('statsDisplay').innerHTML = `
                    <div class="stat-card"><div class="stat-value">${totalQuizzes}</div><div class="small">Quizzes</div></div>
                    <div class="stat-card"><div class="stat-value">${totalQuestions}+</div><div class="small">Questions</div></div>
                    <div class="stat-card"><div class="stat-value">${quizData.length}</div><div class="small">Subjects</div></div>
                `;

                let currentFilter = 'all';
                let currentSearch = '';

                // helpers
                function setFilter(filter) {
                    currentFilter = filter;
                    renderAllFilters();
                    renderCards();
                    const subj = quizData.find(s => s.subject === filter);
                    document.getElementById('mobileActiveFilter').innerText = !filter || filter==='all' ? 'All subjects' : (subj?.display || filter);
                    const offcanvasEl = document.getElementById('subjectOffcanvas');
                    const bsOffcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
                    if (bsOffcanvas) bsOffcanvas.hide();
                }

                // render filter lists
                function renderAllFilters() {
                    const allCount = quizData.reduce((acc, s) => acc + s.quizzes.length, 0);
                    let html = `<li class="mb-2"><button class="filter-btn d-flex align-items-center ${currentFilter==='all'?'active':''}" data-filter="all"><i class="fas fa-th me-2"></i> All subjects <span class="filter-count ms-auto">${allCount}</span></button></li>`;
                    quizData.forEach(s => {
                        html += `<li class="mb-2"><button class="filter-btn d-flex align-items-center ${currentFilter===s.subject?'active':''}" data-filter="${s.subject}"><i class="${s.icon} me-2"></i> ${s.display} <span class="filter-count ms-auto">${s.quizzes.length}</span></button></li>`;
                    });
                    document.getElementById('sidebarSubjectsList').innerHTML = html;
                    document.querySelectorAll('#sidebarSubjectsList .filter-btn').forEach(btn => {
                        btn.addEventListener('click', () => setFilter(btn.dataset.filter));
                    });

                    let drawerHtml = `<li class="mb-2"><button class="filter-btn d-flex align-items-center ${currentFilter==='all'?'active':''}" data-filter="all"><i class="fas fa-th me-2"></i> All subjects <span class="filter-count ms-auto">${allCount}</span></button></li>`;
                    quizData.forEach(s => {
                        drawerHtml += `<li class="mb-2"><button class="filter-btn d-flex align-items-center ${currentFilter===s.subject?'active':''}" data-filter="${s.subject}"><i class="${s.icon} me-2"></i> ${s.display} <span class="filter-count ms-auto">${s.quizzes.length}</span></button></li>`;
                    });
                    document.getElementById('drawerSubjectsList').innerHTML = drawerHtml;
                    document.querySelectorAll('#drawerSubjectsList .filter-btn').forEach(btn => {
                        btn.addEventListener('click', () => setFilter(btn.dataset.filter));
                    });
                }

                // highlight
                function highlightText(text, term) {
                    if (!term) return text;
                    const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`, 'gi');
                    return text.replace(regex, '<mark>$1</mark>');
                }

                function renderCards() {
                    const term = currentSearch.trim().toLowerCase();
                    let anyVisible = false;
                    let cardsHtml = '';

                    quizData.forEach(subject => {
                        if (currentFilter !== 'all' && subject.subject !== currentFilter) return;
                        const filtered = subject.quizzes.filter(q => !term || q.title.toLowerCase().includes(term) || subject.subject.toLowerCase().includes(term));
                        if (filtered.length === 0 && term !== '') return;
                        anyVisible = true;

                        const itemsHtml = filtered.map(q => {
                            const titleDisplay = term ? highlightText(q.title, term) : q.title;
                            let badgeClass = 'bg-secondary';
                            if (q.type === 'exam') badgeClass = 'badge-exam';
                            else if (q.type === 'practice') badgeClass = 'badge-practice';
                            else if (q.type === 'quizlet') badgeClass = 'badge-quizlet';
                            return `<li class="quiz-item">
                                <a href="${q.href}" class="quiz-link">
                                    <span class="d-flex align-items-center gap-2">
                                        <span class="quiz-icon"><i class="fas ${q.type==='exam'?'fa-file-alt':(q.type==='practice'?'fa-play-circle':'fa-code')}"></i></span>
                                        <span class="quiz-title">${titleDisplay}</span>
                                    </span>
                                    <span class="d-flex align-items-center gap-2">
                                        <span class="badge ${badgeClass} rounded-pill">${q.qCount}</span>
                                        <i class="fas fa-arrow-right text-secondary"></i>
                                    </span>
                                </a>
                            </li>`;
                        }).join('');

                        const tooMany = subject.quizzes.length > 6;
                        cardsHtml += `<div class="col-md-6 col-xl-4">
                            <div class="subject-card rounded-4 p-0">
                                <div class="p-3 d-flex align-items-center gap-3 border-bottom border-custom" style="background:linear-gradient(135deg, rgba(96,165,250,0.05), rgba(59,130,246,0.05));">
                                    <div class="bg-primary bg-opacity-10 p-3 rounded-3"><i class="${subject.icon} fs-3 text-primary-custom"></i></div>
                                    <div><h3 class="h5 mb-0">${subject.display}</h3><span class="small text-secondary">${subject.quizzes.length} quizzes</span></div>
                                    <span class="badge bg-primary rounded-pill ms-auto">${subject.quizzes.length}</span>
                                </div>
                                <div class="p-3">
                                    <ul class="list-unstyled quiz-list ${tooMany?'collapsed':''}">${itemsHtml}</ul>
                                </div>
                                ${tooMany ? `<button class="view-all-btn btn btn-link w-100 text-decoration-none border-top border-custom py-2" style="color:var(--primary);"><span>View all quizzes</span> <i class="fas fa-chevron-down"></i></button>` : ''}
                            </div>
                        </div>`;
                    });

                    document.getElementById('subjectsGrid').innerHTML = cardsHtml;
                    document.getElementById('noResultsRow').style.display = anyVisible ? 'none' : 'flex';

                    document.querySelectorAll('.view-all-btn').forEach(btn => {
                        const card = btn.closest('.subject-card');
                        const list = card.querySelector('.quiz-list');
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            const expanded = list.classList.toggle('expanded');
                            btn.querySelector('span').innerText = expanded ? 'Show less' : 'View all quizzes';
                            btn.querySelector('i').classList.toggle('fa-chevron-down', !expanded);
                            btn.querySelector('i').classList.toggle('fa-chevron-up', expanded);
                        });
                    });
                }

                // search debounce
                const searchInput = document.getElementById('smartSearch');
                let timeout;
                searchInput.addEventListener('input', () => {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        currentSearch = searchInput.value;
                        renderCards();
                    }, 150);
                });

                // theme toggle
                const toggle = document.getElementById('themeToggle');
                const body = document.body;
                const icon = toggle.querySelector('i');
                const span = toggle.querySelector('span');
                
                if (localStorage.getItem('theme') === 'dark') {
                    body.classList.replace('light-mode','dark-mode'); 
                    icon.className = 'fas fa-sun'; 
                    span.textContent = ' Dark Mode';
                } else if (localStorage.getItem('theme') === 'light') {
                    body.classList.replace('dark-mode','light-mode'); 
                    icon.className = 'fas fa-moon'; 
                    span.textContent = ' Light Mode';
                }

                toggle.addEventListener('click', () => {
                    if (body.classList.contains('light-mode')) {
                        body.classList.replace('light-mode','dark-mode'); 
                        icon.className = 'fas fa-sun'; 
                        span.textContent = ' Dark Mode';
                        localStorage.setItem('theme','dark');
                    } else {
                        body.classList.replace('dark-mode','light-mode'); 
                        icon.className = 'fas fa-moon'; 
                        span.textContent = ' Light Mode';
                        localStorage.setItem('theme','light');
                    }
                });

                document.getElementById('logoHome').addEventListener('click', () => window.scrollTo({ top:0, behavior:'smooth' }));

                // init
                renderAllFilters();
                renderCards();
                setFilter('all');
            }
        })();
    </script>
</body>
</html>
