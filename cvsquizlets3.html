<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Embryology Quiz Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #f72585;
            --success: #4cc9f0;
            --warning: #f9c74f;
            --danger: #f94144;
            --info: #577590;
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f5;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #868e96;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --bg-primary: var(--gray-900);
            --bg-secondary: #1a1d21;
            --bg-tertiary: #2c303a;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --card-bg: rgba(35, 39, 47, 0.95);
            --card-border: rgba(255, 255, 255, 0.1);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15), 0 5px 10px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2);
            --transition-base: all 0.2s ease-in-out;
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
            --header-height: 70px;
            --max-width: 900px;
            --side-padding: 1.5rem;
        }

        [data-theme="light"] {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #eef2f6;
            --text-primary: #1a1d21;
            --text-secondary: rgba(26, 29, 33, 0.7);
            --text-tertiary: rgba(26, 29, 33, 0.5);
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-border: rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.08), 0 5px 10px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.08);
        }

        [data-theme="minimal"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #334155;
            --text-tertiary: #64748b;
            --card-bg: #ffffff;
            --card-border: #e2e8f0;
            --primary: #0ea5e9;
            --primary-light: #38bdf8;
            --primary-dark: #0284c7;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition-base);
            line-height: 1.6;
            font-weight: 400;
        }

        header {
            height: var(--header-height);
            background: var(--bg-secondary);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--side-padding);
            transition: var(--transition-base);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--primary);
        }

        .logo-icon {
            font-size: 1.5rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-base);
            position: relative;
        }

        .control-btn:hover {
            background: var(--bg-tertiary);
            transform: translateY(-2px);
        }

        .control-btn i {
            font-size: 1.1rem;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        main {
            flex: 1;
            padding: 2rem var(--side-padding);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .quiz-container {
            width: 100%;
            max-width: var(--max-width);
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-smooth);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .quiz-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .quiz-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .stats-container {
            display: flex;
            gap: 1rem;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            min-width: 70px;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin: 1.5rem 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary));
            border-radius: var(--radius-lg);
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            100% { left: 100%; }
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .question-tags {
            display: flex;
            gap: 0.5rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .question-number {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            line-height: 1.4;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 1rem 1.25rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition-smooth);
            border: 1px solid transparent;
        }

        .option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .option.selected {
            background: rgba(67, 97, 238, 0.1);
            border-color: var(--primary);
            animation: pulse 0.3s ease;
        }

        .option.correct {
            background: rgba(76, 201, 240, 0.1);
            border-color: var(--success);
        }

        .option.incorrect {
            background: rgba(249, 65, 68, 0.1);
            border-color: var(--danger);
        }

        .option-letter {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
        }

        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--danger);
            color: white;
        }

        .option-text {
            flex: 1;
        }

        .bookmark-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition-base);
        }

        .bookmark-btn:hover {
            color: var(--primary);
        }

        .bookmark-btn.bookmarked {
            color: var(--warning);
        }

        .feedback {
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: fadeIn 0.3s ease;
        }

        .feedback.correct {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success);
        }

        .feedback.incorrect {
            background: rgba(249, 65, 68, 0.1);
            color: var(--danger);
        }

        .feedback-icon {
            font-size: 1.5rem;
        }

        .explanation-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .explanation-container.expanded {
            max-height: 500px;
        }

        .explanation {
            padding: 1.25rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            margin-top: 1rem;
            border-left: 4px solid var(--primary);
        }

        .explanation-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition-base);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .results-container {
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: conic-gradient(var(--primary) 0% var(--p, 0%), var(--bg-tertiary) var(--p, 0%) 100%);
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: var(--card-bg);
        }

        .score-text {
            position: relative;
            z-index: 1;
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }

        .result-stat {
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
        }

        .result-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .result-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .review-section {
            margin-top: 2rem;
            text-align: left;
        }

        .review-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .review-item {
            padding: 1.25rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1rem;
            background: var(--bg-tertiary);
        }

        .review-item.correct {
            border-left: 4px solid var(--success);
        }

        .review-item.incorrect {
            border-left: 4px solid var(--danger);
        }

        .review-question {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .review-answer {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .review-explanation {
            font-size: 0.85rem;
            color: var(--text-secondary);
            padding-top: 0.5rem;
            border-top: 1px solid var(--card-border);
        }

        footer {
            padding: 1.5rem var(--side-padding);
            background: var(--bg-secondary);
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
            box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .pulse {
            animation: pulse 0.5s ease;
        }

        .bounce-in {
            animation: bounceIn 0.5s ease;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        @media (max-width: 768px) {
            :root {
                --side-padding: 1rem;
                --header-height: 60px;
            }

            .quiz-container {
                padding: 1.5rem;
            }

            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .stats-container {
                width: 100%;
                justify-content: space-between;
            }

            .results-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .score-circle {
                width: 120px;
                height: 120px;
            }

            .score-circle::before {
                width: 100px;
                height: 100px;
            }

            .score-value {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .navigation {
                flex-direction: column;
                gap: 0.75rem;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .option {
                padding: 0.75rem;
            }

            .option-letter {
                width: 28px;
                height: 28px;
                margin-right: 0.75rem;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <header>
        <div class="logo">
            <i class="fas fa-brain logo-icon"></i>
            <span>MedQuiz Pro</span>
        </div>
        <div class="header-controls">
            <button class="control-btn" id="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="control-btn" id="sound-toggle" aria-label="Toggle sound">
                <i class="fas fa-volume-up"></i>
            </button>
            <button class="control-btn" id="stats-btn" aria-label="View statistics">
                <i class="fas fa-chart-line"></i>
                <span class="badge" id="bookmarks-count">0</span>
            </button>
        </div>
    </header>

    <main>
        <div class="quiz-container">
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">MedQuiz Pro</h1>
                    <p class="quiz-subtitle">Test your knowledge with professional questions and detailed explanations</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="score">0</span>
                        <span class="stat-label">Score</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="streak">0</span>
                        <span class="stat-label">Streak</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">All</span>
                        <span class="stat-label">Category</span>
                    </div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>

            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">cvs</span>
                    <span class="tag" id="difficulty-tag">Medium</span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">10</span></div>
            <div class="question-text" id="question">Which part of the brain is responsible for coordinating skeletal muscle contractions?</div>

            <div class="options-grid" id="options-container">
                <div class="option">
                    <div class="option-letter">A</div>
                    <div class="option-text">Cerebrum</div>
                </div>
                <div class="option">
                    <div class="option-letter">B</div>
                    <div class="option-text">Cerebellum</div>
                </div>
                <div class="option">
                    <div class="option-letter">C</div>
                    <div class="option-text">Pons</div>
                </div>
                <div class="option">
                    <div class="option-letter">D</div>
                    <div class="option-text">Midbrain</div>
                </div>
            </div>

            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>

            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>

            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text">The cerebellum, located posterior to the brainstem, is the 'little brain.' It compares intended movements with actual movements to ensure smooth, coordinated skeletal muscle activity and maintain posture and balance.</div>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </main>

    <footer>
        &copy; 2025 MedQuiz Pro || All Rights Reserved
    </footer>

    <script>
        const questions = 
        
        [
    {
        "question": "A patient presents with chest pain and ECG changes suggesting ischemia in the anterior wall of the left ventricle and the apex. Based on the arterial supply described, blockage of which artery is most likely responsible?",
        "options": ["Right coronary artery", "Left circumflex artery", "Posterior interventricular artery", "Anterior interventricular artery", "Right marginal artery"],
        "answer": 3,
        "correctAnswer": "Anterior interventricular artery",
        "explanation": "The anterior interventricular artery (LAD) supplies the anterior left ventricle and apex, per 'CVS (Overview).pptx'. Blockage causes anterior myocardial infarction. Right coronary supplies right heart, circumflex supplies lateral/posterior, posterior interventricular supplies posterior septum, and right marginal supplies right ventricle."
    },
    {
        "question": "In a clinical scenario where a patient has pericardial effusion leading to tamponade, which pericardial structure would accumulate fluid, potentially compressing the heart?",
        "options": ["Fibrous pericardium", "Parietal serous pericardium", "Visceral serous pericardium", "Pericardial cavity", "Epicardium"],
        "answer": 3,
        "correctAnswer": "Pericardial cavity",
        "explanation": "The pericardial cavity, between visceral and parietal serous pericardium, accumulates fluid in effusion, causing tamponade, per 'CVS (Overview).pptx'. Fibrous pericardium is outer, parietal lines it, visceral adheres to heart, and epicardium is visceral pericardium."
    },
    {
        "question": "During auscultation, a diastolic murmur is heard best at the left 5th intercostal space in the midclavicular line. This suggests stenosis of which valve, based on the valve positions?",
        "options": ["Aortic valve", "Pulmonary valve", "Tricuspid valve", "Mitral valve", "Semilunar valve"],
        "answer": 3,
        "correctAnswer": "Mitral valve",
        "explanation": "Mitral valve stenosis causes a diastolic murmur at the left 5th intercostal space (apex), per 'Circulatory S.ppt'. Aortic/pulmonary stenosis cause systolic murmurs, tricuspid is at lower sternal border, and semilunar refers to aortic/pulmonary."
    },
    {
        "question": "A patient with renal failure shows signs of anemia. Considering erythropoiesis, where is the primary site of red blood cell production affected by renal hormones?",
        "options": ["Liver sinusoids", "Spleen pulp", "Red bone marrow", "Lymph nodes", "Thymus gland"],
        "answer": 2,
        "correctAnswer": "Red bone marrow",
        "explanation": "Erythropoiesis occurs in red bone marrow, stimulated by renal erythropoietin, per 'Circulatory S.ppt'. Liver is fetal, spleen filters, lymph nodes produce lymphocytes, and thymus matures T-cells."
    },
    {
        "question": "In a trauma case, a stab wound penetrates the anterior chest at the 4th intercostal space midline. Which heart chamber is most at risk, given its position forming the sternocostal surface?",
        "options": ["Left atrium", "Left ventricle", "Right atrium", "Right ventricle", "Pulmonary trunk"],
        "answer": 3,
        "correctAnswer": "Right ventricle",
        "explanation": "The right ventricle forms the sternocostal surface, vulnerable to anterior trauma, per 'Circulatory S.ppt'. Left atrium is posterior, left ventricle forms apex, right atrium is right border, and pulmonary trunk is superior."
    },
    {
        "question": "Which arterial branch from the celiac trunk supplies the spleen, and what clinical condition might arise from its occlusion?",
        "options": ["Left gastric artery - gastric ulcers", "Common hepatic artery - liver ischemia", "Splenic artery - splenic infarction", "Superior mesenteric - intestinal ischemia", "Inferior phrenic - diaphragmatic pain"],
        "answer": 2,
        "correctAnswer": "Splenic artery - splenic infarction",
        "explanation": "The splenic artery from the celiac trunk supplies the spleen, and occlusion causes splenic infarction, per 'Circulatory S.ppt'. Left gastric supplies stomach, hepatic supplies liver, superior mesenteric supplies intestines, and phrenic is from aorta."
    },
    {
        "question": "A patient with varices in the lower leg likely has incompetence in which superficial vein that drains into the femoral vein?",
        "options": ["Small saphenous vein", "Great saphenous vein", "Basilic vein", "Cephalic vein", "Popliteal vein"],
        "answer": 1,
        "correctAnswer": "Great saphenous vein",
        "explanation": "The great saphenous vein, draining into the femoral vein, is commonly involved in varicose veins, per 'Circulatory S.ppt'. Small saphenous drains to popliteal, basilic/cephalic are upper limb, and popliteal is deep."
    },
    {
        "question": "In congestive heart failure, fluid backup in the pulmonary circulation suggests failure of which side of the heart?",
        "options": ["Right side - systemic congestion", "Left side - pulmonary congestion", "Both sides equally", "Atria only", "Ventricles only"],
        "answer": 1,
        "correctAnswer": "Left side - pulmonary congestion",
        "explanation": "Left heart failure causes pulmonary congestion, per 'CVS (Overview).pptx'. Right side causes systemic edema, biventricular is possible but not primary, and ventricles drive pumping, not atria alone."
    },
    {
        "question": "A lymph node biopsy shows proliferation in response to infection. What is the role of lymphatic nodules within nodes?",
        "options": ["Filter blood plasma", "Sites of lymphocyte proliferation", "Produce red blood cells", "Store platelets", "Regulate heart rate"],
        "answer": 1,
        "correctAnswer": "Sites of lymphocyte proliferation",
        "explanation": "Lymphatic nodules in lymph nodes are sites of lymphocyte proliferation, per 'Circulatory S.ppt'. Blood plasma is not filtered, RBCs/platelets are bone marrow, and heart rate is autonomic."
    },
    {
        "question": "During cardiac catheterization, contrast shows the coronary sinus receiving most venous drainage. Which vein does NOT drain into it?",
        "options": ["Great cardiac vein", "Middle cardiac vein", "Small cardiac vein", "Oblique vein of left atrium", "Anterior cardiac vein"],
        "answer": 4,
        "correctAnswer": "Anterior cardiac vein",
        "explanation": "Anterior cardiac vein drains directly to right atrium, not coronary sinus, per 'CVS (Overview).pptx'. Great, middle, small, and oblique veins drain to the sinus."
    },
    {
        "question": "A patient with atrial fibrillation has irregular heart rhythm. Which structure initiates normal sinus rhythm?",
        "options": ["AV node", "Bundle of His", "Purkinje fibers", "SA node", "Sympathetic trunks"],
        "answer": 3,
        "correctAnswer": "SA node",
        "explanation": "The SA node is the pacemaker initiating sinus rhythm, per 'Circulatory S.ppt'. AV node delays, bundle of His/Purkinje transmit, and sympathetic trunks modulate rate."
    },
    {
        "question": "In hypovolemic shock, which function of blood is primarily compromised leading to tissue hypoxia?",
        "options": ["Regulation of pH", "Protection against infection", "Transportation of oxygen", "Clotting to prevent bleeding", "Heat distribution"],
        "answer": 2,
        "correctAnswer": "Transportation of oxygen",
        "explanation": "Blood transports oxygen, compromised in hypovolemic shock, per 'Circulatory S.ppt'. pH regulation, infection protection, clotting, and heat distribution are secondary."
    },
    {
        "question": "A gunshot wound to the neck risks damaging which artery that divides below the mandible angle?",
        "options": ["Subclavian artery", "Axillary artery", "Common carotid artery", "Vertebral artery", "External iliac artery"],
        "answer": 2,
        "correctAnswer": "Common carotid artery",
        "explanation": "The common carotid divides below the mandible, per 'CVS (Overview).pptx'. Subclavian is thoracic, axillary is arm, vertebral is in transverse foramina, and external iliac is pelvic."
    },
    {
        "question": "In portal hypertension, which vein carries digested nutrients to the liver and may develop varices?",
        "options": ["Inferior vena cava", "Superior vena cava", "Portal vein", "Azygos vein", "Coronary sinus"],
        "answer": 2,
        "correctAnswer": "Portal vein",
        "explanation": "The portal vein carries digested nutrients to the liver, causing varices in hypertension, per 'Circulatory S.ppt'. IVC/SVC are systemic, azygos drains thorax, and coronary sinus drains heart."
    },
    {
        "question": "A patient with eosinophilic asthma has elevated which granulocyte type?",
        "options": ["Neutrophils", "Basophils", "Eosinophils", "Monocytes", "Lymphocytes"],
        "answer": 2,
        "correctAnswer": "Eosinophils",
        "explanation": "Eosinophils, granulocytes, are elevated in allergic asthma, per 'Circulatory S.ppt'. Neutrophils for bacteria, basophils release histamine, monocytes/lymphocytes are agranulocytes."
    },
    {
        "question": "During surgery, ligation of the ductus arteriosus remnant (ligamentum arteriosum) risks which nerve, leading to hoarseness?",
        "options": ["Phrenic nerve", "Vagus nerve", "Left recurrent laryngeal nerve", "Sympathetic trunk", "Greater splanchnic nerve"],
        "answer": 2,
        "correctAnswer": "Left recurrent laryngeal nerve",
        "explanation": "The left recurrent laryngeal nerve loops around the ligamentum arteriosum, risking hoarseness if injured, per 'Circulatory S.ppt'. Phrenic is for diaphragm, vagus is parent, sympathetic/splanchnic are unrelated."
    },
    {
        "question": "In fenestrated capillaries of the kidney, what allows for filtration in glomeruli?",
        "options": ["Intercellular clefts", "Plasma membrane holes", "Incomplete basement membrane", "Smooth muscle layers", "Valves"],
        "answer": 1,
        "correctAnswer": "Plasma membrane holes",
        "explanation": "Fenestrated capillaries in kidneys have plasma membrane holes for glomerular filtration, per 'Circulatory S.ppt'. Clefts are continuous, incomplete basement is sinusoids, smooth muscle is arterioles, and valves are veins."
    },
    {
        "question": "A patient with thrombosis in the popliteal vein risks pulmonary embolism. Which deep vein forms the popliteal at the knee?",
        "options": ["Femoral and great saphenous", "Anterior and posterior tibial", "External and internal iliac", "Basilic and cephalic", "Radial and ulnar"],
        "answer": 1,
        "correctAnswer": "Anterior and posterior tibial",
        "explanation": "Anterior and posterior tibial veins form the popliteal vein, per 'Circulatory S.ppt'. Femoral receives saphenous, iliac form common iliac, and basilic/cephalic/radial/ulnar are upper limb."
    },
    {
        "question": "In the mediastinum, a tumor compressing the esophagus would be in which subdivision?",
        "options": ["Superior mediastinum", "Anterior inferior", "Middle inferior", "Posterior inferior", "Costomediastinal recess"],
        "answer": 3,
        "correctAnswer": "Posterior inferior",
        "explanation": "The esophagus is in the posterior inferior mediastinum, per 'Circulatory S.ppt'. Superior has aorta, anterior has thymus, middle has heart, and costomediastinal is pleural."
    },
    {
        "question": "A neutropenic patient is at risk for infections due to low levels of which WBC?",
        "options": ["Eosinophils", "Basophils", "Neutrophils", "Lymphocytes", "Monocytes"],
        "answer": 2,
        "correctAnswer": "Neutrophils",
        "explanation": "Neutrophils, granulocytes, fight bacterial infections; low levels increase infection risk, per 'Circulatory S.ppt'. Eosinophils for parasites, basophils for allergies, lymphocytes/monocytes for adaptive/phagocytic."
    },
    {
        "question": "Blockage of the inferior mesenteric artery would cause ischemia in which colonic parts?",
        "options": ["Small intestine and ascending colon", "Transverse colon (half), descending, sigmoid, rectum", "Cecum and appendix", "Stomach and duodenum", "Liver and pancreas"],
        "answer": 1,
        "correctAnswer": "Transverse colon (half), descending, sigmoid, rectum",
        "explanation": "Inferior mesenteric artery supplies half transverse, descending, sigmoid, and rectum, per 'Circulatory S.ppt'. Small intestine/ascending/cecum/appendix are superior mesenteric, stomach/duodenum/liver/pancreas are celiac."
    },
    {
        "question": "In a patient with deep vein thrombosis, which valve presence distinguishes veins from arteries?",
        "options": ["Absence in arteries, presence in veins to prevent backflow", "Presence in both for unidirectional flow", "Only in capillaries", "In arteries for high pressure", "None in systemic circulation"],
        "answer": 0,
        "correctAnswer": "Absence in arteries, presence in veins to prevent backflow",
        "explanation": "Veins have valves to prevent backflow, arteries do not, per 'Circulatory S.ppt'. Capillaries/arteries lack valves, and systemic veins have them."
    },
    {
        "question": "Aortic dissection often occurs at the arch. Which structure is in the superior mediastinum near the arch?",
        "options": ["Thoracic duct", "Esophagus", "Arch of the aorta", "Inferior vena cava", "Diaphragm"],
        "answer": 2,
        "correctAnswer": "Arch of the aorta",
        "explanation": "The aortic arch is in the superior mediastinum, per 'Circulatory S.ppt'. Thoracic duct/esophagus are posterior, IVC is inferior/abdominal, and diaphragm is below."
    },
    {
        "question": "In agranulocytosis, which WBC types are reduced, affecting innate immunity?",
        "options": ["Granulocytes: neutrophils, eosinophils, basophils", "Agranulocytes: monocytes, lymphocytes", "Only platelets", "Red blood cells", "Natural killer cells only"],
        "answer": 0,
        "correctAnswer": "Granulocytes: neutrophils, eosinophils, basophils",
        "explanation": "Agranulocytosis reduces granulocytes (neutrophils, eosinophils, basophils), impacting innate immunity, per 'Circulatory S.ppt'. Agranulocytes are monocytes/lymphocytes, platelets/RBCs are not WBCs, and NK cells are lymphocytes."
    },
    {
        "question": "A patient with mitral regurgitation has backflow during systole. Which pressure change causes this?",
        "options": ["Ventricular pressure > atrial during diastole", "Atrial pressure > ventricular during systole", "Ventricular pressure > arterial during diastole", "Ventricular pressure > atrial during systole", "Arterial pressure > ventricular during systole"],
        "answer": 3,
        "correctAnswer": "Ventricular pressure > atrial during systole",
        "explanation": "Mitral regurgitation occurs when ventricular pressure exceeds atrial during systole, but the valve is incompetent, per 'Circulatory S.ppt'. Diastole opens AV valves, arterial pressure affects semilunar."
    },
    {
        "question": "Occlusion of the radial artery after trauma. Which anastomosis in the palm might provide collateral flow?",
        "options": ["Superficial and deep palmar arches", "Plantar arch", "Dorsal pedal arch", "Popliteal bifurcation", "Cubital fossa connection"],
        "answer": 0,
        "correctAnswer": "Superficial and deep palmar arches",
        "explanation": "Radial and ulnar arteries form superficial and deep palmar arches for collateral flow, per 'CVS (Overview).pptx'. Plantar/dorsal pedal are foot, popliteal is knee, and cubital is venous."
    },
    {
        "question": "In lymphoma, enlarged cervical lymph nodes are palpated. Which group is this?",
        "options": ["Popliteal", "Inguinal", "Lumbar", "Cervical", "Axillary"],
        "answer": 3,
        "correctAnswer": "Cervical",
        "explanation": "Cervical lymph nodes are in the neck, enlarged in lymphoma, per 'Circulatory S.ppt'. Popliteal in knee, inguinal in groin, lumbar in abdomen, axillary in armpit."
    },
    {
        "question": "A patient with basilar artery occlusion has brainstem infarction. How is the basilar formed?",
        "options": ["Union of internal carotids", "Union of vertebral arteries", "Branch from subclavian", "From common carotid", "From aortic arch"],
        "answer": 1,
        "correctAnswer": "Union of vertebral arteries",
        "explanation": "The basilar artery forms from vertebral arteries, per 'Circulatory S.ppt'. Carotids supply anterior brain, subclavian gives vertebral, and aortic arch gives larger branches."
    },
    {
        "question": "In thrombocytopenia, low platelets affect which blood function?",
        "options": ["Oxygen transport", "Immune protection", "Clotting", "pH regulation", "Nutrient transport"],
        "answer": 2,
        "correctAnswer": "Clotting",
        "explanation": "Platelets enable clotting, per 'Circulatory S.ppt'. Oxygen is RBCs, immunity is WBCs, pH/nutrients are plasma."
    },
    {
        "question": "During CPR, compression depth targets the sternum at which level to pump blood from the heart?",
        "options": ["Jugular notch", "Sternal angle (2nd rib)", "Mid-sternum (4th-5th costal)", "Xiphoid process", "Apex at 5th intercostal"],
        "answer": 2,
        "correctAnswer": "Mid-sternum (4th-5th costal)",
        "explanation": "CPR compresses mid-sternum where right ventricle lies, per 'CVS (Overview).pptx'. Jugular is too high, sternal angle is 2nd rib, xiphoid risks liver, apex is lateral."
    },
    {
        "question": "A patient with superior vena cava syndrome has facial edema. Which veins drain into SVC?",
        "options": ["Common iliac", "Brachiocephalic", "Portal", "Hepatic", "Renal"],
        "answer": 1,
        "correctAnswer": "Brachiocephalic",
        "explanation": "Brachiocephalic veins drain into SVC, causing edema in SVC syndrome, per 'CVS (Overview).pptx'. Iliac/hepatic/renal to IVC, portal to liver."
    },
    {
        "question": "In sinusoids of the liver, what feature allows for exchange between blood and hepatocytes?",
        "options": ["Tight junctions", "Large fenestrations and incomplete basement", "Smooth muscle walls", "Valves", "Endothelial lining only"],
        "answer": 1,
        "correctAnswer": "Large fenestrations and incomplete basement",
        "explanation": "Liver sinusoids have large fenestrations and incomplete basement for exchange, per 'Circulatory S.ppt'. Tight junctions in continuous, smooth muscle in arterioles, valves in veins, all have endothelium."
    },
    {
        "question": "A brachial artery laceration in the cubital fossa affects which branches?",
        "options": ["Radial and ulnar", "Axillary and subclavian", "Femoral and popliteal", "Tibial and fibular", "Carotid and vertebral"],
        "answer": 0,
        "correctAnswer": "Radial and ulnar",
        "explanation": "Brachial artery divides into radial and ulnar in cubital fossa, per 'CVS (Overview).pptx'. Others are unrelated regions."
    },
    {
        "question": "In cardiac tamponade, needle aspiration is safest at which site to avoid pleura?",
        "options": ["Left 5th intercostal midclavicular", "Right 2nd intercostal sternal", "Subxiphoid left of xiphisternal junction", "Jugular notch", "Midaxillary 4th intercostal"],
        "answer": 2,
        "correctAnswer": "Subxiphoid left of xiphisternal junction",
        "explanation": "Subxiphoid approach avoids pleura for pericardiocentesis, per clinical adaptation and 'Circulatory S.ppt'. Other sites risk lung/vessel puncture."
    },
    {
        "question": "The thoracic aorta branches include bronchial arteries for what?",
        "options": ["Pericardium", "Lungs systemic circulation", "Esophagus", "Intercostals", "Phrenic"],
        "answer": 1,
        "correctAnswer": "Lungs systemic circulation",
        "explanation": "Bronchial arteries supply systemic circulation to lungs, per 'Circulatory S.ppt'. Others supply respective structures."
    },
    {
        "question": "A patient with ulnar nerve palsy has weak grip. Which artery supplies the medial forearm?",
        "options": ["Radial", "Brachial", "Ulnar", "Axillary", "Subclavian"],
        "answer": 2,
        "correctAnswer": "Ulnar",
        "explanation": "Ulnar artery supplies medial forearm, per 'CVS (Overview).pptx'. Radial is lateral, brachial is arm, axillary/subclavian are proximal."
    },
    {
        "question": "In the inferior vena cava, which tributary corresponds to the gonadal arteries?",
        "options": ["Lumbar veins", "Renal veins", "Right and left testicular/ovarian veins", "Inferior phrenic veins", "Median sacral vein"],
        "answer": 2,
        "correctAnswer": "Right and left testicular/ovarian veins",
        "explanation": "Testicular/ovarian veins drain to IVC, corresponding to gonadal arteries, per 'CVS (Overview).pptx'. Others drain different regions."
    },
    {
        "question": "A complete heart block on ECG suggests damage to bundle branches. Which artery supplies the septum where bundles run?",
        "options": ["Left circumflex", "Right coronary", "Anterior interventricular", "Posterior interventricular", "Obtuse marginal"],
        "answer": 2,
        "correctAnswer": "Anterior interventricular",
        "explanation": "Anterior interventricular (LAD) supplies septum with bundle branches, per clinical adaptation and 'Circulatory S.ppt'. Others supply lateral/posterior regions."
    },
    {
        "question": "The serous pericardium has two layers; which adheres to the heart?",
        "options": ["Parietal layer", "Fibrous layer", "Visceral layer", "Epicardial layer", "Endocardial layer"],
        "answer": 2,
        "correctAnswer": "Visceral layer",
        "explanation": "Visceral serous pericardium adheres to the heart, per 'Circulatory S.ppt'. Parietal lines fibrous, fibrous is outer, epicardial is synonymous, endocardial is inner lining."
    },
    {
        "question": "In pulmonary embolism, blockage in pulmonary arteries affects which circulation?",
        "options": ["Systemic", "Coronary", "Cerebral", "Pulmonary", "Hepatic portal"],
        "answer": 3,
        "correctAnswer": "Pulmonary",
        "explanation": "Pulmonary embolism affects pulmonary circulation, per 'Circulatory S.ppt'. Others are unrelated circulations."
    },
    {
        "question": "A low hemoglobin level indicates anemia. What shape optimizes oxygen exchange in RBCs?",
        "options": ["Spherical", "Biconcave disc", "Oval fragment", "Granular sphere", "Cylindrical"],
        "answer": 1,
        "correctAnswer": "Biconcave disc",
        "explanation": "RBCs are biconcave discs for optimal oxygen exchange, per 'Circulatory S.ppt'. Spherical reduces area, oval fragments are platelets, granular is WBCs, cylindrical is not RBC."
    },
    {
        "question": "In the tunica media of muscular arteries, what allows vasoconstriction?",
        "options": ["Endothelium", "Elastic fibers only", "Smooth muscle fibers", "Collagen fibers", "Vasa vasorum"],
        "answer": 2,
        "correctAnswer": "Smooth muscle fibers",
        "explanation": "Smooth muscle in tunica media allows vasoconstriction, per 'Circulatory S.ppt'. Endothelium is intima, elastic in elastic arteries, collagen in adventitia, vasa vasorum supply."
    },
    {
        "question": "A vertebral artery dissection causes Wallenberg syndrome. Where does it enter the cranium?",
        "options": ["Carotid canal", "Foramen magnum", "Jugular foramen", "Transverse foramen", "Aortic hiatus"],
        "answer": 1,
        "correctAnswer": "Foramen magnum",
        "explanation": "Vertebral artery enters cranium via foramen magnum, per 'Circulatory S.ppt'. Carotid canal for carotid, jugular for vein, transverse for neck ascent, aortic hiatus for aorta."
    },
    {
        "question": "In abdominal aortic aneurysm, which paired branch supplies the adrenals?",
        "options": ["Inferior phrenic", "Middle suprarenal", "Renal", "Gonadal", "Median sacral"],
        "answer": 1,
        "correctAnswer": "Middle suprarenal",
        "explanation": "Middle suprarenal arteries supply adrenals, per 'CVS (Overview).pptx'. Phrenic for diaphragm, renal for kidneys, gonadal for gonads, median sacral is unpaired."
    },
    {
        "question": "Azygos vein dilation in IVC obstruction compresses which structure?",
        "options": ["Trachea", "Esophagus", "Thoracic duct", "Descending aorta", "Phrenic nerve"],
        "answer": 2,
        "correctAnswer": "Thoracic duct",
        "explanation": "Azygos vein dilation compresses thoracic duct in posterior mediastinum, per clinical adaptation and 'Circulatory S.ppt'. Trachea/esophagus/aorta/phrenic are not adjacent."
    },
    {
        "question": "Elevated right ventricular pressure in cor pulmonale suggests stenosis of which valve?",
        "options": ["Mitral", "Tricuspid", "Aortic", "Pulmonary", "Bicuspid"],
        "answer": 3,
        "correctAnswer": "Pulmonary",
        "explanation": "Pulmonary valve stenosis increases right ventricular pressure, per 'Circulatory S.ppt'. Mitral/bicuspid are left, tricuspid is inlet, aortic is left-sided."
    },
    {
        "question": "In the xiphoid area, a tricuspid stenosis murmur is heard. How many cusps does the tricuspid have?",
        "options": ["2", "3", "4", "1", "None"],
        "answer": 1,
        "correctAnswer": "3",
        "explanation": "Tricuspid valve has three cusps, per 'Circulatory S.ppt'. Mitral has two, semilunar have three, not four/one/none."
    },
    {
        "question": "A femoral artery aneurysm risks which continuation distal to inguinal ligament?",
        "options": ["External iliac", "Popliteal", "Anterior tibial", "Posterior tibial", "Dorsal pedal"],
        "answer": 1,
        "correctAnswer": "Popliteal",
        "explanation": "Femoral artery continues as popliteal distal to inguinal ligament, per 'CVS (Overview).pptx'. External iliac is proximal, tibial/dorsal pedal are distal."
    },
    {
        "question": "In the conducting system, the impulse from SA node reaches AV node, then bundles. What happens if AV node is blocked?",
        "options": ["Atrial fibrillation", "Ventricular asystole", "Heart block", "Tachycardia", "Bradycardia only"],
        "answer": 2,
        "correctAnswer": "Heart block",
        "explanation": "AV node block causes heart block, disrupting ventricular conduction, per 'Circulatory S.ppt'. AFib is atrial, asystole is complete stop, tachycardia/bradycardia are rates."
    },
    {
        "question": "A patient with Kaposi's sarcoma has sinusoids in affected tissues. What distinguishes sinusoids from other capillaries?",
        "options": ["Continuous endothelium", "Fenestrated with holes", "Large fenestrations, incomplete basement", "Smooth muscle presence", "Valve structures"],
        "answer": 2,
        "correctAnswer": "Large fenestrations, incomplete basement",
        "explanation": "Sinusoids have large fenestrations and incomplete basement, per 'Circulatory S.ppt'. Continuous lack holes, fenestrated have holes, no smooth muscle/valves in capillaries."
    }
]
        

;

        // DOM Elements
        let body = document.body;
        let questionElement = document.getElementById('question');
        let optionsContainer = document.getElementById('options-container');
        let currentQuestionElement = document.getElementById('current-question');
        let totalQuestionsElement = document.getElementById('total-questions');
        let progressBar = document.getElementById('progress-bar');
        let prevButton = document.getElementById('prev-btn');
        let nextButton = document.getElementById('next-btn');
        let feedbackElement = document.getElementById('feedback');
        let timerElement = document.getElementById('timer');
        let scoreElement = document.getElementById('score');
        let streakElement = document.getElementById('streak');
        let categoryElement = document.getElementById('category');
        let explanationContainer = document.getElementById('explanation-container');
        let explanationTextElement = document.getElementById('explanation-text');
        let themeToggle = document.getElementById('theme-toggle');
        let soundToggle = document.getElementById('sound-toggle');
        let bookmarkBtn = document.getElementById('bookmark-btn');
        let bookmarksCount = document.getElementById('bookmarks-count');
        let categoryTag = document.getElementById('category-tag');
        let difficultyTag = document.getElementById('difficulty-tag');
        let showExplanationBtn = document.getElementById('show-explanation-btn');

        // Quiz state
        let currentQuestionIndex = 0;
        let score = 0;
        let streak = 0;
        let selectedOption = null;
        let timeStarted = null;
        let timerInterval = null;
        let timeElapsed = 0;
        let answers = [];
        let soundsEnabled = true;
        let bookmarkedQuestions = [];
        let quizHistory = [];
        let performanceMetrics = {
            categories: {},
            difficulties: { Easy: 0, Medium: 0, Hard: 0 },
            totalCorrect: 0,
            totalQuestions: 0
        };

        function initQuiz() {
            // Reset DOM elements
            scoreElement.textContent = score;
            streakElement.textContent = streak;
            timerElement.textContent = '00:00';
            totalQuestionsElement.textContent = questions.length;
            
            loadQuestion();
            startTimer();
            
            // Remove existing event listeners to prevent duplicates
            const prevBtnClone = prevButton.cloneNode(true);
            prevButton.parentNode.replaceChild(prevBtnClone, prevButton);
            const nextBtnClone = nextButton.cloneNode(true);
            nextButton.parentNode.replaceChild(nextBtnClone, nextButton);
            const themeToggleClone = themeToggle.cloneNode(true);
            themeToggle.parentNode.replaceChild(themeToggleClone, themeToggle);
            const soundToggleClone = soundToggle.cloneNode(true);
            soundToggle.parentNode.replaceChild(soundToggleClone, soundToggle);
            const bookmarkBtnClone = bookmarkBtn.cloneNode(true);
            bookmarkBtn.parentNode.replaceChild(bookmarkBtnClone, bookmarkBtn);
            const showExplanationBtnClone = showExplanationBtn.cloneNode(true);
            showExplanationBtn.parentNode.replaceChild(showExplanationBtnClone, showExplanationBtn);

            // Reassign DOM elements after cloning
            prevButton = document.getElementById('prev-btn');
            nextButton = document.getElementById('next-btn');
            themeToggle = document.getElementById('theme-toggle');
            soundToggle = document.getElementById('sound-toggle');
            bookmarkBtn = document.getElementById('bookmark-btn');
            showExplanationBtn = document.getElementById('show-explanation-btn');

            // Add event listeners
            prevButton.addEventListener('click', goToPreviousQuestion);
            nextButton.addEventListener('click', goToNextQuestion);
            themeToggle.addEventListener('click', toggleTheme);
            soundToggle.addEventListener('click', toggleSound);
            bookmarkBtn.addEventListener('click', toggleBookmark);
            showExplanationBtn.addEventListener('click', toggleExplanation);
            
            // Keyboard navigation
            document.removeEventListener('keydown', handleKeydown);
            document.addEventListener('keydown', handleKeydown);
            
            loadPreferences();
            loadQuizHistory();
            updateBookmarksCount();
        }

        function handleKeydown(e) {
            if (e.key === 'ArrowRight') {
                goToNextQuestion();
            } else if (e.key === 'ArrowLeft') {
                goToPreviousQuestion();
            } else if (e.key.toLowerCase() === 'a' || e.key === '1') {
                selectOption(0);
            } else if (e.key.toLowerCase() === 'b' || e.key === '2') {
                selectOption(1);
            } else if (e.key.toLowerCase() === 'c' || e.key === '3') {
                selectOption(2);
            } else if (e.key.toLowerCase() === 'd' || e.key === '4') {
                selectOption(3);
            } else if (e.key === 'Enter') {
                if (showExplanationBtn.style.display !== 'none') {
                    toggleExplanation();
                }
            }
        }

        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            questionElement.textContent = question.question;
            currentQuestionElement.textContent = currentQuestionIndex + 1;
            categoryTag.textContent = question.category || 'Unknown';
            difficultyTag.textContent = question.difficulty || 'Medium';
            categoryElement.textContent = question.category || 'All';
            
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            optionsContainer.innerHTML = '';
            
            const optionLetters = ['A', 'B', 'C', 'D', 'E'];
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option', 'bounce-in');
                optionElement.setAttribute('role', 'button');
                optionElement.setAttribute('tabindex', '0');
                optionElement.setAttribute('aria-label', `Option ${optionLetters[index]}: ${option}`);
                
                const optionLetter = document.createElement('div');
                optionLetter.classList.add('option-letter');
                optionLetter.textContent = optionLetters[index];
                
                const optionText = document.createElement('div');
                optionText.classList.add('option-text');
                optionText.textContent = option;
                
                optionElement.appendChild(optionLetter);
                optionElement.appendChild(optionText);
                
                optionElement.addEventListener('click', () => selectOption(index));
                optionElement.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        selectOption(index);
                    }
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            prevButton.disabled = currentQuestionIndex === 0;
            nextButton.textContent = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz' : 'Next Question';
            
            feedbackElement.style.display = 'none';
            showExplanationBtn.style.display = 'none';
            explanationContainer.classList.remove('expanded');
            
            selectedOption = null;
            
            // If the question was previously answered or skipped, display the feedback
            if (answers[currentQuestionIndex]) {
                const ans = answers[currentQuestionIndex];
                const options = document.querySelectorAll('.option');
                feedbackElement.style.display = 'flex';
                showExplanationBtn.style.display = 'block';
                explanationTextElement.textContent = question.explanation;
                options.forEach(option => option.style.pointerEvents = 'none');
                
                if (ans.selected === 'Skipped') {
                    selectedOption = null;
                    feedbackElement.classList.add('incorrect');
                    feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
                    options[question.answer].classList.add('correct');
                } else {
                    const optIndex = question.options.findIndex(opt => opt === ans.selected);
                    if (optIndex !== -1) {
                        selectedOption = optIndex;
                        options[optIndex].classList.add('selected');
                        if (ans.isCorrect) {
                            feedbackElement.classList.add('correct');
                            feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                        } else {
                            feedbackElement.classList.add('incorrect');
                            feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                            options[question.answer].classList.add('correct');
                        }
                    }
                }
            }
            
            updateBookmarkStatus();
        }

        function selectOption(index) {
            if (selectedOption !== null || answers[currentQuestionIndex]) return;
            
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            selectedOption = index;
            
            const question = questions[currentQuestionIndex];
            const isCorrect = index === question.answer;
            
            feedbackElement.style.display = 'flex';
            if (isCorrect) {
                feedbackElement.classList.remove('incorrect');
                feedbackElement.classList.add('correct');
                feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                score += getScoreForDifficulty(question.difficulty);
                streak++;
                playSound('correct');
            } else {
                feedbackElement.classList.remove('correct');
                feedbackElement.classList.add('incorrect');
                feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                options[question.answer].classList.add('correct');
                streak = 0;
                playSound('incorrect');
            }
            
            scoreElement.textContent = score;
            streakElement.textContent = streak;
            
            explanationTextElement.textContent = question.explanation;
            showExplanationBtn.style.display = 'block';
            
            answers[currentQuestionIndex] = {
                question: question.question,
                selected: question.options[index],
                correct: question.options[question.answer],
                isCorrect: isCorrect,
                explanation: question.explanation,
                category: question.category,
                difficulty: question.difficulty
            };
            
            updatePerformanceMetrics(isCorrect, question);
            
            options.forEach(option => option.style.pointerEvents = 'none');
        }

        function maybeHandleSkip() {
            if (!answers[currentQuestionIndex] && selectedOption === null) {
                const question = questions[currentQuestionIndex];
                answers[currentQuestionIndex] = {
                    question: question.question,
                    selected: 'Skipped',
                    correct: question.options[question.answer],
                    isCorrect: false,
                    explanation: question.explanation,
                    category: question.category,
                    difficulty: question.difficulty
                };
                updatePerformanceMetrics(false, question);
                streak = 0;
                streakElement.textContent = streak;
            }
        }

        function toggleExplanation() {
            explanationContainer.classList.toggle('expanded');
            showExplanationBtn.innerHTML = explanationContainer.classList.contains('expanded') ?
                '<i class="fas fa-info-circle"></i> Hide Explanation' :
                '<i class="fas fa-info-circle"></i> Show Explanation';
        }

        function getScoreForDifficulty(difficulty) {
            switch (difficulty) {
                case 'Easy': return 5;
                case 'Medium': return 10;
                case 'Hard': return 15;
                default: return 10;
            }
        }

        function updatePerformanceMetrics(isCorrect, question) {
            performanceMetrics.totalQuestions++;
            if (isCorrect) performanceMetrics.totalCorrect++;
            
            performanceMetrics.categories[question.category] = performanceMetrics.categories[question.category] || { correct: 0, total: 0 };
            performanceMetrics.categories[question.category].total++;
            if (isCorrect) performanceMetrics.categories[question.category].correct++;
            
            performanceMetrics.difficulties[question.difficulty] = performanceMetrics.difficulties[question.difficulty] || 0;
            if (isCorrect) performanceMetrics.difficulties[question.difficulty]++;
        }

        function toggleBookmark() {
            const questionId = questions[currentQuestionIndex].id;
            const index = bookmarkedQuestions.indexOf(questionId);
            if (index === -1) {
                bookmarkedQuestions.push(questionId);
                bookmarkBtn.classList.add('bookmarked');
            } else {
                bookmarkedQuestions.splice(index, 1);
                bookmarkBtn.classList.remove('bookmarked');
            }
            updateBookmarksCount();
            saveBookmarks();
        }

        function updateBookmarkStatus() {
            const questionId = questions[currentQuestionIndex].id;
            bookmarkBtn.classList.toggle('bookmarked', bookmarkedQuestions.includes(questionId));
        }

        function updateBookmarksCount() {
            bookmarksCount.textContent = bookmarkedQuestions.length;
        }

        function goToNextQuestion() {
            maybeHandleSkip();
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                showResults();
                saveQuizHistory();
            }
        }

        function goToPreviousQuestion() {
            maybeHandleSkip();
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function startTimer() {
            timeStarted = new Date();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            timeElapsed++;
            
            const minutes = Math.floor(timeElapsed / 60).toString().padStart(2, '0');
            const seconds = (timeElapsed % 60).toString().padStart(2, '0');
            timerElement.textContent = `${minutes}:${seconds}`;
            
            // Optional: Add warning color for long durations (e.g., after 5 minutes)
            if (timeElapsed >= 300) {
                timerElement.style.color = 'var(--danger)';
                timerElement.classList.add('pulse');
            } else {
                timerElement.style.color = 'var(--primary)';
                timerElement.classList.remove('pulse');
            }
        }

        function showResults() {
            clearInterval(timerInterval);
            
            const quizContainer = document.querySelector('.quiz-container');
            const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
            const percentage = ((score / maxScore) * 100).toFixed(1);
            const categoryStats = Object.entries(performanceMetrics.categories)
                .map(([category, stats]) => `${category}: ${((stats.correct / stats.total) * 100).toFixed(1)}%`)
                .join(', ');
            
            quizContainer.innerHTML = `
                <div class="results-container">
                    <h2 class="quiz-title">Quiz Completed!</h2>
                    <p class="quiz-subtitle">You've finished the embryology quiz</p>
                    
                    <div class="score-circle" style="--p: ${percentage}%">
                        <div class="score-text">
                            <div class="score-value">${score}</div>
                            <div class="score-label">Points</div>
                        </div>
                    </div>
                    
                    <div class="results-stats">
                        <div class="result-stat">
                            <div class="result-stat-value">${percentage}%</div>
                            <div class="result-stat-label">Accuracy</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${timeElapsed}s</div>
                            <div class="result-stat-label">Time Taken</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${streak}</div>
                            <div class="result-stat-label">Best Streak</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${bookmarkedQuestions.length}</div>
                            <div class="result-stat-label">Bookmarked</div>
                        </div>
                    </div>
                    
                    <div class="review-section">
                        <h3 class="review-title">Performance Analytics</h3>
                        <div class="review-item">
                            <div class="review-answer">Category Performance: ${categoryStats}</div>
                            <div class="review-answer">Difficulty Performance: Easy: ${performanceMetrics.difficulties.Easy || 0}, Medium: ${performanceMetrics.difficulties.Medium || 0}, Hard: ${performanceMetrics.difficulties.Hard || 0}</div>
                        </div>
                        
                        <h3 class="review-title">Review Your Answers</h3>
                        ${answers.map((answer, index) => `
                            <div class="review-item ${answer.isCorrect ? 'correct' : 'incorrect'}">
                                <div class="review-question">Q${index + 1}: ${answer.question} (${answer.category} - ${answer.difficulty})</div>
                                <div class="review-answer">Your Answer: ${answer.selected}</div>
                                <div class="review-answer">Correct Answer: ${answer.correct}</div>
                                <div class="review-explanation">${answer.explanation}</div>
                            </div>
                        `).join('')}
                        
                        <h3 class="review-title">Bookmarked Questions</h3>
                        ${bookmarkedQuestions.map(qid => {
                            const question = questions.find(q => q.id === qid);
                            return `
                                <div class="review-item">
                                    <div class="review-question">${question.question} (${question.category} - ${question.difficulty})</div>
                                    <div class="review-answer">Correct Answer: ${question.correctAnswer}</div>
                                    <div class="review-explanation">${question.explanation}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <button class="btn btn-primary mt-4" id="restart-btn">
                        <i class="fas fa-redo"></i> Try Again
                    </button>
                </div>
            `;
            
            document.getElementById('restart-btn').addEventListener('click', restartQuiz);
        }

        function restartQuiz() {
            // Reset quiz state
            currentQuestionIndex = 0;
            score = 0;
            streak = 0;
            timeElapsed = 0;
            answers = [];
            selectedOption = null;
            performanceMetrics = {
                categories: {},
                difficulties: { Easy: 0, Medium: 0, Hard: 0 },
                totalCorrect: 0,
                totalQuestions: 0
            };
            
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            // Reset DOM
            const quizContainer = document.querySelector('.quiz-container');
            quizContainer.innerHTML = `
                <div class="quiz-header">
                    <div>
                        <h1 class="quiz-title">Advanced Embryology Quiz</h1>
                        <p class="quiz-subtitle">Test your knowledge with professional questions and detailed explanations</p>
                    </div>
                    <div class="stats-container">
                        <div class="stat">
                            <span class="stat-value" id="score">0</span>
                            <span class="stat-label">Score</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="timer">00:00</span>
                            <span class="stat-label">Time</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="streak">0</span>
                            <span class="stat-label">Streak</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="category">All</span>
                            <span class="stat-label">Category</span>
                        </div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
                </div>

                <div class="question-meta">
                    <div class="question-tags">
                        <span class="tag" id="category-tag">Neuro</span>
                        <span class="tag" id="difficulty-tag">Medium</span>
                    </div>
                    <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                        <i class="fas fa-bookmark"></i>
                    </button>
                </div>
                <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">10</span></div>
                <div class="question-text" id="question"></div>

                <div class="options-grid" id="options-container"></div>

                <div class="feedback correct" id="feedback" style="display: none;">
                    <i class="fas fa-check-circle feedback-icon"></i>
                    <div class="feedback-text">Correct! Well done.</div>
                </div>

                <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                    <i class="fas fa-info-circle"></i> Show Explanation
                </button>

                <div class="explanation-container" id="explanation-container">
                    <div class="explanation">
                        <div class="explanation-title">Explanation:</div>
                        <div id="explanation-text"></div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="btn btn-secondary" id="prev-btn" disabled>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-primary" id="next-btn">
                        Next Question <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            `;
            
            // Reinitialize DOM elements
            questionElement = document.getElementById('question');
            optionsContainer = document.getElementById('options-container');
            currentQuestionElement = document.getElementById('current-question');
            totalQuestionsElement = document.getElementById('total-questions');
            progressBar = document.getElementById('progress-bar');
            prevButton = document.getElementById('prev-btn');
            nextButton = document.getElementById('next-btn');
            feedbackElement = document.getElementById('feedback');
            timerElement = document.getElementById('timer');
            scoreElement = document.getElementById('score');
            streakElement = document.getElementById('streak');
            categoryElement = document.getElementById('category');
            explanationContainer = document.getElementById('explanation-container');
            explanationTextElement = document.getElementById('explanation-text');
            bookmarkBtn = document.getElementById('bookmark-btn');
            bookmarksCount = document.getElementById('bookmarks-count');
            categoryTag = document.getElementById('category-tag');
            difficultyTag = document.getElementById('difficulty-tag');
            showExplanationBtn = document.getElementById('show-explanation-btn');
            
            // Reinitialize the quiz
            initQuiz();
        }

        function toggleTheme() {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 
                            currentTheme === 'light' ? 'minimal' : 'dark';
            
            body.setAttribute('data-theme', newTheme);
            themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-moon"></i>' : 
                                  newTheme === 'light' ? '<i class="fas fa-sun"></i>' : 
                                  '<i class="fas fa-paint-brush"></i>';
            
            localStorage.setItem('theme', newTheme);
        }

        function toggleSound() {
            soundsEnabled = !soundsEnabled;
            soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
            
            localStorage.setItem('soundsEnabled', soundsEnabled);
        }

        function playSound(type) {
            if (!soundsEnabled) return;
            console.log(`Playing ${type} sound`);
        }

        function loadPreferences() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                body.setAttribute('data-theme', savedTheme);
                themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-moon"></i>' : 
                                      savedTheme === 'light' ? '<i class="fas fa-sun"></i>' : 
                                      '<i class="fas fa-paint-brush"></i>';
            }
            
            const savedSounds = localStorage.getItem('soundsEnabled');
            if (savedSounds !== null) {
                soundsEnabled = savedSounds === 'true';
                soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
            }
        }

        function saveBookmarks() {
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarkedQuestions));
        }

        function loadQuizHistory() {
            const saved = localStorage.getItem('quizHistory');
            if (saved) {
                quizHistory = JSON.parse(saved);
            }
            loadBookmarks();
        }

        function saveQuizHistory() {
            quizHistory.push({
                timestamp: new Date().toISOString(),
                score: score,
                percentage: ((score / (questions.length * 15)) * 100).toFixed(1),
                timeSpent: timeElapsed,
                streak: streak,
                answers: answers,
                performanceMetrics: performanceMetrics
            });
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
        }

        function loadBookmarks() {
            const saved = localStorage.getItem('bookmarkedQuestions');
            if (saved) {
                bookmarkedQuestions = JSON.parse(saved);
            }
        }

        window.addEventListener('DOMContentLoaded', initQuiz);
    </script>
</body>
</html>