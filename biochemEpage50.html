<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MED QUIZ Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #f72585;
            --success: #4cc9f0;
            --warning: #f9c74f;
            --danger: #f94144;
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f5;
            --gray-800: #343a40;
            --gray-900: #212529;
            --bg-primary: var(--gray-900);
            --bg-secondary: #1a1d21;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --card-bg: rgba(35, 39, 47, 0.95);
            --card-border: #4cc9f0;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --transition: all 0.2s ease-in-out;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --header-height: 50px;
            --max-width: 800px;
            --side-padding: 1rem;
            --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
        }

        [data-theme="light"] {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --text-primary: #1a1d21;
            --text-secondary: rgba(26, 29, 33, 0.7);
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            line-height: 1.5;
            font-weight: 400;
            overflow-x: hidden;
            padding: 0;
        }

        /* Compact Header */
        header {
            height: var(--header-height);
            background: var(--gradient-primary);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--side-padding);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            color: white;
        }

        .logo-icon {
            font-size: 1.25rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 1.5rem var(--side-padding);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .quiz-container {
            width: 100%;
            max-width: var(--max-width);
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 1px solid var(--card-border);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .quiz-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .quiz-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .stats-container {
            display: flex;
            gap: 0.75rem;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            min-width: 60px;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1rem;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius-md);
            overflow: hidden;
            margin: 1.5rem 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            transition: width 0.4s ease;
        }

        /* Question Meta */
        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            padding: 0.25rem 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .difficulty-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .difficulty-easy { background-color: var(--success); }
        .difficulty-medium { background-color: var(--warning); }
        .difficulty-hard { background-color: var(--danger); }

        .bookmark-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .bookmark-btn.bookmarked {
            color: var(--warning);
        }

        /* Question */
        .question-number {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            text-align: center;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            border-color: var(--primary-light);
        }

        .option.selected {
            background: rgba(67, 97, 238, 0.15);
            border-color: var(--primary);
        }

        .option.correct {
            background: rgba(76, 201, 240, 0.15);
            border-color: var(--success);
        }

        .option.incorrect {
            background: rgba(249, 65, 68, 0.15);
            border-color: var(--danger);
        }

        .option-letter {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--danger);
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 0.95rem;
        }

        /* Feedback */
        .feedback {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
        }

        .feedback.correct {
            background: rgba(76, 201, 240, 0.15);
            color: var(--success);
        }

        .feedback.incorrect {
            background: rgba(249, 65, 68, 0.15);
            color: var(--danger);
        }

        .feedback.skipped {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary);
        }

        .feedback-icon {
            font-size: 1.25rem;
        }

        /* Explanation */
        .explanation-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .explanation-container.expanded {
            max-height: 500px;
        }

        .explanation {
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .explanation-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            font-size: 0.9rem;
            flex: 1;
            justify-content: center;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255,255,255,0.2);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Study Mode Toggle */
        .study-mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            justify-content: center;
            font-size: 0.9rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Results */
        .results-container {
            text-align: center;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: conic-gradient(var(--gradient-primary) 0% var(--p, 0%), var(--bg-secondary) var(--p, 0%) 100%);
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--card-bg);
        }

        .score-text {
            position: relative;
            z-index: 1;
        }

        .score-value {
            font-size: 1.75rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .result-stat {
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
        }

        .result-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .result-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .review-section {
            margin-top: 2rem;
            text-align: left;
        }

        .review-title {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary);
            text-align: center;
        }

        .review-item {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            background: rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }

        .review-item.correct {
            border-left: 3px solid var(--success);
        }

        .review-item.incorrect {
            border-left: 3px solid var(--danger);
        }

        .review-item.skipped {
            border-left: 3px solid var(--primary);
        }

        .review-question {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .review-answer {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
        }

        .review-explanation {
            color: var(--text-secondary);
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        footer {
            padding: 2rem var(--side-padding);
            background: var(--bg-secondary);
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            margin-top: auto;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal {
            background: var(--card-bg);
            border-radius: var(--radius-2xl);
            padding: 2.5rem;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: translateY(-50px) scale(0.95);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--card-border);
        }
        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-base);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: rgba(255,255,255,0.1);
            color: var(--primary);
        }
        .modal-body {
            margin-bottom: 2rem;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        .difficulty-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.75rem;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .difficulty-easy {
            background-color: var(--success);
            box-shadow: 0 0 10px var(--success);
        }
        .difficulty-medium {
            background-color: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }
        .difficulty-hard {
            background-color: var(--danger);
            box-shadow: 0 0 10px var(--danger);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition-base);
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .stat-card-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .stat-card-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--gradient-primary);
            opacity: 0;
            border-radius: 2px;
        }
        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(-100px) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }
        .fab {
            position: fixed;
            bottom: 2.5rem;
            right: 2.5rem;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            box-shadow: var(--shadow-xl);
            cursor: pointer;
            z-index: 100;
            transition: var(--transition-smooth);
            border: 3px solid rgba(255,255,255,0.2);
        }
        .fab:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 20px 40px rgba(67, 97, 238, 0.3);
        }
        .study-mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-lg);
            justify-content: center;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .toggle-slider {
            background-color: var(--primary);
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.5);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(32px);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease;
        }
        .pulse {
            animation: pulse 1s infinite;
        }
        .bounce-in {
            animation: bounceIn 0.6s ease;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        .text-center {
            text-align: center;
        }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .full-width {
            width: 100%;
        }
        @media (max-width: 768px) {
            :root {
                --side-padding: 1rem;
                --header-height: 50px;
            }
            .quiz-container {
                padding: 2rem;
                border-radius: var(--radius-xl);
            }
            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.5rem;
            }
            .stats-container {
                width: 100%;
                justify-content: space-between;
            }
            .results-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .score-circle {
                width: 140px;
                height: 140px;
            }
            .score-circle::before {
                width: 110px;
                height: 110px;
            }
            .score-value {
                font-size: 2.25rem;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .fab {
                bottom: 1.5rem;
                right: 1.5rem;
                width: 55px;
                height: 55px;
                font-size: 1.5rem;
            }
            .navigation {
                flex-direction: column;
            }
            .btn {
                width: 100%;
            }
            .options-grid {
                grid-template-columns: 1fr;
            }
            .options-grid .option:nth-child(1),
            .options-grid .option:nth-child(2),
            .options-grid .option:nth-child(3),
            .options-grid .option:nth-child(4) {
                grid-column: auto;
            }
        }
        @media (max-width: 480px) {
            .option {
                padding: 1rem;
            }
            .option-letter {
                width: 32px;
                height: 32px;
                margin-right: 1rem;
            }
            .quiz-title {
                font-size: 1.5rem;
            }
            .question-text {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body data-theme="dark" data-progress="0">
    <header>
        <div class="logo">
            <i class="fas fa-brain logo-icon"></i>
            <span>MedQuiz</span>
        </div>
        <div class="header-controls">
            <button class="control-btn" id="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="control-btn" id="sound-toggle" aria-label="Toggle sound">
                <i class="fas fa-volume-up"></i>
            </button>
            <button class="control-btn" id="stats-btn" aria-label="View statistics">
                <i class="fas fa-chart-line"></i>
                <span class="badge" id="bookmarks-count">0</span>
            </button>
        </div>
    </header>
    <main>
        <div class="quiz-container">
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">MED QUIZ</h1>
                    <p class="quiz-subtitle">Test your medical knowledge</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">All</span>
                        <span class="stat-label">Category</span>
                    </div>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>
            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">Biochemistry</span>
                    <span class="tag" id="difficulty-tag">
                        <span class="difficulty-indicator difficulty-medium"></span>
                        Medium
                    </span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">15</span></div>
            <div class="question-text" id="question">Which part of the brain is responsible for coordinating skeletal muscle contractions?</div>
            <div class="options-grid" id="options-container">
                <div class="option">
                    <div class="option-letter">A</div>
                    <div class="option-text">Cerebrum</div>
                </div>
                <div class="option">
                    <div class="option-letter">B</div>
                    <div class="option-text">Cerebellum</div>
                </div>
                <div class="option">
                    <div class="option-letter">C</div>
                    <div class="option-text">Pons</div>
                </div>
                <div class="option">
                    <div class="option-letter">D</div>
                    <div class="option-text">Midbrain</div>
                </div>
            </div>
            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>
            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>
            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text">The cerebellum, located posterior to the brainstem, is the 'little brain.' It compares intended movements with actual movements to ensure smooth, coordinated skeletal muscle activity and maintain posture and balance.</div>
                </div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-danger" id="skip-btn">
                    <i class="fas fa-forward"></i> Skip
                </button>
            </div>
        </div>
    </main>
    <div class="fab" id="quick-actions-btn" style="display: none;">
        <i class="fas fa-bolt"></i>
    </div>
    <div class="confetti-container" id="confetti-container"></div>
    <div class="modal-overlay" id="stats-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Your Statistics</h2>
                <button class="modal-close" id="close-stats-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-total-questions">0</div>
                        <div class="stat-card-label">Total Questions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-correct-answers">0</div>
                        <div class="stat-card-label">Correct Answers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-accuracy">0%</div>
                        <div class="stat-card-label">Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-avg-time">0s</div>
                        <div class="stat-card-label">Avg. Time</div>
                    </div>
                </div>
                <h3 class="review-title">Performance by Category</h3>
                <div id="category-stats"></div>
                <h3 class="review-title mt-2">Performance by Difficulty</h3>
                <div id="difficulty-stats"></div>
                <h3 class="review-title mt-2">Quiz History</h3>
                <div id="history-stats"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-stats-btn">Close</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="quick-actions-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Quick Actions</h2>
                <button class="modal-close" id="close-actions-modal">&times;</button>
            </div>
            <div class="modal-body">
                <button class="btn btn-primary full-width mt-1" id="mark-for-review-btn">
                    <i class="fas fa-flag"></i> Mark for Review
                </button>
                <button class="btn btn-secondary full-width mt-1" id="view-explanation-btn">
                    <i class="fas fa-info-circle"></i> View Explanation
                </button>
                <button class="btn btn-success full-width mt-1" id="hint-btn">
                    <i class="fas fa-lightbulb"></i> Get a Hint
                </button>
                <button class="btn btn-danger full-width mt-1" id="report-question-btn">
                    <i class="fas fa-exclamation-triangle"></i> Report Question
                </button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-actions-btn">Close</button>
            </div>
        </div>
    </div>
    <footer>
        &copy; 2025 MedQuiz | MED Practice Platform | All Rights Reserved
    </footer>
    <script>
        const questions = [
    {
        "id": 201,
        "question": "Irreversible inhibition is characterized by:",
        "options": ["Non-covalent binding that can be easily reversed", "Tight, often covalent binding to the enzyme's active site", "Binding only to the enzyme-substrate (ES) complex", "A decrease in the apparent Vmax with no change in Km"],
        "answer": 1,
        "correctAnswer": "Tight, often covalent binding to the enzyme's active site",
        "explanation": "Irreversible inhibition typically involves covalent binding, making reversal difficult. Non-covalent binding is reversible, and ES-specific binding is uncompetitive. Errors can affect inhibition classification.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 202,
        "question": "Di-isopropyl fluorophosphate (DFP) is a classic example of an irreversible inhibitor. Its toxicity primarily arises from its ability to:",
        "options": ["Competitively inhibit acetylcholinesterase", "Covalently modify a serine residue in the active site of acetylcholinesterase", "Act as a heavy metal poison that binds to -SH groups", "Non-competitively inhibit glycoprotein peptidase"],
        "answer": 1,
        "correctAnswer": "Covalently modify a serine residue in the active site of acetylcholinesterase",
        "explanation": "DFP covalently binds to the serine residue in acetylcholinesterase’s active site, causing irreversible inhibition. It’s not competitive or a heavy metal. Errors can affect toxicology studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 203,
        "question": "Penicillin is described as a 'suicide substrate' because it:",
        "options": ["Competes with the natural substrate for the active site", "Is a substrate that gets converted by the enzyme into a reactive product that then covalently inhibits the same enzyme", "Binds to an allosteric site, inducing a conformational change that inactivates the enzyme", "Requires proteolytic activation to become an effective inhibitor"],
        "answer": 1,
        "correctAnswer": "Is a substrate that gets converted by the enzyme into a reactive product that then covalently inhibits the same enzyme",
        "explanation": "Penicillin is processed by bacterial enzymes into a reactive form that covalently inhibits them. It’s not competitive or allosteric. Errors can affect antibiotic mechanism understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 204,
        "question": "Heavy metals like Hg²⁺ and Pb²⁺ act as irreversible inhibitors primarily by:",
        "options": ["Forming covalent bonds with active site serine residues", "Competing with essential metal ion cofactors like Mg²⁺", "Binding with high affinity to sulfhydryl (-SH) groups on enzymes", "Mimicking the structure of the natural substrate"],
        "answer": 2,
        "correctAnswer": "Binding with high affinity to sulfhydryl (-SH) groups on enzymes",
        "explanation": "Heavy metals bind -SH groups, disrupting enzyme function irreversibly. They don’t mimic substrates or compete with cofactors. Errors can affect toxicology studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 205,
        "question": "The key feature that distinguishes reversible from irreversible inhibition is:",
        "options": ["The location on the enzyme where binding occurs", "The use of covalent bonds versus non-covalent interactions", "The effect on the Km of the enzyme", "The ability to be used as a drug"],
        "answer": 1,
        "correctAnswer": "The use of covalent bonds versus non-covalent interactions",
        "explanation": "Irreversible inhibition often involves covalent bonds, while reversible uses non-covalent interactions. Location and Km effects vary. Errors can affect inhibition classification.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 206,
        "question": "In competitive inhibition, the inhibitor:",
        "options": ["Binds to a site other than the active site", "Binds only to the ES complex", "Usually resembles the substrate structurally and binds to the free enzyme", "Lowers the Vmax of the reaction"],
        "answer": 2,
        "correctAnswer": "Usually resembles the substrate structurally and binds to the free enzyme",
        "explanation": "Competitive inhibitors mimic the substrate and bind the active site of free enzyme. They don’t lower Vmax. Errors can affect inhibition mechanism understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 207,
        "question": "The effect of a competitive inhibitor can be overcome by:",
        "options": ["Adding an allosteric activator", "Increasing the concentration of the substrate", "Decreasing the temperature", "Adding a non-competitive inhibitor"],
        "answer": 1,
        "correctAnswer": "Increasing the concentration of the substrate",
        "explanation": "Excess substrate outcompetes the inhibitor for the active site. Other options don’t address competitive inhibition. Errors can affect inhibition reversal studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 208,
        "question": "Statin drugs (e.g., atorvastatin) are effective because they:",
        "options": ["Irreversibly inhibit HMG-CoA reductase", "Are non-competitive inhibitors of glycoprotein peptidase", "Are structural analogs of HMG-CoA and act as competitive inhibitors of HMG-CoA reductase", "Covalently modify the active site of enzymes involved in cholesterol synthesis"],
        "answer": 2,
        "correctAnswer": "Are structural analogs of HMG-CoA and act as competitive inhibitors of HMG-CoA reductase",
        "explanation": "Statins competitively inhibit HMG-CoA reductase by mimicking HMG-CoA. They are not irreversible or non-competitive. Errors can affect pharmacology studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 209,
        "question": "In non-competitive inhibition, the inhibitor:",
        "options": ["Binds directly to the active site, competing with the substrate", "Binds to a site other than the active site, inducing a conformational change that impairs catalysis", "Binds only to the ES complex", "Increases the apparent affinity of the enzyme for the substrate (lowers Km)"],
        "answer": 1,
        "correctAnswer": "Binds to a site other than the active site, inducing a conformational change that impairs catalysis",
        "explanation": "Non-competitive inhibitors bind allosterically, reducing catalysis without affecting substrate binding. They don’t bind ES only or lower Km. Errors can affect inhibition studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 210,
        "question": "A key characteristic of non-competitive inhibition is that inhibition:",
        "options": ["Can be overcome by adding excess substrate", "Results in a decreased Km", "Results in a decreased Vmax, and Km remains unchanged", "Is always irreversible"],
        "answer": 2,
        "correctAnswer": "Results in a decreased Vmax, and Km remains unchanged",
        "explanation": "Non-competitive inhibition lowers Vmax without changing Km, as it doesn’t affect substrate binding. It’s not overcome by substrate. Errors can affect kinetics analysis.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 211,
        "question": "In uncompetitive inhibition, the inhibitor binds:",
        "options": ["Only to the free enzyme (E)", "To either the free enzyme (E) or the ES complex", "Only to the enzyme-substrate (ES) complex", "Covalently to the active site"],
        "answer": 2,
        "correctAnswer": "Only to the enzyme-substrate (ES) complex",
        "explanation": "Uncompetitive inhibitors bind only to the ES complex, not free enzyme or covalently. Errors can affect inhibition classification.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 212,
        "question": "A surprising feature of uncompetitive inhibition is that increasing the substrate concentration:",
        "options": ["Overcomes the inhibition", "Has no effect on the level of inhibition", "Actually favors the formation of the ES complex, which the inhibitor can then bind to, potentially worsening inhibition", "Converts it into competitive inhibition"],
        "answer": 2,
        "correctAnswer": "Actually favors the formation of the ES complex, which the inhibitor can then bind to, potentially worsening inhibition",
        "explanation": "More substrate increases ES complex formation, enhancing uncompetitive inhibition. It doesn’t overcome or convert inhibition. Errors can affect kinetics studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 213,
        "question": "On a Lineweaver-Burk plot, competitive inhibition is identified by:",
        "options": ["The lines for different inhibitor concentrations intersecting on the y-axis (1/Vmax unchanged)", "The lines intersecting on the x-axis (Km unchanged)", "A set of parallel lines", "The lines intersecting in the second quadrant"],
        "answer": 0,
        "correctAnswer": "The lines for different inhibitor concentrations intersecting on the y-axis (1/Vmax unchanged)",
        "explanation": "Competitive inhibition increases apparent Km but not Vmax, so lines intersect on the y-axis (1/Vmax). Errors can affect plot interpretation.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 214,
        "question": "On a Lineweaver-Burk plot, non-competitive inhibition is identified by:",
        "options": ["The lines intersecting on the y-axis", "The lines intersecting on the x-axis", "The lines intersecting to the left of the y-axis, with the same slope", "The lines for different inhibitor concentrations intersecting on the x-axis (Km unchanged)"],
        "answer": 1,
        "correctAnswer": "The lines intersecting on the x-axis",
        "explanation": "Non-competitive inhibition keeps Km unchanged but lowers Vmax, so lines intersect on the x-axis (-1/Km). Errors can affect plot analysis.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 215,
        "question": "Regulatory enzymes are often found at the first committed step of a metabolic pathway because:",
        "options": ["They are the fastest enzymes in the pathway", "This allows for the most efficient conservation of energy and prevention of intermediate buildup", "They are the only enzymes that can be inhibited", "This step is always the slowest"],
        "answer": 1,
        "correctAnswer": "This allows for the most efficient conservation of energy and prevention of intermediate buildup",
        "explanation": "Regulating the first committed step prevents wasteful intermediate accumulation. Not all are slowest or only inhibitable. Errors can affect pathway regulation studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 216,
        "question": "Allosteric enzymes are distinct because they:",
        "options": ["Are always inhibited by their substrates", "Have a regulatory site (allosteric site) distinct from the active site", "Are only regulated by covalent modification", "Cannot be activated, only inhibited"],
        "answer": 1,
        "correctAnswer": "Have a regulatory site (allosteric site) distinct from the active site",
        "explanation": "Allosteric enzymes have separate regulatory sites for effectors. They can be activated or inhibited, not just covalently modified. Errors can affect allosteric regulation understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 217,
        "question": "A classic feature of allosteric enzymes is that they often exhibit:",
        "options": ["Michaelis-Menten hyperbolic kinetics", "Sigmoidal (S-shaped) kinetics due to cooperativity between subunits", "No saturation kinetics", "A very low Km for their substrate"],
        "answer": 1,
        "correctAnswer": "Sigmoidal (S-shaped) kinetics due to cooperativity between subunits",
        "explanation": "Allosteric enzymes show sigmoidal kinetics due to cooperative subunit interactions, unlike hyperbolic Michaelis-Menten kinetics. Errors can affect kinetics studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 218,
        "question": "In the concerted model (MWC model) of allosterism, an activator binds preferentially to:",
        "options": ["The T (tense, inactive) state, stabilizing it", "The R (relaxed, active) state, stabilizing it and shifting the equilibrium toward the active form", "The ES complex only", "The free enzyme and prevents substrate binding"],
        "answer": 1,
        "correctAnswer": "The R (relaxed, active) state, stabilizing it and shifting the equilibrium toward the active form",
        "explanation": "Activators bind the R state, promoting activity. They don’t bind T state or ES only. Errors can affect allosteric model understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 219,
        "question": "Reversible covalent modification differs from allosteric regulation because it:",
        "options": ["Involves non-covalent binding of effectors", "Involves the actual covalent attachment and removal of chemical groups (e.g., phosphate) to the enzyme", "Is always irreversible", "Does not change the enzyme's activity"],
        "answer": 1,
        "correctAnswer": "Involves the actual covalent attachment and removal of chemical groups (e.g., phosphate) to the enzyme",
        "explanation": "Covalent modification (e.g., phosphorylation) alters enzyme structure covalently, unlike non-covalent allosteric regulation. It’s reversible and affects activity. Errors can affect regulation studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 220,
        "question": "The most common form of reversible covalent modification is:",
        "options": ["Methylation and demethylation", "Adenylation and deadenylation", "Phosphorylation and dephosphorylation", "Acetylation and deacetylation"],
        "answer": 2,
        "correctAnswer": "Phosphorylation and dephosphorylation",
        "explanation": "Phosphorylation/dephosphorylation is the most common covalent modification, regulating many enzymes. Other modifications are less frequent. Errors can affect regulation mechanisms.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 221,
        "question": "Phosphorylation is catalyzed by _____, while dephosphorylation is catalyzed by _____.",
        "options": ["Phosphatases; Kinases", "Kinases; Phosphatases", "Synthases; Synthetases", "Ligases; Hydrolases"],
        "answer": 1,
        "correctAnswer": "Kinases; Phosphatases",
        "explanation": "Kinases add phosphate groups, and phosphatases remove them. Other pairs are incorrect. Errors can affect enzyme regulation terminology.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 222,
        "question": "The effect of phosphorylation on an enzyme's activity is:",
        "options": ["Always activating", "Always inhibiting", "Dependent on the specific enzyme; it can be activating or inhibiting", "To make it irreversible"],
        "answer": 2,
        "correctAnswer": "Dependent on the specific enzyme; it can be activating or inhibiting",
        "explanation": "Phosphorylation’s effect varies by enzyme (e.g., activates glycogen phosphorylase, inhibits glycogen synthase). It’s not always one or irreversible. Errors can affect regulation studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 223,
        "question": "The note states that phosphorylation of glycogen phosphorylase _____ it, while phosphorylation of glycogen synthase _____ it.",
        "options": ["Activates; Activates", "Inhibits; Inhibits", "Activates; Inhibits", "Inhibits; Activates"],
        "answer": 2,
        "correctAnswer": "Activates; Inhibits",
        "explanation": "Phosphorylation activates glycogen phosphorylase (promotes glycogen breakdown) and inhibits glycogen synthase (halts glycogen synthesis). Errors can affect metabolic regulation understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 224,
        "question": "Zymogens (or proenzymes) are:",
        "options": ["Allosterically regulated enzymes", "Enzymes controlled by phosphorylation", "Inactive enzyme precursors that require proteolytic cleavage for activation", "Enzymes that are permanently inhibited"],
        "answer": 2,
        "correctAnswer": "Inactive enzyme precursors that require proteolytic cleavage for activation",
        "explanation": "Zymogens are inactive precursors activated by cleavage (e.g., trypsinogen to trypsin). They’re not allosteric or permanently inhibited. Errors can affect zymogen function understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 225,
        "question": "The purpose of synthesizing digestive enzymes like trypsin as zymogens is to:",
        "options": ["Increase their catalytic efficiency", "Prevent them from digesting the tissues of the organ that produces them", "Allow for allosteric control", "Make them more specific for their substrate"],
        "answer": 1,
        "correctAnswer": "Prevent them from digesting the tissues of the organ that produces them",
        "explanation": "Zymogens prevent autodigestion in producing tissues (e.g., pancreas). They don’t enhance efficiency or specificity. Errors can affect digestive enzyme regulation.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 226,
        "question": "The clinical measurement of enzyme levels in serum is useful because:",
        "options": ["Enzymes are only found in the blood", "Elevated levels of specific intracellular enzymes in the blood can indicate tissue damage or disease", "It directly measures the rate of metabolic pathways", "Blood enzyme levels are constant and never change"],
        "answer": 1,
        "correctAnswer": "Elevated levels of specific intracellular enzymes in the blood can indicate tissue damage or disease",
        "explanation": "Elevated intracellular enzyme levels in serum indicate tissue damage. Enzymes aren’t blood-exclusive or constant. Errors can affect diagnostic applications.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 227,
        "question": "A significantly elevated level of Creatine Kinase (CK) in serum is most strongly associated with damage to:",
        "options": ["Liver tissue", "Pancreatic tissue", "Myocardial (heart) and skeletal muscle tissue", "Bone tissue"],
        "answer": 2,
        "correctAnswer": "Myocardial (heart) and skeletal muscle tissue",
        "explanation": "Elevated CK indicates heart or skeletal muscle damage (e.g., myocardial infarction). Other tissues are less associated. Errors can affect clinical diagnostics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 228,
        "question": "Elevated levels of both AST and ALT, but particularly ALT, are most indicative of:",
        "options": ["Myocardial infarction", "Liver disease with cell damage", "Prostate cancer", "Acute pancreatitis"],
        "answer": 1,
        "correctAnswer": "Liver disease with cell damage",
        "explanation": "High ALT and AST, especially ALT, indicate liver damage. Other conditions are less specific. Errors can affect diagnostic interpretation.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 229,
        "question": "An elevated level of Acid Phosphatase (ACP) is a classic serum marker for:",
        "options": ["Biliary obstruction or bone disease", "Prostatic carcinoma", "Muscle damage", "Pancreatic inflammation"],
        "answer": 1,
        "correctAnswer": "Prostatic carcinoma",
        "explanation": "Elevated ACP is a marker for prostatic carcinoma. Other conditions are linked to different enzymes. Errors can affect cancer diagnostics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 230,
        "question": "Alkaline Phosphatase (ALP) is elevated in serum in cases of:",
        "options": ["Liver disease (e.g., biliary obstruction) and osteoblastic bone disease (e.g., Paget's disease)", "Exclusive liver disease", "Exclusive muscle disease", "Myocardial infarction"],
        "answer": 0,
        "correctAnswer": "Liver disease (e.g., biliary obstruction) and osteoblastic bone disease (e.g., Paget's disease)",
        "explanation": "ALP elevation indicates liver or bone disease. It’s not exclusive to one or linked to muscle/myocardial issues. Errors can affect diagnostics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 231,
        "question": "The enzyme α-Amylase is a key serum marker for:",
        "options": ["Liver cirrhosis", "Acute pancreatitis", "Myocardial infarction", "Prostate cancer"],
        "answer": 1,
        "correctAnswer": "Acute pancreatitis",
        "explanation": "Elevated α-Amylase is a marker for acute pancreatitis. Other conditions involve different enzymes. Errors can affect diagnostic accuracy.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 232,
        "question": "An uncompetitive inhibitor would cause which of the following changes on a Michaelis-Menten plot (V vs. [S])?",
        "options": ["The curve would shift to the right, requiring a higher [S] to reach ½Vmax", "The Vmax would decrease, and the curve would appear to have a lower plateau", "Both the apparent Vmax and the apparent Km would decrease", "The curve would remain unchanged"],
        "answer": 2,
        "correctAnswer": "Both the apparent Vmax and the apparent Km would decrease",
        "explanation": "Uncompetitive inhibition lowers both apparent Vmax and Km, shifting the curve left and down. Errors can affect kinetics interpretation.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 233,
        "question": "The primary reason allosteric enzymes have quaternary structure (multiple subunits) is to:",
        "options": ["Increase their molecular weight", "Allow for cooperative interactions between subunits", "Make them more soluble in water", "Prevent their inhibition"],
        "answer": 1,
        "correctAnswer": "Allow for cooperative interactions between subunits",
        "explanation": "Quaternary structure enables subunit cooperativity, key to allosteric regulation. It’s not about weight or solubility. Errors can affect allosteric enzyme understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 234,
        "question": "In the context of enzyme regulation, an 'effector' is:",
        "options": ["Always the substrate of the reaction", "Always an inhibitor", "A molecule that binds to the enzyme and modulates its activity (can be an inhibitor or activator)", "The product of the reaction"],
        "answer": 2,
        "correctAnswer": "A molecule that binds to the enzyme and modulates its activity (can be an inhibitor or activator)",
        "explanation": "Effectors modulate activity as activators or inhibitors, not just substrates or products. Errors can affect regulation terminology.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 235,
        "question": "The term 'allosteric' literally means:",
        "options": ["Same space", "Other space or other site", "Together acting", "Change maker"],
        "answer": 1,
        "correctAnswer": "Other space or other site",
        "explanation": "Allosteric means 'other site,' referring to regulatory sites distinct from the active site. Errors can affect allosteric terminology understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 236,
        "question": "Which type of inhibition would result in a Lineweaver-Burk plot where the slope (Km/Vmax) remains unchanged but the y-intercept (1/Vmax) increases?",
        "options": ["Competitive Inhibition", "Pure Non-competitive Inhibition", "Uncompetitive Inhibition", "Irreversible Inhibition"],
        "answer": 1,
        "correctAnswer": "Pure Non-competitive Inhibition",
        "explanation": "In pure non-competitive inhibition, Vmax decreases (increasing 1/Vmax), and Km is unchanged. However, the slope (Km/Vmax) increases due to lower Vmax, making the question tricky. The intended focus is on y-intercept increase and x-intercept (-1/Km) unchanged, typical of non-competitive inhibition. Errors can affect plot interpretation.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 237,
        "question": "The regulation of enzyme activity by proteolytic cleavage (zymogen activation) is generally:",
        "options": ["Reversible and rapid", "Irreversible and rapid", "Reversible and slow", "Irreversible and serves as a one-time, committed activation"],
        "answer": 3,
        "correctAnswer": "Irreversible and serves as a one-time, committed activation",
        "explanation": "Zymogen activation (e.g., trypsinogen to trypsin) is irreversible, committing the enzyme to activity. It’s not reversible or slow. Errors can affect zymogen regulation studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 238,
        "question": "A patient presents with severe abdominal pain. A blood test shows highly elevated serum amylase levels. The most likely diagnosis is:",
        "options": ["Heart attack", "Liver failure", "Acute pancreatitis", "Prostate cancer"],
        "answer": 2,
        "correctAnswer": "Acute pancreatitis",
        "explanation": "Elevated serum amylase is a key marker for acute pancreatitis. Other conditions involve different enzymes. Errors can affect clinical diagnostics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 239,
        "question": "The 'induced-fit model' of enzyme specificity, mentioned in the summary, proposes that:",
        "options": ["The active site is a rigid, pre-shaped lock for the substrate key", "The substrate binding induces a conformational change in the enzyme to form a precise fit", "Inhibitors always bind to a site other than the active site", "Enzymes are consumed in the reactions they catalyze"],
        "answer": 1,
        "correctAnswer": "The substrate binding induces a conformational change in the enzyme to form a precise fit",
        "explanation": "The induced-fit model posits that substrate binding reshapes the active site for better fit, unlike the rigid lock-and-key model. Errors can affect specificity understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 240,
        "question": "The concept that 'Vmax is a theoretical maximum never achieved in reality' is because:",
        "options": ["The Michaelis-Menten equation is mathematically flawed", "It is impossible to achieve an infinitely high substrate concentration", "Enzymes are always inhibited in vivo", "Km values are too high"],
        "answer": 1,
        "correctAnswer": "It is impossible to achieve an infinitely high substrate concentration",
        "explanation": "Vmax requires infinite [S], which is impractical. The equation is valid, and Km or inhibition isn’t the issue. Errors can affect kinetics studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 241,
        "question": "An isoenzyme (isozyme) is:",
        "options": ["A different form of an enzyme that catalyzes the same reaction but may have different kinetic properties or tissue localization", "An enzyme that is inhibited by its own product", "An enzyme that requires a metal ion cofactor", "The inactive precursor of an enzyme"],
        "answer": 0,
        "correctAnswer": "A different form of an enzyme that catalyzes the same reaction but may have different kinetic properties or tissue localization",
        "explanation": "Isoenzymes catalyze the same reaction but differ in kinetics or tissue distribution (e.g., CK-MB vs. CK-MM). They’re not precursors or inhibited by products. Errors can affect isoenzyme studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 242,
        "question": "The clinical utility of measuring specific isoenzymes (like CK-MB for heart or CK-MM for muscle) is to:",
        "options": ["Determine the total amount of enzyme activity present", "Identify the specific organ or tissue that is damaged", "Measure the concentration of the substrate", "Calculate the Km of the enzyme"],
        "answer": 1,
        "correctAnswer": "Identify the specific organ or tissue that is damaged",
        "explanation": "Isoenzyme levels (e.g., CK-MB for heart) pinpoint damaged tissues. They don’t measure total activity or substrate. Errors can affect diagnostics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 243,
        "question": "In the reaction scheme for reversible covalent modification (Protein-OH + ATP <=> Protein-O-P + ADP), the forward and reverse reactions are catalyzed by different enzymes. This is important because it:",
        "options": ["Makes the process energetically unfavorable", "Allows the two reactions to be independently regulated", "Ensures the process is always irreversible", "Increases the affinity of the enzyme for its substrate"],
        "answer": 1,
        "correctAnswer": "Allows the two reactions to be independently regulated",
        "explanation": "Separate enzymes (e.g., kinases, phosphatases) allow independent control of phosphorylation/dephosphorylation. It’s not irreversible or affinity-related. Errors can affect regulation studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 244,
        "question": "An allosteric activator would typically shift the saturation curve of an allosteric enzyme:",
        "options": ["To the right, making it more hyperbolic", "To the left, making it more sigmoidal", "To the left, making it more hyperbolic and decreasing the apparent Km", "To the right, increasing the apparent Km"],
        "answer": 2,
        "correctAnswer": "To the left, making it more hyperbolic and decreasing the apparent Km",
        "explanation": "Allosteric activators shift the curve left, increasing substrate affinity (lower apparent Km) and making it more hyperbolic. Errors can affect allosteric kinetics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 245,
        "question": "The primary advantage of allosteric regulation over controlling the amount of enzyme present is:",
        "options": ["It is irreversible", "It is a much slower process", "It allows for very rapid, second-by-second control of metabolic flux", "It requires protein synthesis"],
        "answer": 2,
        "correctAnswer": "It allows for very rapid, second-by-second control of metabolic flux",
        "explanation": "Allosteric regulation enables rapid metabolic control, unlike slow protein synthesis. It’s reversible, not slow. Errors can affect regulation dynamics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 246,
        "question": "In uncompetitive inhibition, the inhibitor has no affinity for the free enzyme (E). This means the apparent Km will:",
        "options": ["Increase", "Decrease", "Remain the same", "Become zero"],
        "answer": 1,
        "correctAnswer": "Decrease",
        "explanation": "Uncompetitive inhibitors bind ES, shifting equilibrium to form more ES, lowering apparent Km. Errors can affect inhibition kinetics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 247,
        "question": "A non-competitive inhibitor binds to both E and ES with equal affinity. What is the effect on Km?",
        "options": ["Km increases", "Km decreases", "Km remains unchanged", "Km becomes undefined"],
        "answer": 2,
        "correctAnswer": "Km remains unchanged",
        "explanation": "Pure non-competitive inhibition doesn’t affect substrate binding affinity (Km), as the inhibitor binds equally to E and ES. Errors can affect kinetics analysis.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 248,
        "question": "The term 'Kcat' (or turnover number) refers to:",
        "options": ["The substrate concentration at ½Vmax", "The number of substrate molecules converted to product per enzyme molecule per second when the enzyme is saturated", "The inhibition constant for a competitive inhibitor", "The maximum velocity of the reaction"],
        "answer": 1,
        "correctAnswer": "The number of substrate molecules converted to product per enzyme molecule per second when the enzyme is saturated",
        "explanation": "Kcat is the turnover number, measuring catalytic events per enzyme at saturation. It’s not Km or Vmax. Errors can affect kinetic parameter understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 249,
        "question": "The catalytic efficiency of an enzyme is best given by:",
        "options": ["Vmax", "Km", "Kcat", "Kcat / Km"],
        "answer": 3,
        "correctAnswer": "Kcat / Km",
        "explanation": "Kcat/Km measures catalytic efficiency, combining turnover rate and substrate affinity. Other options are incomplete. Errors can affect efficiency calculations.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 250,
        "question": "The role of ATP in kinase-mediated phosphorylation is to act as a:",
        "options": ["Competitive inhibitor", "Allosteric effector", "Phosphate group donor", "Energy-destroying molecule"],
        "answer": 2,
        "correctAnswer": "Phosphate group donor",
        "explanation": "ATP donates a phosphate group in kinase-mediated phosphorylation. It’s not an inhibitor or effector. Errors can affect phosphorylation mechanism understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    }
]
        ;
        // Store original questions for restart functionality (moved to global scope for cross-browser compatibility)
        const originalQuestions = [...questions];
        // DOM Elements (global for cross-browser)
        let body = document.body;
        let questionElement, optionsContainer, currentQuestionElement, totalQuestionsElement, progressBar, prevButton, nextButton, skipButton, feedbackElement, timerElement, scoreElement, streakElement, categoryElement, explanationContainer, explanationTextElement, themeToggle, soundToggle, bookmarkBtn, bookmarksCount, categoryTag, difficultyTag, showExplanationBtn, statsBtn, statsModal, closeStatsModal, closeStatsBtn, quickActionsBtn, quickActionsModal, closeActionsModal, closeActionsBtn, studyModeToggle, confettiContainer;
        // Quiz state
        let currentQuestionIndex = 0;
        let score = 0;
        let streak = 0;
        let selectedOption = null;
        let timeStarted = null;
        let timerInterval = null;
        let timeElapsed = 0;
        let answers = [];
        let soundsEnabled = true;
        let bookmarkedQuestions = [];
        let quizHistory = [];
        let studyMode = false;
        let performanceMetrics = {
            categories: {},
            difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
            totalCorrect: 0,
            totalQuestions: 0,
            totalTime: 0
        };
        function initQuiz() {
            try {
            // Assign DOM elements safely
            questionElement = document.getElementById('question') || questionElement;
            optionsContainer = document.getElementById('options-container') || optionsContainer;
            currentQuestionElement = document.getElementById('current-question') || currentQuestionElement;
            totalQuestionsElement = document.getElementById('total-questions') || totalQuestionsElement;
            progressBar = document.getElementById('progress-bar') || progressBar;
            prevButton = document.getElementById('prev-btn') || prevButton;
            nextButton = document.getElementById('next-btn') || nextButton;
            skipButton = document.getElementById('skip-btn') || skipButton;
            feedbackElement = document.getElementById('feedback') || feedbackElement;
            timerElement = document.getElementById('timer') || timerElement;
            scoreElement = document.getElementById('score') || scoreElement;
            streakElement = document.getElementById('streak') || streakElement;
            categoryElement = document.getElementById('category') || categoryElement;
            explanationContainer = document.getElementById('explanation-container') || explanationContainer;
            explanationTextElement = document.getElementById('explanation-text') || explanationTextElement;
            themeToggle = document.getElementById('theme-toggle') || themeToggle;
            soundToggle = document.getElementById('sound-toggle') || soundToggle;
            bookmarkBtn = document.getElementById('bookmark-btn') || bookmarkBtn;
            bookmarksCount = document.getElementById('bookmarks-count') || bookmarksCount;
            categoryTag = document.getElementById('category-tag') || categoryTag;
            difficultyTag = document.getElementById('difficulty-tag') || difficultyTag;
            showExplanationBtn = document.getElementById('show-explanation-btn') || showExplanationBtn;
            statsBtn = document.getElementById('stats-btn') || statsBtn;
            statsModal = document.getElementById('stats-modal') || statsModal;
            closeStatsModal = document.getElementById('close-stats-modal') || closeStatsModal;
            closeStatsBtn = document.getElementById('close-stats-btn') || closeStatsBtn;
            quickActionsBtn = document.getElementById('quick-actions-btn') || quickActionsBtn;
            quickActionsModal = document.getElementById('quick-actions-modal') || quickActionsModal;
            closeActionsModal = document.getElementById('close-actions-modal') || closeActionsModal;
            closeActionsBtn = document.getElementById('close-actions-btn') || closeActionsBtn;
            studyModeToggle = document.getElementById('study-mode-toggle') || studyModeToggle;
            confettiContainer = document.getElementById('confetti-container') || confettiContainer;
            // Reset DOM elements
            if (scoreElement) scoreElement.textContent = score;
            if (streakElement) streakElement.textContent = streak;
            if (timerElement) timerElement.textContent = '00:00';
            if (totalQuestionsElement) totalQuestionsElement.textContent = questions.length;
           
            loadQuestion();
            startTimer();
           
            // Clone elements to remove old listeners (cross-browser safe)
            if (prevButton) {
                const prevBtnClone = prevButton.cloneNode(true);
                prevButton.parentNode.replaceChild(prevBtnClone, prevButton);
                prevButton = prevBtnClone;
            }
            if (nextButton) {
                const nextBtnClone = nextButton.cloneNode(true);
                nextButton.parentNode.replaceChild(nextBtnClone, nextButton);
                nextButton = nextBtnClone;
            }
            if (skipButton) {
                const skipBtnClone = skipButton.cloneNode(true);
                skipButton.parentNode.replaceChild(skipBtnClone, skipButton);
                skipButton = skipBtnClone;
            }
            if (themeToggle) {
                const themeToggleClone = themeToggle.cloneNode(true);
                themeToggle.parentNode.replaceChild(themeToggleClone, themeToggle);
                themeToggle = themeToggleClone;
            }
            if (soundToggle) {
                const soundToggleClone = soundToggle.cloneNode(true);
                soundToggle.parentNode.replaceChild(soundToggleClone, soundToggle);
                soundToggle = soundToggleClone;
            }
            if (bookmarkBtn) {
                const bookmarkBtnClone = bookmarkBtn.cloneNode(true);
                bookmarkBtn.parentNode.replaceChild(bookmarkBtnClone, bookmarkBtn);
                bookmarkBtn = bookmarkBtnClone;
            }
            if (showExplanationBtn) {
                const showExplanationBtnClone = showExplanationBtn.cloneNode(true);
                showExplanationBtn.parentNode.replaceChild(showExplanationBtnClone, showExplanationBtn);
                showExplanationBtn = showExplanationBtnClone;
            }
            if (statsBtn) {
                const statsBtnClone = statsBtn.cloneNode(true);
                statsBtn.parentNode.replaceChild(statsBtnClone, statsBtn);
                statsBtn = statsBtnClone;
            }
            // Add event listeners safely
            if (prevButton) prevButton.addEventListener('click', goToPreviousQuestion);
            if (nextButton) nextButton.addEventListener('click', goToNextQuestion);
            if (skipButton) skipButton.addEventListener('click', skipQuestion);
            if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
            if (soundToggle) soundToggle.addEventListener('click', toggleSound);
            if (bookmarkBtn) bookmarkBtn.addEventListener('click', toggleBookmark);
            if (showExplanationBtn) showExplanationBtn.addEventListener('click', toggleExplanation);
            if (statsBtn) statsBtn.addEventListener('click', showStatsModal);
            if (closeStatsModal) closeStatsModal.addEventListener('click', hideStatsModal);
            if (closeStatsBtn) closeStatsBtn.addEventListener('click', hideStatsModal);
            if (quickActionsBtn) quickActionsBtn.addEventListener('click', showQuickActionsModal);
            if (closeActionsModal) closeActionsModal.addEventListener('click', hideQuickActionsModal);
            if (closeActionsBtn) closeActionsBtn.addEventListener('click', hideQuickActionsModal);
            if (studyModeToggle) studyModeToggle.addEventListener('change', toggleStudyMode);
           
            const markForReviewBtn = document.getElementById('mark-for-review-btn');
            if (markForReviewBtn) markForReviewBtn.addEventListener('click', markForReview);
            const viewExplanationBtn = document.getElementById('view-explanation-btn');
            if (viewExplanationBtn) viewExplanationBtn.addEventListener('click', viewExplanation);
            const hintBtn = document.getElementById('hint-btn');
            if (hintBtn) hintBtn.addEventListener('click', getHint);
            const reportBtn = document.getElementById('report-question-btn');
            if (reportBtn) reportBtn.addEventListener('click', reportQuestion);
           
            // Keyboard navigation
            document.removeEventListener('keydown', handleKeydown);
            document.addEventListener('keydown', handleKeydown);
           
            loadPreferences();
            loadQuizHistory();
            updateBookmarksCount();
            } catch (e) {
                console.error('Error initializing quiz:', e);
            }
        }
        function handleKeydown(e) {
            if (e.key === 'ArrowRight') {
                goToNextQuestion();
            } else if (e.key === 'ArrowLeft') {
                goToPreviousQuestion();
            } else if (e.key.toLowerCase() === 'a' || e.key === '1') {
                selectOption(0);
            } else if (e.key.toLowerCase() === 'b' || e.key === '2') {
                selectOption(1);
            } else if (e.key.toLowerCase() === 'c' || e.key === '3') {
                selectOption(2);
            } else if (e.key.toLowerCase() === 'd' || e.key === '4') {
                selectOption(3);
            } else if (e.key === 'Enter') {
                if (showExplanationBtn && showExplanationBtn.style.display !== 'none') {
                    toggleExplanation();
                }
            } else if (e.key === 's' || e.key === '5') {
                skipQuestion();
            }
        }
        function loadQuestion() {
            if (!questionElement || !optionsContainer) return; // Safety check
            const question = questions[currentQuestionIndex];
            if (!question) return;
            questionElement.textContent = question.question;
            currentQuestionElement.textContent = currentQuestionIndex + 1;
            if (categoryTag) categoryTag.textContent = question.category || 'Unknown';
           
            // Update difficulty tag with indicator
            if (difficultyTag) {
                difficultyTag.innerHTML = `
                    <span class="difficulty-indicator difficulty-${question.difficulty.toLowerCase().replace(' ', '-')}"></span>
                    ${question.difficulty}
                `;
            }
           
            if (categoryElement) categoryElement.textContent = question.category || 'All';
           
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            if (progressBar) progressBar.style.width = `${progress}%`;
           
            // Update progress level for appearance change
            let progressLevel = 0;
            if (progress > 75) progressLevel = 75;
            else if (progress > 50) progressLevel = 50;
            else if (progress > 25) progressLevel = 25;
            body.setAttribute('data-progress', progressLevel);
           
            optionsContainer.innerHTML = '';
           
            const optionLetters = ['A', 'B', 'C', 'D'];
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option', 'fade-in');
                optionElement.setAttribute('role', 'button');
                optionElement.setAttribute('tabindex', '0');
                optionElement.setAttribute('aria-label', `Option ${optionLetters[index]}: ${option}`);
               
                const optionLetter = document.createElement('div');
                optionLetter.classList.add('option-letter');
                optionLetter.textContent = optionLetters[index];
               
                const optionText = document.createElement('div');
                optionText.classList.add('option-text');
                optionText.textContent = option;
               
                optionElement.appendChild(optionLetter);
                optionElement.appendChild(optionText);
               
                optionElement.addEventListener('click', () => selectOption(index));
                optionElement.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectOption(index);
                    }
                });
               
                optionsContainer.appendChild(optionElement);
            });
           
            if (prevButton) prevButton.disabled = currentQuestionIndex === 0;
            if (nextButton) nextButton.textContent = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz' : 'Next Question';
            if (nextButton) nextButton.innerHTML = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz <i class="fas fa-flag-checkered"></i>' : 'Next Question <i class="fas fa-arrow-right"></i>';
           
            if (feedbackElement) feedbackElement.style.display = 'none';
            if (showExplanationBtn) showExplanationBtn.style.display = 'none';
            if (explanationContainer) explanationContainer.classList.remove('expanded');
           
            selectedOption = null;
           
            // Show quick actions button
            if (quickActionsBtn) quickActionsBtn.style.display = 'flex';
           
            // If the question was previously answered or skipped, display the feedback
            if (answers[currentQuestionIndex]) {
                const ans = answers[currentQuestionIndex];
                const options = document.querySelectorAll('.option');
                if (feedbackElement) feedbackElement.style.display = 'flex';
                if (showExplanationBtn) showExplanationBtn.style.display = 'block';
                if (explanationTextElement) explanationTextElement.textContent = question.explanation;
                options.forEach(option => option.style.pointerEvents = 'none');
               
                if (ans.selected === 'Skipped') {
                    selectedOption = null;
                    if (feedbackElement) {
                        feedbackElement.classList.add('skipped');
                        feedbackElement.innerHTML = '<i class="fas fa-forward feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
                    }
                    options[question.answer].classList.add('correct');
                } else {
                    const optIndex = question.options.findIndex(opt => opt === ans.selected);
                    if (optIndex !== -1) {
                        selectedOption = optIndex;
                        options[optIndex].classList.add('selected');
                        if (ans.isCorrect) {
                            if (feedbackElement) {
                                feedbackElement.classList.add('correct');
                                feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                            }
                        } else {
                            if (feedbackElement) {
                                feedbackElement.classList.add('incorrect');
                                feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                            }
                            options[question.answer].classList.add('correct');
                            options[optIndex].classList.add('incorrect'); // Highlight selected as incorrect
                        }
                    }
                }
            }
           
            updateBookmarkStatus();
        }
        function selectOption(index) {
            if (selectedOption !== null || answers[currentQuestionIndex]) return;
           
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected', 'incorrect'));
            options[index].classList.add('selected');
            selectedOption = index;
           
            const question = questions[currentQuestionIndex];
            const isCorrect = index === question.answer;
           
            if (feedbackElement) feedbackElement.style.display = 'flex';
            if (isCorrect) {
                if (feedbackElement) {
                    feedbackElement.classList.remove('incorrect');
                    feedbackElement.classList.add('correct');
                    feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                }
                score += getScoreForDifficulty(question.difficulty);
                streak++;
                playSound('correct');
               
                // Show confetti for correct answers on hard questions
                if (question.difficulty === 'Hard' || question.difficulty === 'Very Hard') {
                    createConfetti();
                }
            } else {
                if (feedbackElement) {
                    feedbackElement.classList.remove('correct');
                    feedbackElement.classList.add('incorrect');
                    feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                }
                options[question.answer].classList.add('correct');
                options[index].classList.add('incorrect'); // Highlight selected as incorrect
                streak = 0;
                playSound('incorrect');
            }
           
            if (scoreElement) scoreElement.textContent = score;
            if (streakElement) streakElement.textContent = streak;
           
            if (explanationTextElement) explanationTextElement.textContent = question.explanation;
            if (showExplanationBtn) showExplanationBtn.style.display = 'block';
           
            answers[currentQuestionIndex] = {
                question: question.question,
                selected: question.options[index],
                correct: question.options[question.answer],
                isCorrect: isCorrect,
                explanation: question.explanation,
                category: question.category,
                difficulty: question.difficulty
            };
           
            updatePerformanceMetrics(isCorrect, question);
           
            options.forEach(option => option.style.pointerEvents = 'none');
        }
        function skipQuestion() {
            if (answers[currentQuestionIndex]) return;
           
            const question = questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');
           
            if (feedbackElement) {
                feedbackElement.style.display = 'flex';
                feedbackElement.classList.add('skipped');
                feedbackElement.innerHTML = '<i class="fas fa-forward feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
            }
           
            options[question.answer].classList.add('correct');
            if (showExplanationBtn) showExplanationBtn.style.display = 'block';
            if (explanationTextElement) explanationTextElement.textContent = question.explanation;
           
            answers[currentQuestionIndex] = {
                question: question.question,
                selected: 'Skipped',
                correct: question.options[question.answer],
                isCorrect: false,
                explanation: question.explanation,
                category: question.category,
                difficulty: question.difficulty
            };
           
            updatePerformanceMetrics(false, question);
            streak = 0;
            if (streakElement) streakElement.textContent = streak;
           
            options.forEach(option => option.style.pointerEvents = 'none');
        }
        function maybeHandleSkip() {
            if (!answers[currentQuestionIndex] && selectedOption === null) {
                skipQuestion();
            }
        }
        function toggleExplanation() {
            if (!explanationContainer) return;
            explanationContainer.classList.toggle('expanded');
            if (!showExplanationBtn) return;
            showExplanationBtn.innerHTML = explanationContainer.classList.contains('expanded') ?
                '<i class="fas fa-info-circle"></i> Hide Explanation' :
                '<i class="fas fa-info-circle"></i> Show Explanation';
        }
        function getScoreForDifficulty(difficulty) {
            switch (difficulty) {
                case 'Easy': return 5;
                case 'Medium': return 10;
                case 'Hard': return 15;
                case 'Very Hard': return 20;
                default: return 10;
            }
        }
        function updatePerformanceMetrics(isCorrect, question) {
            performanceMetrics.totalQuestions++;
            performanceMetrics.totalTime += timeElapsed;
            if (isCorrect) performanceMetrics.totalCorrect++;
           
            performanceMetrics.categories[question.category] = performanceMetrics.categories[question.category] || { correct: 0, total: 0 };
            performanceMetrics.categories[question.category].total++;
            if (isCorrect) performanceMetrics.categories[question.category].correct++;
           
            if (!performanceMetrics.difficulties[question.difficulty]) performanceMetrics.difficulties[question.difficulty] = 0;
            if (isCorrect) performanceMetrics.difficulties[question.difficulty]++;
        }
        function toggleBookmark() {
            if (!bookmarkBtn) return;
            const questionId = questions[currentQuestionIndex].id;
            const index = bookmarkedQuestions.indexOf(questionId);
            if (index === -1) {
                bookmarkedQuestions.push(questionId);
                bookmarkBtn.classList.add('bookmarked');
                playSound('bookmark');
            } else {
                bookmarkedQuestions.splice(index, 1);
                bookmarkBtn.classList.remove('bookmarked');
            }
            updateBookmarksCount();
            saveBookmarks();
        }
        function updateBookmarkStatus() {
            if (!bookmarkBtn) return;
            const questionId = questions[currentQuestionIndex].id;
            bookmarkBtn.classList.toggle('bookmarked', bookmarkedQuestions.includes(questionId));
        }
        function updateBookmarksCount() {
            if (!bookmarksCount) return;
            bookmarksCount.textContent = bookmarkedQuestions.length;
        }
        function goToNextQuestion() {
            maybeHandleSkip();
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                body.setAttribute('data-progress', '100');
                showResults();
                saveQuizHistory();
            }
        }
        function goToPreviousQuestion() {
            maybeHandleSkip();
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }
        function startTimer() {
            timeStarted = new Date();
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
        }
        function updateTimer() {
            timeElapsed++;
           
            const minutes = Math.floor(timeElapsed / 60).toString().padStart(2, '0');
            const seconds = (timeElapsed % 60).toString().padStart(2, '0');
            if (timerElement) timerElement.textContent = `${minutes}:${seconds}`;
           
            // Optional: Add warning color for long durations (e.g., after 5 minutes)
            if (timeElapsed >= 300) {
                if (timerElement) {
                    timerElement.style.color = 'var(--danger)';
                    timerElement.classList.add('pulse');
                }
            } else {
                if (timerElement) {
                    timerElement.style.color = 'var(--primary)';
                    timerElement.classList.remove('pulse');
                }
            }
        }
        function showResults() {
            if (timerInterval) clearInterval(timerInterval);
            if (quickActionsBtn) quickActionsBtn.style.display = 'none';
           
            const quizContainer = document.querySelector('.quiz-container');
            if (!quizContainer) return;
            const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
            const percentage = ((score / maxScore) * 100).toFixed(1);
            const accuracy = ((performanceMetrics.totalCorrect / performanceMetrics.totalQuestions) * 100).toFixed(1);
            const avgTime = Math.round(performanceMetrics.totalTime / performanceMetrics.totalQuestions);
           
            quizContainer.innerHTML = `
                <div class="results-container">
                    <h2 class="quiz-title">Quiz Completed!</h2>
                    <p class="quiz-subtitle">You've finished the MED QUIZ</p>
                   
                    <div class="score-circle" style="--p: ${percentage}%">
                        <div class="score-text">
                            <div class="score-value">${score}</div>
                            <div class="score-label">Points</div>
                        </div>
                    </div>
                   
                    <div class="results-stats">
                        <div class="result-stat">
                            <div class="result-stat-value">${accuracy}%</div>
                            <div class="result-stat-label">Accuracy</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${timeElapsed}s</div>
                            <div class="result-stat-label">Time Taken</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${streak}</div>
                            <div class="result-stat-label">Best Streak</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${bookmarkedQuestions.length}</div>
                            <div class="result-stat-label">Bookmarked</div>
                        </div>
                    </div>
                   
                    <div class="review-section">
                        <h3 class="review-title">Performance Analytics</h3>
                        <div class="review-item">
                            <div class="review-answer">Average Time Per Question: ${avgTime}s</div>
                            <div class="review-answer">Difficulty Performance:
                                Easy: ${performanceMetrics.difficulties.Easy || 0},
                                Medium: ${performanceMetrics.difficulties.Medium || 0},
                                Hard: ${performanceMetrics.difficulties.Hard || 0},
                                Very Hard: ${performanceMetrics.difficulties['Very Hard'] || 0}
                            </div>
                        </div>
                       
                        <h3 class="review-title">Review Your Answers</h3>
                        ${answers.map((answer, index) => `
                            <div class="review-item ${answer.isCorrect ? 'correct' : answer.selected === 'Skipped' ? 'skipped' : 'incorrect'}">
                                <div class="review-question">Q${index + 1}: ${answer.question} (${answer.category} - ${answer.difficulty})</div>
                                <div class="review-answer">Your Answer: ${answer.selected}</div>
                                <div class="review-answer">Correct Answer: ${answer.correct}</div>
                                <div class="review-explanation">${answer.explanation}</div>
                            </div>
                        `).join('')}
                       
                        ${bookmarkedQuestions.length > 0 ? `
                            <h3 class="review-title">Bookmarked Questions</h3>
                            ${bookmarkedQuestions.map(qid => {
                                const question = questions.find(q => q.id === qid);
                                if (!question) return '';
                                return `
                                    <div class="review-item">
                                        <div class="review-question">${question.question} (${question.category} - ${question.difficulty})</div>
                                        <div class="review-answer">Correct Answer: ${question.correctAnswer}</div>
                                        <div class="review-explanation">${question.explanation}</div>
                                    </div>
                                `;
                            }).join('')}
                        ` : ''}
                    </div>
                   
                    <button class="btn btn-primary mt-4" id="restart-btn">
                        <i class="fas fa-redo"></i> Try Again
                    </button>
                    <button class="btn btn-secondary mt-2" id="review-wrong-btn">
                        <i class="fas fa-search"></i> Review Incorrect Answers
                    </button>
                </div>
            `;
           
            // Add event listeners after DOM update
            const restartBtn = document.getElementById('restart-btn');
            const reviewWrongBtn = document.getElementById('review-wrong-btn');
            if (restartBtn) restartBtn.addEventListener('click', restartQuiz);
            if (reviewWrongBtn) reviewWrongBtn.addEventListener('click', reviewWrongAnswers);
        }
        function reviewWrongAnswers() {
            const wrongAnswers = answers.filter(answer => !answer.isCorrect && answer.selected !== 'Skipped');
           
            if (wrongAnswers.length === 0) {
                alert("You don't have any incorrect answers to review!");
                return;
            }
           
            // Filter questions to only include wrong answers
            const wrongQuestions = questions.filter((q, index) =>
                answers[index] && !answers[index].isCorrect && answers[index].selected !== 'Skipped'
            );
           
            // Reset quiz state for review mode
            questions.length = 0; // Clear array
            questions.push(...wrongQuestions); // Add wrong ones
            currentQuestionIndex = 0;
            score = 0;
            streak = 0;
            timeElapsed = 0;
            answers = [];
            selectedOption = null;
            performanceMetrics = {
                categories: {},
                difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
                totalCorrect: 0,
                totalQuestions: 0,
                totalTime: 0
            };
           
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
            }
           
            body.setAttribute('data-progress', '0');
           
            // Rebuild HTML with dynamic category (fix hardcoded "Neuro")
            const quizContainer = document.querySelector('.quiz-container');
            if (quizContainer) {
                quizContainer.innerHTML = `
                    <div class="quiz-header">
                        <div>
                            <h1 class="quiz-title">MED QUIZ</h1>
                            <p class="quiz-subtitle">Reviewing Incorrect Answers</p>
                        </div>
                        <div class="stats-container">
                            <div class="stat">
                                <span class="stat-value" id="score">0</span>
                                <span class="stat-label">Score</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="timer">00:00</span>
                                <span class="stat-label">Time</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="streak">0</span>
                                <span class="stat-label">Streak</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="category">Review</span>
                                <span class="stat-label">Mode</span>
                            </div>
                        </div>
                    </div>
                  
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
                    </div>
                    <div class="question-meta">
                        <div class="question-tags">
                            <span class="tag" id="category-tag">Biochemistry</span>
                            <span class="tag" id="difficulty-tag">
                                <span class="difficulty-indicator difficulty-medium"></span>
                                Medium
                            </span>
                        </div>
                        <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                            <i class="fas fa-bookmark"></i>
                        </button>
                    </div>
                    <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">${wrongQuestions.length}</span></div>
                    <div class="question-text" id="question"></div>
                    <div class="options-grid" id="options-container"></div>
                    <div class="feedback correct" id="feedback" style="display: none;">
                        <i class="fas fa-check-circle feedback-icon"></i>
                        <div class="feedback-text">Correct! Well done.</div>
                    </div>
                    <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                        <i class="fas fa-info-circle"></i> Show Explanation
                    </button>
                    <div class="explanation-container" id="explanation-container">
                        <div class="explanation">
                            <div class="explanation-title">Explanation:</div>
                            <div id="explanation-text"></div>
                        </div>
                    </div>
                    <div class="navigation">
                        <button class="btn btn-secondary" id="prev-btn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="next-btn">
                            Next Question <i class="fas fa-arrow-right"></i>
                        </button>
                        <button class="btn btn-danger" id="skip-btn">
                            <i class="fas fa-forward"></i> Skip
                        </button>
                    </div>
                `;
            }
           
            // Reinitialize after DOM update
            initQuiz();
        }
        function restartQuiz() {
            // Reset quiz state
            currentQuestionIndex = 0;
            score = 0;
            streak = 0;
            timeElapsed = 0;
            answers = [];
            selectedOption = null;
            performanceMetrics = {
                categories: {},
                difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
                totalCorrect: 0,
                totalQuestions: 0,
                totalTime: 0
            };
           
            // Reset questions to original set (use length = 0 for cross-browser)
            questions.length = 0;
            questions.push(...originalQuestions);
           
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
            }
           
            body.setAttribute('data-progress', '0');
           
            // Rebuild HTML
            const quizContainer = document.querySelector('.quiz-container');
            if (quizContainer) {
                quizContainer.innerHTML = `
                    <div class="quiz-header">
                        <div>
                            <h1 class="quiz-title">MED QUIZ</h1>
                            <p class="quiz-subtitle">Test your medical knowledge</p>
                        </div>
                        <div class="stats-container">
                            <div class="stat">
                                <span class="stat-value" id="score">0</span>
                                <span class="stat-label">Score</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="timer">00:00</span>
                                <span class="stat-label">Time</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="streak">0</span>
                                <span class="stat-label">Streak</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="category">All</span>
                                <span class="stat-label">Category</span>
                            </div>
                        </div>
                    </div>
                
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
                    </div>
                    <div class="question-meta">
                        <div class="question-tags">
                            <span class="tag" id="category-tag">Biochemistry</span>
                            <span class="tag" id="difficulty-tag">
                                <span class="difficulty-indicator difficulty-medium"></span>
                                Medium
                            </span>
                        </div>
                        <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                            <i class="fas fa-bookmark"></i>
                        </button>
                    </div>
                    <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">15</span></div>
                    <div class="question-text" id="question"></div>
                    <div class="options-grid" id="options-container"></div>
                    <div class="feedback correct" id="feedback" style="display: none;">
                        <i class="fas fa-check-circle feedback-icon"></i>
                        <div class="feedback-text">Correct! Well done.</div>
                    </div>
                    <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                        <i class="fas fa-info-circle"></i> Show Explanation
                    </button>
                    <div class="explanation-container" id="explanation-container">
                        <div class="explanation">
                            <div class="explanation-title">Explanation:</div>
                            <div id="explanation-text"></div>
                        </div>
                    </div>
                    <div class="navigation">
                        <button class="btn btn-secondary" id="prev-btn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="next-btn">
                            Next Question <i class="fas fa-arrow-right"></i>
                        </button>
                        <button class="btn btn-danger" id="skip-btn">
                            <i class="fas fa-forward"></i> Skip
                        </button>
                    </div>
                `;
            }
           
            // Reinitialize after DOM update
            initQuiz();
        }
        function markForReview() {
            toggleBookmark();
            hideQuickActionsModal();
        }
        function viewExplanation() {
            if (!answers[currentQuestionIndex]) return;
            toggleExplanation();
            hideQuickActionsModal();
        }
        function getHint() {
            if (answers[currentQuestionIndex]) return;
            const wrongOptions = Array.from(document.querySelectorAll('.option')).filter((opt, idx) => idx !== questions[currentQuestionIndex].answer);
            const randomWrong = wrongOptions[Math.floor(Math.random() * wrongOptions.length)];
            randomWrong.style.opacity = '0.5';
            randomWrong.style.pointerEvents = 'none';
            const hintText = document.createElement('div');
            hintText.textContent = 'Hint: One wrong option eliminated!';
            hintText.classList.add('feedback', 'skipped');
            optionsContainer.before(hintText);
            setTimeout(() => hintText.remove(), 3000);
            hideQuickActionsModal();
        }
        function reportQuestion() {
            alert('Question reported. Thank you for your feedback!');
            hideQuickActionsModal();
        }
        function toggleTheme() {
            if (!body || !themeToggle) return;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' :
                            currentTheme === 'light' ? 'minimal' : 'dark';
           
            body.setAttribute('data-theme', newTheme);
            themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-moon"></i>' :
                                  newTheme === 'light' ? '<i class="fas fa-sun"></i>' :
                                  '<i class="fas fa-paint-brush"></i>';
           
            localStorage.setItem('theme', newTheme);
        }
        function toggleSound() {
            if (!soundToggle) return;
            soundsEnabled = !soundsEnabled;
            soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
           
            localStorage.setItem('soundsEnabled', soundsEnabled);
        }
        function toggleStudyMode() {
            if (!studyModeToggle) return;
            studyMode = studyModeToggle.checked;
            if (showExplanationBtn && explanationContainer) {
                if (studyMode) {
                    showExplanationBtn.style.display = 'block';
                    explanationContainer.classList.add('expanded');
                    showExplanationBtn.innerHTML = '<i class="fas fa-info-circle"></i> Hide Explanation';
                } else {
                    showExplanationBtn.style.display = 'none';
                    explanationContainer.classList.remove('expanded');
                }
            }
            localStorage.setItem('studyMode', studyMode);
        }
        function playSound(type) {
            if (!soundsEnabled) return;
           
            // Enhanced Web Audio for better sounds (reward chime for correct, buzz for incorrect)
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
               
                if (type === 'correct') {
                    // Rising chime for reward
                    const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
                    notes.forEach((freq, i) => {
                        setTimeout(() => {
                            const oscillator = audioContext.createOscillator();
                            const gainNode = audioContext.createGain();
                            oscillator.connect(gainNode);
                            gainNode.connect(audioContext.destination);
                            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                            oscillator.type = 'sine';
                            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                            oscillator.start(audioContext.currentTime + i * 0.1);
                            oscillator.stop(audioContext.currentTime + i * 0.1 + 0.3);
                        }, i * 100);
                    });
                } else if (type === 'incorrect') {
                    // Low buzz for wrong
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.type = 'sawtooth';
                    gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.4);
                } else if (type === 'bookmark') {
                    // Short ding
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.type = 'triangle';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                }
            } catch (e) {
                console.log('Web Audio API not supported');
            }
        }
        function createConfetti() {
            if (!confettiContainer) return;
            const colors = ['#4361ee', '#4cc9f0', '#f72585', '#f9c74f', '#7209b7'];
           
            for (let i = 0; i < 60; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = (6 + Math.random() * 12) + 'px';
                confetti.style.height = (6 + Math.random() * 12) + 'px';
                confetti.style.animation = `confettiFall ${1.5 + Math.random() * 2.5}s linear forwards`;
                confettiContainer.appendChild(confetti);
               
                // Remove confetti after animation
                setTimeout(() => {
                    if (confetti.parentNode) confetti.remove();
                }, 4000);
            }
        }
        function showStatsModal() {
            if (!statsModal) return;
            // Calculate stats
            const totalQuestions = performanceMetrics.totalQuestions;
            const correctAnswers = performanceMetrics.totalCorrect;
            const accuracy = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            const avgTime = totalQuestions > 0 ? Math.round(performanceMetrics.totalTime / totalQuestions) : 0;
           
            // Update modal stats safely
            const modalTotal = document.getElementById('modal-total-questions');
            const modalCorrect = document.getElementById('modal-correct-answers');
            const modalAccuracy = document.getElementById('modal-accuracy');
            const modalAvgTime = document.getElementById('modal-avg-time');
            if (modalTotal) modalTotal.textContent = totalQuestions;
            if (modalCorrect) modalCorrect.textContent = correctAnswers;
            if (modalAccuracy) modalAccuracy.textContent = `${accuracy}%`;
            if (modalAvgTime) modalAvgTime.textContent = `${avgTime}s`;
           
            // Update category stats
            const categoryStatsContainer = document.getElementById('category-stats');
            if (categoryStatsContainer) {
                categoryStatsContainer.innerHTML = `
                    <table style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr><th>Category</th><th>Accuracy</th><th>Correct/Total</th></tr>
                        </thead>
                        <tbody>
                            ${Object.entries(performanceMetrics.categories).map(([category, stats]) => {
                                const categoryAccuracy = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
                                return `<tr><td>${category}</td><td>${categoryAccuracy}%</td><td>${stats.correct}/${stats.total}</td></tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                `;
            }
           
            // Update difficulty stats (fix calculation - use per-difficulty total)
            const difficultyStatsContainer = document.getElementById('difficulty-stats');
            if (difficultyStatsContainer) {
                difficultyStatsContainer.innerHTML = `
                    <table style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr><th>Difficulty</th><th>Accuracy</th><th>Correct/Total</th></tr>
                        </thead>
                        <tbody>
                            ${Object.entries(performanceMetrics.difficulties).map(([difficulty, correctCount]) => {
                                const diffTotals = {};
                                answers.forEach(ans => {
                                    if (ans.difficulty && ans.isCorrect !== undefined) {
                                        if (!diffTotals[ans.difficulty]) diffTotals[ans.difficulty] = { correct: 0, total: 0 };
                                        diffTotals[ans.difficulty].total++;
                                        if (ans.isCorrect) diffTotals[ans.difficulty].correct++;
                                    }
                                });
                                const totalForDifficulty = diffTotals[difficulty] ? diffTotals[difficulty].total : 0;
                                if (totalForDifficulty > 0) {
                                    const difficultyAccuracy = Math.round((correctCount / totalForDifficulty) * 100);
                                    return `<tr><td>${difficulty}</td><td>${difficultyAccuracy}%</td><td>${correctCount}/${totalForDifficulty}</td></tr>`;
                                }
                                return '';
                            }).join('')}
                        </tbody>
                    </table>
                `;
            }
           
            // Update history
            const historyContainer = document.getElementById('history-stats');
            if (historyContainer) {
              if (quizHistory.length === 0) {
                historyContainer.innerHTML = '<p>No history yet.</p>';
              } else {
                historyContainer.innerHTML = `
                  <table style="width:100%; border-collapse: collapse;">
                    <thead>
                      <tr><th>Date</th><th>Score</th><th>Percentage</th><th>Time</th><th>Streak</th></tr>
                    </thead>
                    <tbody>
                      ${quizHistory.map(h => {
                        const date = new Date(h.timestamp).toLocaleString();
                        return `<tr><td>${date}</td><td>${h.score}</td><td>${h.percentage}%</td><td>${h.timeSpent}s</td><td>${h.streak}</td></tr>`;
                      }).join('')}
                    </tbody>
                  </table>
                `;
              }
            }
           
            statsModal.classList.add('active');
        }
        function hideStatsModal() {
            if (statsModal) statsModal.classList.remove('active');
        }
        function showQuickActionsModal() {
            if (quickActionsModal) quickActionsModal.classList.add('active');
        }
        function hideQuickActionsModal() {
            if (quickActionsModal) quickActionsModal.classList.remove('active');
        }
        function loadPreferences() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme && body) {
                body.setAttribute('data-theme', savedTheme);
                if (themeToggle) {
                    themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-moon"></i>' :
                                          savedTheme === 'light' ? '<i class="fas fa-sun"></i>' :
                                          '<i class="fas fa-paint-brush"></i>';
                }
            }
           
            const savedSounds = localStorage.getItem('soundsEnabled');
            if (savedSounds !== null) {
                soundsEnabled = savedSounds === 'true';
                if (soundToggle) {
                    soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
                }
            }
           
            const savedStudyMode = localStorage.getItem('studyMode');
            if (savedStudyMode !== null) {
                studyMode = savedStudyMode === 'true';
                if (studyModeToggle) studyModeToggle.checked = studyMode;
                if (studyMode && showExplanationBtn && explanationContainer) {
                    showExplanationBtn.style.display = 'block';
                    explanationContainer.classList.add('expanded');
                    showExplanationBtn.innerHTML = '<i class="fas fa-info-circle"></i> Hide Explanation';
                }
            }
        }
        function saveBookmarks() {
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarkedQuestions));
        }
        function loadQuizHistory() {
            const saved = localStorage.getItem('quizHistory');
            if (saved) {
                try {
                    quizHistory = JSON.parse(saved);
                } catch (e) {
                    quizHistory = [];
                }
            }
            loadBookmarks();
        }
        function saveQuizHistory() {
            const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
            quizHistory.push({
                timestamp: new Date().toISOString(),
                score: score,
                percentage: ((score / maxScore) * 100).toFixed(1),
                timeSpent: timeElapsed,
                streak: streak,
                answers: answers,
                performanceMetrics: performanceMetrics
            });
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
        }
        function loadBookmarks() {
            const saved = localStorage.getItem('bookmarkedQuestions');
            if (saved) {
                try {
                    bookmarkedQuestions = JSON.parse(saved);
                } catch (e) {
                    bookmarkedQuestions = [];
                }
            }
        }
        // Initialize on DOM load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initQuiz);
        } else {
            initQuiz();
        }
    </script>
</body>
</html>