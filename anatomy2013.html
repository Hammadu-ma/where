<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Embryology Quiz Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #f72585;
            --success: #4cc9f0;
            --warning: #f9c74f;
            --danger: #f94144;
            --info: #577590;
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f5;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #868e96;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --bg-primary: var(--gray-900);
            --bg-secondary: #1a1d21;
            --bg-tertiary: #2c303a;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --card-bg: rgba(35, 39, 47, 0.95);
            --card-border: rgba(255, 255, 255, 0.1);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15), 0 5px 10px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2);
            --transition-base: all 0.2s ease-in-out;
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
            --header-height: 70px;
            --max-width: 900px;
            --side-padding: 1.5rem;
        }

        [data-theme="light"] {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #eef2f6;
            --text-primary: #1a1d21;
            --text-secondary: rgba(26, 29, 33, 0.7);
            --text-tertiary: rgba(26, 29, 33, 0.5);
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-border: rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.08), 0 5px 10px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.08);
        }

        [data-theme="minimal"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #334155;
            --text-tertiary: #64748b;
            --card-bg: #ffffff;
            --card-border: #e2e8f0;
            --primary: #0ea5e9;
            --primary-light: #38bdf8;
            --primary-dark: #0284c7;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition-base);
            line-height: 1.6;
            font-weight: 400;
        }

        [data-progress="25"] {
            --primary: #f72585; /* Pink for 25% */
        }

        [data-progress="50"] {
            --primary: #4cc9f0; /* Cyan for 50% */
            --bg-tertiary: rgba(76, 201, 240, 0.1);
        }

        [data-progress="75"] {
            --primary: #f9c74f; /* Yellow for 75% */
            --shadow-lg: 0 10px 25px rgba(249, 199, 79, 0.3);
        }

        [data-progress="100"] {
            --primary: #28a745; /* Green for 100% */
            --success: #28a745;
        }

        header {
            height: var(--header-height);
            background: var(--bg-secondary);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--side-padding);
            transition: var(--transition-base);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--primary);
        }

        .logo-icon {
            font-size: 1.5rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-base);
            position: relative;
        }

        .control-btn:hover {
            background: var(--bg-tertiary);
            transform: translateY(-2px);
        }

        .control-btn i {
            font-size: 1.1rem;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        main {
            flex: 1;
            padding: 2rem var(--side-padding);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .quiz-container {
            width: 100%;
            max-width: var(--max-width);
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-smooth);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .quiz-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .quiz-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .stats-container {
            display: flex;
            gap: 1rem;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            min-width: 70px;
            transition: var(--transition-smooth);
        }

        .stat-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin: 1.5rem 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary));
            border-radius: var(--radius-lg);
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            100% { left: 100%; }
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .question-tags {
            display: flex;
            gap: 0.5rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            font-size: 0.8rem;
            color: var(--text-secondary);
            transition: var(--transition-base);
        }

        .question-number {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            line-height: 1.4;
            transition: var(--transition-smooth);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 1rem 1.25rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition-smooth);
            border: 1px solid transparent;
        }

        .option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .option.selected {
            background: rgba(67, 97, 238, 0.1);
            border-color: var(--primary);
            animation: pulse 0.3s ease;
        }

        .option.correct {
            background: rgba(76, 201, 240, 0.1);
            border-color: var(--success);
            animation: correctAnimation 0.5s ease;
        }

        .option.incorrect {
            background: rgba(249, 65, 68, 0.1);
            border-color: var(--danger);
            animation: shake 0.5s ease;
        }

        @keyframes correctAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        .option-letter {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
        }

        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--danger);
            color: white;
        }

        .option-text {
            flex: 1;
        }

        .bookmark-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition-base);
        }

        .bookmark-btn:hover {
            color: var(--primary);
        }

        .bookmark-btn.bookmarked {
            color: var(--warning);
        }

        .feedback {
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: fadeIn 0.3s ease;
            transition: var(--transition-smooth);
        }

        .feedback.correct {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success);
        }

        .feedback.incorrect {
            background: rgba(249, 65, 68, 0.1);
            color: var(--danger);
        }

        .feedback-icon {
            font-size: 1.5rem;
        }

        .explanation-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .explanation-container.expanded {
            max-height: 500px;
        }

        .explanation {
            padding: 1.25rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            margin-top: 1rem;
            border-left: 4px solid var(--primary);
        }

        .explanation-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition-base);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .results-container {
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: conic-gradient(var(--primary) 0% var(--p, 0%), var(--bg-tertiary) var(--p, 0%) 100%);
            position: relative;
            transition: var(--transition-smooth);
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: var(--card-bg);
        }

        .score-text {
            position: relative;
            z-index: 1;
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }

        .result-stat {
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            transition: var(--transition-smooth);
        }

        .result-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .result-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .review-section {
            margin-top: 2rem;
            text-align: left;
        }

        .review-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .review-item {
            padding: 1.25rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1rem;
            background: var(--bg-tertiary);
            transition: var(--transition-smooth);
        }

        .review-item.correct {
            border-left: 4px solid var(--success);
        }

        .review-item.incorrect {
            border-left: 4px solid var(--danger);
        }

        .review-question {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .review-answer {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .review-explanation {
            font-size: 0.85rem;
            color: var(--text-secondary);
            padding-top: 0.5rem;
            border-top: 1px solid var(--card-border);
        }

        footer {
            padding: 1.5rem var(--side-padding);
            background: var(--bg-secondary);
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
            box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .pulse {
            animation: pulse 0.5s ease;
        }

        .bounce-in {
            animation: bounceIn 0.5s ease;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center {
            text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        @media (max-width: 768px) {
            :root {
                --side-padding: 1rem;
                --header-height: 60px;
            }

            .quiz-container {
                padding: 1.5rem;
            }

            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .stats-container {
                width: 100%;
                justify-content: space-between;
            }

            .results-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .score-circle {
                width: 120px;
                height: 120px;
            }

            .score-circle::before {
                width: 100px;
                height: 100px;
            }

            .score-value {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .navigation {
                flex-direction: column;
                gap: 0.75rem;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .option {
                padding: 0.75rem;
            }

            .option-letter {
                width: 28px;
                height: 28px;
                margin-right: 0.75rem;
            }
        }
    </style>
</head>
<body data-theme="dark" data-progress="0">
    <header>
        <div class="logo">
            <i class="fas fa-brain logo-icon"></i>
            <span>EmbryoQuiz</span>
        </div>
        <div class="header-controls">
            <button class="control-btn" id="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="control-btn" id="sound-toggle" aria-label="Toggle sound">
                <i class="fas fa-volume-up"></i>
            </button>
            <button class="control-btn" id="stats-btn" aria-label="View statistics">
                <i class="fas fa-chart-line"></i>
                <span class="badge" id="bookmarks-count">0</span>
            </button>
        </div>
    </header>

    <main>
        <div class="quiz-container">
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">Advanced Embryology Quiz</h1>
                    <p class="quiz-subtitle">Test your knowledge with professional questions and detailed explanations</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="score">0</span>
                        <span class="stat-label">Score</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="streak">0</span>
                        <span class="stat-label">Streak</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">All</span>
                        <span class="stat-label">Category</span>
                    </div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>

            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">Neuro</span>
                    <span class="tag" id="difficulty-tag">Medium</span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">10</span></div>
            <div class="question-text" id="question">Which part of the brain is responsible for coordinating skeletal muscle contractions?</div>

            <div class="options-grid" id="options-container">
                <div class="option">
                    <div class="option-letter">A</div>
                    <div class="option-text">Cerebrum</div>
                </div>
                <div class="option">
                    <div class="option-letter">B</div>
                    <div class="option-text">Cerebellum</div>
                </div>
                <div class="option">
                    <div class="option-letter">C</div>
                    <div class="option-text">Pons</div>
                </div>
                <div class="option">
                    <div class="option-letter">D</div>
                    <div class="option-text">Midbrain</div>
                </div>
            </div>

            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>

            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>

            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text">The cerebellum, located posterior to the brainstem, is the 'little brain.' It compares intended movements with actual movements to ensure smooth, coordinated skeletal muscle activity and maintain posture and balance.</div>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </main>

    <footer>
        &copy; 2025 EmbryoQuiz | Advanced Embryology Learning Platform | All Rights Reserved
    </footer>

    <script>
        const questions = [
    {
        "question": "Which of the following is NOT the concept of anatomy?",
        "options": ["Study of human body structure", "Study of structure relationships", "Physical examination is surface anatomy", "None of the above", "Study of organ function"],
        "answer": 3,
        "correctAnswer": "None of the above",
        "explanation": "All options A-C describe anatomy (structure, relationships, surface application); function is physiology. None is incorrect as all are valid. Misunderstanding anatomy risks diagnostic errors."
    },
    {
        "question": "Which of the following is NOT true about anatomical position?",
        "options": ["Palms stand erect facing forwards", "Upper extremities at sides", "Palms turned forward", "Head and eyes facing forwards", "Feet together"],
        "answer": 0,
        "correctAnswer": "Palms stand erect facing forwards",
        "explanation": "'Palms erect facing forwards' is vague; palms face anteriorly (C, D). Other options are correct. Incorrect positioning affects surgical orientation."
    },
    {
        "question": "The plane that divides the body into superior and inferior parts:",
        "options": ["Mid-sagittal section", "Coronal section", "Transverse section", "Oblique section", "Parasagittal section"],
        "answer": 2,
        "correctAnswer": "Transverse section",
        "explanation": "Transverse (horizontal) plane divides superior/inferior. Sagittal is medial/lateral, coronal is anterior/posterior, oblique is angled. Errors affect imaging interpretation."
    },
    {
        "question": "A patient is scheduled for thyroid surgery. In which position should you place the patient in the operation room?",
        "options": ["Flexion", "Left lateral", "Prone", "Supine", "Trendelenburg"],
        "answer": 3,
        "correctAnswer": "Supine",
        "explanation": "Supine (on back) allows neck access for thyroid surgery. Others are unsuitable. Incorrect positioning risks surgical complications."
    },
    {
        "question": "Langerhans cells are located in:",
        "options": ["Stratum basale", "Stratum lucidum", "Stratum corneum", "Stratum spinosum", "Stratum granulosum"],
        "answer": 3,
        "correctAnswer": "Stratum spinosum",
        "explanation": "Langerhans cells (immune) are in stratum spinosum. Others are incorrect layers. Defects cause immune-related skin disorders."
    },
    {
        "question": "Fingerprint patterns are established due to:",
        "options": ["Stratum corneum", "Dermal papillary layer", "Stratum basale", "Dermal reticular layer", "Hypodermis"],
        "answer": 1,
        "correctAnswer": "Dermal papillary layer",
        "explanation": "Dermal papillary layer’s ridges form fingerprints. Other layers don’t contribute directly. Abnormal ridges cause dermatoglyphic disorders."
    },
    {
        "question": "What area of the skin structure is responsible for 'goose bump' formation?",
        "options": ["Pacinian corpuscle", "Arrector pili muscle", "Meissner's corpuscle", "Sensory nerve fiber", "Hair follicle"],
        "answer": 1,
        "correctAnswer": "Arrector pili muscle",
        "explanation": "Arrector pili muscles contract for goose bumps. Others are sensory or structural. Dysfunction affects thermoregulation."
    },
    {
        "question": "All are capsulated sensory receptors in the skin except:",
        "options": ["Hair follicle receptors", "Pacinian corpuscles", "Ruffini ending", "Meissner's corpuscles", "Krause end bulbs"],
        "answer": 0,
        "correctAnswer": "Hair follicle receptors",
        "explanation": "Hair follicle receptors are unencapsulated; others are encapsulated. Errors affect sensory neuropathy diagnosis."
    },
    {
        "question": "Which of the following is/are true statement?",
        "options": ["Epiphysis ossifies from primary center", "Diaphysis ossifies from secondary center", "Epiphysis is most active for bone formation", "Epiphyseal line responsible for growth", "None"],
        "answer": 4,
        "correctAnswer": "None",
        "explanation": "Epiphysis is secondary, diaphysis is primary, plate (not epiphysis) forms bone, plate (not line) drives growth. Errors cause growth disorders like dwarfism."
    },
    {
        "question": "All of the following statements are false, except:",
        "options": ["Metaphysis has poor blood supply", "Endochondral ossification affects trunk", "Nutrient foramen opposite fibula growth", "Secondary ossification forms main bone", "All are false"],
        "answer": 2,
        "correctAnswer": "Nutrient foramen opposite fibula growth",
        "explanation": "Nutrient foramen is opposite fibula’s growing end; metaphysis has good supply, trunk is intramembranous, secondary forms ends. Errors cause osteomyelitis misdiagnosis."
    },
    {
        "question": "What is the difference between compact bone and spongy bone?",
        "options": ["Different bone marrow", "Different materials", "Different cell sizes", "Different cell arrangement", "Different density"],
        "answer": 3,
        "correctAnswer": "Different cell arrangement",
        "explanation": "Compact bone is dense with osteons; spongy is trabecular. Marrow, materials, cell sizes are similar, density is related but not primary. Errors affect fracture healing."
    },
    {
        "question": "Which of the following is/are true about classification of bone based on shape?",
        "options": ["Clavicle and vertebra are modified long bone", "Modified long bones fit medullary cavity", "Metacarpals, phalanges are typical long bones", "Epiphyseal line indicates growth beginning", "All are true"],
        "answer": 2,
        "correctAnswer": "Metacarpals, phalanges are typical long bones",
        "explanation": "Metacarpals, phalanges are long bones; clavicle is short, vertebrae irregular, modified bones lack medullary cavity, line indicates growth end. Errors affect bone classification."
    },
    {
        "question": "Which bone is not attached to any other bone in human body?",
        "options": ["Patella", "Hyoid bone", "Clavicle", "Malleus", "Incus"],
        "answer": 1,
        "correctAnswer": "Hyoid bone",
        "explanation": "Hyoid is suspended by ligaments/muscles, unattached to bones. Others articulate. Hyoid fractures risk airway obstruction."
    },
    {
        "question": "A thief was trying to escape, sustaining an open fracture where bone ends are forced together. This is a:",
        "options": ["Depression", "Greenstick", "Spiral", "Comminuted", "Compacted"],
        "answer": 4,
        "correctAnswer": "Compacted",
        "explanation": "Compacted (impacted) fracture involves bone ends driven together. Others are different patterns. Open fractures risk infection, needing surgery."
    },
    {
        "question": "Voluntary muscle is found at?",
        "options": ["Tongue", "Heart", "Stomach", "Uterine tube", "Bladder"],
        "answer": 0,
        "correctAnswer": "Tongue",
        "explanation": "Tongue has voluntary skeletal muscle; others are involuntary (cardiac, smooth). Errors cause motor dysfunction."
    },
    {
        "question": "An entire skeletal muscle is surrounded by:",
        "options": ["Epimysium", "Perimysium", "Tendon sheath", "Sarcoderma", "Endomysium"],
        "answer": 0,
        "correctAnswer": "Epimysium",
        "explanation": "Epimysium surrounds whole muscle; perimysium/endomysium cover fascicles/fibers, others are incorrect. Damage causes muscle weakness."
    },
    {
        "question": "Which of the following statements about smooth muscle is true?",
        "options": ["Peripheral nuclei", "Striated and involuntary", "Branching fibers", "Spindle-shaped fibers", "Rapid contractions"],
        "answer": 3,
        "correctAnswer": "Spindle-shaped fibers",
        "explanation": "Smooth muscle is spindle-shaped; nuclei are central, non-striated, non-branching, contractions slow. Errors affect gastrointestinal motility."
    },
    {
        "question": "Which muscle naming criteria are used to name the quadriceps femoris?",
        "options": ["Action and location", "Origin and insertion", "Location and fiber direction", "Location and number of origins", "Shape and size"],
        "answer": 3,
        "correctAnswer": "Location and number of origins",
        "explanation": "'Quad-' indicates four origins on femur. Others are incorrect criteria. Misnaming affects surgical identification."
    },
    {
        "question": "Which muscle is NOT named after its location in the body?",
        "options": ["Deltoid", "Extensor carpi ulnaris", "Rectus abdominis", "Biceps femoris", "Temporalis"],
        "answer": 3,
        "correctAnswer": "Biceps femoris",
        "explanation": "Biceps femoris is named for two heads, not location; others reflect location. Errors affect anatomical mapping."
    },
    {
        "question": "Which component of the cardiovascular system is involved in providing protection as the body’s second line of defense?",
        "options": ["Platelets", "Red blood cells", "White blood cells", "Formed elements", "Erythrocytes"],
        "answer": 2,
        "correctAnswer": "White blood cells",
        "explanation": "White blood cells (leukocytes) are immune defense. Others are clotting or oxygen transport. Errors cause immune deficiencies."
    },
    {
        "question": "Which of the following is TRUE regarding the cardiovascular system?",
        "options": ["Blood is stationary", "Venous drainage against gravity", "Coronary arteries are muscular", "Capillaries determine systemic circuits", "Musculo-venous pump is peripheral heart"],
        "answer": 4,
        "correctAnswer": "Musculo-venous pump is peripheral heart",
        "explanation": "Musculo-venous pump aids venous return; blood flows, veins use gravity/valves, coronary arteries are elastic, capillaries aid exchange. Errors cause venous insufficiency."
    },
    {
        "question": "Which of the following is TRUE regarding arterial anastomosis?",
        "options": ["Potential anastomosis is equal-sized arteries", "Actual anastomosis by terminal arterioles", "True end-anastomosis more serious", "Potential anastomosis at capillary level", "All are true"],
        "answer": 1,
        "correctAnswer": "Actual anastomosis by terminal arterioles",
        "explanation": "Actual anastomosis involves arteriolar unions; potential is pre-existing, severity varies, capillaries are microcirculation. Errors cause ischemic complications."
    },
    {
        "question": "Oligodendrocytes:",
        "options": ["Same as islets of Langerhans", "Same as microglia in CNS", "Same as microglia in PNS", "Same as Schwann cells in PNS", "Same as Schwann cells in CNS"],
        "answer": 4,
        "correctAnswer": "Same as Schwann cells in CNS",
        "explanation": "Oligodendrocytes myelinate CNS axons, like Schwann cells in PNS. Others are incorrect. Defects cause demyelinating diseases."
    },
    {
        "question": "Which of the following is TRUE regarding neurons?",
        "options": ["Cell body identical to other cells", "Dendrites only extensions", "Multipolar neurons most common in CNS", "Nodes of Ranvier are myelinated", "Sensory and motor neurons have ganglia"],
        "answer": 2,
        "correctAnswer": "Multipolar neurons most common in CNS",
        "explanation": "Multipolar neurons dominate CNS; cell body is unique, axons extend, nodes are unmyelinated, only sensory have ganglia. Errors cause neurological misdiagnosis."
    },
    {
        "question": "What are the two structural divisions of Peripheral Nervous System (PNS)?",
        "options": ["Somatic and autonomic", "Afferent and efferent", "Spinal and cranial nerves", "Sensory and motor", "Central and peripheral"],
        "answer": 0,
        "correctAnswer": "Somatic and autonomic",
        "explanation": "PNS divides into somatic (voluntary) and autonomic (involuntary). Others are functional/anatomical. Errors affect nerve function assessment."
    },
    {
        "question": "Which event is true regarding cleavage of zygote after 24 hours of fertilization?",
        "options": ["Meiotic division to blastomeres", "Highly differentiated blastomeres", "Increased cytoplasmic content", "Decrease in size, increase in blastomeres", "Increase in size, decrease in blastomeres"],
        "answer": 3,
        "correctAnswer": "Decrease in size, increase in blastomeres",
        "explanation": "Cleavage is mitotic, reducing blastomere size, increasing number. Others are incorrect. Errors cause embryonic arrest."
    },
    {
        "question": "Which of the following is incorrect regarding the phases of gametogenesis?",
        "options": ["Primordial germ cells from yolk sac", "Mitosis during migration", "Meiosis during migration", "Gamete differentiation", "All are correct"],
        "answer": 2,
        "correctAnswer": "Meiosis during migration",
        "explanation": "Meiosis occurs post-migration in gonads; others are correct. Errors cause infertility."
    },
    {
        "question": "The correct order in ovarian cycle is respectively:",
        "options": ["Folliculogenesis, corpus luteum, ovulation", "Corpus luteum, ovulation, folliculogenesis", "Ovulation, folliculogenesis, corpus luteum", "Folliculogenesis, ovulation, corpus luteum", "Corpus luteum, folliculogenesis, ovulation"],
        "answer": 3,
        "correctAnswer": "Folliculogenesis, ovulation, corpus luteum",
        "explanation": "Ovarian cycle: folliculogenesis, ovulation, corpus luteum. Errors cause hormonal imbalances."
    },
    {
        "question": "Which statement is true regarding the final fate of somites?",
        "options": ["Myotome forms skeletal muscle", "Sclerotome forms vertebrae/ribs", "From paraxial mesoderm", "Dermatome forms dermis", "All are true"],
        "answer": 2,
        "correctAnswer": "From paraxial mesoderm",
        "explanation": "Somites arise from paraxial mesoderm; A, B, D are fates but not the focus. Errors cause musculoskeletal defects."
    },
    {
        "question": "Primitive streak enables identification of the:",
        "options": ["Craniocaudal axis", "Cranial from caudal", "Dorsal from ventral", "Right from left", "Body cavity"],
        "answer": 0,
        "correctAnswer": "Craniocaudal axis",
        "explanation": "Primitive streak sets craniocaudal axis; others are secondary. Errors cause axial malformations."
    },
    {
        "question": "Which of the following are not derivatives of neural crest cells?",
        "options": ["Peripheral nervous system", "Chromaffin cells", "Schwann cells", "Odontoblasts", "Melanocytes"],
        "answer": 3,
        "correctAnswer": "Odontoblasts",
        "explanation": "Odontoblasts (dentin) are mesenchymal; others are neural crest. Errors cause craniofacial defects."
    },
    {
        "question": "In measuring the length of the embryo, which is the sitting height?",
        "options": ["Greatest length (GL)", "Crown-rump length (CRL)", "Crown-heel length (CHL)", "Carnegie staging", "Somite count"],
        "answer": 1,
        "correctAnswer": "Crown-rump length (CRL)",
        "explanation": "CRL measures sitting height. Others measure different aspects. Errors affect fetal growth assessment."
    },
    {
        "question": "Derivative of the branchial arch nerve includes the following except?",
        "options": ["1st arch: Trigeminal (V)", "2nd arch: Facial (VII)", "3rd arch: Glossopharyngeal (IX)", "4th arch: Vagus (X)", "6th arch: Accessory (XI)"],
        "answer": 4,
        "correctAnswer": "6th arch: Accessory (XI)",
        "explanation": "Accessory (XI) is not branchial; 6th arch relates to vagus (X). Errors cause cranial nerve misdiagnosis."
    },
    {
        "question": "Which embryonic cavity becomes the body cavity?",
        "options": ["Extraembryonic coelom", "Intraembryonic coelom", "Chorionic cavity", "Primitive yolk sac", "Exocoelomic cavity"],
        "answer": 1,
        "correctAnswer": "Intraembryonic coelom",
        "explanation": "Intraembryonic coelom forms body cavities (peritoneal, pleural, pericardial). Others are extraembryonic. Errors cause cavity malformations."
    },
    {
        "question": "Which of the following is false regarding embryonic folding?",
        "options": ["Occurs in 3rd week", "Due to differential growth", "Longitudinal folding bends embryo", "Heart/oropharynx move caudally", "All gut formed by yolk sac"],
        "answer": 4,
        "correctAnswer": "All gut formed by yolk sac",
        "explanation": "Gut is partially from yolk sac; others are true. Errors cause gut malformations."
    },
    {
        "question": "Which of the following is false regarding human placenta?",
        "options": ["Fetal part: chorionic frondosum", "Maternal part: decidua basalis", "Hemochorial type", "Nitabuch’s layer on chorionic plate", "Two-layer membrane in 3rd trimester"],
        "answer": 3,
        "correctAnswer": "Nitabuch’s layer on chorionic plate",
        "explanation": "Nitabuch’s layer is in decidua basalis; three-four layers persist. Errors cause placental dysfunction."
    },
    {
        "question": "The right & left crus of diaphragm is developed from:",
        "options": ["Septum transversum", "Pleuroperitoneal membranes", "Dorsal mesentery of esophagus", "Mesoderm of body wall", "Paraxial mesoderm"],
        "answer": 3,
        "correctAnswer": "Mesoderm of body wall",
        "explanation": "Crus derive from somatic mesoderm; others form other diaphragm parts. Errors cause diaphragmatic hernia."
    },
    {
        "question": "Which one is incorrectly matched regarding pharyngeal arches?",
        "options": ["1st pouch: Auditory tube", "4th pouch: Ultimo-branchial body", "2nd-4th membrane: disappear cartilages", "4th/6th arch: laryngeal cartilages", "None"],
        "answer": 2,
        "correctAnswer": "2nd-4th membrane: disappear cartilages",
        "explanation": "2nd-4th membranes form cartilages; others are correct. Errors cause pharyngeal defects."
    },
    {
        "question": "Which one of the following is incorrectly matched?",
        "options": ["Malformation: abnormal process", "Most anomalies detected at five years", "Teratogenic pre-embryonic: major anomaly", "Dysplasia: abnormal cell organization", "All are correct"],
        "answer": 1,
        "correctAnswer": "Most anomalies detected at five years",
        "explanation": "Anomalies are detected at birth/earlier; others are correct. Delayed detection risks untreated congenital defects."
    },
    {
        "question": "Hypoplasia of the mandible, cleft palate, micrognathia are features of:",
        "options": ["Treacher Collins syndrome", "Pierre Robin syndrome", "DiGeorge syndrome", "Treacher Collins and Pierre Robin", "None"],
        "answer": 3,
        "correctAnswer": "Treacher Collins and Pierre Robin",
        "explanation": "Both syndromes feature these; DiGeorge affects thymus/parathyroids. Errors cause misdiagnosis."
    },
    {
        "question": "Which one of the following is/are NOT a correct description about tissues?",
        "options": ["Tissues are cells and intracellular matrix", "Microvilli form brush border", "Transitional epithelium varies with distension", "Non-keratinized epithelium in dry regions", "Epithelial tissue has minimal matrix"],
        "answer": 4,
        "correctAnswer": "Non-keratinized epithelium in dry regions",
        "explanation": "Non-keratinized epithelium is in moist areas; others are correct. Errors affect tissue repair understanding."
    },
    {
        "question": "Which reason makes histology dependent on microscopes?",
        "options": ["Small size of cells and matrix", "Small size of tissues", "Small size of organs", "All of the above", "None"],
        "answer": 0,
        "correctAnswer": "Small size of cells and matrix",
        "explanation": "Histology requires microscopy for cells/matrix; tissues/organs are larger. Errors miss cellular pathology."
    },
    {
        "question": "Which body tissue is most frequently subject to wear and tear due to its superficial location?",
        "options": ["Nervous tissue", "Muscle tissue", "Connective tissue", "Epithelial tissue", "Adipose tissue"],
        "answer": 3,
        "correctAnswer": "Epithelial tissue",
        "explanation": "Epithelial tissue lines surfaces, facing wear; others are deeper. Damage risks infection."
    },
    {
        "question": "Which description about epithelial tissues is wrong?",
        "options": ["On free surfaces/cavities", "From all germ layers", "Cells have structural modifications", "Avascular", "Rest on basal lamina"],
        "answer": 1,
        "correctAnswer": "From all germ layers",
        "explanation": "Epithelium is mainly ectoderm/endoderm; others are correct. Errors affect repair strategies."
    },
    {
        "question": "Which histological feature distinguishes connective tissue from other basic tissues?",
        "options": ["Highest cellularity", "Abundant cellular junctions", "Abundant intercellular substance", "Presence of blood vessels", "Presence of nerve endings"],
        "answer": 2,
        "correctAnswer": "Abundant intercellular substance",
        "explanation": "Connective tissue has abundant matrix; cellularity/junctions are epithelial, vessels/nerves not unique. Errors cause tissue weakness."
    },
    {
        "question": "Tendons, ligaments, retinacula, cartilages, or bones are chiefly composed of:",
        "options": ["Epithelial tissue", "Nervous tissue", "Muscle tissue", "Connective tissue", "Adipose tissue"],
        "answer": 3,
        "correctAnswer": "Connective tissue",
        "explanation": "These are connective tissues; others are incorrect. Injuries (e.g., ligament tears) need repair."
    },
    {
        "question": "The basic tissue type that constitutes the brain and spinal cord is:",
        "options": ["Connective tissue", "Skeletal tissue", "Blood tissue", "Nervous tissue", "Epithelial tissue"],
        "answer": 3,
        "correctAnswer": "Nervous tissue",
        "explanation": "Brain/spinal cord are nervous tissue; others are incorrect. Damage causes neurological deficits."
    },
    {
        "question": "Most tissues undergo constant cell turnover because of continuous cell division and death. Which type?",
        "options": ["Connective tissue", "Muscle tissue", "Epithelial tissue", "Nervous tissue", "Adipose tissue"],
        "answer": 2,
        "correctAnswer": "Epithelial tissue",
        "explanation": "Epithelial tissue (e.g., skin) has high turnover; others are slower. Errors cause ulcers."
    },
    {
        "question": "Each biological tissue consists of two interacting structural components known as ______ and ______.",
        "options": [],
        "answer": null,
        "correctAnswer": "Cells and extracellular matrix",
        "explanation": "Tissues comprise cells and matrix. Errors affect tissue engineering."
    },
    {
        "question": "Nerve tissues are principally composed of two groups of cells: These are ______ and ______.",
        "options": [],
        "answer": null,
        "correctAnswer": "Neurons and neuroglia",
        "explanation": "Nerve tissue has neurons (signal) and neuroglia (support). Errors cause neurological disorders."
    }
];

        // DOM Elements
        let body = document.body;
        let questionElement = document.getElementById('question');
        let optionsContainer = document.getElementById('options-container');
        let currentQuestionElement = document.getElementById('current-question');
        let totalQuestionsElement = document.getElementById('total-questions');
        let progressBar = document.getElementById('progress-bar');
        let prevButton = document.getElementById('prev-btn');
        let nextButton = document.getElementById('next-btn');
        let feedbackElement = document.getElementById('feedback');
        let timerElement = document.getElementById('timer');
        let scoreElement = document.getElementById('score');
        let streakElement = document.getElementById('streak');
        let categoryElement = document.getElementById('category');
        let explanationContainer = document.getElementById('explanation-container');
        let explanationTextElement = document.getElementById('explanation-text');
        let themeToggle = document.getElementById('theme-toggle');
        let soundToggle = document.getElementById('sound-toggle');
        let bookmarkBtn = document.getElementById('bookmark-btn');
        let bookmarksCount = document.getElementById('bookmarks-count');
        let categoryTag = document.getElementById('category-tag');
        let difficultyTag = document.getElementById('difficulty-tag');
        let showExplanationBtn = document.getElementById('show-explanation-btn');

        // Quiz state
        let currentQuestionIndex = 0;
        let score = 0;
        let streak = 0;
        let selectedOption = null;
        let timeStarted = null;
        let timerInterval = null;
        let timeElapsed = 0;
        let answers = [];
        let soundsEnabled = true;
        let bookmarkedQuestions = [];
        let quizHistory = [];
        let performanceMetrics = {
            categories: {},
            difficulties: { Easy: 0, Medium: 0, Hard: 0 },
            totalCorrect: 0,
            totalQuestions: 0
        };

        function initQuiz() {
            // Reset DOM elements
            scoreElement.textContent = score;
            streakElement.textContent = streak;
            timerElement.textContent = '00:00';
            totalQuestionsElement.textContent = questions.length;
            
            loadQuestion();
            startTimer();
            
            // Remove existing event listeners to prevent duplicates
            const prevBtnClone = prevButton.cloneNode(true);
            prevButton.parentNode.replaceChild(prevBtnClone, prevButton);
            const nextBtnClone = nextButton.cloneNode(true);
            nextButton.parentNode.replaceChild(nextBtnClone, nextButton);
            const themeToggleClone = themeToggle.cloneNode(true);
            themeToggle.parentNode.replaceChild(themeToggleClone, themeToggle);
            const soundToggleClone = soundToggle.cloneNode(true);
            soundToggle.parentNode.replaceChild(soundToggleClone, soundToggle);
            const bookmarkBtnClone = bookmarkBtn.cloneNode(true);
            bookmarkBtn.parentNode.replaceChild(bookmarkBtnClone, bookmarkBtn);
            const showExplanationBtnClone = showExplanationBtn.cloneNode(true);
            showExplanationBtn.parentNode.replaceChild(showExplanationBtnClone, showExplanationBtn);

            // Reassign DOM elements after cloning
            prevButton = document.getElementById('prev-btn');
            nextButton = document.getElementById('next-btn');
            themeToggle = document.getElementById('theme-toggle');
            soundToggle = document.getElementById('sound-toggle');
            bookmarkBtn = document.getElementById('bookmark-btn');
            showExplanationBtn = document.getElementById('show-explanation-btn');

            // Add event listeners
            prevButton.addEventListener('click', goToPreviousQuestion);
            nextButton.addEventListener('click', goToNextQuestion);
            themeToggle.addEventListener('click', toggleTheme);
            soundToggle.addEventListener('click', toggleSound);
            bookmarkBtn.addEventListener('click', toggleBookmark);
            showExplanationBtn.addEventListener('click', toggleExplanation);
            
            // Keyboard navigation
            document.removeEventListener('keydown', handleKeydown);
            document.addEventListener('keydown', handleKeydown);
            
            loadPreferences();
            loadQuizHistory();
            updateBookmarksCount();
        }

        function handleKeydown(e) {
            if (e.key === 'ArrowRight') {
                goToNextQuestion();
            } else if (e.key === 'ArrowLeft') {
                goToPreviousQuestion();
            } else if (e.key.toLowerCase() === 'a' || e.key === '1') {
                selectOption(0);
            } else if (e.key.toLowerCase() === 'b' || e.key === '2') {
                selectOption(1);
            } else if (e.key.toLowerCase() === 'c' || e.key === '3') {
                selectOption(2);
            } else if (e.key.toLowerCase() === 'd' || e.key === '4') {
                selectOption(3);
            } else if (e.key === 'Enter') {
                if (showExplanationBtn.style.display !== 'none') {
                    toggleExplanation();
                }
            }
        }

        function loadQuestion() {
            const question = questions[currentQuestionIndex];
            questionElement.textContent = question.question;
            currentQuestionElement.textContent = currentQuestionIndex + 1;
            categoryTag.textContent = question.category || 'Unknown';
            difficultyTag.textContent = question.difficulty || 'Medium';
            categoryElement.textContent = question.category || 'All';
            
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Update progress level for appearance change
            let progressLevel = 0;
            if (progress > 75) progressLevel = 75;
            else if (progress > 50) progressLevel = 50;
            else if (progress > 25) progressLevel = 25;
            body.setAttribute('data-progress', progressLevel);
            
            optionsContainer.innerHTML = '';
            
            const optionLetters = ['A', 'B', 'C', 'D'];
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option', 'bounce-in');
                optionElement.setAttribute('role', 'button');
                optionElement.setAttribute('tabindex', '0');
                optionElement.setAttribute('aria-label', `Option ${optionLetters[index]}: ${option}`);
                
                const optionLetter = document.createElement('div');
                optionLetter.classList.add('option-letter');
                optionLetter.textContent = optionLetters[index];
                
                const optionText = document.createElement('div');
                optionText.classList.add('option-text');
                optionText.textContent = option;
                
                optionElement.appendChild(optionLetter);
                optionElement.appendChild(optionText);
                
                optionElement.addEventListener('click', () => selectOption(index));
                optionElement.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        selectOption(index);
                    }
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            prevButton.disabled = currentQuestionIndex === 0;
            nextButton.textContent = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz' : 'Next Question';
            
            feedbackElement.style.display = 'none';
            showExplanationBtn.style.display = 'none';
            explanationContainer.classList.remove('expanded');
            
            selectedOption = null;
            
            // If the question was previously answered or skipped, display the feedback
            if (answers[currentQuestionIndex]) {
                const ans = answers[currentQuestionIndex];
                const options = document.querySelectorAll('.option');
                feedbackElement.style.display = 'flex';
                showExplanationBtn.style.display = 'block';
                explanationTextElement.textContent = question.explanation;
                options.forEach(option => option.style.pointerEvents = 'none');
                
                if (ans.selected === 'Skipped') {
                    selectedOption = null;
                    feedbackElement.classList.add('incorrect');
                    feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
                    options[question.answer].classList.add('correct');
                } else {
                    const optIndex = question.options.findIndex(opt => opt === ans.selected);
                    if (optIndex !== -1) {
                        selectedOption = optIndex;
                        options[optIndex].classList.add('selected');
                        if (ans.isCorrect) {
                            feedbackElement.classList.add('correct');
                            feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                        } else {
                            feedbackElement.classList.add('incorrect');
                            feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                            options[question.answer].classList.add('correct');
                        }
                    }
                }
            }
            
            updateBookmarkStatus();
        }

        function selectOption(index) {
            if (selectedOption !== null || answers[currentQuestionIndex]) return;
            
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            selectedOption = index;
            
            const question = questions[currentQuestionIndex];
            const isCorrect = index === question.answer;
            
            feedbackElement.style.display = 'flex';
            if (isCorrect) {
                feedbackElement.classList.remove('incorrect');
                feedbackElement.classList.add('correct');
                feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                score += getScoreForDifficulty(question.difficulty);
                streak++;
                playSound('correct');
            } else {
                feedbackElement.classList.remove('correct');
                feedbackElement.classList.add('incorrect');
                feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                options[question.answer].classList.add('correct');
                streak = 0;
                playSound('incorrect');
            }
            
            scoreElement.textContent = score;
            streakElement.textContent = streak;
            
            explanationTextElement.textContent = question.explanation;
            showExplanationBtn.style.display = 'block';
            
            answers[currentQuestionIndex] = {
                question: question.question,
                selected: question.options[index],
                correct: question.options[question.answer],
                isCorrect: isCorrect,
                explanation: question.explanation,
                category: question.category,
                difficulty: question.difficulty
            };
            
            updatePerformanceMetrics(isCorrect, question);
            
            options.forEach(option => option.style.pointerEvents = 'none');
        }

        function maybeHandleSkip() {
            if (!answers[currentQuestionIndex] && selectedOption === null) {
                const question = questions[currentQuestionIndex];
                answers[currentQuestionIndex] = {
                    question: question.question,
                    selected: 'Skipped',
                    correct: question.options[question.answer],
                    isCorrect: false,
                    explanation: question.explanation,
                    category: question.category,
                    difficulty: question.difficulty
                };
                updatePerformanceMetrics(false, question);
                streak = 0;
                streakElement.textContent = streak;
            }
        }

        function toggleExplanation() {
            explanationContainer.classList.toggle('expanded');
            showExplanationBtn.innerHTML = explanationContainer.classList.contains('expanded') ?
                '<i class="fas fa-info-circle"></i> Hide Explanation' :
                '<i class="fas fa-info-circle"></i> Show Explanation';
        }

        function getScoreForDifficulty(difficulty) {
            switch (difficulty) {
                case 'Easy': return 5;
                case 'Medium': return 10;
                case 'Hard': return 15;
                default: return 10;
            }
        }

        function updatePerformanceMetrics(isCorrect, question) {
            performanceMetrics.totalQuestions++;
            if (isCorrect) performanceMetrics.totalCorrect++;
            
            performanceMetrics.categories[question.category] = performanceMetrics.categories[question.category] || { correct: 0, total: 0 };
            performanceMetrics.categories[question.category].total++;
            if (isCorrect) performanceMetrics.categories[question.category].correct++;
            
            performanceMetrics.difficulties[question.difficulty] = performanceMetrics.difficulties[question.difficulty] || 0;
            if (isCorrect) performanceMetrics.difficulties[question.difficulty]++;
        }

        function toggleBookmark() {
            const questionId = questions[currentQuestionIndex].id;
            const index = bookmarkedQuestions.indexOf(questionId);
            if (index === -1) {
                bookmarkedQuestions.push(questionId);
                bookmarkBtn.classList.add('bookmarked');
            } else {
                bookmarkedQuestions.splice(index, 1);
                bookmarkBtn.classList.remove('bookmarked');
            }
            updateBookmarksCount();
            saveBookmarks();
        }

        function updateBookmarkStatus() {
            const questionId = questions[currentQuestionIndex].id;
            bookmarkBtn.classList.toggle('bookmarked', bookmarkedQuestions.includes(questionId));
        }

        function updateBookmarksCount() {
            bookmarksCount.textContent = bookmarkedQuestions.length;
        }

        function goToNextQuestion() {
            maybeHandleSkip();
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                body.setAttribute('data-progress', '100');
                showResults();
                saveQuizHistory();
            }
        }

        function goToPreviousQuestion() {
            maybeHandleSkip();
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function startTimer() {
            timeStarted = new Date();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            timeElapsed++;
            
            const minutes = Math.floor(timeElapsed / 60).toString().padStart(2, '0');
            const seconds = (timeElapsed % 60).toString().padStart(2, '0');
            timerElement.textContent = `${minutes}:${seconds}`;
            
            // Optional: Add warning color for long durations (e.g., after 5 minutes)
            if (timeElapsed >= 300) {
                timerElement.style.color = 'var(--danger)';
                timerElement.classList.add('pulse');
            } else {
                timerElement.style.color = 'var(--primary)';
                timerElement.classList.remove('pulse');
            }
        }

        function showResults() {
            clearInterval(timerInterval);
            
            const quizContainer = document.querySelector('.quiz-container');
            const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
            const percentage = ((score / maxScore) * 100).toFixed(1);
            const categoryStats = Object.entries(performanceMetrics.categories)
                .map(([category, stats]) => `${category}: ${((stats.correct / stats.total) * 100).toFixed(1)}%`)
                .join(', ');
            
            quizContainer.innerHTML = `
                <div class="results-container">
                    <h2 class="quiz-title">Quiz Completed!</h2>
                    <p class="quiz-subtitle">You've finished the embryology quiz</p>
                    
                    <div class="score-circle" style="--p: ${percentage}%">
                        <div class="score-text">
                            <div class="score-value">${score}</div>
                            <div class="score-label">Points</div>
                        </div>
                    </div>
                    
                    <div class="results-stats">
                        <div class="result-stat">
                            <div class="result-stat-value">${percentage}%</div>
                            <div class="result-stat-label">Accuracy</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${timeElapsed}s</div>
                            <div class="result-stat-label">Time Taken</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${streak}</div>
                            <div class="result-stat-label">Best Streak</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${bookmarkedQuestions.length}</div>
                            <div class="result-stat-label">Bookmarked</div>
                        </div>
                    </div>
                    
                    <div class="review-section">
                        <h3 class="review-title">Performance Analytics</h3>
                        <div class="review-item">
                            <div class="review-answer">Category Performance: ${categoryStats}</div>
                            <div class="review-answer">Difficulty Performance: Easy: ${performanceMetrics.difficulties.Easy || 0}, Medium: ${performanceMetrics.difficulties.Medium || 0}, Hard: ${performanceMetrics.difficulties.Hard || 0}</div>
                        </div>
                        
                        <h3 class="review-title">Review Your Answers</h3>
                        ${answers.map((answer, index) => `
                            <div class="review-item ${answer.isCorrect ? 'correct' : 'incorrect'}">
                                <div class="review-question">Q${index + 1}: ${answer.question} (${answer.category} - ${answer.difficulty})</div>
                                <div class="review-answer">Your Answer: ${answer.selected}</div>
                                <div class="review-answer">Correct Answer: ${answer.correct}</div>
                                <div class="review-explanation">${answer.explanation}</div>
                            </div>
                        `).join('')}
                        
                        <h3 class="review-title">Bookmarked Questions</h3>
                        ${bookmarkedQuestions.map(qid => {
                            const question = questions.find(q => q.id === qid);
                            return `
                                <div class="review-item">
                                    <div class="review-question">${question.question} (${question.category} - ${question.difficulty})</div>
                                    <div class="review-answer">Correct Answer: ${question.correctAnswer}</div>
                                    <div class="review-explanation">${question.explanation}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <button class="btn btn-primary mt-4" id="restart-btn">
                        <i class="fas fa-redo"></i> Try Again
                    </button>
                </div>
            `;
            
            document.getElementById('restart-btn').addEventListener('click', restartQuiz);
        }

        function restartQuiz() {
            // Reset quiz state
            currentQuestionIndex = 0;
            score = 0;
            streak = 0;
            timeElapsed = 0;
            answers = [];
            selectedOption = null;
            performanceMetrics = {
                categories: {},
                difficulties: { Easy: 0, Medium: 0, Hard: 0 },
                totalCorrect: 0,
                totalQuestions: 0
            };
            
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            body.setAttribute('data-progress', '0');
            
            // Reset DOM
            const quizContainer = document.querySelector('.quiz-container');
            quizContainer.innerHTML = `
                <div class="quiz-header">
                    <div>
                        <h1 class="quiz-title">Advanced Embryology Quiz</h1>
                        <p class="quiz-subtitle">Test your knowledge with professional questions and detailed explanations</p>
                    </div>
                    <div class="stats-container">
                        <div class="stat">
                            <span class="stat-value" id="score">0</span>
                            <span class="stat-label">Score</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="timer">00:00</span>
                            <span class="stat-label">Time</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="streak">0</span>
                            <span class="stat-label">Streak</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="category">All</span>
                            <span class="stat-label">Category</span>
                        </div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
                </div>

                <div class="question-meta">
                    <div class="question-tags">
                        <span class="tag" id="category-tag">Neuro</span>
                        <span class="tag" id="difficulty-tag">Medium</span>
                    </div>
                    <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                        <i class="fas fa-bookmark"></i>
                    </button>
                </div>
                <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">10</span></div>
                <div class="question-text" id="question"></div>

                <div class="options-grid" id="options-container"></div>

                <div class="feedback correct" id="feedback" style="display: none;">
                    <i class="fas fa-check-circle feedback-icon"></i>
                    <div class="feedback-text">Correct! Well done.</div>
                </div>

                <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                    <i class="fas fa-info-circle"></i> Show Explanation
                </button>

                <div class="explanation-container" id="explanation-container">
                    <div class="explanation">
                        <div class="explanation-title">Explanation:</div>
                        <div id="explanation-text"></div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="btn btn-secondary" id="prev-btn" disabled>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-primary" id="next-btn">
                        Next Question <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            `;
            
            // Reinitialize DOM elements
            questionElement = document.getElementById('question');
            optionsContainer = document.getElementById('options-container');
            currentQuestionElement = document.getElementById('current-question');
            totalQuestionsElement = document.getElementById('total-questions');
            progressBar = document.getElementById('progress-bar');
            prevButton = document.getElementById('prev-btn');
            nextButton = document.getElementById('next-btn');
            feedbackElement = document.getElementById('feedback');
            timerElement = document.getElementById('timer');
            scoreElement = document.getElementById('score');
            streakElement = document.getElementById('streak');
            categoryElement = document.getElementById('category');
            explanationContainer = document.getElementById('explanation-container');
            explanationTextElement = document.getElementById('explanation-text');
            bookmarkBtn = document.getElementById('bookmark-btn');
            bookmarksCount = document.getElementById('bookmarks-count');
            categoryTag = document.getElementById('category-tag');
            difficultyTag = document.getElementById('difficulty-tag');
            showExplanationBtn = document.getElementById('show-explanation-btn');
            
            // Reinitialize the quiz
            initQuiz();
        }

        function toggleTheme() {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 
                            currentTheme === 'light' ? 'minimal' : 'dark';
            
            body.setAttribute('data-theme', newTheme);
            themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-moon"></i>' : 
                                  newTheme === 'light' ? '<i class="fas fa-sun"></i>' : 
                                  '<i class="fas fa-paint-brush"></i>';
            
            localStorage.setItem('theme', newTheme);
        }

        function toggleSound() {
            soundsEnabled = !soundsEnabled;
            soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
            
            localStorage.setItem('soundsEnabled', soundsEnabled);
        }

        function playSound(type) {
            if (!soundsEnabled) return;
            console.log(`Playing ${type} sound`);
        }

        function loadPreferences() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                body.setAttribute('data-theme', savedTheme);
                themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-moon"></i>' : 
                                      savedTheme === 'light' ? '<i class="fas fa-sun"></i>' : 
                                      '<i class="fas fa-paint-brush"></i>';
            }
            
            const savedSounds = localStorage.getItem('soundsEnabled');
            if (savedSounds !== null) {
                soundsEnabled = savedSounds === 'true';
                soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
            }
        }

        function saveBookmarks() {
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarkedQuestions));
        }

        function loadQuizHistory() {
            const saved = localStorage.getItem('quizHistory');
            if (saved) {
                quizHistory = JSON.parse(saved);
            }
            loadBookmarks();
        }

        function saveQuizHistory() {
            quizHistory.push({
                timestamp: new Date().toISOString(),
                score: score,
                percentage: ((score / (questions.length * 15)) * 100).toFixed(1),
                timeSpent: timeElapsed,
                streak: streak,
                answers: answers,
                performanceMetrics: performanceMetrics
            });
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
        }

        function loadBookmarks() {
            const saved = localStorage.getItem('bookmarkedQuestions');
            if (saved) {
                bookmarkedQuestions = JSON.parse(saved);
            }
        }

        window.addEventListener('DOMContentLoaded', initQuiz);
    </script>
</body>
</html>