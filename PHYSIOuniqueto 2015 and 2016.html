<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MED QUIZ Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #f72585;
            --success: #4cc9f0;
            --warning: #f9c74f;
            --danger: #f94144;
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f5;
            --gray-800: #343a40;
            --gray-900: #212529;
            --bg-primary: var(--gray-900);
            --bg-secondary: #1a1d21;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --card-bg: rgba(35, 39, 47, 0.95);
            --card-border: #4cc9f0;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --transition: all 0.2s ease-in-out;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --header-height: 50px;
            --max-width: 800px;
            --side-padding: 1rem;
            --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
        }

        [data-theme="light"] {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --text-primary: #1a1d21;
            --text-secondary: rgba(26, 29, 33, 0.7);
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            line-height: 1.5;
            font-weight: 400;
            overflow-x: hidden;
            padding: 0;
        }

        /* Compact Header */
        header {
            height: var(--header-height);
            background: var(--gradient-primary);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--side-padding);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            color: white;
        }

        .logo-icon {
            font-size: 1.25rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 1.5rem var(--side-padding);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .quiz-container {
            width: 100%;
            max-width: var(--max-width);
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 1px solid var(--card-border);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .quiz-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .quiz-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .stats-container {
            display: flex;
            gap: 0.75rem;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            min-width: 60px;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1rem;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius-md);
            overflow: hidden;
            margin: 1.5rem 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            transition: width 0.4s ease;
        }

        /* Question Meta */
        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            padding: 0.25rem 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .difficulty-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .difficulty-easy { background-color: var(--success); }
        .difficulty-medium { background-color: var(--warning); }
        .difficulty-hard { background-color: var(--danger); }

        .bookmark-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .bookmark-btn.bookmarked {
            color: var(--warning);
        }

        /* Question */
        .question-number {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            text-align: center;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            border-color: var(--primary-light);
        }

        .option.selected {
            background: rgba(67, 97, 238, 0.15);
            border-color: var(--primary);
        }

        .option.correct {
            background: rgba(76, 201, 240, 0.15);
            border-color: var(--success);
        }

        .option.incorrect {
            background: rgba(249, 65, 68, 0.15);
            border-color: var(--danger);
        }

        .option-letter {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--danger);
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 0.95rem;
        }

        /* Feedback */
        .feedback {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
        }

        .feedback.correct {
            background: rgba(76, 201, 240, 0.15);
            color: var(--success);
        }

        .feedback.incorrect {
            background: rgba(249, 65, 68, 0.15);
            color: var(--danger);
        }

        .feedback.skipped {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary);
        }

        .feedback-icon {
            font-size: 1.25rem;
        }

        /* Explanation */
        .explanation-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .explanation-container.expanded {
            max-height: 500px;
        }

        .explanation {
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .explanation-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            font-size: 0.9rem;
            flex: 1;
            justify-content: center;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255,255,255,0.2);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Study Mode Toggle */
        .study-mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            justify-content: center;
            font-size: 0.9rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Results */
        .results-container {
            text-align: center;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: conic-gradient(var(--gradient-primary) 0% var(--p, 0%), var(--bg-secondary) var(--p, 0%) 100%);
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--card-bg);
        }

        .score-text {
            position: relative;
            z-index: 1;
        }

        .score-value {
            font-size: 1.75rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .result-stat {
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
        }

        .result-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .result-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .review-section {
            margin-top: 2rem;
            text-align: left;
        }

        .review-title {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary);
            text-align: center;
        }

        .review-item {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            background: rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }

        .review-item.correct {
            border-left: 3px solid var(--success);
        }

        .review-item.incorrect {
            border-left: 3px solid var(--danger);
        }

        .review-item.skipped {
            border-left: 3px solid var(--primary);
        }

        .review-question {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .review-answer {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
        }

        .review-explanation {
            color: var(--text-secondary);
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        footer {
            padding: 2rem var(--side-padding);
            background: var(--bg-secondary);
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            margin-top: auto;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal {
            background: var(--card-bg);
            border-radius: var(--radius-2xl);
            padding: 2.5rem;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: translateY(-50px) scale(0.95);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--card-border);
        }
        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-base);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: rgba(255,255,255,0.1);
            color: var(--primary);
        }
        .modal-body {
            margin-bottom: 2rem;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        .difficulty-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.75rem;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .difficulty-easy {
            background-color: var(--success);
            box-shadow: 0 0 10px var(--success);
        }
        .difficulty-medium {
            background-color: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }
        .difficulty-hard {
            background-color: var(--danger);
            box-shadow: 0 0 10px var(--danger);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition-base);
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .stat-card-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .stat-card-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--gradient-primary);
            opacity: 0;
            border-radius: 2px;
        }
        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(-100px) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }
        .fab {
            position: fixed;
            bottom: 2.5rem;
            right: 2.5rem;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            box-shadow: var(--shadow-xl);
            cursor: pointer;
            z-index: 100;
            transition: var(--transition-smooth);
            border: 3px solid rgba(255,255,255,0.2);
        }
        .fab:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 20px 40px rgba(67, 97, 238, 0.3);
        }
        .study-mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-lg);
            justify-content: center;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .toggle-slider {
            background-color: var(--primary);
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.5);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(32px);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease;
        }
        .pulse {
            animation: pulse 1s infinite;
        }
        .bounce-in {
            animation: bounceIn 0.6s ease;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        .text-center {
            text-align: center;
        }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .full-width {
            width: 100%;
        }
        @media (max-width: 768px) {
            :root {
                --side-padding: 1rem;
                --header-height: 50px;
            }
            .quiz-container {
                padding: 2rem;
                border-radius: var(--radius-xl);
            }
            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.5rem;
            }
            .stats-container {
                width: 100%;
                justify-content: space-between;
            }
            .results-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .score-circle {
                width: 140px;
                height: 140px;
            }
            .score-circle::before {
                width: 110px;
                height: 110px;
            }
            .score-value {
                font-size: 2.25rem;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .fab {
                bottom: 1.5rem;
                right: 1.5rem;
                width: 55px;
                height: 55px;
                font-size: 1.5rem;
            }
            .navigation {
                flex-direction: column;
            }
            .btn {
                width: 100%;
            }
            .options-grid {
                grid-template-columns: 1fr;
            }
            .options-grid .option:nth-child(1),
            .options-grid .option:nth-child(2),
            .options-grid .option:nth-child(3),
            .options-grid .option:nth-child(4) {
                grid-column: auto;
            }
        }
        @media (max-width: 480px) {
            .option {
                padding: 1rem;
            }
            .option-letter {
                width: 32px;
                height: 32px;
                margin-right: 1rem;
            }
            .quiz-title {
                font-size: 1.5rem;
            }
            .question-text {
                font-size: 1.1rem;
            }
        }
        /* Explanation Section Styling */
.explanation-container {
    background: var(--background-secondary, #f8f9fa); /* Light background for contrast */
    border-radius: 12px; /* Rounded corners */
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
    transition: all 0.3s ease; /* Smooth transition for expand/collapse */
    border: 1px solid var(--border-color, #e0e0e0); /* Subtle border */
}

.explanation-container.expanded {
    max-height: 800px; /* Increased max-height for content */
    opacity: 1;
    transform: translateY(0); /* Smooth slide-in effect */
}

.explanation-container:not(.expanded) {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transform: translateY(-10px); /* Slight upward shift when hidden */
}

.explanation {
    display: flex;
    flex-direction: column;
    gap: 12px; /* Spacing between title and text */
}

.explanation-title {
    font-size: 1.25rem; /* Slightly larger for emphasis */
    font-weight: 600;
    color: var(--primary, #4361ee); /* Match quiz primary color */
    border-bottom: 2px solid var(--primary-light, #4cc9f0); /* Underline effect */
    padding-bottom: 8px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.explanation-title::before {
    content: "\f05a"; /* Font Awesome info-circle icon */
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    color: var(--primary, #4361ee);
    font-size: 1.2rem;
}

#explanation-text {
    font-size: 1rem;
    line-height: 1.6; /* Improved readability */
    color: var(--text-color, #333);
}

/* Styling for the "Why Not Other Options" list */
#explanation-text ul {
    list-style: none; /* Remove default bullets */
    padding: 0;
    margin: 16px 0 0 0;
}

#explanation-text li {
    position: relative;
    padding-left: 28px; /* Space for custom bullet */
    margin-bottom: 12px; /* Spacing between items */
    font-size: 0.95rem;
    line-height: 1.5;
    color: var(--text-secondary, #555);
    transition: transform 0.2s ease, background 0.2s ease;
}

#explanation-text li::before {
    content: "\f00d"; /* Font Awesome times-circle icon for incorrect options */
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    color: var(--danger, #f72585); /* Red/pink for incorrect options */
    position: absolute;
    left: 0;
    top: 4px;
    font-size: 1rem;
}

#explanation-text li strong {
    color: var(--text-color, #333); /* Darker color for option labels */
    font-weight: 600;
}

/* Hover effect for list items */
#explanation-text li:hover {
    background: var(--background-hover, rgba(67, 97, 238, 0.1)); /* Subtle highlight */
    border-radius: 6px;
    transform: translateX(4px); /* Slight shift for interactivity */
    padding-left: 32px; /* Adjust for hover */
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .explanation-container {
        padding: 15px;
        margin-top: 15px;
    }

    .explanation-title {
        font-size: 1.1rem;
    }

    #explanation-text {
        font-size: 0.95rem;
    }

    #explanation-text li {
        font-size: 0.9rem;
        padding-left: 24px;
        margin-bottom: 10px;
    }
}

/* Animation for expanding explanation */
@keyframes explanationFadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.explanation-container.expanded .explanation {
    animation: explanationFadeIn 0.3s ease;
}

/* Ensure consistency with theme variables */
:root {
    --background-secondary: #f8f9fa;
    --border-color: #e0e0e0;
    --text-color: #333;
    --text-secondary: #555;
    --background-hover: rgba(67, 97, 238, 0.1);
}

[data-theme="dark"] {
    --background-secondary: #2a2a2a;
    --border-color: #444;
    --text-color: #e0e0e0;
    --text-secondary: #b0b0b0;
    --background-hover: rgba(76, 201, 240, 0.2);
}

[data-theme="minimal"] {
    --background-secondary: #f0f4f8;
    --border-color: #d0d4d8;
    --text-color: #2a2a2a;
    --text-secondary: #666;
    --background-hover: rgba(67, 97, 238, 0.05);
}
    </style>
</head>
<body data-theme="dark" data-progress="0">
    <header>
        <div class="logo">
            <i class="fas fa-brain logo-icon"></i>
            <span>MedQuiz</span>
        </div>
        <div class="header-controls">
            <button class="control-btn" id="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="control-btn" id="sound-toggle" aria-label="Toggle sound">
                <i class="fas fa-volume-up"></i>
            </button>
            <button class="control-btn" id="stats-btn" aria-label="View statistics">
                <i class="fas fa-chart-line"></i>
                <span class="badge" id="bookmarks-count">0</span>
            </button>
        </div>
    </header>
    <main>
        <div class="quiz-container">
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">MED QUIZ</h1>
                    <p class="quiz-subtitle">Test your medical knowledge</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">All</span>
                        <span class="stat-label">Category</span>
                    </div>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>
            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">Biochemistry</span>
                    <span class="tag" id="difficulty-tag">
                        <span class="difficulty-indicator difficulty-medium"></span>
                        Medium
                    </span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">15</span></div>
            <div class="question-text" id="question">Which part of the brain is responsible for coordinating skeletal muscle contractions?</div>
            <div class="options-grid" id="options-container">
                <div class="option">
                    <div class="option-letter">A</div>
                    <div class="option-text">Cerebrum</div>
                </div>
                <div class="option">
                    <div class="option-letter">B</div>
                    <div class="option-text">Cerebellum</div>
                </div>
                <div class="option">
                    <div class="option-letter">C</div>
                    <div class="option-text">Pons</div>
                </div>
                <div class="option">
                    <div class="option-letter">D</div>
                    <div class="option-text">Midbrain</div>
                </div>
            </div>
            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>
            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>
            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text">The cerebellum, located posterior to the brainstem, is the 'little brain.' It compares intended movements with actual movements to ensure smooth, coordinated skeletal muscle activity and maintain posture and balance.</div>
                </div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-danger" id="skip-btn">
                    <i class="fas fa-forward"></i> Skip
                </button>
            </div>
        </div>
    </main>
    <div class="fab" id="quick-actions-btn" style="display: none;">
        <i class="fas fa-bolt"></i>
    </div>
    <div class="confetti-container" id="confetti-container"></div>
    <div class="modal-overlay" id="stats-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Your Statistics</h2>
                <button class="modal-close" id="close-stats-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-total-questions">0</div>
                        <div class="stat-card-label">Total Questions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-correct-answers">0</div>
                        <div class="stat-card-label">Correct Answers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-accuracy">0%</div>
                        <div class="stat-card-label">Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-avg-time">0s</div>
                        <div class="stat-card-label">Avg. Time</div>
                    </div>
                </div>
                <h3 class="review-title">Performance by Category</h3>
                <div id="category-stats"></div>
                <h3 class="review-title mt-2">Performance by Difficulty</h3>
                <div id="difficulty-stats"></div>
                <h3 class="review-title mt-2">Quiz History</h3>
                <div id="history-stats"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-stats-btn">Close</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="quick-actions-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Quick Actions</h2>
                <button class="modal-close" id="close-actions-modal">&times;</button>
            </div>
            <div class="modal-body">
                <button class="btn btn-primary full-width mt-1" id="mark-for-review-btn">
                    <i class="fas fa-flag"></i> Mark for Review
                </button>
                <button class="btn btn-secondary full-width mt-1" id="view-explanation-btn">
                    <i class="fas fa-info-circle"></i> View Explanation
                </button>
                <button class="btn btn-success full-width mt-1" id="hint-btn">
                    <i class="fas fa-lightbulb"></i> Get a Hint
                </button>
                <button class="btn btn-danger full-width mt-1" id="report-question-btn">
                    <i class="fas fa-exclamation-triangle"></i> Report Question
                </button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-actions-btn">Close</button>
            </div>
        </div>
    </div>
    <footer>
        &copy; 2025 MedQuiz | MED Practice Platform | All Rights Reserved
    </footer>
<script>
const questions = [
    {
        "id": 1,
        "question": "Bipolar neurons are located in the",
        "options": [
            "Anterior horn of the gray matter of spinal cord",
            "Retina and inner ear",
            "Lateral horn of the gray matter of the spinal cord",
            "Posterior horn of the gray matter of the spinal cord",
            "Peripheral effector organs"
        ],
        "answer": 1,
        "correctAnswer": "Retina and inner ear",
        "explanation": "Bipolar neurons, with two processes, are sensory and found in the retina (bipolar cells) and inner ear (vestibular/cochlear ganglia). Other regions contain motor or interneurons. In Guyton and Hall, 13th edition, Chapter 45, page 557, bipolar neurons are noted in special senses.",
        "whyNotOtherOptions": {
            "a": "Anterior horn contains motor neurons.",
            "c": "Lateral horn contains autonomic neurons.",
            "d": "Posterior horn contains sensory interneurons.",
            "e": "Effector organs are not neuron locations."
        },
        "relatedQuestions": ["2 (neuroglia)", "32 (trigeminal)"],
        "category": "Neurophysiology",
        "difficulty": "Hard"
    },
    {
        "id": 2,
        "question": "Identify the correct statement from the following:",
        "options": [
            "Motor neurons transmit impulses from periphery to the CNS",
            "Microglia provides nutrients to neurons in the CNS",
            "Neuroglia are excitable cells",
            "Nerve insulators for central and peripheral NS are of the same attributes",
            "Satellite cells are located in CNS"
        ],
        "answer": -1,
        "correctAnswer": "None of the above",
        "explanation": "None of the options are correct: motor neurons transmit from CNS to periphery, astrocytes (not microglia) provide nutrients, neurons (not neuroglia) are excitable, CNS (oligodendrocytes) and PNS (Schwann cells) insulators differ, and satellite cells are in PNS ganglia, not CNS. In Guyton and Hall, 13th edition, Chapter 45, pages 554-556, these distinctions are clarified. Note: No option matches, so answer is set to -1.",
        "whyNotOtherOptions": {
            "a": "Motor neurons transmit from CNS to muscles.",
            "b": "Astrocytes, not microglia, provide nutrients.",
            "c": "Neurons, not neuroglia, are excitable.",
            "d": "CNS uses oligodendrocytes; PNS uses Schwann cells.",
            "e": "Satellite cells are in PNS ganglia, not CNS."
        },
        "relatedQuestions": ["1 (bipolar neurons)", "13 (action potential)"],
        "category": "Neurophysiology",
        "difficulty": "Hard"
    },
    {
        "id": 3,
        "question": "Which of the following is not involved in the homeostasis of glucose?",
        "options": [
            "Liver",
            "Kidneys",
            "Brain",
            "Pancreas",
            "Lung"
        ],
        "answer": 4,
        "correctAnswer": "Lung",
        "explanation": "Liver (glycogen, gluconeogenesis), kidneys (reabsorption, gluconeogenesis), brain (glucose consumer), and pancreas (insulin/glucagon) regulate glucose. Lungs have no direct role. In Guyton and Hall, 13th edition, Chapter 79, pages 977-978, these organs are key; lungs are not mentioned.",
        "whyNotOtherOptions": {
            "a": "Liver stores glycogen, performs gluconeogenesis.",
            "b": "Kidneys reabsorb glucose, produce glucose.",
            "c": "Brain consumes glucose, affects regulation.",
            "d": "Pancreas secretes insulin/glucagon."
        },
        "relatedQuestions": ["44 (renal threshold)", "49 (proximal tubules)"],
        "category": "Endocrine Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 4,
        "question": "Which of the following events is energy independent?",
        "options": [
            "Release of Ca2+ from the sarcoplasmic reticulum",
            "Return of Ca2+ back to the sarcoplasmic reticulum",
            "The movement of myosin head to the center",
            "Detachment of myosin head from actin",
            "Final ionic rearrangement"
        ],
        "answer": 0,
        "correctAnswer": "Release of Ca2+ from the sarcoplasmic reticulum",
        "explanation": "Ca2+ release is passive via ryanodine receptors triggered by action potentials, requiring no ATP. Reuptake, myosin movement, and detachment require ATP. Ionic rearrangement is unclear but likely energy-dependent. In Guyton and Hall, 13th edition, Chapter 7, page 88, Ca2+ release is described as energy-independent.",
        "whyNotOtherOptions": {
            "b": "Ca2+ reuptake uses Ca2+-ATPase, requiring ATP.",
            "c": "Myosin movement requires ATP hydrolysis.",
            "d": "Myosin detachment requires ATP binding.",
            "e": "Ionic rearrangement likely involves energy."
        },
        "relatedQuestions": ["21 (T-tubules)", "23 (contractile proteins)"],
        "category": "Muscle Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 5,
        "question": "If a person has to continue his activities after 15 seconds, the source of energy to continue the activity for the next 45 to 60 seconds is obtained from:",
        "options": [
            "Stored ATP",
            "Phosphagen system",
            "Anaerobic metabolism",
            "Aerobic metabolism",
            "Myoglobin"
        ],
        "answer": 2,
        "correctAnswer": "Anaerobic metabolism",
        "explanation": "After 15 seconds, stored ATP and phosphagen (creatine phosphate) are depleted. Anaerobic metabolism (glycolysis) provides energy for 45–60 seconds until aerobic metabolism dominates. Myoglobin stores oxygen, not energy. In Guyton and Hall, 13th edition, Chapter 85, pages 1053-1054, anaerobic glycolysis supports short-term intense activity.",
        "whyNotOtherOptions": {
            "a": "Stored ATP lasts ~2–3 seconds.",
            "b": "Phosphagen system lasts ~10–15 seconds.",
            "d": "Aerobic metabolism dominates after ~2 minutes.",
            "e": "Myoglobin stores oxygen, not energy."
        },
        "relatedQuestions": ["4 (muscle energy)", "23 (contractile proteins)"],
        "category": "Muscle Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 6,
        "question": "Not true of the single unit smooth muscle is:",
        "options": [
            "Innervated in motor units comparable to those of skeletal muscles",
            "Has gap junctions",
            "Responsible to neural & hormonal controls",
            "No pacemaker cells",
            "Less common"
        ],
        "answer": 0,
        "correctAnswer": "Innervated in motor units comparable to those of skeletal muscles",
        "explanation": "Single-unit smooth muscle has gap junctions, responds to neural/hormonal control, has pacemaker cells, and is more common (e.g., GI, uterus). Unlike skeletal muscle, it is not innervated in discrete motor units. In Guyton and Hall, 13th edition, Chapter 8, pages 95-96, single-unit smooth muscle lacks motor unit organization.",
        "whyNotOtherOptions": {
            "b": "Gap junctions allow coordinated contraction.",
            "c": "Responds to autonomic and hormonal signals.",
            "d": "Pacemaker cells exist (e.g., interstitial cells of Cajal).",
            "e": "Single-unit is common (e.g., visceral organs)."
        },
        "relatedQuestions": ["4 (muscle energy)", "22 (muscle types)"],
        "category": "Muscle Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 7,
        "question": "A signaling that causes muscle contraction is:",
        "options": [
            "Endocrine",
            "Paracrine",
            "Synaptic",
            "Contact"
        ],
        "answer": 2,
        "correctAnswer": "Synaptic",
        "explanation": "Muscle contraction is triggered by synaptic signaling, where neurotransmitters (e.g., acetylcholine at NMJ) initiate action potentials. Endocrine/paracrine modulate; contact signaling is not primary. In Guyton and Hall, 13th edition, Chapter 7, page 83, synaptic transmission at NMJ drives contraction.",
        "whyNotOtherOptions": {
            "a": "Endocrine (hormones) modulates, not direct.",
            "b": "Paracrine affects nearby cells, not contraction.",
            "d": "Contact signaling is not primary for contraction."
        },
        "relatedQuestions": ["4 (muscle energy)", "21 (T-tubules)"],
        "category": "Muscle Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 8,
        "question": "Which one of the following is not the effect of sympathetic stimulation on the cardiovascular system?",
        "options": [
            "Increased heart rate",
            "Increased force of contraction of the cardiac muscle",
            "Vasoconstriction of the systemic blood vessels",
            "Increases cardiac output",
            "None of the above"
        ],
        "answer": 4,
        "correctAnswer": "None of the above",
        "explanation": "Sympathetic stimulation increases heart rate, contractility, vasoconstriction (alpha receptors), and cardiac output. All are effects. In Guyton and Hall, 13th edition, Chapter 9, pages 111-112, these are detailed as sympathetic effects.",
        "whyNotOtherOptions": {
            "a": "Increases heart rate (chronotropy).",
            "b": "Increases contractility (inotropy).",
            "c": "Causes vasoconstriction via alpha receptors.",
            "d": "Increases cardiac output via heart rate/contractility."
        },
        "relatedQuestions": ["9 (beta receptors)", "10 (autonomic innervation)"],
        "category": "Cardiovascular Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 9,
        "question": "The receptor that is found on the coronary arteries is",
        "options": [
            "Alpha 1",
            "Beta 1",
            "Alpha 2",
            "Beta 2"
        ],
        "answer": 3,
        "correctAnswer": "Beta 2",
        "explanation": "Coronary arteries have beta-2 receptors, mediating vasodilation to increase blood flow. In Guyton and Hall, 13th edition, Chapter 21, page 248, beta-2 receptors are noted for coronary vasodilation.",
        "whyNotOtherOptions": {
            "a": "Alpha 1 causes vasoconstriction, not dilation.",
            "b": "Beta 1 is primarily in the heart (rate/contractility).",
            "c": "Alpha 2 is not primary in coronary arteries."
        },
        "relatedQuestions": ["8 (sympathetic CV)", "16 (beta adrenoceptors)"],
        "category": "Cardiovascular Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 10,
        "question": "Of the following one does not receive dual autonomic innervation. Identify:",
        "options": [
            "The heart",
            "The blood vessels",
            "The liver",
            "The stomach",
            "Pancreas"
        ],
        "answer": 1,
        "correctAnswer": "The blood vessels",
        "explanation": "Blood vessels are primarily sympathetic-innervated (vasoconstriction); parasympathetic innervation is limited (e.g., some vasodilation in specific areas). Heart, liver, stomach, and pancreas receive dual innervation. In Guyton and Hall, 13th edition, Chapter 61, page 763, blood vessels are noted as predominantly sympathetic.",
        "whyNotOtherOptions": {
            "a": "Heart has sympathetic and parasympathetic innervation.",
            "c": "Liver receives dual innervation for metabolism.",
            "d": "Stomach has vagal and sympathetic innervation.",
            "e": "Pancreas has dual innervation for secretion."
        },
        "relatedQuestions": ["8 (sympathetic CV)", "25 (ANS neurotransmitters)"],
        "category": "Autonomic Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 11,
        "question": "Mechanism of action of acetylcholine when binding with M1 is via",
        "options": [
            "Formation of IP3 and DAG",
            "Activation of adenyl cyclase",
            "Hyperpolarization",
            "Opening Na+ channels",
            "Inhibition of Ca2+ channels"
        ],
        "answer": 0,
        "correctAnswer": "Formation of IP3 and DAG",
        "explanation": "M1 muscarinic receptors (Gq-coupled) activate phospholipase C, producing IP3 and DAG, which mobilize calcium and activate signaling. In Guyton and Hall, 13th edition, Chapter 61, page 762, M1 signaling is via IP3/DAG.",
        "whyNotOtherOptions": {
            "b": "Adenyl cyclase is for beta receptors (cAMP).",
            "c": "M1 causes depolarization, not hyperpolarization.",
            "d": "Na+ channels are nicotinic receptor-mediated.",
            "e": "Ca2+ inhibition is not M1’s mechanism."
        },
        "relatedQuestions": ["10 (autonomic innervation)", "25 (ANS neurotransmitters)"],
        "category": "Autonomic Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 12,
        "question": "Not the function of surfactant is:",
        "options": [
            "Increases surface area",
            "Decreases pressure in the alveoli",
            "Prevents lung collapse",
            "Increases work of breathing",
            "Facilitates gas exchange"
        ],
        "answer": 3,
        "correctAnswer": "Increases work of breathing",
        "explanation": "Surfactant reduces surface tension, decreasing alveolar pressure, preventing collapse, and facilitating gas exchange by stabilizing alveoli. It reduces, not increases, work of breathing. In Guyton and Hall, 13th edition, Chapter 40, page 489, surfactant lowers breathing work.",
        "whyNotOtherOptions": {
            "a": "Surfactant stabilizes alveoli, aiding surface area.",
            "b": "Reduces alveolar pressure via lower surface tension.",
            "c": "Prevents collapse by reducing surface tension.",
            "e": "Facilitates gas exchange by maintaining alveolar patency."
        },
        "relatedQuestions": ["13 (RDS)", "14 (respiratory function)"],
        "category": "Respiratory Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 13,
        "question": "Lack of surfactant substances as occur in infants with respiratory distress syndrome (RDS) results in:",
        "options": [
            "An increased lung compliance",
            "Stabilization of alveolar volume",
            "Lung collapse",
            "A reduced alveolar-arterial O2 tension difference"
        ],
        "answer": 2,
        "correctAnswer": "Lung collapse",
        "explanation": "Surfactant deficiency increases surface tension, causing alveolar collapse (atelectasis) in RDS. Compliance decreases, and O2 difference widens. In Guyton and Hall, 13th edition, Chapter 40, page 489, surfactant prevents collapse; its absence causes atelectasis.",
        "whyNotOtherOptions": {
            "a": "Compliance decreases due to high surface tension.",
            "b": "Lack of surfactant destabilizes alveoli.",
            "d": "O2 difference increases due to impaired gas exchange."
        },
        "relatedQuestions": ["12 (surfactant)", "15 (ciliary beating)"],
        "category": "Respiratory Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 14,
        "question": "The respiratory function of the respiratory system is:",
        "options": [
            "Word production",
            "Air conduction",
            "Defense",
            "Olfaction",
            "Regulation of pH"
        ],
        "answer": 4,
        "correctAnswer": "Regulation of pH",
        "explanation": "The primary respiratory function is gas exchange, regulating CO2 to maintain acid-base balance (pH). Word production, conduction, defense, and olfaction are secondary. In Guyton and Hall, 13th edition, Chapter 42, pages 511-512, CO2 regulation is linked to pH control.",
        "whyNotOtherOptions": {
            "a": "Word production (phonation) is a vocal function.",
            "b": "Air conduction is structural, not functional.",
            "c": "Defense is a secondary function (e.g., cilia).",
            "d": "Olfaction is sensory, not respiratory."
        },
        "relatedQuestions": ["13 (RDS)", "15 (ciliary beating)"],
        "category": "Respiratory Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 15,
        "question": "Defense function of the respiratory system is:",
        "options": [
            "Gas moistening",
            "Ciliary beating",
            "Warming of the air",
            "Smell",
            "Secretion of ACE"
        ],
        "answer": 1,
        "correctAnswer": "Ciliary beating",
        "explanation": "Ciliary beating (mucociliary escalator) clears pathogens, serving as a defense mechanism. Moistening, warming, smell, and ACE secretion are not defense functions. In Guyton and Hall, 13th edition, Chapter 39, page 479, mucociliary clearance is a key respiratory defense.",
        "whyNotOtherOptions": {
            "a": "Moistening conditions air, not defense.",
            "c": "Warming is conditioning, not defense.",
            "d": "Smell is sensory, not defense.",
            "e": "ACE secretion is cardiovascular, not defense."
        },
        "relatedQuestions": ["13 (RDS)", "16 (beta adrenoceptors)"],
        "category": "Respiratory Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 16,
        "question": "Bronchial obstruction is likely to be relieved by",
        "options": [
            "Stimulation of cholinergic receptors",
            "Stimulation of beta adrenoceptors",
            "Histamine",
            "Stimulation of mast cell membranes",
            "Slow reactive substance of anaphylaxis"
        ],
        "answer": 1,
        "correctAnswer": "Stimulation of beta adrenoceptors",
        "explanation": "Beta-2 adrenoceptor stimulation causes bronchodilation, relieving obstruction. Cholinergic stimulation, histamine, and leukotrienes (SRS-A) cause constriction. In Guyton and Hall, 13th edition, Chapter 61, page 764, beta-2 receptors mediate bronchodilation.",
        "whyNotOtherOptions": {
            "a": "Cholinergic stimulation causes bronchoconstriction.",
            "c": "Histamine causes bronchoconstriction.",
            "d": "Mast cell stimulation releases constrictive mediators.",
            "e": "SRS-A (leukotrienes) causes constriction."
        },
        "relatedQuestions": ["9 (beta receptors)", "15 (ciliary beating)"],
        "category": "Respiratory Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 17,
        "question": "The net pressure in the glomerular capillaries that pushes fluid outward is called",
        "options": [
            "Glomerular capillary pressure",
            "Glomerular colloid osmotic capillary pressure",
            "Bowman’s capsular pressure",
            "Filtration pressure",
            "Mean systemic capillary filling pressure"
        ],
        "answer": 3,
        "correctAnswer": "Filtration pressure",
        "explanation": "Net filtration pressure drives fluid out, calculated as glomerular hydrostatic pressure minus opposing pressures (colloid osmotic and Bowman’s capsule). In Guyton and Hall, 13th edition, Chapter 26, page 318, it’s defined as Pg - (Pi + Pc).",
        "whyNotOtherOptions": {
            "a": "Glomerular pressure is a component, not net pressure.",
            "b": "Colloid osmotic pressure opposes filtration.",
            "c": "Bowman’s pressure opposes filtration.",
            "e": "Systemic pressure is unrelated to glomerular filtration."
        },
        "relatedQuestions": ["18 (GFR control)", "20 (capsular pressure)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 18,
        "question": "Which of the following is true regarding control of the GFR and RBF?",
        "options": [
            "Strong activation of sympathetic NS causes marked vasoconstriction of efferent arterioles",
            "Angiotensin II causes efferent arteriolar vasoconstriction",
            "Angiotensin II increases flow through peritubular capillaries",
            "ANP (released by atria when stretched) decreases GFR",
            "Endothelin increases GFR"
        ],
        "answer": 1,
        "correctAnswer": "Angiotensin II causes efferent arteriolar vasoconstriction",
        "explanation": "Angiotensin II constricts efferent arterioles, maintaining GFR by increasing glomerular pressure. Sympathetic constricts both arterioles, ANP increases GFR, and endothelin reduces GFR. In Guyton and Hall, 13th edition, Chapter 26, page 323, angiotensin II’s effect is detailed.",
        "whyNotOtherOptions": {
            "a": "Sympathetic constricts both afferent and efferent arterioles.",
            "c": "Angiotensin II reduces peritubular flow due to efferent constriction.",
            "d": "ANP increases GFR by afferent vasodilation.",
            "e": "Endothelin reduces GFR by vasoconstriction."
        },
        "relatedQuestions": ["17 (filtration pressure)", "19 (sympathetic GFR)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 19,
        "question": "Sympathetic stimulation decreases GFR via:",
        "options": [
            "Constricting afferent arterioles",
            "Dilating afferent arterioles",
            "Dilating efferent arterioles",
            "Inhibiting juxtaglomerular cells",
            "Activating stretch receptors"
        ],
        "answer": 0,
        "correctAnswer": "Constricting afferent arterioles",
        "explanation": "Sympathetic stimulation decreases GFR by constricting afferent arterioles, reducing glomerular blood flow. In Guyton and Hall, 13th edition, Chapter 26, page 322, sympathetic vasoconstriction is noted to lower GFR.",
        "whyNotOtherOptions": {
            "b": "Dilation would increase GFR, not decrease.",
            "c": "Efferent dilation would decrease glomerular pressure.",
            "d": "Sympathetic stimulates JG cells (renin release).",
            "e": "Stretch receptors are unrelated to GFR."
        },
        "relatedQuestions": ["18 (GFR control)", "17 (filtration pressure)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 20,
        "question": "Bowman’s capsular hydrostatic pressure is because of:",
        "options": [
            "Renal blood flow",
            "Glomerular oncotic pressure",
            "Glomerular hydrostatic pressure",
            "Glomerular filtrate",
            "Sympathetic stimulation"
        ],
        "answer": 3,
        "correctAnswer": "Glomerular filtrate",
        "explanation": "Bowman’s capsule hydrostatic pressure results from filtrate accumulation, opposing filtration. In Guyton and Hall, 13th edition, Chapter 26, page 318, capsular pressure is attributed to filtrate in Bowman’s space.",
        "whyNotOtherOptions": {
            "a": "Renal blood flow affects glomerular pressure, not capsular.",
            "b": "Oncotic pressure is in capillaries, not capsule.",
            "c": "Glomerular hydrostatic pressure drives filtration.",
            "e": "Sympathetic affects arterioles, not capsule directly."
        },
        "relatedQuestions": ["17 (filtration pressure)", "18 (GFR control)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 21,
        "question": "The function of T-tubules in the skeletal muscle fibers is",
        "options": [
            "Storage of Calcium ion",
            "Conduction of depolarization waves to the sarcoplasmic reticulum",
            "Contain post synaptic receptors",
            "Storage of neurotransmitters",
            "None of the above"
        ],
        "answer": 1,
        "correctAnswer": "Conduction of depolarization waves to the sarcoplasmic reticulum",
        "explanation": "T-tubules conduct action potentials deep into muscle fibers, triggering Ca2+ release from the sarcoplasmic reticulum. In Guyton and Hall, 13th edition, Chapter 7, pages 87-88, T-tubules facilitate excitation-contraction coupling.",
        "whyNotOtherOptions": {
            "a": "Sarcoplasmic reticulum, not T-tubules, stores Ca2+.",
            "c": "Postsynaptic receptors are at the NMJ surface.",
            "d": "Neurotransmitters are stored presynaptically, not in T-tubules.",
            "e": "Option B is correct, so E is invalid."
        },
        "relatedQuestions": ["4 (muscle energy)", "23 (contractile proteins)"],
        "category": "Muscle Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 22,
        "question": "Which of the following statements is wrong about muscle tissue?",
        "options": [
            "Cardiac and skeletal muscles have striated appearance",
            "Cardiac and smooth muscles are involuntary",
            "Skeletal and cardiac muscles are innervated by the ANS",
            "Cardiac and smooth muscles are innervated by ANS"
        ],
        "answer": 2,
        "correctAnswer": "Skeletal and cardiac muscles are innervated by the ANS",
        "explanation": "Skeletal muscle is voluntary, innervated by somatic nervous system, not ANS. Cardiac and smooth muscles are involuntary and ANS-innervated; cardiac and skeletal are striated. In Guyton and Hall, 13th edition, Chapters 6, 8, 9, pages 70, 95, 105, these distinctions are clear.",
        "whyNotOtherOptions": {
            "a": "Cardiac and skeletal muscles are striated.",
            "b": "Cardiac and smooth muscles are involuntary.",
            "d": "Cardiac and smooth muscles are ANS-innervated."
        },
        "relatedQuestions": ["6 (smooth muscle)", "21 (T-tubules)"],
        "category": "Muscle Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 23,
        "question": "The principal contractile proteins in the skeletal muscle are:",
        "options": [
            "Actin and troponin",
            "Actin and myosin",
            "Troponin and tropomyosin",
            "Myosin and tropomyosin",
            "Actin and tropomyosin"
        ],
        "answer": 1,
        "correctAnswer": "Actin and myosin",
        "explanation": "Actin and myosin form cross-bridges for skeletal muscle contraction. Troponin and tropomyosin are regulatory. In Guyton and Hall, 13th edition, Chapter 6, page 72, actin and myosin are the main contractile proteins.",
        "whyNotOtherOptions": {
            "a": "Troponin is regulatory, not contractile.",
            "c": "Troponin and tropomyosin are regulatory proteins.",
            "d": "Tropomyosin is regulatory, not contractile.",
            "e": "Tropomyosin is regulatory, not contractile."
        },
        "relatedQuestions": ["4 (muscle energy)", "21 (T-tubules)"],
        "category": "Muscle Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 24,
        "question": "Which of the following best describes the urine of a 46-year-old man with damaged pituitary gland?",
        "options": [
            "A higher flow of hypotonic urine",
            "A higher flow of hypertonic urine",
            "A normal flow of hypertonic urine",
            "A lower flow of hypotonic urine",
            "A lower flow of hypertonic urine"
        ],
        "answer": 0,
        "correctAnswer": "A higher flow of hypotonic urine",
        "explanation": "Pituitary damage (e.g., diabetes insipidus) reduces ADH, impairing water reabsorption, leading to high-volume hypotonic urine. In Guyton and Hall, 13th edition, Chapter 28, page 349, ADH deficiency causes dilute, high-flow urine.",
        "whyNotOtherOptions": {
            "b": "Hypertonic urine requires ADH, which is deficient.",
            "c": "Normal flow is unlikely with pituitary damage.",
            "d": "Lower flow is not typical; volume increases.",
            "e": "Hypertonic urine is not produced without ADH."
        },
        "relatedQuestions": ["17 (filtration pressure)", "46 (ADH/aldosterone)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 25,
        "question": "A neurotransmitter produced by a postganglionic sympathetic fiber to the sweat glands is",
        "options": [
            "Acetylcholine",
            "Adrenaline",
            "Noradrenaline",
            "Dopamine"
        ],
        "answer": 0,
        "correctAnswer": "Acetylcholine",
        "explanation": "Sweat gland sympathetic fibers are uniquely cholinergic, releasing acetylcholine. Most sympathetic fibers release noradrenaline. In Guyton and Hall, 13th edition, Chapter 61, page 761, this exception is noted.",
        "whyNotOtherOptions": {
            "b": "Adrenaline is from adrenal medulla, not postganglionic.",
            "c": "Noradrenaline is typical for sympathetic fibers.",
            "d": "Dopamine is not primary in sympathetic fibers."
        },
        "relatedQuestions": ["10 (autonomic innervation)", "11 (M1 mechanism)"],
        "category": "Autonomic Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 26,
        "question": "Decreasing the resistance of the afferent arteriole in the glomerulus of the kidney will decrease which of the following?",
        "options": [
            "Glomerular filtration rate",
            "Renal plasma flow",
            "Filtration fraction",
            "Renin release from juxtaglomerular cells",
            "All"
        ],
        "answer": 2,
        "correctAnswer": "Filtration fraction",
        "explanation": "Decreasing afferent arteriole resistance increases renal plasma flow (RPF) and GFR, but filtration fraction (GFR/RPF) decreases as RPF rises more than GFR. Renin release may decrease due to increased flow. In Guyton and Hall, 13th edition, Chapter 26, page 321, afferent dilation effects are described.",
        "whyNotOtherOptions": {
            "a": "GFR increases with reduced resistance.",
            "b": "Renal plasma flow increases, not decreases.",
            "d": "Renin may decrease, but not primary effect.",
            "e": "Not all decrease; GFR and RPF increase."
        },
        "relatedQuestions": ["17 (filtration pressure)", "18 (GFR control)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 27,
        "question": "Response to high pressure in the renal blood flow is:",
        "options": [
            "Tubuloglomerular autoregulation",
            "Myogenic contraction",
            "Release of ANP",
            "Sympathetic stimulation",
            "Parasympathetic stimulation"
        ],
        "answer": 1,
        "correctAnswer": "Myogenic contraction",
        "explanation": "High renal blood flow pressure triggers myogenic contraction of afferent arterioles to maintain stable GFR and RBF (autoregulation). Tubuloglomerular feedback responds to flow rate, not pressure. In Guyton and Hall, 13th edition, Chapter 26, page 322, myogenic mechanism is described for pressure regulation.",
        "whyNotOtherOptions": {
            "a": "Tubuloglomerular responds to tubular flow, not pressure.",
            "c": "ANP responds to systemic volume, not renal pressure.",
            "d": "Sympathetic is not primary for autoregulation.",
            "e": "Parasympathetic has minimal renal role."
        },
        "relatedQuestions": ["18 (GFR control)", "19 (sympathetic GFR)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 28,
        "question": "The filtration fraction is increased by which of the following?",
        "options": [
            "Increasing renal blood flow",
            "Increasing afferent arteriolar resistance",
            "Increasing efferent arteriolar resistance",
            "Increasing plasma oncotic pressure",
            "Increasing the pressure within Bowman's capsule"
        ],
        "answer": 2,
        "correctAnswer": "Increasing efferent arteriolar resistance",
        "explanation": "Filtration fraction (GFR/RPF) increases with efferent arteriolar constriction, which raises glomerular pressure (increasing GFR) while reducing RPF. In Guyton and Hall, 13th edition, Chapter 26, page 321, efferent constriction elevates filtration fraction.",
        "whyNotOtherOptions": {
            "a": "Increased RBF lowers filtration fraction.",
            "b": "Afferent resistance decreases GFR and filtration fraction.",
            "d": "Oncotic pressure opposes filtration, lowering GFR.",
            "e": "Bowman’s pressure opposes filtration, lowering GFR."
        },
        "relatedQuestions": ["17 (filtration pressure)", "26 (afferent resistance)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 29,
        "question": "Structure in the renal medulla that drains urine to the ureter is:",
        "options": [
            "Calyx",
            "Pyramid",
            "Renal pelvis",
            "Glomerulus",
            "Hilum"
        ],
        "answer": 2,
        "correctAnswer": "Renal pelvis",
        "explanation": "The renal pelvis collects urine from calyces and drains it to the ureter. Calyces collect from pyramids, glomerulus filters, and hilum is an entry/exit point. In Guyton and Hall, 13th edition, Chapter 26, page 314, the renal pelvis is the final drainage structure.",
        "whyNotOtherOptions": {
            "a": "Calyces drain to pelvis, not directly to ureter.",
            "b": "Pyramids contain nephrons, not drainage.",
            "d": "Glomerulus filters blood, not urine drainage.",
            "e": "Hilum is the entry/exit, not a drainage structure."
        },
        "relatedQuestions": ["17 (filtration pressure)", "20 (capsular pressure)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 30,
        "question": "The renal threshold for glucose is equal to",
        "options": [
            "340 mg/ml",
            "200 mg/dl",
            "125 ml/min",
            "80-120 mg/dl",
            "40 mg/dl"
        ],
        "answer": 1,
        "correctAnswer": "200 mg/dl",
        "explanation": "The renal threshold for glucose is ~180-200 mg/dL, above which glucosuria occurs due to saturated tubular reabsorption. In Guyton and Hall, 13th edition, Chapter 27, page 336, the threshold is approximately 200 mg/dL.",
        "whyNotOtherOptions": {
            "a": "340 mg/ml is too high (unit error).",
            "c": "125 ml/min is GFR, not threshold.",
            "d": "80-120 mg/dl is below threshold (normal range).",
            "e": "40 mg/dl is far below threshold."
        },
        "relatedQuestions": ["3 (glucose homeostasis)", "49 (proximal tubules)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 31,
        "question": "Ptyalin (amylase) is produced by:",
        "options": [
            "The parotid gland",
            "Parietal cells",
            "Chief cells",
            "Enteroendocrine cells"
        ],
        "answer": 0,
        "correctAnswer": "The parotid gland",
        "explanation": "Ptyalin (salivary amylase) is secreted by the parotid gland to initiate starch digestion. Parietal cells secrete HCl, chief cells secrete pepsinogen, and enteroendocrine cells secrete hormones. In Guyton and Hall, 13th edition, Chapter 64, page 806, parotid glands produce salivary amylase.",
        "whyNotOtherOptions": {
            "b": "Parietal cells secrete HCl and intrinsic factor.",
            "c": "Chief cells secrete pepsinogen.",
            "d": "Enteroendocrine cells secrete hormones like gastrin."
        },
        "relatedQuestions": ["35 (CHO digestion)", "40 (HCl secretion)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 32,
        "question": "Which of the following cranial nerves is responsible for corneal sensitivity?",
        "options": [
            "Glossopharyngeal nerve",
            "Trochlear nerve",
            "Trigeminal nerve",
            "Abducens nerve",
            "Oculomotor nerve"
        ],
        "answer": 2,
        "correctAnswer": "Trigeminal nerve",
        "explanation": "The trigeminal nerve (V), via its ophthalmic branch, provides corneal sensation. In Guyton and Hall, 13th edition, Chapter 52, page 642, corneal sensitivity is trigeminal-mediated.",
        "whyNotOtherOptions": {
            "a": "Glossopharyngeal (IX) innervates throat/tongue.",
            "b": "Trochlear (IV) controls eye movement.",
            "d": "Abducens (VI) controls eye abduction.",
            "e": "Oculomotor (III) controls eye muscles/pupil."
        },
        "relatedQuestions": ["1 (bipolar neurons)", "34 (hypoglossal)"],
        "category": "Neurophysiology",
        "difficulty": "Hard"
    },
    {
        "id": 33,
        "question": "If your tongue is atrophied, there is lesion in which cranial nerve?",
        "options": [
            "Facial",
            "Glossopharyngeal",
            "Vagus",
            "Hypoglossal",
            "Trigeminal"
        ],
        "answer": 3,
        "correctAnswer": "Hypoglossal",
        "explanation": "The hypoglossal nerve (XII) innervates tongue muscles; lesions cause atrophy. In Guyton and Hall, 13th edition, Chapter 55, page 674, hypoglossal nerve controls tongue movement.",
        "whyNotOtherOptions": {
            "a": "Facial (VII) controls facial expression.",
            "b": "Glossopharyngeal (IX) is sensory for tongue.",
            "c": "Vagus (X) innervates pharynx/larynx.",
            "e": "Trigeminal (V) is sensory/motor for face."
        },
        "relatedQuestions": ["1 (bipolar neurons)", "32 (trigeminal)"],
        "category": "Neurophysiology",
        "difficulty": "Hard"
    },
    {
        "id": 34,
        "question": "Which of the following cranial nerve is stimulatory to the salivary glands?",
        "options": [
            "Oculomotor",
            "Facial",
            "Vagus",
            "Trigeminal",
            "Hypoglossal"
        ],
        "answer": 1,
        "correctAnswer": "Facial",
        "explanation": "The facial nerve (VII) stimulates submandibular/sublingual salivary glands via parasympathetic fibers. In Guyton and Hall, 13th edition, Chapter 64, page 809, the facial nerve is primary for salivary secretion.",
        "whyNotOtherOptions": {
            "a": "Oculomotor (III) innervates eye muscles.",
            "c": "Vagus (X) affects GI, not salivary glands.",
            "d": "Trigeminal (V) is sensory/motor for face.",
            "e": "Hypoglossal (XII) controls tongue."
        },
        "relatedQuestions": ["32 (trigeminal)", "33 (hypoglossal)"],
        "category": "Neurophysiology",
        "difficulty": "Hard"
    },
    {
        "id": 35,
        "question": "Which of the following food item is chemically digested in the mouth?",
        "options": [
            "Protein",
            "Fat",
            "CHO",
            "Vitamin",
            "Mineral"
        ],
        "answer": 2,
        "correctAnswer": "CHO",
        "explanation": "Carbohydrates (CHO) are digested in the mouth by salivary amylase (ptyalin), breaking down starches. Proteins, fats, vitamins, and minerals are not enzymatically digested in the mouth. In Guyton and Hall, 13th edition, Chapter 65, page 818, salivary amylase initiates starch digestion.",
        "whyNotOtherOptions": {
            "a": "Protein digestion begins in stomach (pepsin).",
            "b": "Fat digestion starts in duodenum (lipase).",
            "d": "Vitamins are absorbed, not digested.",
            "e": "Minerals are absorbed, not digested."
        },
        "relatedQuestions": ["31 (ptyalin)", "40 (HCl secretion)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 36,
        "question": "The hardest part of the teeth is",
        "options": [
            "Crown",
            "Dentin",
            "Enamel",
            "Root",
            "None"
        ],
        "answer": 2,
        "correctAnswer": "Enamel",
        "explanation": "Enamel, a highly mineralized layer, is the hardest substance in the body. In Guyton and Hall, 13th edition, Chapter 64, page 804, enamel is described as the hardest tooth component.",
        "whyNotOtherOptions": {
            "a": "Crown includes enamel but is not the hardest part.",
            "b": "Dentin is less hard than enamel.",
            "d": "Root contains dentin, less hard than enamel.",
            "e": "Option C is correct, so E is invalid."
        },
        "relatedQuestions": ["35 (CHO digestion)", "42 (premolars)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 37,
        "question": "The total number of premolar teeth in adults is",
        "options": [
            "8",
            "4",
            "12",
            "16",
            "20"
        ],
        "answer": 0,
        "correctAnswer": "8",
        "explanation": "Adults have 8 premolars (4 upper, 4 lower) in a 32-tooth dentition. In Guyton and Hall, 13th edition, Chapter 64, page 804, adult dentition includes 8 premolars.",
        "whyNotOtherOptions": {
            "b": "4 is too few; each quadrant has 2 premolars.",
            "c": "12 exceeds total premolars.",
            "d": "16 includes other teeth types.",
            "e": "20 includes additional teeth types."
        },
        "relatedQuestions": ["36 (enamel)", "35 (CHO digestion)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 38,
        "question": "Which one of the following is secreted into the colon?",
        "options": [
            "Glucose",
            "Glycine",
            "Bile Salts",
            "Calcium",
            "Bicarbonate"
        ],
        "answer": 4,
        "correctAnswer": "Bicarbonate",
        "explanation": "The colon secretes bicarbonate to neutralize acids from bacterial fermentation. Bile salts are reabsorbed in the ileum. In Guyton and Hall, 13th edition, Chapter 65, page 826, bicarbonate secretion is noted in the colon.",
        "whyNotOtherOptions": {
            "a": "Glucose is absorbed, not secreted.",
            "b": "Glycine is not secreted in the colon.",
            "c": "Bile salts are reabsorbed in the ileum.",
            "d": "Calcium is absorbed, not secreted."
        },
        "relatedQuestions": ["39 (bile salts)", "43 (CCK)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 39,
        "question": "Bile salts are secreted into what region of the small intestine?",
        "options": [
            "Jejunum",
            "Duodenum",
            "Ileum",
            "Splanchnic Circulation",
            "Enterohepatic Circulation"
        ],
        "answer": 1,
        "correctAnswer": "Duodenum",
        "explanation": "Bile salts are secreted into the duodenum via the common bile duct to aid fat digestion. In Guyton and Hall, 13th edition, Chapter 65, page 821, bile release into the duodenum is described.",
        "whyNotOtherOptions": {
            "a": "Jejunum receives bile but is not primary site.",
            "c": "Ileum reabsorbs bile salts.",
            "d": "Splanchnic circulation is vascular, not a site.",
            "e": "Enterohepatic circulation is a process, not a site."
        },
        "relatedQuestions": ["38 (colon secretion)", "43 (CCK)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 40,
        "question": "Secretion of HCl by parietal cells in the stomach is increased by",
        "options": [
            "Parasympathetic stimulation",
            "Drinking coffee and alcohol",
            "Release of histamine by mast cells",
            "Infection with helicobacter pylori",
            "All are correct"
        ],
        "answer": 4,
        "correctAnswer": "All are correct",
        "explanation": "HCl secretion is stimulated by vagal (parasympathetic) input, histamine (from mast cells), caffeine/alcohol (via gastrin), and H. pylori (via inflammation). In Guyton and Hall, 13th edition, Chapter 65, page 817, these factors are listed as stimulants.",
        "whyNotOtherOptions": {
            "a": "Vagal stimulation increases HCl via acetylcholine.",
            "b": "Coffee/alcohol stimulate gastrin, increasing HCl.",
            "c": "Histamine activates H2 receptors, increasing HCl.",
            "d": "H. pylori inflammation enhances gastrin and HCl."
        },
        "relatedQuestions": ["35 (CHO digestion)", "41 (pepsin)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 41,
        "question": "Identify an enzyme secreted by the chief cells of the stomach:",
        "options": [
            "HCl",
            "Pepsin",
            "Mucus",
            "Intrinsic factor",
            "None of the above"
        ],
        "answer": 1,
        "correctAnswer": "Pepsin",
        "explanation": "Chief cells secrete pepsinogen, which becomes pepsin, a digestive enzyme. HCl and intrinsic factor are from parietal cells, mucus from surface cells. In Guyton and Hall, 13th edition, Chapter 65, page 816, chief cells are noted for pepsinogen secretion.",
        "whyNotOtherOptions": {
            "a": "HCl is secreted by parietal cells.",
            "c": "Mucus is secreted by mucous cells.",
            "d": "Intrinsic factor is from parietal cells.",
            "e": "Option B is correct, so E is invalid."
        },
        "relatedQuestions": ["40 (HCl secretion)", "47 (mucosa)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 42,
        "question": "The total number of premolar teeth in adults is",
        "options": [
            "8",
            "4",
            "12",
            "16",
            "20"
        ],
        "answer": 0,
        "correctAnswer": "8",
        "explanation": "Adults have 8 premolars (4 upper, 4 lower) in a 32-tooth dentition. In Guyton and Hall, 13th edition, Chapter 64, page 804, adult dentition includes 8 premolars.",
        "whyNotOtherOptions": {
            "b": "4 is too few; each quadrant has 2 premolars.",
            "c": "12 exceeds total premolars.",
            "d": "16 includes other teeth types.",
            "e": "20 includes additional teeth types."
        },
        "relatedQuestions": ["36 (enamel)", "35 (CHO digestion)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 43,
        "question": "A hormone that causes release of bile from the gall bladder is:",
        "options": [
            "Secretin",
            "Cholecystokinin",
            "Gastric inhibitory peptide",
            "Gastrin",
            "Sympathetic nervous system"
        ],
        "answer": 1,
        "correctAnswer": "Cholecystokinin",
        "explanation": "Cholecystokinin (CCK) causes gallbladder contraction and bile release. In Guyton and Hall, 13th edition, Chapter 65, page 821, CCK is noted for this role.",
        "whyNotOtherOptions": {
            "a": "Secretin promotes pancreatic bicarbonate, not bile.",
            "c": "GIP affects insulin, not bile.",
            "d": "Gastrin stimulates gastric acid, not bile.",
            "e": "Sympathetic system is not a hormone."
        },
        "relatedQuestions": ["39 (bile salts)", "44 (CCK stimulus)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 44,
        "question": "Stimulus for the secretion of cholecystokinin is",
        "options": [
            "Protein digestion products",
            "Histamine",
            "Somatostatin",
            "Acidic chyme in the duodenum",
            "Fat digestion products"
        ],
        "answer": 4,
        "correctAnswer": "Fat digestion products",
        "explanation": "Fatty acids and monoglycerides in the duodenum are the primary stimuli for CCK release, though proteins contribute. In Guyton and Hall, 13th edition, Chapter 65, page 821, fat digestion products are the main trigger for CCK.",
        "whyNotOtherOptions": {
            "a": "Proteins contribute but are secondary to fats.",
            "b": "Histamine affects gastric acid, not CCK.",
            "c": "Somatostatin inhibits secretions, not a stimulus.",
            "d": "Acidic chyme triggers secretin, not CCK."
        },
        "relatedQuestions": ["43 (CCK)", "39 (bile salts)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 45,
        "question": "An essential regulation of bile release into the duodenum is:",
        "options": [
            "Secretin",
            "CCK",
            "GIP",
            "Gastrin",
            "Sympathetic nervous system"
        ],
        "answer": 1,
        "correctAnswer": "CCK",
        "explanation": "Cholecystokinin (CCK) is essential for bile release by causing gallbladder contraction and sphincter of Oddi relaxation. In Guyton and Hall, 13th edition, Chapter 65, page 821, CCK is the primary regulator of bile release.",
        "whyNotOtherOptions": {
            "a": "Secretin promotes pancreatic bicarbonate, not bile.",
            "c": "GIP affects insulin, not bile.",
            "d": "Gastrin stimulates gastric acid, not bile.",
            "e": "Sympathetic system inhibits bile release."
        },
        "relatedQuestions": ["43 (CCK)", "44 (CCK stimulus)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 46,
        "question": "The hormone that causes release of bicarbonate from the pancreas is:",
        "options": [
            "CCK",
            "Secretin",
            "Gastrin",
            "Somatostatin",
            "Insulin"
        ],
        "answer": 1,
        "correctAnswer": "Secretin",
        "explanation": "Secretin stimulates pancreatic bicarbonate secretion to neutralize acidic chyme in the duodenum. In Guyton and Hall, 13th edition, Chapter 65, page 820, secretin is identified as the primary stimulus for bicarbonate release.",
        "whyNotOtherOptions": {
            "a": "CCK stimulates enzyme secretion, not bicarbonate.",
            "c": "Gastrin stimulates gastric acid, not pancreatic bicarbonate.",
            "d": "Somatostatin inhibits secretions.",
            "e": "Insulin regulates glucose, not bicarbonate."
        },
        "relatedQuestions": ["43 (CCK)", "44 (CCK stimulus)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 47,
        "question": "GIT layers that contains much of glands is",
        "options": [
            "Serosa",
            "Muscularis",
            "Submucosa",
            "Mucosa",
            "All"
        ],
        "answer": 3,
        "correctAnswer": "Mucosa",
        "explanation": "The mucosa contains most GI glands (e.g., gastric pits, intestinal crypts). Submucosa has some glands (e.g., Brunner’s), but mucosa is primary. In Guyton and Hall, 13th edition, Chapter 63, page 793, the mucosa is described as gland-rich.",
        "whyNotOtherOptions": {
            "a": "Serosa is the outer connective layer, no glands.",
            "b": "Muscularis is for motility, no glands.",
            "c": "Submucosa has some glands, but fewer than mucosa.",
            "e": "Only mucosa is gland-rich, not all layers."
        },
        "relatedQuestions": ["40 (HCl secretion)", "41 (pepsin)"],
        "category": "Gastrointestinal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 48,
        "question": "Center for swallowing is located in the",
        "options": [
            "Hypothalamus",
            "Medulla oblongata",
            "Pons",
            "Mid-brain",
            "Cortex"
        ],
        "answer": 1,
        "correctAnswer": "Medulla oblongata",
        "explanation": "The swallowing center in the medulla oblongata coordinates the swallowing reflex. In Guyton and Hall, 13th edition, Chapter 64, page 807, the medulla is identified as the swallowing center.",
        "whyNotOtherOptions": {
            "a": "Hypothalamus regulates autonomic functions, not swallowing.",
            "c": "Pons relays signals, not primary for swallowing.",
            "d": "Midbrain handles sensory/motor reflexes, not swallowing.",
            "e": "Cortex initiates voluntary swallowing, not reflex."
        },
        "relatedQuestions": ["32 (trigeminal)", "34 (facial nerve)"],
        "category": "Neurophysiology",
        "difficulty": "Hard"
    },
    {
        "id": 49,
        "question": "Part of the renal tubules where nutritionally important substances are reabsorbed is called",
        "options": [
            "Collecting duct",
            "Proximal tubules",
            "Distal tubules",
            "Loop of Henle",
            "Urinary bladder"
        ],
        "answer": 1,
        "correctAnswer": "Proximal tubules",
        "explanation": "Proximal tubules reabsorb ~65% of nutrients (e.g., glucose, amino acids) via active transport. In Guyton and Hall, 13th edition, Chapter 27, page 332, proximal tubules are noted for nutrient reabsorption.",
        "whyNotOtherOptions": {
            "a": "Collecting duct regulates water/electrolytes.",
            "c": "Distal tubules regulate ions/acid-base.",
            "d": "Loop of Henle concentrates urine.",
            "e": "Bladder stores urine, no reabsorption."
        },
        "relatedQuestions": ["30 (renal threshold)", "3 (glucose homeostasis)"],
        "category": "Renal Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 50,
        "question": "The hormone that is stored in the form of preprohormone is:",
        "options": [
            "Insulin",
            "Aldosterone",
            "Thyroxine",
            "Testosterone",
            "Cortisol"
        ],
        "answer": 0,
        "correctAnswer": "Insulin",
        "explanation": "Insulin is synthesized as preproinsulin, cleaved to proinsulin, then mature insulin. Steroid hormones (aldosterone, testosterone, cortisol) and thyroxine (amine) are not stored as preprohormones. In Guyton and Hall, 13th edition, Chapter 79, page 974, insulin’s preproinsulin synthesis is detailed.",
        "whyNotOtherOptions": {
            "b": "Aldosterone is a steroid, not stored as preprohormone.",
            "c": "Thyroxine is amine-derived, not a preprohormone.",
            "d": "Testosterone is a steroid, not stored as preprohormone.",
            "e": "Cortisol is a steroid, not stored as preprohormone."
        },
        "relatedQuestions": ["51 (amine hormone)", "53 (aldosterone)"],
        "category": "Endocrine Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 51,
        "question": "From the given options below, which one is an amine hormone?",
        "options": [
            "Growth hormone",
            "T3",
            "ADH",
            "Cortisol"
        ],
        "answer": 1,
        "correctAnswer": "T3",
        "explanation": "T3 (triiodothyronine) is an amine hormone derived from tyrosine. Growth hormone and ADH are peptides; cortisol is a steroid. In Guyton and Hall, 13th edition, Chapter 74, page 912, thyroid hormones are classified as amine hormones.",
        "whyNotOtherOptions": {
            "a": "Growth hormone is a peptide hormone.",
            "c": "ADH is a peptide hormone.",
            "d": "Cortisol is a steroid hormone."
        },
        "relatedQuestions": ["50 (insulin)", "54 (T3 receptors)"],
        "category": "Endocrine Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 52,
        "question": "Which hormone of the following has receptors inside the cell?",
        "options": [
            "ADH",
            "Insulin",
            "Growth hormone",
            "Glucagon",
            "Aldosterone"
        ],
        "answer": 4,
        "correctAnswer": "Aldosterone",
        "explanation": "Aldosterone, a steroid hormone, binds intracellular nuclear receptors to regulate gene expression. ADH, insulin, growth hormone, and glucagon bind membrane receptors. In Guyton and Hall, 13th edition, Chapter 74, page 916, steroid receptors are intracellular.",
        "whyNotOtherOptions": {
            "a": "ADH binds membrane receptors (V1/V2).",
            "b": "Insulin binds membrane tyrosine kinase receptors.",
            "c": "Growth hormone binds membrane receptors.",
            "d": "Glucagon binds membrane receptors (cAMP)."
        },
        "relatedQuestions": ["50 (insulin)", "53 (aldosterone)"],
        "category": "Endocrine Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 53,
        "question": "Being non-steroidal but having intracellular receptor is:",
        "options": [
            "Epinephrine",
            "Dopamine",
            "T3",
            "Somatostatin",
            "Serotonin"
        ],
        "answer": 2,
        "correctAnswer": "T3",
        "explanation": "T3 (thyroid hormone) is a non-steroidal amine hormone that binds intracellular nuclear receptors to regulate gene expression. Others use membrane receptors. In Guyton and Hall, 13th edition, Chapter 76, page 943, T3/T4 receptors are nuclear.",
        "whyNotOtherOptions": {
            "a": "Epinephrine uses membrane receptors (adrenergic).",
            "b": "Dopamine uses membrane receptors.",
            "d": "Somatostatin is a peptide, uses membrane receptors.",
            "e": "Serotonin uses membrane receptors."
        },
        "relatedQuestions": ["51 (amine hormone)", "52 (aldosterone)"],
        "category": "Endocrine Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 54,
        "question": "A hormone whose secretion is excess during the time of deep sleep is:",
        "options": [
            "Growth hormone",
            "Insulin",
            "Cortisol",
            "Adrenalin",
            "ADH"
        ],
        "answer": 0,
        "correctAnswer": "Growth hormone",
        "explanation": "Growth hormone (GH) secretion peaks during deep (slow-wave) sleep. In Guyton and Hall, 13th edition, Chapter 75, page 931, GH pulses are noted during sleep.",
        "whyNotOtherOptions": {
            "b": "Insulin is regulated by glucose, not sleep.",
            "c": "Cortisol peaks in the morning, not sleep.",
            "d": "Adrenalin is stress-related, not sleep-related.",
            "e": "ADH is regulated by osmolarity, not sleep."
        },
        "relatedQuestions": ["50 (insulin)", "51 (amine hormone)"],
        "category": "Endocrine Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 55,
        "question": "Mullerian duct develops into the:",
        "options": [
            "Ovaries",
            "Female genital tract",
            "Male accessory glands",
            "Female external genitalia",
            "Ovaries"
        ],
        "answer": 1,
        "correctAnswer": "Female genital tract",
        "explanation": "Mullerian ducts develop into the female internal genital tract (fallopian tubes, uterus, upper vagina). Ovaries and external genitalia arise from different structures; male glands from Wolffian ducts. In Guyton and Hall, 13th edition, Chapter 82, page 1015, Mullerian ducts form the female tract. Note: Option A repeated as E, likely a typo.",
        "whyNotOtherOptions": {
            "a": "Ovaries develop from gonadal ridges.",
            "c": "Male glands develop from Wolffian ducts.",
            "d": "External genitalia arise from genital tubercle.",
            "e": "Same as A, ovaries not from Mullerian ducts."
        },
        "relatedQuestions": ["Embryology 1 (Mullerian ducts)", "Embryology 2 (Wolffian ducts)", "60 (fertilization)"],
        "category": "Reproductive Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 56,
        "question": "Which one of the following is known to be the hormone of ovulation?",
        "options": [
            "FSH",
            "Estradiol",
            "Progesterone",
            "hCG",
            "LH"
        ],
        "answer": 4,
        "correctAnswer": "LH",
        "explanation": "The luteinizing hormone (LH) surge triggers ovulation by stimulating follicle rupture. In Guyton and Hall, 13th edition, Chapter 83, page 1022, LH is identified as the ovulation trigger.",
        "whyNotOtherOptions": {
            "a": "FSH promotes follicle growth, not ovulation.",
            "b": "Estradiol supports follicle development.",
            "c": "Progesterone maintains pregnancy post-ovulation.",
            "d": "hCG maintains corpus luteum, not ovulation."
        },
        "relatedQuestions": ["55 (Mullerian ducts)", "62 (proliferative phase)"],
        "category": "Reproductive Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 57,
        "question": "Which of the following is not a haploid cell?",
        "options": [
            "Spermatogonium",
            "Secondary oocytes",
            "Spermatids",
            "Oocyte",
            "Ovum"
        ],
        "answer": 0,
        "correctAnswer": "Spermatogonium",
        "explanation": "Spermatogonia are diploid germ cells. Secondary oocytes, spermatids, and ovum are haploid (post-meiosis). ‘Oocyte’ likely refers to secondary oocyte, which is haploid. In Guyton and Hall, 13th edition, Chapter 82, page 1008, spermatogonia are diploid, while spermatids/oocytes are haploid.",
        "whyNotOtherOptions": {
            "b": "Secondary oocytes are haploid post-meiosis I.",
            "c": "Spermatids are haploid post-meiosis.",
            "d": "Oocyte (secondary) is haploid in context.",
            "e": "Ovum is haploid, mature egg."
        },
        "relatedQuestions": ["Embryology 10 (gametogenesis)", "60 (fertilization)"],
        "category": "Reproductive Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 58,
        "question": "In the male sexual act, the erection phase is under the regulation of the",
        "options": [
            "Parasympathetic nervous system",
            "Sympathetic nervous system",
            "Somatic pudendal nerve",
            "The vagus nerve from medulla",
            "Phrenic nerve of the cervical segment"
        ],
        "answer": 0,
        "correctAnswer": "Parasympathetic nervous system",
        "explanation": "Erection is mediated by parasympathetic nerves (pelvic) causing vasodilation via nitric oxide. In Guyton and Hall, 13th edition, Chapter 81, page 1005, parasympathetic innervation drives erection.",
        "whyNotOtherOptions": {
            "b": "Sympathetic mediates emission/ejaculation.",
            "c": "Pudendal nerve controls perineal muscles.",
            "d": "Vagus nerve is not involved in erection.",
            "e": "Phrenic nerve controls diaphragm, not erection."
        },
        "relatedQuestions": ["Embryology 2 (Wolffian ducts)", "10 (autonomic innervation)"],
        "category": "Reproductive Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 59,
        "question": "The function of the uterus is:",
        "options": [
            "Hormone secretion",
            "Essential reproductive organ",
            "Site for normal pregnancy",
            "Gametogenesis",
            "None of the above"
        ],
        "answer": 2,
        "correctAnswer": "Site for normal pregnancy",
        "explanation": "The uterus is the primary site for embryo implantation and pregnancy. It secretes some hormones and is a reproductive organ, but its main function is gestation. In Guyton and Hall, 13th edition, Chapter 83, page 1025, the uterus is described as the site for pregnancy.",
        "whyNotOtherOptions": {
            "a": "Hormone secretion is secondary (e.g., prostaglandins).",
            "b": "Reproductive organ is too vague; pregnancy is specific.",
            "d": "Gametogenesis occurs in ovaries, not uterus.",
            "e": "Option C is correct, so E is invalid."
        },
        "relatedQuestions": ["55 (Mullerian ducts)", "60 (fertilization)"],
        "category": "Reproductive Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 60,
        "question": "Usual site of fertilization in the female reproductive system is:",
        "options": [
            "Ovary",
            "Fallopian tubes",
            "Uterus",
            "Vagina",
            "Cervix"
        ],
        "answer": 1,
        "correctAnswer": "Fallopian tubes",
        "explanation": "Fertilization occurs in the ampulla of the fallopian tube, where sperm meets the ovum. In Guyton and Hall, 13th edition, Chapter 84, page 1035, the fallopian tube is the fertilization site.",
        "whyNotOtherOptions": {
            "a": "Ovaries produce eggs, not site of fertilization.",
            "c": "Uterus is for implantation, not fertilization.",
            "d": "Vagina is for sperm deposition, not fertilization.",
            "e": "Cervix is a passage, not fertilization site."
        },
        "relatedQuestions": ["55 (Mullerian ducts)", "Embryology 1 (Mullerian ducts)"],
        "category": "Reproductive Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 61,
        "question": "Proliferative phase of the endometrial cycle is controlled by which hormone?",
        "options": [
            "Progesterone",
            "FSH",
            "LH",
            "Estrogen",
            "Oxytocin"
        ],
        "answer": 3,
        "correctAnswer": "Estrogen",
        "explanation": "Estrogen drives the proliferative phase, promoting endometrial growth. Progesterone dominates the secretory phase. In Guyton and Hall, 13th edition, Chapter 83, page 1024, estrogen is the key hormone for endometrial proliferation.",
        "whyNotOtherOptions": {
            "a": "Progesterone drives the secretory phase.",
            "b": "FSH stimulates follicle growth, not directly endometrium.",
            "c": "LH triggers ovulation, not proliferation.",
            "e": "Oxytocin affects labor/milk ejection."
        },
        "relatedQuestions": ["56 (LH ovulation)", "59 (uterus)"],
        "category": "Reproductive Physiology",
        "difficulty": "Hard"
    },
    {
        "id": 62,
        "question": "Determinant factor for the fetus to become a male individual is:",
        "options": [
            "The presence of the hypothalamus",
            "The presence of penis",
            "The presence of the SRY-protein",
            "The absence of the X chromosome",
            "All of the above"
        ],
        "answer": 2,
        "correctAnswer": "The presence of the SRY-protein",
        "explanation": "The SRY (sex-determining region Y) protein, encoded by the Y chromosome, triggers testis development, determining male sex. In Guyton and Hall, 13th edition, Chapter 82, page 1014, SRY is critical for male differentiation.",
        "whyNotOtherOptions": {
            "a": "Hypothalamus is not sex-determining.",
            "b": "Penis develops later, not a determinant.",
            "d": "Males have an X chromosome (XY).",
            "e": "Only C is correct, so E is invalid."
        },
        "relatedQuestions": ["Embryology 2 (Wolffian ducts)", "58 (erection)"],
        "category": "Reproductive Physiology",
        "difficulty": "Hard"
    }
]
    

;
// Store original questions for restart functionality (moved to global scope for cross-browser compatibility)
const originalQuestions = [...questions];
// DOM Elements (global for cross-browser)
let body = document.body;
let questionElement, optionsContainer, currentQuestionElement, totalQuestionsElement, progressBar, prevButton, nextButton, skipButton, feedbackElement, timerElement, scoreElement, streakElement, categoryElement, explanationContainer, explanationTextElement, themeToggle, soundToggle, bookmarkBtn, bookmarksCount, categoryTag, difficultyTag, showExplanationBtn, statsBtn, statsModal, closeStatsModal, closeStatsBtn, quickActionsBtn, quickActionsModal, closeActionsModal, closeActionsBtn, studyModeToggle, confettiContainer;
// Quiz state
let currentQuestionIndex = 0;
let score = 0;
let streak = 0;
let selectedOption = null;
let timeStarted = null;
let timerInterval = null;
let timeElapsed = 0;
let answers = [];
let soundsEnabled = true;
let bookmarkedQuestions = [];
let quizHistory = [];
let studyMode = false;
let performanceMetrics = {
    categories: {},
    difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
    totalCorrect: 0,
    totalQuestions: 0,
    totalTime: 0
};
function initQuiz() {
    try {
        // Assign DOM elements safely
        questionElement = document.getElementById('question') || questionElement;
        optionsContainer = document.getElementById('options-container') || optionsContainer;
        currentQuestionElement = document.getElementById('current-question') || currentQuestionElement;
        totalQuestionsElement = document.getElementById('total-questions') || totalQuestionsElement;
        progressBar = document.getElementById('progress-bar') || progressBar;
        prevButton = document.getElementById('prev-btn') || prevButton;
        nextButton = document.getElementById('next-btn') || nextButton;
        skipButton = document.getElementById('skip-btn') || skipButton;
        feedbackElement = document.getElementById('feedback') || feedbackElement;
        timerElement = document.getElementById('timer') || timerElement;
        scoreElement = document.getElementById('score') || scoreElement;
        streakElement = document.getElementById('streak') || streakElement;
        categoryElement = document.getElementById('category') || categoryElement;
        explanationContainer = document.getElementById('explanation-container') || explanationContainer;
        explanationTextElement = document.getElementById('explanation-text') || explanationTextElement;
        themeToggle = document.getElementById('theme-toggle') || themeToggle;
        soundToggle = document.getElementById('sound-toggle') || soundToggle;
        bookmarkBtn = document.getElementById('bookmark-btn') || bookmarkBtn;
        bookmarksCount = document.getElementById('bookmarks-count') || bookmarksCount;
        categoryTag = document.getElementById('category-tag') || categoryTag;
        difficultyTag = document.getElementById('difficulty-tag') || difficultyTag;
        showExplanationBtn = document.getElementById('show-explanation-btn') || showExplanationBtn;
        statsBtn = document.getElementById('stats-btn') || statsBtn;
        statsModal = document.getElementById('stats-modal') || statsModal;
        closeStatsModal = document.getElementById('close-stats-modal') || closeStatsModal;
        closeStatsBtn = document.getElementById('close-stats-btn') || closeStatsBtn;
        quickActionsBtn = document.getElementById('quick-actions-btn') || quickActionsBtn;
        quickActionsModal = document.getElementById('quick-actions-modal') || quickActionsModal;
        closeActionsModal = document.getElementById('close-actions-modal') || closeActionsModal;
        closeActionsBtn = document.getElementById('close-actions-btn') || closeActionsBtn;
        studyModeToggle = document.getElementById('study-mode-toggle') || studyModeToggle;
        confettiContainer = document.getElementById('confetti-container') || confettiContainer;
        // Reset DOM elements
        if (scoreElement) scoreElement.textContent = score;
        if (streakElement) streakElement.textContent = streak;
        if (timerElement) timerElement.textContent = '00:00';
        if (totalQuestionsElement) totalQuestionsElement.textContent = questions.length;
        
        loadQuestion();
        startTimer();
        
        // Clone elements to remove old listeners (cross-browser safe)
        if (prevButton) {
            const prevBtnClone = prevButton.cloneNode(true);
            prevButton.parentNode.replaceChild(prevBtnClone, prevButton);
            prevButton = prevBtnClone;
        }
        if (nextButton) {
            const nextBtnClone = nextButton.cloneNode(true);
            nextButton.parentNode.replaceChild(nextBtnClone, nextButton);
            nextButton = nextBtnClone;
        }
        if (skipButton) {
            const skipBtnClone = skipButton.cloneNode(true);
            skipButton.parentNode.replaceChild(skipBtnClone, skipButton);
            skipButton = skipBtnClone;
        }
        if (themeToggle) {
            const themeToggleClone = themeToggle.cloneNode(true);
            themeToggle.parentNode.replaceChild(themeToggleClone, themeToggle);
            themeToggle = themeToggleClone;
        }
        if (soundToggle) {
            const soundToggleClone = soundToggle.cloneNode(true);
            soundToggle.parentNode.replaceChild(soundToggleClone, soundToggle);
            soundToggle = soundToggleClone;
        }
        if (bookmarkBtn) {
            const bookmarkBtnClone = bookmarkBtn.cloneNode(true);
            bookmarkBtn.parentNode.replaceChild(bookmarkBtnClone, bookmarkBtn);
            bookmarkBtn = bookmarkBtnClone;
        }
        if (showExplanationBtn) {
            const showExplanationBtnClone = showExplanationBtn.cloneNode(true);
            showExplanationBtn.parentNode.replaceChild(showExplanationBtnClone, showExplanationBtn);
            showExplanationBtn = showExplanationBtnClone;
        }
        if (statsBtn) {
            const statsBtnClone = statsBtn.cloneNode(true);
            statsBtn.parentNode.replaceChild(statsBtnClone, statsBtn);
            statsBtn = statsBtnClone;
        }
        // Add event listeners safely
        if (prevButton) prevButton.addEventListener('click', goToPreviousQuestion);
        if (nextButton) nextButton.addEventListener('click', goToNextQuestion);
        if (skipButton) skipButton.addEventListener('click', skipQuestion);
        if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
        if (soundToggle) soundToggle.addEventListener('click', toggleSound);
        if (bookmarkBtn) bookmarkBtn.addEventListener('click', toggleBookmark);
        if (showExplanationBtn) showExplanationBtn.addEventListener('click', toggleExplanation);
        if (statsBtn) statsBtn.addEventListener('click', showStatsModal);
        if (closeStatsModal) closeStatsModal.addEventListener('click', hideStatsModal);
        if (closeStatsBtn) closeStatsBtn.addEventListener('click', hideStatsModal);
        if (quickActionsBtn) quickActionsBtn.addEventListener('click', showQuickActionsModal);
        if (closeActionsModal) closeActionsModal.addEventListener('click', hideQuickActionsModal);
        if (closeActionsBtn) closeActionsBtn.addEventListener('click', hideQuickActionsModal);
        if (studyModeToggle) studyModeToggle.addEventListener('change', toggleStudyMode);
        
        const markForReviewBtn = document.getElementById('mark-for-review-btn');
        if (markForReviewBtn) markForReviewBtn.addEventListener('click', markForReview);
        const viewExplanationBtn = document.getElementById('view-explanation-btn');
        if (viewExplanationBtn) viewExplanationBtn.addEventListener('click', viewExplanation);
        const hintBtn = document.getElementById('hint-btn');
        if (hintBtn) hintBtn.addEventListener('click', getHint);
        const reportBtn = document.getElementById('report-question-btn');
        if (reportBtn) reportBtn.addEventListener('click', reportQuestion);
        
        // Keyboard navigation
        document.removeEventListener('keydown', handleKeydown);
        document.addEventListener('keydown', handleKeydown);
        
        loadPreferences();
        loadQuizHistory();
        updateBookmarksCount();
    } catch (e) {
        console.error('Error initializing quiz:', e);
    }
}
function handleKeydown(e) {
    if (e.key === 'ArrowRight') {
        goToNextQuestion();
    } else if (e.key === 'ArrowLeft') {
        goToPreviousQuestion();
    } else if (e.key.toLowerCase() === 'a' || e.key === '1') {
        selectOption(0);
    } else if (e.key.toLowerCase() === 'b' || e.key === '2') {
        selectOption(1);
    } else if (e.key.toLowerCase() === 'c' || e.key === '3') {
        selectOption(2);
    } else if (e.key.toLowerCase() === 'd' || e.key === '4') {
        selectOption(3);
    } else if (e.key.toLowerCase() === 'e' || e.key === '5') {
        selectOption(4);
    } else if (e.key === 'Enter') {
        if (showExplanationBtn && showExplanationBtn.style.display !== 'none') {
            toggleExplanation();
        }
    } else if (e.key === 's' || e.key === '5') {
        skipQuestion();
    }
}
function loadQuestion() {
    if (!questionElement || !optionsContainer) return; // Safety check
    const question = questions[currentQuestionIndex];
    if (!question) return;
    questionElement.textContent = question.question;
    currentQuestionElement.textContent = currentQuestionIndex + 1;
    if (categoryTag) categoryTag.textContent = question.category || 'Unknown';
    
    // Update difficulty tag with indicator
    if (difficultyTag) {
        difficultyTag.innerHTML = `
            <span class="difficulty-indicator difficulty-${question.difficulty.toLowerCase().replace(' ', '-')}"></span>
            ${question.difficulty}
        `;
    }
    
    if (categoryElement) categoryElement.textContent = question.category || 'All';
    
    const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
    if (progressBar) progressBar.style.width = `${progress}%`;
    
    // Update progress level for appearance change
    let progressLevel = 0;
    if (progress > 75) progressLevel = 75;
    else if (progress > 50) progressLevel = 50;
    else if (progress > 25) progressLevel = 25;
    body.setAttribute('data-progress', progressLevel);
    
    optionsContainer.innerHTML = '';
    
    const optionLetters = ['A', 'B', 'C', 'D', 'E'];
    question.options.forEach((option, index) => {
        const optionElement = document.createElement('div');
        optionElement.classList.add('option', 'fade-in');
        optionElement.setAttribute('role', 'button');
        optionElement.setAttribute('tabindex', '0');
        optionElement.setAttribute('aria-label', `Option ${optionLetters[index]}: ${option}`);
        
        const optionLetter = document.createElement('div');
        optionLetter.classList.add('option-letter');
        optionLetter.textContent = optionLetters[index];
        
        const optionText = document.createElement('div');
        optionText.classList.add('option-text');
        optionText.textContent = option;
        
        optionElement.appendChild(optionLetter);
        optionElement.appendChild(optionText);
        
        optionElement.addEventListener('click', () => selectOption(index));
        optionElement.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                selectOption(index);
            }
        });
        
        optionsContainer.appendChild(optionElement);
    });
    
    if (prevButton) prevButton.disabled = currentQuestionIndex === 0;
    if (nextButton) nextButton.textContent = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz' : 'Next Question';
    if (nextButton) nextButton.innerHTML = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz <i class="fas fa-flag-checkered"></i>' : 'Next Question <i class="fas fa-arrow-right"></i>';
    
    if (feedbackElement) feedbackElement.style.display = 'none';
    if (showExplanationBtn) showExplanationBtn.style.display = 'none';
    if (explanationContainer) explanationContainer.classList.remove('expanded');
    
    selectedOption = null;
    
    // Show quick actions button
    if (quickActionsBtn) quickActionsBtn.style.display = 'flex';
    
    // If the question was previously answered or skipped, display the feedback and explanations
    if (answers[currentQuestionIndex]) {
        const ans = answers[currentQuestionIndex];
        const options = document.querySelectorAll('.option');
        if (feedbackElement) feedbackElement.style.display = 'flex';
        if (showExplanationBtn) showExplanationBtn.style.display = 'block';
        
        // Update explanation with general explanation and whyNotOtherOptions
        if (explanationTextElement) {
            let explanationContent = question.explanation;
            if (question.whyNotOtherOptions) {
                explanationContent += '<br><br><strong>Why Not Other Options:</strong><ul>';
                const optionLetters = ['a', 'b', 'c', 'd'];
                optionLetters.forEach((letter, index) => {
                    if (index !== question.answer && question.whyNotOtherOptions[letter]) {
                        explanationContent += `<li><strong>Option ${letter.toUpperCase()}:</strong> ${question.whyNotOtherOptions[letter]}</li>`;
                    }
                });
                explanationContent += '</ul>';
            }
            explanationTextElement.innerHTML = explanationContent;
        }
        
        options.forEach(option => option.style.pointerEvents = 'none');
        
        if (ans.selected === 'Skipped') {
            selectedOption = null;
            if (feedbackElement) {
                feedbackElement.classList.add('skipped');
                feedbackElement.innerHTML = '<i class="fas fa-forward feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
            }
            options[question.answer].classList.add('correct');
        } else {
            const optIndex = question.options.findIndex(opt => opt === ans.selected);
            if (optIndex !== -1) {
                selectedOption = optIndex;
                options[optIndex].classList.add('selected');
                if (ans.isCorrect) {
                    if (feedbackElement) {
                        feedbackElement.classList.add('correct');
                        feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                    }
                } else {
                    if (feedbackElement) {
                        feedbackElement.classList.add('incorrect');
                        feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                    }
                    options[question.answer].classList.add('correct');
                    options[optIndex].classList.add('incorrect');
                }
            }
        }
    }
    
    updateBookmarkStatus();
}
function selectOption(index) {
    if (selectedOption !== null || answers[currentQuestionIndex]) return;
    
    const options = document.querySelectorAll('.option');
    options.forEach(option => option.classList.remove('selected', 'incorrect'));
    options[index].classList.add('selected');
    selectedOption = index;
    
    const question = questions[currentQuestionIndex];
    const isCorrect = index === question.answer;
    
    if (feedbackElement) feedbackElement.style.display = 'flex';
    if (isCorrect) {
        if (feedbackElement) {
            feedbackElement.classList.remove('incorrect');
            feedbackElement.classList.add('correct');
            feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
        }
        score += getScoreForDifficulty(question.difficulty);
        streak++;
        playSound('correct');
        
        if (question.difficulty === 'Hard' || question.difficulty === 'Very Hard') {
            createConfetti();
        }
    } else {
        if (feedbackElement) {
            feedbackElement.classList.remove('correct');
            feedbackElement.classList.add('incorrect');
            feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
        }
        options[question.answer].classList.add('correct');
        options[index].classList.add('incorrect');
        streak = 0;
        playSound('incorrect');
    }
    
    if (scoreElement) scoreElement.textContent = score;
    if (streakElement) streakElement.textContent = streak;
    
    if (explanationTextElement) {
        let explanationContent = question.explanation;
        if (question.whyNotOtherOptions) {
            explanationContent += '<br><br><strong>Why Not Other Options:</strong><ul>';
            const optionLetters = ['a', 'b', 'c', 'd'];
            optionLetters.forEach((letter, idx) => {
                if (idx !== question.answer && question.whyNotOtherOptions[letter]) {
                    explanationContent += `<li><strong>Option ${letter.toUpperCase()}:</strong> ${question.whyNotOtherOptions[letter]}</li>`;
                }
            });
            explanationContent += '</ul>';
        }
        explanationTextElement.innerHTML = explanationContent;
    }
    if (showExplanationBtn) showExplanationBtn.style.display = 'block';
    
    answers[currentQuestionIndex] = {
        question: question.question,
        selected: question.options[index],
        correct: question.options[question.answer],
        isCorrect: isCorrect,
        explanation: question.explanation,
        category: question.category,
        difficulty: question.difficulty
    };
    
    updatePerformanceMetrics(isCorrect, question);
    
    options.forEach(option => option.style.pointerEvents = 'none');
}
function skipQuestion() {
    if (answers[currentQuestionIndex]) return;
    
    const question = questions[currentQuestionIndex];
    const options = document.querySelectorAll('.option');
    
    if (feedbackElement) {
        feedbackElement.style.display = 'flex';
        feedbackElement.classList.add('skipped');
        feedbackElement.innerHTML = '<i class="fas fa-forward feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
    }
    
    options[question.answer].classList.add('correct');
    if (showExplanationBtn) showExplanationBtn.style.display = 'block';
    
    if (explanationTextElement) {
        let explanationContent = question.explanation;
        if (question.whyNotOtherOptions) {
            explanationContent += '<br><br><strong>Why Not Other Options:</strong><ul>';
            const optionLetters = ['a', 'b', 'c', 'd'];
            optionLetters.forEach((letter, idx) => {
                if (idx !== question.answer && question.whyNotOtherOptions[letter]) {
                    explanationContent += `<li><strong>Option ${letter.toUpperCase()}:</strong> ${question.whyNotOtherOptions[letter]}</li>`;
                }
            });
            explanationContent += '</ul>';
        }
        explanationTextElement.innerHTML = explanationContent;
    }
    
    answers[currentQuestionIndex] = {
        question: question.question,
        selected: 'Skipped',
        correct: question.options[question.answer],
        isCorrect: false,
        explanation: question.explanation,
        category: question.category,
        difficulty: question.difficulty
    };
    
    updatePerformanceMetrics(false, question);
    streak = 0;
    if (streakElement) streakElement.textContent = streak;
    
    options.forEach(option => option.style.pointerEvents = 'none');
}
function maybeHandleSkip() {
    if (!answers[currentQuestionIndex] && selectedOption === null) {
        skipQuestion();
    }
}
function toggleExplanation() {
    if (!explanationContainer) return;
    explanationContainer.classList.toggle('expanded');
    if (!showExplanationBtn) return;
    showExplanationBtn.innerHTML = explanationContainer.classList.contains('expanded') ?
        '<i class="fas fa-info-circle"></i> Hide Explanation' :
        '<i class="fas fa-info-circle"></i> Show Explanation';
}
function getScoreForDifficulty(difficulty) {
    switch (difficulty) {
        case 'Easy': return 5;
        case 'Medium': return 10;
        case 'Hard': return 15;
        case 'Very Hard': return 20;
        default: return 10;
    }
}
function updatePerformanceMetrics(isCorrect, question) {
    performanceMetrics.totalQuestions++;
    performanceMetrics.totalTime += timeElapsed;
    if (isCorrect) performanceMetrics.totalCorrect++;
    
    performanceMetrics.categories[question.category] = performanceMetrics.categories[question.category] || { correct: 0, total: 0 };
    performanceMetrics.categories[question.category].total++;
    if (isCorrect) performanceMetrics.categories[question.category].correct++;
    
    if (!performanceMetrics.difficulties[question.difficulty]) performanceMetrics.difficulties[question.difficulty] = 0;
    if (isCorrect) performanceMetrics.difficulties[question.difficulty]++;
}
function toggleBookmark() {
    if (!bookmarkBtn) return;
    const questionId = questions[currentQuestionIndex].id;
    const index = bookmarkedQuestions.indexOf(questionId);
    if (index === -1) {
        bookmarkedQuestions.push(questionId);
        bookmarkBtn.classList.add('bookmarked');
        playSound('bookmark');
    } else {
        bookmarkedQuestions.splice(index, 1);
        bookmarkBtn.classList.remove('bookmarked');
    }
    updateBookmarksCount();
    saveBookmarks();
}
function updateBookmarkStatus() {
    if (!bookmarkBtn) return;
    const questionId = questions[currentQuestionIndex].id;
    bookmarkBtn.classList.toggle('bookmarked', bookmarkedQuestions.includes(questionId));
}
function updateBookmarksCount() {
    if (!bookmarksCount) return;
    bookmarksCount.textContent = bookmarkedQuestions.length;
}
function goToNextQuestion() {
    maybeHandleSkip();
    if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        loadQuestion();
    } else {
        body.setAttribute('data-progress', '100');
        showResults();
        saveQuizHistory();
    }
}
function goToPreviousQuestion() {
    maybeHandleSkip();
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion();
    }
}
function startTimer() {
    timeStarted = new Date();
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(updateTimer, 1000);
}
function updateTimer() {
    timeElapsed++;
    
    const minutes = Math.floor(timeElapsed / 60).toString().padStart(2, '0');
    const seconds = (timeElapsed % 60).toString().padStart(2, '0');
    if (timerElement) timerElement.textContent = `${minutes}:${seconds}`;
    
    if (timeElapsed >= 300) {
        if (timerElement) {
            timerElement.style.color = 'var(--danger)';
            timerElement.classList.add('pulse');
        }
    } else {
        if (timerElement) {
            timerElement.style.color = 'var(--primary)';
            timerElement.classList.remove('pulse');
        }
    }
}
function showResults() {
    if (timerInterval) clearInterval(timerInterval);
    if (quickActionsBtn) quickActionsBtn.style.display = 'none';
    
    const quizContainer = document.querySelector('.quiz-container');
    if (!quizContainer) return;
    const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
    const percentage = ((score / maxScore) * 100).toFixed(1);
    const accuracy = ((performanceMetrics.totalCorrect / performanceMetrics.totalQuestions) * 100).toFixed(1);
    const avgTime = Math.round(performanceMetrics.totalTime / performanceMetrics.totalQuestions);
    
    quizContainer.innerHTML = `
        <div class="results-container">
            <h2 class="quiz-title">Quiz Completed!</h2>
            <p class="quiz-subtitle">You've finished the MED QUIZ</p>
            
            <div class="score-circle" style="--p: ${percentage}%">
                <div class="score-text">
                    <div class="score-value">${score}</div>
                    <div class="score-label">Points</div>
                </div>
            </div>
            
            <div class="results-stats">
                <div class="result-stat">
                    <div class="result-stat-value">${accuracy}%</div>
                    <div class="result-stat-label">Accuracy</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value">${timeElapsed}s</div>
                    <div class="result-stat-label">Time Taken</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value">${streak}</div>
                    <div class="result-stat-label">Best Streak</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value">${bookmarkedQuestions.length}</div>
                    <div class="result-stat-label">Bookmarked</div>
                </div>
            </div>
            
            <div class="review-section">
                <h3 class="review-title">Performance Analytics</h3>
                <div class="review-item">
                    <div class="review-answer">Average Time Per Question: ${avgTime}s</div>
                    <div class="review-answer">Difficulty Performance:
                        Easy: ${performanceMetrics.difficulties.Easy || 0},
                        Medium: ${performanceMetrics.difficulties.Medium || 0},
                        Hard: ${performanceMetrics.difficulties.Hard || 0},
                        Very Hard: ${performanceMetrics.difficulties['Very Hard'] || 0}
                    </div>
                </div>
                
                <h3 class="review-title">Review Your Answers</h3>
                ${answers.map((answer, index) => `
                    <div class="review-item ${answer.isCorrect ? 'correct' : answer.selected === 'Skipped' ? 'skipped' : 'incorrect'}">
                        <div class="review-question">Q${index + 1}: ${answer.question} (${answer.category} - ${answer.difficulty})</div>
                        <div class="review-answer">Your Answer: ${answer.selected}</div>
                        <div class="review-answer">Correct Answer: ${answer.correct}</div>
                        <div class="review-explanation">${answer.explanation}
                            ${questions[index].whyNotOtherOptions ? `
                                <br><br><strong>Why Not Other Options:</strong>
                                <ul>
                                    ${Object.entries(questions[index].whyNotOtherOptions).map(([key, value]) => `
                                        <li><strong>Option ${key.toUpperCase()}:</strong> ${value}</li>
                                    `).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    </div>
                `).join('')}
                
                ${bookmarkedQuestions.length > 0 ? `
                    <h3 class="review-title">Bookmarked Questions</h3>
                    ${bookmarkedQuestions.map(qid => {
                        const question = questions.find(q => q.id === qid);
                        if (!question) return '';
                        return `
                            <div class="review-item">
                                <div class="review-question">${question.question} (${question.category} - ${question.difficulty})</div>
                                <div class="review-answer">Correct Answer: ${question.correctAnswer}</div>
                                <div class="review-explanation">${question.explanation}
                                    ${question.whyNotOtherOptions ? `
                                        <br><br><strong>Why Not Other Options:</strong>
                                        <ul>
                                            ${Object.entries(question.whyNotOtherOptions).map(([key, value]) => `
                                                <li><strong>Option ${key.toUpperCase()}:</strong> ${value}</li>
                                            `).join('')}
                                        </ul>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                ` : ''}
            </div>
            
            <button class="btn btn-primary mt-4" id="restart-btn">
                <i class="fas fa-redo"></i> Try Again
            </button>
            <button class="btn btn-secondary mt-2" id="review-wrong-btn">
                <i class="fas fa-search"></i> Review Incorrect Answers
            </button>
        </div>
    `;
    
    // Add event listeners after DOM update
    const restartBtn = document.getElementById('restart-btn');
    const reviewWrongBtn = document.getElementById('review-wrong-btn');
    if (restartBtn) restartBtn.addEventListener('click', restartQuiz);
    if (reviewWrongBtn) reviewWrongBtn.addEventListener('click', reviewWrongAnswers);
}
function reviewWrongAnswers() {
    const wrongAnswers = answers.filter(answer => !answer.isCorrect && answer.selected !== 'Skipped');
    
    if (wrongAnswers.length === 0) {
        alert("You don't have any incorrect answers to review!");
        return;
    }
    
    const wrongQuestions = questions.filter((q, index) =>
        answers[index] && !answers[index].isCorrect && answers[index].selected !== 'Skipped'
    );
    
    questions.length = 0;
    questions.push(...wrongQuestions);
    currentQuestionIndex = 0;
    score = 0;
    streak = 0;
    timeElapsed = 0;
    answers = [];
    selectedOption = null;
    performanceMetrics = {
        categories: {},
        difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
        totalCorrect: 0,
        totalQuestions: 0,
        totalTime: 0
    };
    
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    body.setAttribute('data-progress', '0');
    
    const quizContainer = document.querySelector('.quiz-container');
    if (quizContainer) {
        quizContainer.innerHTML = `
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">MED QUIZ</h1>
                    <p class="quiz-subtitle">Reviewing Incorrect Answers</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="score">0</span>
                        <span class="stat-label">Score</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="streak">0</span>
                        <span class="stat-label">Streak</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">Review</span>
                        <span class="stat-label">Mode</span>
                    </div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>
            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">Biochemistry</span>
                    <span class="tag" id="difficulty-tag">
                        <span class="difficulty-indicator difficulty-medium"></span>
                        Medium
                    </span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">${wrongQuestions.length}</span></div>
            <div class="question-text" id="question"></div>
            <div class="options-grid" id="options-container"></div>
            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>
            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>
            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text"></div>
                </div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-danger" id="skip-btn">
                    <i class="fas fa-forward"></i> Skip
                </button>
            </div>
        `;
    }
    
    initQuiz();
}
function restartQuiz() {
    currentQuestionIndex = 0;
    score = 0;
    streak = 0;
    timeElapsed = 0;
    answers = [];
    selectedOption = null;
    performanceMetrics = {
        categories: {},
        difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
        totalCorrect: 0,
        totalQuestions: 0,
        totalTime: 0
    };
    
    questions.length = 0;
    questions.push(...originalQuestions);
    
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    body.setAttribute('data-progress', '0');
    
    const quizContainer = document.querySelector('.quiz-container');
    if (quizContainer) {
        quizContainer.innerHTML = `
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">MED QUIZ</h1>
                    <p class="quiz-subtitle">Test your medical knowledge</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="score">0</span>
                        <span class="stat-label">Score</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="streak">0</span>
                        <span class="stat-label">Streak</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">All</span>
                        <span class="stat-label">Category</span>
                    </div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>
            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">Biochemistry</span>
                    <span class="tag" id="difficulty-tag">
                        <span class="difficulty-indicator difficulty-medium"></span>
                        Medium
                    </span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">15</span></div>
            <div class="question-text" id="question"></div>
            <div class="options-grid" id="options-container"></div>
            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>
            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>
            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text"></div>
                </div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-danger" id="skip-btn">
                    <i class="fas fa-forward"></i> Skip
                </button>
            </div>
        `;
    }
    
    initQuiz();
}
function markForReview() {
    toggleBookmark();
    hideQuickActionsModal();
}
function viewExplanation() {
    if (!answers[currentQuestionIndex]) return;
    toggleExplanation();
    hideQuickActionsModal();
}
function getHint() {
    if (answers[currentQuestionIndex]) return;
    const wrongOptions = Array.from(document.querySelectorAll('.option')).filter((opt, idx) => idx !== questions[currentQuestionIndex].answer);
    const randomWrong = wrongOptions[Math.floor(Math.random() * wrongOptions.length)];
    randomWrong.style.opacity = '0.5';
    randomWrong.style.pointerEvents = 'none';
    const hintText = document.createElement('div');
    hintText.textContent = 'Hint: One wrong option eliminated!';
    hintText.classList.add('feedback', 'skipped');
    optionsContainer.before(hintText);
    setTimeout(() => hintText.remove(), 3000);
    hideQuickActionsModal();
}
function reportQuestion() {
    alert('Question reported. Thank you for your feedback!');
    hideQuickActionsModal();
}
function toggleTheme() {
    if (!body || !themeToggle) return;
    const currentTheme = body.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' :
                    currentTheme === 'light' ? 'minimal' : 'dark';
    
    body.setAttribute('data-theme', newTheme);
    themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-moon"></i>' :
                          newTheme === 'light' ? '<i class="fas fa-sun"></i>' :
                          '<i class="fas fa-paint-brush"></i>';
    
    localStorage.setItem('theme', newTheme);
}
function toggleSound() {
    if (!soundToggle) return;
    soundsEnabled = !soundsEnabled;
    soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
    
    localStorage.setItem('soundsEnabled', soundsEnabled);
}
function toggleStudyMode() {
    if (!studyModeToggle) return;
    studyMode = studyModeToggle.checked;
    if (showExplanationBtn && explanationContainer) {
        if (studyMode) {
            showExplanationBtn.style.display = 'block';
            explanationContainer.classList.add('expanded');
            showExplanationBtn.innerHTML = '<i class="fas fa-info-circle"></i> Hide Explanation';
        } else {
            showExplanationBtn.style.display = 'none';
            explanationContainer.classList.remove('expanded');
        }
    }
    localStorage.setItem('studyMode', studyMode);
}
function playSound(type) {
    if (!soundsEnabled) return;
    
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        if (type === 'correct') {
            const notes = [523.25, 659.25, 783.99];
            notes.forEach((freq, i) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime + i * 0.1);
                    oscillator.stop(audioContext.currentTime + i * 0.1 + 0.3);
                }, i * 100);
            });
        } else if (type === 'incorrect') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.type = 'sawtooth';
            gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.4);
        } else if (type === 'bookmark') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.type = 'triangle';
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.2);
        }
    } catch (e) {
        console.log('Web Audio API not supported');
    }
}
function createConfetti() {
    if (!confettiContainer) return;
    const colors = ['#4361ee', '#4cc9f0', '#f72585', '#f9c74f', '#7209b7'];
    
    for (let i = 0; i < 60; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.width = (6 + Math.random() * 12) + 'px';
        confetti.style.height = (6 + Math.random() * 12) + 'px';
        confetti.style.animation = `confettiFall ${1.5 + Math.random() * 2.5}s linear forwards`;
        confettiContainer.appendChild(confetti);
        
        setTimeout(() => {
            if (confetti.parentNode) confetti.remove();
        }, 4000);
    }
}
function showStatsModal() {
    if (!statsModal) return;
    const totalQuestions = performanceMetrics.totalQuestions;
    const correctAnswers = performanceMetrics.totalCorrect;
    const accuracy = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
    const avgTime = totalQuestions > 0 ? Math.round(performanceMetrics.totalTime / totalQuestions) : 0;
    
    const modalTotal = document.getElementById('modal-total-questions');
    const modalCorrect = document.getElementById('modal-correct-answers');
    const modalAccuracy = document.getElementById('modal-accuracy');
    const modalAvgTime = document.getElementById('modal-avg-time');
    if (modalTotal) modalTotal.textContent = totalQuestions;
    if (modalCorrect) modalCorrect.textContent = correctAnswers;
    if (modalAccuracy) modalAccuracy.textContent = `${accuracy}%`;
    if (modalAvgTime) modalAvgTime.textContent = `${avgTime}s`;
    
    const categoryStatsContainer = document.getElementById('category-stats');
    if (categoryStatsContainer) {
        categoryStatsContainer.innerHTML = `
            <table style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr><th>Category</th><th>Accuracy</th><th>Correct/Total</th></tr>
                </thead>
                <tbody>
                    ${Object.entries(performanceMetrics.categories).map(([category, stats]) => {
                        const categoryAccuracy = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
                        return `<tr><td>${category}</td><td>${categoryAccuracy}%</td><td>${stats.correct}/${stats.total}</td></tr>`;
                    }).join('')}
                </tbody>
            </table>
        `;
    }
    
    const difficultyStatsContainer = document.getElementById('difficulty-stats');
    if (difficultyStatsContainer) {
        difficultyStatsContainer.innerHTML = `
            <table style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr><th>Difficulty</th><th>Accuracy</th><th>Correct/Total</th></tr>
                </thead>
                <tbody>
                    ${Object.entries(performanceMetrics.difficulties).map(([difficulty, correctCount]) => {
                        const diffTotals = {};
                        answers.forEach(ans => {
                            if (ans.difficulty && ans.isCorrect !== undefined) {
                                if (!diffTotals[ans.difficulty]) diffTotals[ans.difficulty] = { correct: 0, total: 0 };
                                diffTotals[ans.difficulty].total++;
                                if (ans.isCorrect) diffTotals[ans.difficulty].correct++;
                            }
                        });
                        const totalForDifficulty = diffTotals[difficulty] ? diffTotals[difficulty].total : 0;
                        if (totalForDifficulty > 0) {
                            const difficultyAccuracy = Math.round((correctCount / totalForDifficulty) * 100);
                            return `<tr><td>${difficulty}</td><td>${difficultyAccuracy}%</td><td>${correctCount}/${totalForDifficulty}</td></tr>`;
                        }
                        return '';
                    }).join('')}
                </tbody>
            </table>
        `;
    }
    
    const historyContainer = document.getElementById('history-stats');
    if (historyContainer) {
        if (quizHistory.length === 0) {
            historyContainer.innerHTML = '<p>No history yet.</p>';
        } else {
            historyContainer.innerHTML = `
                <table style="width:100%; border-collapse: collapse;">
                    <thead>
                        <tr><th>Date</th><th>Score</th><th>Percentage</th><th>Time</th><th>Streak</th></tr>
                    </thead>
                    <tbody>
                        ${quizHistory.map(h => {
                            const date = new Date(h.timestamp).toLocaleString();
                            return `<tr><td>${date}</td><td>${h.score}</td><td>${h.percentage}%</td><td>${h.timeSpent}s</td><td>${h.streak}</td></tr>`;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }
    }
    
    statsModal.classList.add('active');
}
function hideStatsModal() {
    if (statsModal) statsModal.classList.remove('active');
}
function showQuickActionsModal() {
    if (quickActionsModal) quickActionsModal.classList.add('active');
}
function hideQuickActionsModal() {
    if (quickActionsModal) quickActionsModal.classList.remove('active');
}
function loadPreferences() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme && body) {
        body.setAttribute('data-theme', savedTheme);
        if (themeToggle) {
            themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-moon"></i>' :
                                  savedTheme === 'light' ? '<i class="fas fa-sun"></i>' :
                                  '<i class="fas fa-paint-brush"></i>';
        }
    }
    
    const savedSounds = localStorage.getItem('soundsEnabled');
    if (savedSounds !== null) {
        soundsEnabled = savedSounds === 'true';
        if (soundToggle) {
            soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
        }
    }
    
    const savedStudyMode = localStorage.getItem('studyMode');
    if (savedStudyMode !== null) {
        studyMode = savedStudyMode === 'true';
        if (studyModeToggle) studyModeToggle.checked = studyMode;
        if (studyMode && showExplanationBtn && explanationContainer) {
            showExplanationBtn.style.display = 'block';
            explanationContainer.classList.add('expanded');
            showExplanationBtn.innerHTML = '<i class="fas fa-info-circle"></i> Hide Explanation';
        }
    }
}
function saveBookmarks() {
    localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarkedQuestions));
}
function loadQuizHistory() {
    const saved = localStorage.getItem('quizHistory');
    if (saved) {
        try {
            quizHistory = JSON.parse(saved);
        } catch (e) {
            quizHistory = [];
        }
    }
    loadBookmarks();
}
function saveQuizHistory() {
    const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
    quizHistory.push({
        timestamp: new Date().toISOString(),
        score: score,
        percentage: ((score / maxScore) * 100).toFixed(1),
        timeSpent: timeElapsed,
        streak: streak,
        answers: answers,
        performanceMetrics: performanceMetrics
    });
    localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
}
function loadBookmarks() {
    const saved = localStorage.getItem('bookmarkedQuestions');
    if (saved) {
        try {
            bookmarkedQuestions = JSON.parse(saved);
        } catch (e) {
            bookmarkedQuestions = [];
        }
    }
}
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initQuiz);
} else {
    initQuiz();
}
</script>
</body>
</html>