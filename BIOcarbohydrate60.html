<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MED QUIZ Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #f72585;
            --success: #4cc9f0;
            --warning: #f9c74f;
            --danger: #f94144;
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f5;
            --gray-800: #343a40;
            --gray-900: #212529;
            --bg-primary: var(--gray-900);
            --bg-secondary: #1a1d21;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --card-bg: rgba(35, 39, 47, 0.95);
            --card-border: #4cc9f0;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --transition: all 0.2s ease-in-out;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --header-height: 50px;
            --max-width: 800px;
            --side-padding: 1rem;
            --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
        }

        [data-theme="light"] {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --text-primary: #1a1d21;
            --text-secondary: rgba(26, 29, 33, 0.7);
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            line-height: 1.5;
            font-weight: 400;
            overflow-x: hidden;
            padding: 0;
        }

        /* Compact Header */
        header {
            height: var(--header-height);
            background: var(--gradient-primary);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--side-padding);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            color: white;
        }

        .logo-icon {
            font-size: 1.25rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 1.5rem var(--side-padding);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .quiz-container {
            width: 100%;
            max-width: var(--max-width);
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 1px solid var(--card-border);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .quiz-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .quiz-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .stats-container {
            display: flex;
            gap: 0.75rem;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            min-width: 60px;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1rem;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius-md);
            overflow: hidden;
            margin: 1.5rem 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            transition: width 0.4s ease;
        }

        /* Question Meta */
        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            padding: 0.25rem 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .difficulty-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .difficulty-easy { background-color: var(--success); }
        .difficulty-medium { background-color: var(--warning); }
        .difficulty-hard { background-color: var(--danger); }

        .bookmark-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .bookmark-btn.bookmarked {
            color: var(--warning);
        }

        /* Question */
        .question-number {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            text-align: center;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            border-color: var(--primary-light);
        }

        .option.selected {
            background: rgba(67, 97, 238, 0.15);
            border-color: var(--primary);
        }

        .option.correct {
            background: rgba(76, 201, 240, 0.15);
            border-color: var(--success);
        }

        .option.incorrect {
            background: rgba(249, 65, 68, 0.15);
            border-color: var(--danger);
        }

        .option-letter {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--danger);
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 0.95rem;
        }

        /* Feedback */
        .feedback {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
        }

        .feedback.correct {
            background: rgba(76, 201, 240, 0.15);
            color: var(--success);
        }

        .feedback.incorrect {
            background: rgba(249, 65, 68, 0.15);
            color: var(--danger);
        }

        .feedback.skipped {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary);
        }

        .feedback-icon {
            font-size: 1.25rem;
        }

        /* Explanation */
        .explanation-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .explanation-container.expanded {
            max-height: 500px;
        }

        .explanation {
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .explanation-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            font-size: 0.9rem;
            flex: 1;
            justify-content: center;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255,255,255,0.2);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Study Mode Toggle */
        .study-mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            justify-content: center;
            font-size: 0.9rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Results */
        .results-container {
            text-align: center;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: conic-gradient(var(--gradient-primary) 0% var(--p, 0%), var(--bg-secondary) var(--p, 0%) 100%);
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--card-bg);
        }

        .score-text {
            position: relative;
            z-index: 1;
        }

        .score-value {
            font-size: 1.75rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .result-stat {
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
        }

        .result-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .result-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .review-section {
            margin-top: 2rem;
            text-align: left;
        }

        .review-title {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary);
            text-align: center;
        }

        .review-item {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            background: rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }

        .review-item.correct {
            border-left: 3px solid var(--success);
        }

        .review-item.incorrect {
            border-left: 3px solid var(--danger);
        }

        .review-item.skipped {
            border-left: 3px solid var(--primary);
        }

        .review-question {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .review-answer {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
        }

        .review-explanation {
            color: var(--text-secondary);
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        footer {
            padding: 2rem var(--side-padding);
            background: var(--bg-secondary);
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            margin-top: auto;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal {
            background: var(--card-bg);
            border-radius: var(--radius-2xl);
            padding: 2.5rem;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: translateY(-50px) scale(0.95);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--card-border);
        }
        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-base);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: rgba(255,255,255,0.1);
            color: var(--primary);
        }
        .modal-body {
            margin-bottom: 2rem;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        .difficulty-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.75rem;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .difficulty-easy {
            background-color: var(--success);
            box-shadow: 0 0 10px var(--success);
        }
        .difficulty-medium {
            background-color: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }
        .difficulty-hard {
            background-color: var(--danger);
            box-shadow: 0 0 10px var(--danger);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition-base);
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .stat-card-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .stat-card-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--gradient-primary);
            opacity: 0;
            border-radius: 2px;
        }
        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(-100px) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }
        .fab {
            position: fixed;
            bottom: 2.5rem;
            right: 2.5rem;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            box-shadow: var(--shadow-xl);
            cursor: pointer;
            z-index: 100;
            transition: var(--transition-smooth);
            border: 3px solid rgba(255,255,255,0.2);
        }
        .fab:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 20px 40px rgba(67, 97, 238, 0.3);
        }
        .study-mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-lg);
            justify-content: center;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .toggle-slider {
            background-color: var(--primary);
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.5);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(32px);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease;
        }
        .pulse {
            animation: pulse 1s infinite;
        }
        .bounce-in {
            animation: bounceIn 0.6s ease;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        .text-center {
            text-align: center;
        }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .full-width {
            width: 100%;
        }
        @media (max-width: 768px) {
            :root {
                --side-padding: 1rem;
                --header-height: 50px;
            }
            .quiz-container {
                padding: 2rem;
                border-radius: var(--radius-xl);
            }
            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.5rem;
            }
            .stats-container {
                width: 100%;
                justify-content: space-between;
            }
            .results-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .score-circle {
                width: 140px;
                height: 140px;
            }
            .score-circle::before {
                width: 110px;
                height: 110px;
            }
            .score-value {
                font-size: 2.25rem;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .fab {
                bottom: 1.5rem;
                right: 1.5rem;
                width: 55px;
                height: 55px;
                font-size: 1.5rem;
            }
            .navigation {
                flex-direction: column;
            }
            .btn {
                width: 100%;
            }
            .options-grid {
                grid-template-columns: 1fr;
            }
            .options-grid .option:nth-child(1),
            .options-grid .option:nth-child(2),
            .options-grid .option:nth-child(3),
            .options-grid .option:nth-child(4) {
                grid-column: auto;
            }
        }
        @media (max-width: 480px) {
            .option {
                padding: 1rem;
            }
            .option-letter {
                width: 32px;
                height: 32px;
                margin-right: 1rem;
            }
            .quiz-title {
                font-size: 1.5rem;
            }
            .question-text {
                font-size: 1.1rem;
            }
        }
        /* Explanation Section Styling */
.explanation-container {
    background: var(--background-secondary, #f8f9fa); /* Light background for contrast */
    border-radius: 12px; /* Rounded corners */
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
    transition: all 0.3s ease; /* Smooth transition for expand/collapse */
    border: 1px solid var(--border-color, #e0e0e0); /* Subtle border */
}

.explanation-container.expanded {
    max-height: 800px; /* Increased max-height for content */
    opacity: 1;
    transform: translateY(0); /* Smooth slide-in effect */
}

.explanation-container:not(.expanded) {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transform: translateY(-10px); /* Slight upward shift when hidden */
}

.explanation {
    display: flex;
    flex-direction: column;
    gap: 12px; /* Spacing between title and text */
}

.explanation-title {
    font-size: 1.25rem; /* Slightly larger for emphasis */
    font-weight: 600;
    color: var(--primary, #4361ee); /* Match quiz primary color */
    border-bottom: 2px solid var(--primary-light, #4cc9f0); /* Underline effect */
    padding-bottom: 8px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.explanation-title::before {
    content: "\f05a"; /* Font Awesome info-circle icon */
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    color: var(--primary, #4361ee);
    font-size: 1.2rem;
}

#explanation-text {
    font-size: 1rem;
    line-height: 1.6; /* Improved readability */
    color: var(--text-color, #333);
}

/* Styling for the "Why Not Other Options" list */
#explanation-text ul {
    list-style: none; /* Remove default bullets */
    padding: 0;
    margin: 16px 0 0 0;
}

#explanation-text li {
    position: relative;
    padding-left: 28px; /* Space for custom bullet */
    margin-bottom: 12px; /* Spacing between items */
    font-size: 0.95rem;
    line-height: 1.5;
    color: var(--text-secondary, #555);
    transition: transform 0.2s ease, background 0.2s ease;
}

#explanation-text li::before {
    content: "\f00d"; /* Font Awesome times-circle icon for incorrect options */
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    color: var(--danger, #f72585); /* Red/pink for incorrect options */
    position: absolute;
    left: 0;
    top: 4px;
    font-size: 1rem;
}

#explanation-text li strong {
    color: var(--text-color, #333); /* Darker color for option labels */
    font-weight: 600;
}

/* Hover effect for list items */
#explanation-text li:hover {
    background: var(--background-hover, rgba(67, 97, 238, 0.1)); /* Subtle highlight */
    border-radius: 6px;
    transform: translateX(4px); /* Slight shift for interactivity */
    padding-left: 32px; /* Adjust for hover */
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .explanation-container {
        padding: 15px;
        margin-top: 15px;
    }

    .explanation-title {
        font-size: 1.1rem;
    }

    #explanation-text {
        font-size: 0.95rem;
    }

    #explanation-text li {
        font-size: 0.9rem;
        padding-left: 24px;
        margin-bottom: 10px;
    }
}

/* Animation for expanding explanation */
@keyframes explanationFadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.explanation-container.expanded .explanation {
    animation: explanationFadeIn 0.3s ease;
}

/* Ensure consistency with theme variables */
:root {
    --background-secondary: #f8f9fa;
    --border-color: #e0e0e0;
    --text-color: #333;
    --text-secondary: #555;
    --background-hover: rgba(67, 97, 238, 0.1);
}

[data-theme="dark"] {
    --background-secondary: #2a2a2a;
    --border-color: #444;
    --text-color: #e0e0e0;
    --text-secondary: #b0b0b0;
    --background-hover: rgba(76, 201, 240, 0.2);
}

[data-theme="minimal"] {
    --background-secondary: #f0f4f8;
    --border-color: #d0d4d8;
    --text-color: #2a2a2a;
    --text-secondary: #666;
    --background-hover: rgba(67, 97, 238, 0.05);
}
    </style>
</head>
<body data-theme="dark" data-progress="0">
    <header>
        <div class="logo">
            <i class="fas fa-brain logo-icon"></i>
            <span>MedQuiz</span>
        </div>
        <div class="header-controls">
            <button class="control-btn" id="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="control-btn" id="sound-toggle" aria-label="Toggle sound">
                <i class="fas fa-volume-up"></i>
            </button>
            <button class="control-btn" id="stats-btn" aria-label="View statistics">
                <i class="fas fa-chart-line"></i>
                <span class="badge" id="bookmarks-count">0</span>
            </button>
        </div>
    </header>
    <main>
        <div class="quiz-container">
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">MED QUIZ</h1>
                    <p class="quiz-subtitle">Test your medical knowledge</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">All</span>
                        <span class="stat-label">Category</span>
                    </div>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>
            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">Biochemistry</span>
                    <span class="tag" id="difficulty-tag">
                        <span class="difficulty-indicator difficulty-medium"></span>
                        Medium
                    </span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">15</span></div>
            <div class="question-text" id="question">Which part of the brain is responsible for coordinating skeletal muscle contractions?</div>
            <div class="options-grid" id="options-container">
                <div class="option">
                    <div class="option-letter">A</div>
                    <div class="option-text">Cerebrum</div>
                </div>
                <div class="option">
                    <div class="option-letter">B</div>
                    <div class="option-text">Cerebellum</div>
                </div>
                <div class="option">
                    <div class="option-letter">C</div>
                    <div class="option-text">Pons</div>
                </div>
                <div class="option">
                    <div class="option-letter">D</div>
                    <div class="option-text">Midbrain</div>
                </div>
            </div>
            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>
            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>
            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text">The cerebellum, located posterior to the brainstem, is the 'little brain.' It compares intended movements with actual movements to ensure smooth, coordinated skeletal muscle activity and maintain posture and balance.</div>
                </div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-danger" id="skip-btn">
                    <i class="fas fa-forward"></i> Skip
                </button>
            </div>
        </div>
    </main>
    <div class="fab" id="quick-actions-btn" style="display: none;">
        <i class="fas fa-bolt"></i>
    </div>
    <div class="confetti-container" id="confetti-container"></div>
    <div class="modal-overlay" id="stats-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Your Statistics</h2>
                <button class="modal-close" id="close-stats-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-total-questions">0</div>
                        <div class="stat-card-label">Total Questions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-correct-answers">0</div>
                        <div class="stat-card-label">Correct Answers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-accuracy">0%</div>
                        <div class="stat-card-label">Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-avg-time">0s</div>
                        <div class="stat-card-label">Avg. Time</div>
                    </div>
                </div>
                <h3 class="review-title">Performance by Category</h3>
                <div id="category-stats"></div>
                <h3 class="review-title mt-2">Performance by Difficulty</h3>
                <div id="difficulty-stats"></div>
                <h3 class="review-title mt-2">Quiz History</h3>
                <div id="history-stats"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-stats-btn">Close</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="quick-actions-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Quick Actions</h2>
                <button class="modal-close" id="close-actions-modal">&times;</button>
            </div>
            <div class="modal-body">
                <button class="btn btn-primary full-width mt-1" id="mark-for-review-btn">
                    <i class="fas fa-flag"></i> Mark for Review
                </button>
                <button class="btn btn-secondary full-width mt-1" id="view-explanation-btn">
                    <i class="fas fa-info-circle"></i> View Explanation
                </button>
                <button class="btn btn-success full-width mt-1" id="hint-btn">
                    <i class="fas fa-lightbulb"></i> Get a Hint
                </button>
                <button class="btn btn-danger full-width mt-1" id="report-question-btn">
                    <i class="fas fa-exclamation-triangle"></i> Report Question
                </button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-actions-btn">Close</button>
            </div>
        </div>
    </div>
    <footer>
        &copy; 2025 MedQuiz | MED Practice Platform | All Rights Reserved
    </footer>
    ```html
<script>
const questions = [
    {
        "id": 1,
        "question": "What is the empirical formula for many, but not all, carbohydrates?",
        "options": ["(C₂H₆O)ₙ", "(CHO)ₙ", "(CH₂O)ₙ", "(C₆H₁₂O₆)"],
        "answer": 2,
        "correctAnswer": "(CH₂O)ₙ",
        "explanation": "The general empirical formula for many carbohydrates is (CH₂O)ₙ, reflecting the carbon hydrate composition. However, derivatives may include N, P, or S.",
        "whyNotOtherOptions": {
            "a": "(C₂H₆O)ₙ resembles ethanol’s formula, not the general ratio of carbon, hydrogen, and oxygen in carbohydrates.",
            "b": "(CHO)ₙ lacks the proper 1:2:1 C:H:O ratio found in most carbohydrates.",
            "d": "(C₆H₁₂O₆) is the molecular formula for hexoses like glucose, not an empirical formula for all carbohydrates."
        },
        "relatedQuestions": [],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 2,
        "question": "The biological synthesis of glucose in plants is called:",
        "options": ["Glycolysis", "Gluconeogenesis", "Photosynthesis", "Hydrolysis"],
        "answer": 2,
        "correctAnswer": "Photosynthesis",
        "explanation": "Glucose is synthesized from CO₂ and H₂O using sunlight in the process of photosynthesis.",
        "whyNotOtherOptions": {
            "a": "Glycolysis breaks down glucose for energy, not synthesizes it.",
            "b": "Gluconeogenesis synthesizes glucose from non-carbohydrate precursors, mainly in animals.",
            "d": "Hydrolysis breaks glycosidic bonds, not synthesizes glucose."
        },
        "relatedQuestions": ["59 (glycogenesis, related to glucose storage)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 3,
        "question": "Which of the following is a polyhydroxy ketone?",
        "options": ["Glucose", "Galactose", "Glyceraldehyde", "Fructose"],
        "answer": 3,
        "correctAnswer": "Fructose",
        "explanation": "Fructose is a ketose (polyhydroxy ketone), while the others are aldoses (polyhydroxy aldehydes).",
        "whyNotOtherOptions": {
            "a": "Glucose is an aldose with an aldehyde group at C1.",
            "b": "Galactose is an aldose, not a ketone.",
            "c": "Glyceraldehyde is an aldose, the simplest aldehyde sugar."
        },
        "relatedQuestions": ["5 (glucose and galactose as epimers)", "11 (fructose in sucrose)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 4,
        "question": "The reference compound for assigning D or L configuration to monosaccharides is:",
        "options": ["D-Glucose", "D-Glyceraldehyde", "L-Lactic acid", "D-Ribose"],
        "answer": 1,
        "correctAnswer": "D-Glyceraldehyde",
        "explanation": "The configuration of D- and L-glyceraldehyde is the standard reference for designating the D/L form of all other sugars.",
        "whyNotOtherOptions": {
            "a": "D-Glucose is a hexose, not the reference for D/L configuration.",
            "c": "L-Lactic acid is not a sugar and not used for sugar stereochemistry.",
            "d": "D-Ribose is a pentose, not the standard reference."
        },
        "relatedQuestions": ["42 (D/L-glucose as enantiomers)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 5,
        "question": "Glucose and galactose are best described as:",
        "options": ["Anomers", "Enantiomers", "C-4 Epimers", "Ketoses"],
        "answer": 2,
        "correctAnswer": "C-4 Epimers",
        "explanation": "Glucose and galactose differ only in the configuration of the -OH group at carbon 4, making them C-4 epimers.",
        "whyNotOtherOptions": {
            "a": "Anomers differ at the anomeric carbon (C1), not C4 (see ID 6).",
            "b": "Enantiomers are mirror images, differing at all chiral centers (see ID 42).",
            "d": "Glucose and galactose are aldoses, not ketoses (see ID 3)."
        },
        "relatedQuestions": ["3 (fructose as ketose)", "6 (α/β-glucose as anomers)", "42 (enantiomers)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 6,
        "question": "The α and β forms of glucose are known as:",
        "options": ["Enantiomers", "Epimers", "Anomers", "Diastereomers"],
        "answer": 2,
        "correctAnswer": "Anomers",
        "explanation": "α and β anomers are stereoisomers that differ only in the configuration at the anomeric carbon (C1 for glucose).",
        "whyNotOtherOptions": {
            "a": "Enantiomers are mirror images, differing at all chiral centers (see ID 42).",
            "b": "Epimers differ at a non-anomeric chiral carbon (see ID 5).",
            "d": "Diastereomers include anomers but also other non-mirror image stereoisomers, less specific."
        },
        "relatedQuestions": ["5 (epimers)", "7 (mutarotation of anomers)", "47 (anomeric carbon)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 7,
        "question": "The interconversion between α and β anomers in solution is called:",
        "options": ["Tautomerization", "Mutarotation", "Epimerization", "Racemization"],
        "answer": 1,
        "correctAnswer": "Mutarotation",
        "explanation": "Mutarotation is the change in specific optical rotation when an anomeric sugar reaches an equilibrium mixture of its α and β forms in solution.",
        "whyNotOtherOptions": {
            "a": "Tautomerization involves keto-enol shifts, not anomeric changes.",
            "c": "Epimerization changes configuration at a non-anomeric carbon (see ID 5).",
            "d": "Racemization produces a 1:1 mixture of enantiomers, not anomers (see ID 43)."
        },
        "relatedQuestions": ["6 (anomers)", "47 (anomeric carbon)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 8,
        "question": "The sugar found in DNA is:",
        "options": ["Ribose", "2-Deoxyribose", "Ribitol", "Glucose"],
        "answer": 1,
        "correctAnswer": "2-Deoxyribose",
        "explanation": "2-Deoxyribose is the pentose sugar in DNA, differing from ribose by the absence of an oxygen atom on carbon 2.",
        "whyNotOtherOptions": {
            "a": "Ribose is found in RNA, not DNA (see ID 57).",
            "c": "Ribitol is a sugar alcohol, not a nucleic acid component (see ID 44).",
            "d": "Glucose is a hexose, not used in nucleic acids."
        },
        "relatedQuestions": ["57 (ribose in RNA)", "44 (ribitol in riboflavin)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 9,
        "question": "Which derivative is formed by the oxidation of the primary alcohol group (C6) of glucose?",
        "options": ["Gluconic acid", "Glucuronic acid", "Glucosamine", "Sorbitol"],
        "answer": 1,
        "correctAnswer": "Glucuronic acid",
        "explanation": "Oxidation of the primary alcohol group (C6) of an aldose yields a uronic acid, such as glucuronic acid from glucose.",
        "whyNotOtherOptions": {
            "a": "Gluconic acid results from oxidation of the aldehyde group (C1), not C6.",
            "c": "Glucosamine is an amino sugar, not an oxidation product.",
            "d": "Sorbitol is formed by reduction, not oxidation (see ID 51)."
        },
        "relatedQuestions": ["51 (sorbitol from glucose reduction)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 10,
        "question": "Ascorbic acid (Vitamin C) is a necessary cofactor for the synthesis of:",
        "options": ["Glycogen", "Collagen", "Hemoglobin", "DNA"],
        "answer": 1,
        "correctAnswer": "Collagen",
        "explanation": "Vitamin C is essential for enzymes that hydroxylate proline and lysine during collagen formation.",
        "whyNotOtherOptions": {
            "a": "Glycogen synthesis does not require vitamin C (see ID 17).",
            "c": "Hemoglobin synthesis relies on iron, not vitamin C.",
            "d": "DNA synthesis involves deoxyribose, not directly linked to vitamin C (see ID 8)."
        },
        "relatedQuestions": ["8 (deoxyribose in DNA)", "17 (glycogen storage)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 11,
        "question": "Sucrose is composed of:",
        "options": ["Glucose + Glucose", "Galactose + Glucose", "Glucose + Fructose", "Fructose + Fructose"],
        "answer": 2,
        "correctAnswer": "Glucose + Fructose",
        "explanation": "Sucrose (table sugar) is a disaccharide made from α-D-glucose and β-D-fructose.",
        "whyNotOtherOptions": {
            "a": "Glucose + Glucose forms maltose or cellobiose (see ID 15).",
            "b": "Galactose + Glucose forms lactose (see ID 12).",
            "d": "Fructose + Fructose is not a common disaccharide."
        },
        "relatedQuestions": ["3 (fructose as ketose)", "12 (lactose)", "14 (sucrose as non-reducing)", "45 (sucrose glycosidic bond)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 12,
        "question": "Which disaccharide is known as 'milk sugar'?",
        "options": ["Maltose", "Lactose", "Sucrose", "Cellobiose"],
        "answer": 1,
        "correctAnswer": "Lactose",
        "explanation": "Lactose is the carbohydrate found in milk.",
        "whyNotOtherOptions": {
            "a": "Maltose is derived from starch hydrolysis (see ID 15).",
            "c": "Sucrose is table sugar, not milk sugar (see ID 11).",
            "d": "Cellobiose is a cellulose hydrolysis product, not in milk (see ID 23)."
        },
        "relatedQuestions": ["11 (sucrose)", "13 (lactose glycosidic bond)", "50 (lactase deficiency)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 13,
        "question": "The glycosidic bond in lactose is:",
        "options": ["α(1→4)", "β(1→4)", "α(1→2)", "β(1→6)"],
        "answer": 1,
        "correctAnswer": "β(1→4)",
        "explanation": "Lactose consists of β-D-galactose linked to β-D-glucose via a β(1→4) glycosidic bond.",
        "whyNotOtherOptions": {
            "a": "α(1→4) is found in maltose (see ID 15).",
            "c": "α(1→2) is found in sucrose (see ID 45).",
            "d": "β(1→6) is not typical for disaccharides but occurs in branched polysaccharides."
        },
        "relatedQuestions": ["12 (lactose as milk sugar)", "15 (maltose)", "45 (sucrose bond)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 14,
        "question": "Which of the following is a non-reducing sugar?",
        "options": ["Maltose", "Lactose", "Sucrose", "Cellobiose"],
        "answer": 2,
        "correctAnswer": "Sucrose",
        "explanation": "In sucrose, the anomeric carbons of both glucose and fructose are involved in the glycosidic bond, leaving no free anomeric carbon to act as a reducing agent.",
        "whyNotOtherOptions": {
            "a": "Maltose has a free anomeric carbon on one glucose, making it reducing (see ID 15).",
            "b": "Lactose has a free anomeric carbon on glucose, making it reducing (see ID 12).",
            "d": "Cellobiose has a free anomeric carbon, making it reducing (see ID 23)."
        },
        "relatedQuestions": ["11 (sucrose composition)", "12 (lactose)", "15 (maltose)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 15,
        "question": "Maltose is produced from the hydrolysis of:",
        "options": ["Cellulose", "Glycogen", "Starch", "Inulin"],
        "answer": 2,
        "correctAnswer": "Starch",
        "explanation": "Maltose (malt sugar) is a product of the enzymatic breakdown of starch.",
        "whyNotOtherOptions": {
            "a": "Cellulose hydrolysis yields cellobiose, not maltose (see ID 23).",
            "b": "Glycogen hydrolysis also produces maltose, but starch is the primary source in plants (see ID 17).",
            "d": "Inulin hydrolysis yields fructose, not maltose (see ID 21)."
        },
        "relatedQuestions": ["14 (maltose as reducing)", "17 (glycogen)", "21 (inulin)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 16,
        "question": "A disaccharide where the anomeric carbon of only one monosaccharide is involved in the bond is always:",
        "options": ["A glycoside", "A reducing sugar", "A non-reducing sugar", "A furanose"],
        "answer": 1,
        "correctAnswer": "A reducing sugar",
        "explanation": "If one anomeric carbon is free, it can open to its aldehyde or ketone form and act as a reducing agent.",
        "whyNotOtherOptions": {
            "a": "A glycoside involves a sugar bonded to a non-sugar, not necessarily a disaccharide.",
            "c": "A non-reducing sugar requires both anomeric carbons to be bonded, like sucrose (see ID 14).",
            "d": "Furanose refers to a five-membered ring, not a reducing property."
        },
        "relatedQuestions": ["14 (sucrose as non-reducing)", "12 (lactose as reducing)", "15 (maltose as reducing)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 17,
        "question": "The primary storage form of glucose in animals is:",
        "options": ["Starch", "Glycogen", "Cellulose", "Inulin"],
        "answer": 1,
        "correctAnswer": "Glycogen",
        "explanation": "Glycogen is the highly branched polymer of glucose stored in the liver and muscles of animals.",
        "whyNotOtherOptions": {
            "a": "Starch is the plant storage polysaccharide (see ID 15).",
            "c": "Cellulose is a structural polysaccharide, not for storage (see ID 23).",
            "d": "Inulin is a fructose polymer, not used in animals (see ID 21)."
        },
        "relatedQuestions": ["15 (starch hydrolysis)", "21 (inulin)", "23 (cellulose)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 18,
        "question": "The main difference between amylose and amylopectin is:",
        "options": ["Amylose is made of fructose", "Amylose is unbranched, amylopectin is branched", "Amylopectin has β-linkages", "Amylose is found in animals"],
        "answer": 1,
        "correctAnswer": "Amylose is unbranched, amylopectin is branched",
        "explanation": "Amylose is a linear polymer of glucose with α(1→4) bonds, while amylopectin is branched with additional α(1→6) bonds.",
        "whyNotOtherOptions": {
            "a": "Amylose is made of glucose, not fructose (see ID 21).",
            "c": "Amylopectin has α-linkages, not β (see ID 23 for β-linkages).",
            "d": "Amylose is found in plants, not animals (see ID 17)."
        },
        "relatedQuestions": ["15 (starch hydrolysis)", "17 (glycogen in animals)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 19,
        "question": "Branching in glycogen occurs more frequently than in amylopectin. How often?",
        "options": ["Every 5-10 residues", "Every 8-12 residues", "Every 24-30 residues", "Every 50-100 residues"],
        "answer": 1,
        "correctAnswer": "Every 8-12 residues",
        "explanation": "Glycogen is more highly branched than amylopectin, with branches occurring every 8-12 glucose residues.",
        "whyNotOtherOptions": {
            "a": "5-10 residues is too frequent for glycogen branching.",
            "c": "24-30 residues is typical for amylopectin, not glycogen.",
            "d": "50-100 residues is far too infrequent for either polysaccharide."
        },
        "relatedQuestions": ["17 (glycogen structure)", "18 (amylopectin branching)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 20,
        "question": "The biological advantage of branching in glycogen and starch is that it:",
        "options": ["Increases solubility", "Creates multiple non-reducing ends for faster synthesis and degradation", "Makes the molecule stronger", "Prevents hydrolysis"],
        "answer": 1,
        "correctAnswer": "Creates multiple non-reducing ends for faster synthesis and degradation",
        "explanation": "Branching creates numerous non-reducing ends, which are sites where enzymes add or remove glucose units rapidly.",
        "whyNotOtherOptions": {
            "a": "Solubility is a secondary effect, not the primary advantage.",
            "c": "Strength is relevant to structural polysaccharides like cellulose (see ID 23).",
            "d": "Branching facilitates enzymatic access, not prevents hydrolysis."
        },
        "relatedQuestions": ["17 (glycogen)", "18 (amylopectin)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 21,
        "question": "Inulin, a polysaccharide used to assess kidney function, is a polymer of:",
        "options": ["Glucose", "Fructose", "Galactose", "N-Acetylglucosamine"],
        "answer": 1,
        "correctAnswer": "Fructose",
        "explanation": "Inulin is a homopolymer of fructose linked by β(1→2) bonds.",
        "whyNotOtherOptions": {
            "a": "Glucose forms starch or glycogen, not inulin (see ID 17).",
            "c": "Galactose is not a component of inulin (see ID 12).",
            "d": "N-Acetylglucosamine is found in chitin or GAGs, not inulin (see ID 25)."
        },
        "relatedQuestions": ["17 (glycogen)", "25 (chitin)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 22,
        "question": "Dextrans, used as plasma expanders, are produced by:",
        "options": ["Plants", "Microorganisms", "Animal liver", "Chemical synthesis"],
        "answer": 1,
        "correctAnswer": "Microorganisms",
        "explanation": "Dextrans are polymers of glucose produced by certain bacteria.",
        "whyNotOtherOptions": {
            "a": "Plants produce starch, not dextrans (see ID 15).",
            "c": "Animal liver produces glycogen, not dextrans (see ID 17).",
            "d": "Dextrans are biologically produced, not chemically synthesized."
        },
        "relatedQuestions": ["17 (glycogen)", "15 (starch)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 23,
        "question": "The glycosidic linkage in cellulose is:",
        "options": ["α(1→4)", "β(1→4)", "α(1→6)", "β(1→6)"],
        "answer": 1,
        "correctAnswer": "β(1→4)",
        "explanation": "Cellulose is a linear polymer of glucose units linked by β(1→4) glycosidic bonds.",
        "whyNotOtherOptions": {
            "a": "α(1→4) linkages are found in starch or glycogen (see ID 18).",
            "c": "α(1→6) linkages occur in branched polysaccharides like amylopectin (see ID 18).",
            "d": "β(1→6) is not a common linkage in polysaccharides."
        },
        "relatedQuestions": ["15 (starch)", "24 (cellulose indigestibility)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 24,
        "question": "Humans cannot digest cellulose because they lack the enzyme to hydrolyze:",
        "options": ["α(1→4) linkages", "β(1→4) linkages", "α(1→6) linkages", "Peptide bonds"],
        "answer": 1,
        "correctAnswer": "β(1→4) linkages",
        "explanation": "Human enzymes (like amylase) can break α(1→4) linkages but not the β(1→4) linkages in cellulose.",
        "whyNotOtherOptions": {
            "a": "α(1→4) linkages are digestible by amylase in starch (see ID 15).",
            "c": "α(1→6) linkages are cleaved by debranching enzymes in glycogen metabolism.",
            "d": "Peptide bonds are unrelated to carbohydrate digestion."
        },
        "relatedQuestions": ["23 (cellulose linkage)", "15 (starch)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 25,
        "question": "Chitin, a structural polysaccharide in insect exoskeletons, is composed of repeating units of:",
        "options": ["Glucose", "N-Acetylglucosamine (GlcNAc)", "N-Acetylgalactosamine (GalNAc)", "Glucuronic acid"],
        "answer": 1,
        "correctAnswer": "N-Acetylglucosamine (GlcNAc)",
        "explanation": "Chitin is a linear homopolymer of β(1→4) linked N-Acetylglucosamine residues.",
        "whyNotOtherOptions": {
            "a": "Glucose forms cellulose or starch, not chitin (see ID 23).",
            "c": "N-Acetylgalactosamine is found in some GAGs, not chitin (see ID 29).",
            "d": "Glucuronic acid is in GAGs, not chitin (see ID 29)."
        },
        "relatedQuestions": ["23 (cellulose)", "29 (GAGs)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 26,
        "question": "Which of the following is the most abundant organic compound on Earth?",
        "options": ["Glycogen", "Starch", "Cellulose", "Chitin"],
        "answer": 2,
        "correctAnswer": "Cellulose",
        "explanation": "Cellulose, a major component of plant cell walls, is the most abundant polysaccharide and organic compound.",
        "whyNotOtherOptions": {
            "a": "Glycogen is animal-specific and less abundant (see ID 17).",
            "b": "Starch is abundant in plants but less so than cellulose (see ID 15).",
            "d": "Chitin is common in insects and fungi but not as abundant as cellulose."
        },
        "relatedQuestions": ["23 (cellulose linkage)", "24 (cellulose indigestibility)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 27,
        "question": "Glycosaminoglycans (GAGs) are best described as:",
        "options": ["Short, branched heteropolysaccharides", "Long, unbranched, negatively charged heteropolysaccharides", "Neutral homopolysaccharides", "Proteins with attached oligosaccharides"],
        "answer": 1,
        "correctAnswer": "Long, unbranched, negatively charged heteropolysaccharides",
        "explanation": "GAGs are long, linear polymers of repeating disaccharide units with acidic groups (carboxylate and sulfate), making them polyanionic.",
        "whyNotOtherOptions": {
            "a": "GAGs are unbranched, unlike glycoproteins’ short, branched oligosaccharides (see ID 36).",
            "c": "GAGs are heteropolysaccharides with negative charges, not neutral homopolysaccharides (see ID 17).",
            "d": "Proteins with oligosaccharides describe glycoproteins, not GAGs (see ID 36)."
        },
        "relatedQuestions": ["29 (GAG composition)", "34 (proteoglycans)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 28,
        "question": "The repeating disaccharide unit of GAGs always contains:",
        "options": ["A uronic acid and a neutral sugar", "An amino sugar and a uronic acid", "Two identical hexoses", "A sugar acid and a sugar alcohol"],
        "answer": 1,
        "correctAnswer": "An amino sugar and a uronic acid",
        "explanation": "By definition, a GAG's repeating unit consists of an amino sugar (e.g., GlcNAc, GalNAc) and a uronic acid (e.g., glucuronic acid).",
        "whyNotOtherOptions": {
            "a": "Neutral sugars are not typical in GAGs; amino sugars are required.",
            "c": "GAGs are heteropolysaccharides, not homopolysaccharides with identical hexoses.",
            "d": "Sugar alcohols are not components of GAGs."
        },
        "relatedQuestions": ["27 (GAGs description)", "29 (hyaluronic acid)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 29,
        "question": "Which GAG is unique because it is NOT sulfated and NOT covalently attached to a protein core?",
        "options": ["Heparin", "Chondroitin sulfate", "Hyaluronic Acid (HA)", "Keratan sulfate"],
        "answer": 2,
        "correctAnswer": "Hyaluronic Acid (HA)",
        "explanation": "Hyaluronic acid is the only GAG that is not sulfated and not linked to a protein core via a serine residue.",
        "whyNotOtherOptions": {
            "a": "Heparin is highly sulfated and protein-bound (see ID 32).",
            "b": "Chondroitin sulfate is sulfated and attached to proteins (see ID 52).",
            "d": "Keratan sulfate is sulfated and protein-bound (see ID 33)."
        },
        "relatedQuestions": ["27 (GAGs)", "32 (heparin)", "52 (chondroitin sulfate)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 30,
        "question": "The primary function of hyaluronic acid in joints is to:",
        "options": ["Clot blood", "Act as a lubricant and shock absorber", "Provide tensile strength", "Serve as an energy source"],
        "answer": 1,
        "correctAnswer": "Act as a lubricant and shock absorber",
        "explanation": "Hyaluronic acid forms a viscous, hydrated gel that lubricates joints and absorbs shock.",
        "whyNotOtherOptions": {
            "a": "Blood clotting is a function of heparin (see ID 32).",
            "c": "Tensile strength is provided by collagen, not hyaluronic acid.",
            "d": "Hyaluronic acid is not an energy source; glycogen serves that role (see ID 17)."
        },
        "relatedQuestions": ["29 (hyaluronic acid)", "31 (hyaluronidase)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 31,
        "question": "The enzyme hyaluronidase, found in sperm, aids fertilization by:",
        "options": ["Synthesizing hyaluronic acid", "Breaking down the hyaluronic acid matrix around the ovum", "Clotting blood", "Hydrolyzing cellulose"],
        "answer": 1,
        "correctAnswer": "Breaking down the hyaluronic acid matrix around the ovum",
        "explanation": "Hyaluronidase degrades the gel-like hyaluronic acid surrounding the ovum, allowing sperm to penetrate.",
        "whyNotOtherOptions": {
            "a": "Hyaluronidase degrades, not synthesizes, hyaluronic acid.",
            "c": "Blood clotting is unrelated; heparin affects clotting (see ID 32).",
            "d": "Cellulose is not present in animal tissues (see ID 24)."
        },
        "relatedQuestions": ["29 (hyaluronic acid)", "30 (HA function)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 32,
        "question": "Which GAG is a potent anticoagulant stored in mast cells?",
        "options": ["Hyaluronic acid", "Heparin", "Chondroitin sulfate", "Dermatan sulfate"],
        "answer": 1,
        "correctAnswer": "Heparin",
        "explanation": "Heparin is a highly sulfated GAG that inhibits blood coagulation and is used clinically as an anticoagulant.",
        "whyNotOtherOptions": {
            "a": "Hyaluronic acid is unsulfated and not an anticoagulant (see ID 29).",
            "c": "Chondroitin sulfate supports cartilage, not clotting (see ID 52).",
            "d": "Dermatan sulfate has some anticoagulant activity but is less potent than heparin."
        },
        "relatedQuestions": ["29 (hyaluronic acid)", "52 (chondroitin sulfate)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 33,
        "question": "Keratan sulfate is unique among GAGs because it:",
        "options": ["Contains iduronic acid", "Is unsulfated", "Contains no uronic acid", "Is a homopolymer"],
        "answer": 2,
        "correctAnswer": "Contains no uronic acid",
        "explanation": "Keratan sulfate's repeating disaccharide unit is galactose and N-acetylglucosamine; it lacks a uronic acid.",
        "whyNotOtherOptions": {
            "a": "Iduronic acid is found in heparin and dermatan sulfate, not keratan sulfate.",
            "b": "Keratan sulfate is sulfated, unlike hyaluronic acid (see ID 29).",
            "d": "Keratan sulfate is a heteropolymer, not a homopolymer."
        },
        "relatedQuestions": ["29 (hyaluronic acid)", "32 (heparin)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 34,
        "question": "A proteoglycan is best defined as a:",
        "options": ["Protein with short, branched oligosaccharides", "Core protein with attached glycosaminoglycan (GAG) chains", "Peptide linked to a heteroglycan", "Lipid with attached carbohydrate"],
        "answer": 1,
        "correctAnswer": "Core protein with attached glycosaminoglycan (GAG) chains",
        "explanation": "Proteoglycans are macromolecules with a core protein and one or more covalently attached GAG chains, forming a 'bottle-brush' structure.",
        "whyNotOtherOptions": {
            "a": "Short, branched oligosaccharides describe glycoproteins, not proteoglycans (see ID 36).",
            "c": "Heteroglycan is vague; proteoglycans specifically have GAGs.",
            "d": "Lipids with carbohydrates are glycolipids, not proteoglycans."
        },
        "relatedQuestions": ["27 (GAGs)", "36 (glycoproteins)", "49 (bottle-brush model)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 35,
        "question": "The high negative charge on proteoglycans in the extracellular matrix (ECM) is crucial for their ability to:",
        "options": ["Conduct electricity", "Bind large amounts of water and provide resilience", "Repel pathogens", "Store energy"],
        "answer": 1,
        "correctAnswer": "Bind large amounts of water and provide resilience",
        "explanation": "The negative charges attract cations and water, creating a hydrated gel that resists compression and provides cushioning.",
        "whyNotOtherOptions": {
            "a": "Proteoglycans do not conduct electricity.",
            "c": "Pathogen repulsion is not their primary role.",
            "d": "Energy storage is the role of glycogen, not proteoglycans (see ID 17)."
        },
        "relatedQuestions": ["34 (proteoglycans)", "52 (chondroitin sulfate)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 36,
        "question": "Glycoproteins differ from proteoglycans primarily in the:",
        "options": ["Presence of a protein core", "Length, structure, and type of carbohydrate chain", "Location in the body", "Overall negative charge"],
        "answer": 1,
        "correctAnswer": "Length, structure, and type of carbohydrate chain",
        "explanation": "Glycoproteins have short, branched oligosaccharides, while proteoglycans have long, linear GAG chains. Glycoproteins are more protein-dominant.",
        "whyNotOtherOptions": {
            "a": "Both have protein cores, so this is not the primary difference.",
            "c": "Location varies for both; it’s not the key distinction.",
            "d": "Glycoproteins are often neutral, but charge is secondary to carbohydrate structure."
        },
        "relatedQuestions": ["34 (proteoglycans)", "37 (glycoprotein O-linkages)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 37,
        "question": "In glycoproteins, oligosaccharides can be O-linked to which amino acids?",
        "options": ["Asparagine", "Serine or Threonine", "Lysine or Arginine", "Glutamate"],
        "answer": 1,
        "correctAnswer": "Serine or Threonine",
        "explanation": "O-linked glycans are attached to the hydroxyl group of serine or threonine residues.",
        "whyNotOtherOptions": {
            "a": "Asparagine is for N-linked glycans, not O-linked.",
            "c": "Lysine and arginine are not typically glycosylated.",
            "d": "Glutamate is not involved in glycosylation."
        },
        "relatedQuestions": ["36 (glycoproteins)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 38,
        "question": "Which of the following is a function of glycoproteins?",
        "options": ["Energy storage", "Blood group antigens (A, B, O)", "Primary structural component of plant cell walls", "Potent anticoagulation"],
        "answer": 1,
        "correctAnswer": "Blood group antigens (A, B, O)",
        "explanation": "The ABO blood group antigens are oligosaccharides on glycoproteins and glycolipids on red blood cell surfaces.",
        "whyNotOtherOptions": {
            "a": "Energy storage is the role of glycogen or starch (see ID 17).",
            "c": "Plant cell walls are primarily cellulose (see ID 26).",
            "d": "Anticoagulation is a function of heparin, a GAG (see ID 32)."
        },
        "relatedQuestions": ["36 (glycoproteins)", "32 (heparin)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 39,
        "question": "The bacterial cell wall component that is the target of the enzyme lysozyme is:",
        "options": ["Peptidoglycan", "Lipopolysaccharide", "Glycogen", "Cellulose"],
        "answer": 0,
        "correctAnswer": "Peptidoglycan",
        "explanation": "Lysozyme kills bacteria by hydrolyzing the β(1→4) glycosidic bonds between NAM and NAG in peptidoglycan.",
        "whyNotOtherOptions": {
            "b": "Lipopolysaccharide is in Gram-negative bacteria outer membranes, not a lysozyme target.",
            "c": "Glycogen is an animal storage polysaccharide (see ID 17).",
            "d": "Cellulose is a plant polysaccharide, not bacterial (see ID 23)."
        },
        "relatedQuestions": ["40 (peptidoglycan sugar)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 40,
        "question": "The unique sugar found in bacterial peptidoglycan is:",
        "options": ["Glucose", "Fructose", "N-Acetylmuramic Acid (MurNAc)", "N-Acetylneuraminic Acid (Neu5Ac)"],
        "answer": 2,
        "correctAnswer": "N-Acetylmuramic Acid (MurNAc)",
        "explanation": "N-Acetylmuramic Acid (MurNAc) is a modified GlcNAc with a lactic acid group, found only in bacterial cell walls.",
        "whyNotOtherOptions": {
            "a": "Glucose is not specific to peptidoglycan (see ID 25).",
            "b": "Fructose is not a component of peptidoglycan (see ID 21).",
            "d": "N-Acetylneuraminic acid is a sialic acid, not in peptidoglycan."
        },
        "relatedQuestions": ["39 (peptidoglycan)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 41,
        "question": "Starch and cellulose are both polymers of glucose. What is the key structural difference?",
        "options": ["Starch is branched, cellulose is linear", "Starch has α-glycosidic bonds, cellulose has β-glycosidic bonds", "Starch has nitrogen, cellulose does not", "Cellulose is made of fructose"],
        "answer": 1,
        "correctAnswer": "Starch has α-glycosidic bonds, cellulose has β-glycosidic bonds",
        "explanation": "The α-linkages in starch form helices, making it digestible by humans. The β-linkages in cellulose form straight, strong fibers that are indigestible.",
        "whyNotOtherOptions": {
            "a": "Starch can be branched (amylopectin) or linear (amylose); cellulose is always linear (see ID 18).",
            "c": "Neither starch nor cellulose contains nitrogen.",
            "d": "Cellulose is made of glucose, not fructose (see ID 21)."
        },
        "relatedQuestions": ["15 (starch)", "23 (cellulose)", "24 (cellulose indigestibility)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 42,
        "question": "D-Glucose and L-Glucose are an example of:",
        "options": ["Epimers", "Enantiomers", "Anomers", "Diastereomers"],
        "answer": 1,
        "correctAnswer": "Enantiomers",
        "explanation": "D and L forms of the same sugar are non-superimposable mirror images, defining them as enantiomers.",
        "whyNotOtherOptions": {
            "a": "Epimers differ at one chiral carbon, not all (see ID 5).",
            "c": "Anomers differ at the anomeric carbon only (see ID 6).",
            "d": "Diastereomers are non-mirror image stereoisomers, but enantiomers is more specific."
        },
        "relatedQuestions": ["4 (D/L configuration)", "5 (epimers)", "6 (anomers)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 43,
        "question": "A solution containing equal amounts of D-glucose and L-glucose would be:",
        "options": ["Dextrorotatory", "Levorotatory", "Optically inactive (racemic mixture)", "Meso"],
        "answer": 2,
        "correctAnswer": "Optically inactive (racemic mixture)",
        "explanation": "A racemic mixture contains equal amounts of enantiomers, canceling each other's optical rotation, resulting in no net rotation of plane-polarized light.",
        "whyNotOtherOptions": {
            "a": "Dextrorotatory requires more D-glucose.",
            "b": "Levorotatory requires more L-glucose.",
            "d": "Meso compounds have an internal plane of symmetry, not applicable to glucose."
        },
        "relatedQuestions": ["42 (enantiomers)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 44,
        "question": "Which carbohydrate derivative is a key component of the vitamin riboflavin?",
        "options": ["Glucuronic acid", "Ribitol", "Sorbitol", "Inositol"],
        "answer": 1,
        "correctAnswer": "Ribitol",
        "explanation": "Ribitol is a sugar alcohol derived from ribose and is a component of riboflavin (vitamin B2) and its coenzymes (FAD).",
        "whyNotOtherOptions": {
            "a": "Glucuronic acid is involved in detoxification, not riboflavin (see ID 9).",
            "c": "Sorbitol is derived from glucose, not ribose (see ID 51).",
            "d": "Inositol is a cyclic sugar alcohol, not part of riboflavin."
        },
        "relatedQuestions": ["9 (glucuronic acid)", "51 (sorbitol)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 45,
        "question": "The glycosidic bond in sucrose is correctly described as:",
        "options": ["α(1→4)", "β(1→4)", "α,β(1→2)", "β(1→2)"],
        "answer": 2,
        "correctAnswer": "α,β(1→2)",
        "explanation": "The bond links the anomeric carbon of α-D-glucose (C1) to the anomeric carbon of β-D-fructose (C2), hence an α,β(1→2) linkage.",
        "whyNotOtherOptions": {
            "a": "α(1→4) is found in maltose (see ID 13).",
            "b": "β(1→4) is found in lactose or cellulose (see ID 13, 23).",
            "d": "β(1→2) does not describe the dual anomeric involvement in sucrose."
        },
        "relatedQuestions": ["11 (sucrose)", "13 (lactose bond)", "14 (sucrose as non-reducing)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 46,
        "question": "Which molecule is a storage polysaccharide in plants, a structural component in plant cell walls, and an indigestible fiber for humans, respectively?",
        "options": ["Glycogen, Chitin, Inulin", "Starch, Cellulose, Cellulose", "Starch, Pectin, Glycogen", "Inulin, Cellulose, Starch"],
        "answer": 1,
        "correctAnswer": "Starch, Cellulose, Cellulose",
        "explanation": "Starch stores glucose in plants. Cellulose provides structural support in plant cell walls. Humans cannot digest cellulose, so it acts as dietary fiber.",
        "whyNotOtherOptions": {
            "a": "Glycogen is animal-specific; chitin is in insects, not plants; inulin is not fiber (see ID 17, 25).",
            "c": "Pectin is structural but not primary; glycogen is animal-specific (see ID 17).",
            "d": "Inulin is not a storage polysaccharide; starch is not fiber (see ID 21)."
        },
        "relatedQuestions": ["15 (starch)", "23 (cellulose)", "24 (cellulose indigestibility)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 47,
        "question": "The carbon atom that becomes the new chiral center during cyclization of a monosaccharide is called the:",
        "options": ["Asymmetric carbon", "Anomeric carbon", "Epimeric carbon", "Chiral center"],
        "answer": 1,
        "correctAnswer": "Anomeric carbon",
        "explanation": "The anomeric carbon is the carbonyl carbon (C1 of an aldose, C2 of a ketose) that becomes a new chiral center upon ring formation.",
        "whyNotOtherOptions": {
            "a": "Asymmetric carbon is a general term for any chiral carbon.",
            "c": "Epimeric carbon refers to where epimers differ, not cyclization-specific (see ID 5).",
            "d": "Chiral center is too broad; anomeric is specific to cyclization."
        },
        "relatedQuestions": ["6 (anomers)", "7 (mutarotation)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 48,
        "question": "Which of the following is NOT a glycosaminoglycan (GAG)?",
        "options": ["Hyaluronic acid", "Chondroitin sulfate", "Glycogen", "Heparin"],
        "answer": 2,
        "correctAnswer": "Glycogen",
        "explanation": "Glycogen is a homopolysaccharide storage molecule, not a heteropolysaccharide GAG.",
        "whyNotOtherOptions": {
            "a": "Hyaluronic acid is a GAG (see ID 29).",
            "b": "Chondroitin sulfate is a GAG (see ID 52).",
            "d": "Heparin is a GAG (see ID 32)."
        },
        "relatedQuestions": ["17 (glycogen)", "27 (GAGs)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 49,
        "question": "The 'bottle-brush' model is used to describe the structure of a:",
        "options": ["Glycoprotein", "Proteoglycan", "Peptidoglycan", "Disaccharide"],
        "answer": 1,
        "correctAnswer": "Proteoglycan",
        "explanation": "In a proteoglycan, many long, linear GAG chains project from a central core protein, resembling a bottle brush.",
        "whyNotOtherOptions": {
            "a": "Glycoproteins have short, branched oligosaccharides, not bottle-brush-like (see ID 36).",
            "c": "Peptidoglycan is a bacterial cell wall component, not bottle-brush structured (see ID 39).",
            "d": "Disaccharides are small molecules, not complex structures."
        },
        "relatedQuestions": ["34 (proteoglycans)", "36 (glycoproteins)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 50,
        "question": "A patient with a deficiency in the enzyme lactase would have trouble digesting:",
        "options": ["Sucrose", "Starch", "Lactose", "Maltose"],
        "answer": 2,
        "correctAnswer": "Lactose",
        "explanation": "Lactase hydrolyzes lactose into glucose and galactose. Its deficiency causes lactose intolerance.",
        "whyNotOtherOptions": {
            "a": "Sucrose is hydrolyzed by sucrase, not lactase (see ID 11).",
            "b": "Starch is broken down by amylase (see ID 15).",
            "d": "Maltose is hydrolyzed by maltase (see ID 15)."
        },
        "relatedQuestions": ["12 (lactose)", "13 (lactose bond)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 51,
        "question": "The conversion of glucose to sorbitol is an example of:",
        "options": ["Oxidation", "Reduction", "Epimerization", "Phosphorylation"],
        "answer": 1,
        "correctAnswer": "Reduction",
        "explanation": "Sorbitol is a sugar alcohol formed by the reduction of the aldehyde group of glucose.",
        "whyNotOtherOptions": {
            "a": "Oxidation of glucose yields gluconic or glucuronic acid (see ID 9).",
            "c": "Epimerization changes stereochemistry at a chiral carbon (see ID 5).",
            "d": "Phosphorylation adds a phosphate group, not relevant here."
        },
        "relatedQuestions": ["9 (glucuronic acid)", "5 (epimerization)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 52,
        "question": "Which carbohydrate is a major component of cartilage and connective tissue, contributing to its resilience?",
        "options": ["Glycogen", "Chondroitin sulfate", "Cellulose", "Sucrose"],
        "answer": 1,
        "correctAnswer": "Chondroitin sulfate",
        "explanation": "Chondroitin sulfate is a GAG in proteoglycans of cartilage, helping attract water and resist compression.",
        "whyNotOtherOptions": {
            "a": "Glycogen is for energy storage, not structural (see ID 17).",
            "c": "Cellulose is a plant structural polysaccharide (see ID 23).",
            "d": "Sucrose is a disaccharide, not structural (see ID 11)."
        },
        "relatedQuestions": ["27 (GAGs)", "34 (proteoglycans)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 53,
        "question": "The linkage connecting the carbohydrate chain to the protein core in a proteoglycan is often via:",
        "options": ["An N-glycosidic bond to asparagine", "A trisaccharide linker (e.g., Gal-Gal-Xyl) to serine", "An ester bond to glutamate", "A phosphodiester bond"],
        "answer": 1,
        "correctAnswer": "A trisaccharide linker (e.g., Gal-Gal-Xyl) to serine",
        "explanation": "The GAG chain is attached to a serine residue in the core protein via a trisaccharide linker (Glucuronic acid-Galactose-Galactose-Xylose-Ser).",
        "whyNotOtherOptions": {
            "a": "N-glycosidic bonds to asparagine are typical for glycoproteins (see ID 37).",
            "c": "Ester bonds to glutamate are not used in proteoglycans.",
            "d": "Phosphodiester bonds are found in nucleic acids, not proteoglycans."
        },
        "relatedQuestions": ["34 (proteoglycans)", "37 (glycoprotein linkages)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 54,
        "question": "Which statement about glycoproteins is FALSE?",
        "options": ["They are found on cell membranes", "They can act as hormones and receptors", "They are primarily composed of carbohydrate by weight", "They have short, branched carbohydrate chains"],
        "answer": 2,
        "correctAnswer": "They are primarily composed of carbohydrate by weight",
        "explanation": "This is false. Glycoproteins are primarily protein by weight, unlike proteoglycans, which are primarily carbohydrate.",
        "whyNotOtherOptions": {
            "a": "Glycoproteins are found on cell membranes (e.g., receptors).",
            "b": "Glycoproteins can function as hormones (e.g., FSH) and receptors.",
            "d": "Glycoproteins have short, branched oligosaccharides (see ID 36)."
        },
        "relatedQuestions": ["36 (glycoproteins)", "38 (glycoprotein functions)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 55,
        "question": "The biological role of heparin is to:",
        "options": ["Store energy", "Prevent blood clotting", "Provide structural support", "Aid in digestion"],
        "answer": 1,
        "correctAnswer": "Prevent blood clotting",
        "explanation": "Heparin is a potent anticoagulant that inhibits the clotting cascade.",
        "whyNotOtherOptions": {
            "a": "Energy storage is the role of glycogen (see ID 17).",
            "c": "Structural support is provided by chondroitin sulfate or collagen (see ID 52).",
            "d": "Heparin does not aid digestion; enzymes like amylase do (see ID 15)."
        },
        "relatedQuestions": ["32 (heparin)", "52 (chondroitin sulfate)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 56,
        "question": "A molecule with 4 chiral centers will have how many stereoisomers?",
        "options": ["4", "8", "16", "32"],
        "answer": 2,
        "correctAnswer": "16",
        "explanation": "The maximum number of stereoisomers for a molecule with n chiral centers is 2ⁿ. 2⁴ = 16.",
        "whyNotOtherOptions": {
            "a": "4 underestimates the exponential growth of stereoisomers.",
            "b": "8 corresponds to 2³, for 3 chiral centers.",
            "d": "32 corresponds to 2⁵, for 5 chiral centers."
        },
        "relatedQuestions": ["42 (enantiomers)", "43 (racemic mixture)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 57,
        "question": "The sugar component of RNA is:",
        "options": ["2-Deoxyribose", "Ribose", "Fructose", "Glucose"],
        "answer": 1,
        "correctAnswer": "Ribose",
        "explanation": "Ribose is the pentose sugar found in RNA.",
        "whyNotOtherOptions": {
            "a": "2-Deoxyribose is in DNA, not RNA (see ID 8).",
            "c": "Fructose is a ketose, not in nucleic acids (see ID 3).",
            "d": "Glucose is a hexose, not used in RNA."
        },
        "relatedQuestions": ["8 (deoxyribose)", "44 (ribitol)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 58,
        "question": "Which of the following is a heteropolysaccharide?",
        "options": ["Cellulose", "Glycogen", "Hyaluronic acid", "Amylose"],
        "answer": 2,
        "correctAnswer": "Hyaluronic acid",
        "explanation": "Hyaluronic acid is a heteropolysaccharide (GAG) composed of D-glucuronate and N-acetyl-D-glucosamine. The others are homopolysaccharides.",
        "whyNotOtherOptions": {
            "a": "Cellulose is a homopolymer of glucose (see ID 23).",
            "b": "Glycogen is a homopolymer of glucose (see ID 17).",
            "d": "Amylose is a homopolymer of glucose (see ID 18)."
        },
        "relatedQuestions": ["27 (GAGs)", "29 (hyaluronic acid)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 59,
        "question": "The process by which glucose is stored as a large polymer in the liver is called:",
        "options": ["Glycolysis", "Glycogenesis", "Glycogenolysis", "Gluconeogenesis"],
        "answer": 1,
        "correctAnswer": "Glycogenesis",
        "explanation": "Glycogenesis is the metabolic pathway for synthesizing glycogen from glucose.",
        "whyNotOtherOptions": {
            "a": "Glycolysis breaks down glucose for energy (see ID 2).",
            "c": "Glycogenolysis degrades glycogen into glucose.",
            "d": "Gluconeogenesis synthesizes glucose from non-carbohydrates (see ID 2)."
        },
        "relatedQuestions": ["17 (glycogen)", "2 (photosynthesis)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 60,
        "question": "A key structural difference between proteoglycans and glycoproteins is that the carbohydrate chains in proteoglycans are:",
        "options": ["Short and branched", "Long, linear, and negatively charged", "Attached to lipids", "Composed of fructose"],
        "answer": 1,
        "correctAnswer": "Long, linear, and negatively charged",
        "explanation": "Proteoglycans have long, linear GAG chains that are highly negative, while glycoproteins have short, branched, often neutral oligosaccharides.",
        "whyNotOtherOptions": {
            "a": "Short and branched chains are characteristic of glycoproteins (see ID 36).",
            "c": "Carbohydrates attached to lipids are glycolipids, not proteoglycans.",
            "d": "Fructose is not a component of proteoglycans (see ID 21)."
        },
        "relatedQuestions": ["34 (proteoglycans)", "36 (glycoproteins)"],
        "category": "Biochemistry",
        "difficulty": "Hard"
    }
]


;
// Store original questions for restart functionality (moved to global scope for cross-browser compatibility)
const originalQuestions = [...questions];
// DOM Elements (global for cross-browser)
let body = document.body;
let questionElement, optionsContainer, currentQuestionElement, totalQuestionsElement, progressBar, prevButton, nextButton, skipButton, feedbackElement, timerElement, scoreElement, streakElement, categoryElement, explanationContainer, explanationTextElement, themeToggle, soundToggle, bookmarkBtn, bookmarksCount, categoryTag, difficultyTag, showExplanationBtn, statsBtn, statsModal, closeStatsModal, closeStatsBtn, quickActionsBtn, quickActionsModal, closeActionsModal, closeActionsBtn, studyModeToggle, confettiContainer;
// Quiz state
let currentQuestionIndex = 0;
let score = 0;
let streak = 0;
let selectedOption = null;
let timeStarted = null;
let timerInterval = null;
let timeElapsed = 0;
let answers = [];
let soundsEnabled = true;
let bookmarkedQuestions = [];
let quizHistory = [];
let studyMode = false;
let performanceMetrics = {
    categories: {},
    difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
    totalCorrect: 0,
    totalQuestions: 0,
    totalTime: 0
};
function initQuiz() {
    try {
        // Assign DOM elements safely
        questionElement = document.getElementById('question') || questionElement;
        optionsContainer = document.getElementById('options-container') || optionsContainer;
        currentQuestionElement = document.getElementById('current-question') || currentQuestionElement;
        totalQuestionsElement = document.getElementById('total-questions') || totalQuestionsElement;
        progressBar = document.getElementById('progress-bar') || progressBar;
        prevButton = document.getElementById('prev-btn') || prevButton;
        nextButton = document.getElementById('next-btn') || nextButton;
        skipButton = document.getElementById('skip-btn') || skipButton;
        feedbackElement = document.getElementById('feedback') || feedbackElement;
        timerElement = document.getElementById('timer') || timerElement;
        scoreElement = document.getElementById('score') || scoreElement;
        streakElement = document.getElementById('streak') || streakElement;
        categoryElement = document.getElementById('category') || categoryElement;
        explanationContainer = document.getElementById('explanation-container') || explanationContainer;
        explanationTextElement = document.getElementById('explanation-text') || explanationTextElement;
        themeToggle = document.getElementById('theme-toggle') || themeToggle;
        soundToggle = document.getElementById('sound-toggle') || soundToggle;
        bookmarkBtn = document.getElementById('bookmark-btn') || bookmarkBtn;
        bookmarksCount = document.getElementById('bookmarks-count') || bookmarksCount;
        categoryTag = document.getElementById('category-tag') || categoryTag;
        difficultyTag = document.getElementById('difficulty-tag') || difficultyTag;
        showExplanationBtn = document.getElementById('show-explanation-btn') || showExplanationBtn;
        statsBtn = document.getElementById('stats-btn') || statsBtn;
        statsModal = document.getElementById('stats-modal') || statsModal;
        closeStatsModal = document.getElementById('close-stats-modal') || closeStatsModal;
        closeStatsBtn = document.getElementById('close-stats-btn') || closeStatsBtn;
        quickActionsBtn = document.getElementById('quick-actions-btn') || quickActionsBtn;
        quickActionsModal = document.getElementById('quick-actions-modal') || quickActionsModal;
        closeActionsModal = document.getElementById('close-actions-modal') || closeActionsModal;
        closeActionsBtn = document.getElementById('close-actions-btn') || closeActionsBtn;
        studyModeToggle = document.getElementById('study-mode-toggle') || studyModeToggle;
        confettiContainer = document.getElementById('confetti-container') || confettiContainer;
        // Reset DOM elements
        if (scoreElement) scoreElement.textContent = score;
        if (streakElement) streakElement.textContent = streak;
        if (timerElement) timerElement.textContent = '00:00';
        if (totalQuestionsElement) totalQuestionsElement.textContent = questions.length;
        
        loadQuestion();
        startTimer();
        
        // Clone elements to remove old listeners (cross-browser safe)
        if (prevButton) {
            const prevBtnClone = prevButton.cloneNode(true);
            prevButton.parentNode.replaceChild(prevBtnClone, prevButton);
            prevButton = prevBtnClone;
        }
        if (nextButton) {
            const nextBtnClone = nextButton.cloneNode(true);
            nextButton.parentNode.replaceChild(nextBtnClone, nextButton);
            nextButton = nextBtnClone;
        }
        if (skipButton) {
            const skipBtnClone = skipButton.cloneNode(true);
            skipButton.parentNode.replaceChild(skipBtnClone, skipButton);
            skipButton = skipBtnClone;
        }
        if (themeToggle) {
            const themeToggleClone = themeToggle.cloneNode(true);
            themeToggle.parentNode.replaceChild(themeToggleClone, themeToggle);
            themeToggle = themeToggleClone;
        }
        if (soundToggle) {
            const soundToggleClone = soundToggle.cloneNode(true);
            soundToggle.parentNode.replaceChild(soundToggleClone, soundToggle);
            soundToggle = soundToggleClone;
        }
        if (bookmarkBtn) {
            const bookmarkBtnClone = bookmarkBtn.cloneNode(true);
            bookmarkBtn.parentNode.replaceChild(bookmarkBtnClone, bookmarkBtn);
            bookmarkBtn = bookmarkBtnClone;
        }
        if (showExplanationBtn) {
            const showExplanationBtnClone = showExplanationBtn.cloneNode(true);
            showExplanationBtn.parentNode.replaceChild(showExplanationBtnClone, showExplanationBtn);
            showExplanationBtn = showExplanationBtnClone;
        }
        if (statsBtn) {
            const statsBtnClone = statsBtn.cloneNode(true);
            statsBtn.parentNode.replaceChild(statsBtnClone, statsBtn);
            statsBtn = statsBtnClone;
        }
        // Add event listeners safely
        if (prevButton) prevButton.addEventListener('click', goToPreviousQuestion);
        if (nextButton) nextButton.addEventListener('click', goToNextQuestion);
        if (skipButton) skipButton.addEventListener('click', skipQuestion);
        if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
        if (soundToggle) soundToggle.addEventListener('click', toggleSound);
        if (bookmarkBtn) bookmarkBtn.addEventListener('click', toggleBookmark);
        if (showExplanationBtn) showExplanationBtn.addEventListener('click', toggleExplanation);
        if (statsBtn) statsBtn.addEventListener('click', showStatsModal);
        if (closeStatsModal) closeStatsModal.addEventListener('click', hideStatsModal);
        if (closeStatsBtn) closeStatsBtn.addEventListener('click', hideStatsModal);
        if (quickActionsBtn) quickActionsBtn.addEventListener('click', showQuickActionsModal);
        if (closeActionsModal) closeActionsModal.addEventListener('click', hideQuickActionsModal);
        if (closeActionsBtn) closeActionsBtn.addEventListener('click', hideQuickActionsModal);
        if (studyModeToggle) studyModeToggle.addEventListener('change', toggleStudyMode);
        
        const markForReviewBtn = document.getElementById('mark-for-review-btn');
        if (markForReviewBtn) markForReviewBtn.addEventListener('click', markForReview);
        const viewExplanationBtn = document.getElementById('view-explanation-btn');
        if (viewExplanationBtn) viewExplanationBtn.addEventListener('click', viewExplanation);
        const hintBtn = document.getElementById('hint-btn');
        if (hintBtn) hintBtn.addEventListener('click', getHint);
        const reportBtn = document.getElementById('report-question-btn');
        if (reportBtn) reportBtn.addEventListener('click', reportQuestion);
        
        // Keyboard navigation
        document.removeEventListener('keydown', handleKeydown);
        document.addEventListener('keydown', handleKeydown);
        
        loadPreferences();
        loadQuizHistory();
        updateBookmarksCount();
    } catch (e) {
        console.error('Error initializing quiz:', e);
    }
}
function handleKeydown(e) {
    if (e.key === 'ArrowRight') {
        goToNextQuestion();
    } else if (e.key === 'ArrowLeft') {
        goToPreviousQuestion();
    } else if (e.key.toLowerCase() === 'a' || e.key === '1') {
        selectOption(0);
    } else if (e.key.toLowerCase() === 'b' || e.key === '2') {
        selectOption(1);
    } else if (e.key.toLowerCase() === 'c' || e.key === '3') {
        selectOption(2);
    } else if (e.key.toLowerCase() === 'd' || e.key === '4') {
        selectOption(3);
    } else if (e.key === 'Enter') {
        if (showExplanationBtn && showExplanationBtn.style.display !== 'none') {
            toggleExplanation();
        }
    } else if (e.key === 's' || e.key === '5') {
        skipQuestion();
    }
}
function loadQuestion() {
    if (!questionElement || !optionsContainer) return; // Safety check
    const question = questions[currentQuestionIndex];
    if (!question) return;
    questionElement.textContent = question.question;
    currentQuestionElement.textContent = currentQuestionIndex + 1;
    if (categoryTag) categoryTag.textContent = question.category || 'Unknown';
    
    // Update difficulty tag with indicator
    if (difficultyTag) {
        difficultyTag.innerHTML = `
            <span class="difficulty-indicator difficulty-${question.difficulty.toLowerCase().replace(' ', '-')}"></span>
            ${question.difficulty}
        `;
    }
    
    if (categoryElement) categoryElement.textContent = question.category || 'All';
    
    const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
    if (progressBar) progressBar.style.width = `${progress}%`;
    
    // Update progress level for appearance change
    let progressLevel = 0;
    if (progress > 75) progressLevel = 75;
    else if (progress > 50) progressLevel = 50;
    else if (progress > 25) progressLevel = 25;
    body.setAttribute('data-progress', progressLevel);
    
    optionsContainer.innerHTML = '';
    
    const optionLetters = ['A', 'B', 'C', 'D'];
    question.options.forEach((option, index) => {
        const optionElement = document.createElement('div');
        optionElement.classList.add('option', 'fade-in');
        optionElement.setAttribute('role', 'button');
        optionElement.setAttribute('tabindex', '0');
        optionElement.setAttribute('aria-label', `Option ${optionLetters[index]}: ${option}`);
        
        const optionLetter = document.createElement('div');
        optionLetter.classList.add('option-letter');
        optionLetter.textContent = optionLetters[index];
        
        const optionText = document.createElement('div');
        optionText.classList.add('option-text');
        optionText.textContent = option;
        
        optionElement.appendChild(optionLetter);
        optionElement.appendChild(optionText);
        
        optionElement.addEventListener('click', () => selectOption(index));
        optionElement.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                selectOption(index);
            }
        });
        
        optionsContainer.appendChild(optionElement);
    });
    
    if (prevButton) prevButton.disabled = currentQuestionIndex === 0;
    if (nextButton) nextButton.textContent = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz' : 'Next Question';
    if (nextButton) nextButton.innerHTML = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz <i class="fas fa-flag-checkered"></i>' : 'Next Question <i class="fas fa-arrow-right"></i>';
    
    if (feedbackElement) feedbackElement.style.display = 'none';
    if (showExplanationBtn) showExplanationBtn.style.display = 'none';
    if (explanationContainer) explanationContainer.classList.remove('expanded');
    
    selectedOption = null;
    
    // Show quick actions button
    if (quickActionsBtn) quickActionsBtn.style.display = 'flex';
    
    // If the question was previously answered or skipped, display the feedback and explanations
    if (answers[currentQuestionIndex]) {
        const ans = answers[currentQuestionIndex];
        const options = document.querySelectorAll('.option');
        if (feedbackElement) feedbackElement.style.display = 'flex';
        if (showExplanationBtn) showExplanationBtn.style.display = 'block';
        
        // Update explanation with general explanation and whyNotOtherOptions
        if (explanationTextElement) {
            let explanationContent = question.explanation;
            if (question.whyNotOtherOptions) {
                explanationContent += '<br><br><strong>Why Not Other Options:</strong><ul>';
                const optionLetters = ['a', 'b', 'c', 'd'];
                optionLetters.forEach((letter, index) => {
                    if (index !== question.answer && question.whyNotOtherOptions[letter]) {
                        explanationContent += `<li><strong>Option ${letter.toUpperCase()}:</strong> ${question.whyNotOtherOptions[letter]}</li>`;
                    }
                });
                explanationContent += '</ul>';
            }
            explanationTextElement.innerHTML = explanationContent;
        }
        
        options.forEach(option => option.style.pointerEvents = 'none');
        
        if (ans.selected === 'Skipped') {
            selectedOption = null;
            if (feedbackElement) {
                feedbackElement.classList.add('skipped');
                feedbackElement.innerHTML = '<i class="fas fa-forward feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
            }
            options[question.answer].classList.add('correct');
        } else {
            const optIndex = question.options.findIndex(opt => opt === ans.selected);
            if (optIndex !== -1) {
                selectedOption = optIndex;
                options[optIndex].classList.add('selected');
                if (ans.isCorrect) {
                    if (feedbackElement) {
                        feedbackElement.classList.add('correct');
                        feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                    }
                } else {
                    if (feedbackElement) {
                        feedbackElement.classList.add('incorrect');
                        feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                    }
                    options[question.answer].classList.add('correct');
                    options[optIndex].classList.add('incorrect');
                }
            }
        }
    }
    
    updateBookmarkStatus();
}
function selectOption(index) {
    if (selectedOption !== null || answers[currentQuestionIndex]) return;
    
    const options = document.querySelectorAll('.option');
    options.forEach(option => option.classList.remove('selected', 'incorrect'));
    options[index].classList.add('selected');
    selectedOption = index;
    
    const question = questions[currentQuestionIndex];
    const isCorrect = index === question.answer;
    
    if (feedbackElement) feedbackElement.style.display = 'flex';
    if (isCorrect) {
        if (feedbackElement) {
            feedbackElement.classList.remove('incorrect');
            feedbackElement.classList.add('correct');
            feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
        }
        score += getScoreForDifficulty(question.difficulty);
        streak++;
        playSound('correct');
        
        if (question.difficulty === 'Hard' || question.difficulty === 'Very Hard') {
            createConfetti();
        }
    } else {
        if (feedbackElement) {
            feedbackElement.classList.remove('correct');
            feedbackElement.classList.add('incorrect');
            feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
        }
        options[question.answer].classList.add('correct');
        options[index].classList.add('incorrect');
        streak = 0;
        playSound('incorrect');
    }
    
    if (scoreElement) scoreElement.textContent = score;
    if (streakElement) streakElement.textContent = streak;
    
    if (explanationTextElement) {
        let explanationContent = question.explanation;
        if (question.whyNotOtherOptions) {
            explanationContent += '<br><br><strong>Why Not Other Options:</strong><ul>';
            const optionLetters = ['a', 'b', 'c', 'd'];
            optionLetters.forEach((letter, idx) => {
                if (idx !== question.answer && question.whyNotOtherOptions[letter]) {
                    explanationContent += `<li><strong>Option ${letter.toUpperCase()}:</strong> ${question.whyNotOtherOptions[letter]}</li>`;
                }
            });
            explanationContent += '</ul>';
        }
        explanationTextElement.innerHTML = explanationContent;
    }
    if (showExplanationBtn) showExplanationBtn.style.display = 'block';
    
    answers[currentQuestionIndex] = {
        question: question.question,
        selected: question.options[index],
        correct: question.options[question.answer],
        isCorrect: isCorrect,
        explanation: question.explanation,
        category: question.category,
        difficulty: question.difficulty
    };
    
    updatePerformanceMetrics(isCorrect, question);
    
    options.forEach(option => option.style.pointerEvents = 'none');
}
function skipQuestion() {
    if (answers[currentQuestionIndex]) return;
    
    const question = questions[currentQuestionIndex];
    const options = document.querySelectorAll('.option');
    
    if (feedbackElement) {
        feedbackElement.style.display = 'flex';
        feedbackElement.classList.add('skipped');
        feedbackElement.innerHTML = '<i class="fas fa-forward feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
    }
    
    options[question.answer].classList.add('correct');
    if (showExplanationBtn) showExplanationBtn.style.display = 'block';
    
    if (explanationTextElement) {
        let explanationContent = question.explanation;
        if (question.whyNotOtherOptions) {
            explanationContent += '<br><br><strong>Why Not Other Options:</strong><ul>';
            const optionLetters = ['a', 'b', 'c', 'd'];
            optionLetters.forEach((letter, idx) => {
                if (idx !== question.answer && question.whyNotOtherOptions[letter]) {
                    explanationContent += `<li><strong>Option ${letter.toUpperCase()}:</strong> ${question.whyNotOtherOptions[letter]}</li>`;
                }
            });
            explanationContent += '</ul>';
        }
        explanationTextElement.innerHTML = explanationContent;
    }
    
    answers[currentQuestionIndex] = {
        question: question.question,
        selected: 'Skipped',
        correct: question.options[question.answer],
        isCorrect: false,
        explanation: question.explanation,
        category: question.category,
        difficulty: question.difficulty
    };
    
    updatePerformanceMetrics(false, question);
    streak = 0;
    if (streakElement) streakElement.textContent = streak;
    
    options.forEach(option => option.style.pointerEvents = 'none');
}
function maybeHandleSkip() {
    if (!answers[currentQuestionIndex] && selectedOption === null) {
        skipQuestion();
    }
}
function toggleExplanation() {
    if (!explanationContainer) return;
    explanationContainer.classList.toggle('expanded');
    if (!showExplanationBtn) return;
    showExplanationBtn.innerHTML = explanationContainer.classList.contains('expanded') ?
        '<i class="fas fa-info-circle"></i> Hide Explanation' :
        '<i class="fas fa-info-circle"></i> Show Explanation';
}
function getScoreForDifficulty(difficulty) {
    switch (difficulty) {
        case 'Easy': return 5;
        case 'Medium': return 10;
        case 'Hard': return 15;
        case 'Very Hard': return 20;
        default: return 10;
    }
}
function updatePerformanceMetrics(isCorrect, question) {
    performanceMetrics.totalQuestions++;
    performanceMetrics.totalTime += timeElapsed;
    if (isCorrect) performanceMetrics.totalCorrect++;
    
    performanceMetrics.categories[question.category] = performanceMetrics.categories[question.category] || { correct: 0, total: 0 };
    performanceMetrics.categories[question.category].total++;
    if (isCorrect) performanceMetrics.categories[question.category].correct++;
    
    if (!performanceMetrics.difficulties[question.difficulty]) performanceMetrics.difficulties[question.difficulty] = 0;
    if (isCorrect) performanceMetrics.difficulties[question.difficulty]++;
}
function toggleBookmark() {
    if (!bookmarkBtn) return;
    const questionId = questions[currentQuestionIndex].id;
    const index = bookmarkedQuestions.indexOf(questionId);
    if (index === -1) {
        bookmarkedQuestions.push(questionId);
        bookmarkBtn.classList.add('bookmarked');
        playSound('bookmark');
    } else {
        bookmarkedQuestions.splice(index, 1);
        bookmarkBtn.classList.remove('bookmarked');
    }
    updateBookmarksCount();
    saveBookmarks();
}
function updateBookmarkStatus() {
    if (!bookmarkBtn) return;
    const questionId = questions[currentQuestionIndex].id;
    bookmarkBtn.classList.toggle('bookmarked', bookmarkedQuestions.includes(questionId));
}
function updateBookmarksCount() {
    if (!bookmarksCount) return;
    bookmarksCount.textContent = bookmarkedQuestions.length;
}
function goToNextQuestion() {
    maybeHandleSkip();
    if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        loadQuestion();
    } else {
        body.setAttribute('data-progress', '100');
        showResults();
        saveQuizHistory();
    }
}
function goToPreviousQuestion() {
    maybeHandleSkip();
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion();
    }
}
function startTimer() {
    timeStarted = new Date();
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(updateTimer, 1000);
}
function updateTimer() {
    timeElapsed++;
    
    const minutes = Math.floor(timeElapsed / 60).toString().padStart(2, '0');
    const seconds = (timeElapsed % 60).toString().padStart(2, '0');
    if (timerElement) timerElement.textContent = `${minutes}:${seconds}`;
    
    if (timeElapsed >= 300) {
        if (timerElement) {
            timerElement.style.color = 'var(--danger)';
            timerElement.classList.add('pulse');
        }
    } else {
        if (timerElement) {
            timerElement.style.color = 'var(--primary)';
            timerElement.classList.remove('pulse');
        }
    }
}
function showResults() {
    if (timerInterval) clearInterval(timerInterval);
    if (quickActionsBtn) quickActionsBtn.style.display = 'none';
    
    const quizContainer = document.querySelector('.quiz-container');
    if (!quizContainer) return;
    const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
    const percentage = ((score / maxScore) * 100).toFixed(1);
    const accuracy = ((performanceMetrics.totalCorrect / performanceMetrics.totalQuestions) * 100).toFixed(1);
    const avgTime = Math.round(performanceMetrics.totalTime / performanceMetrics.totalQuestions);
    
    quizContainer.innerHTML = `
        <div class="results-container">
            <h2 class="quiz-title">Quiz Completed!</h2>
            <p class="quiz-subtitle">You've finished the MED QUIZ</p>
            
            <div class="score-circle" style="--p: ${percentage}%">
                <div class="score-text">
                    <div class="score-value">${score}</div>
                    <div class="score-label">Points</div>
                </div>
            </div>
            
            <div class="results-stats">
                <div class="result-stat">
                    <div class="result-stat-value">${accuracy}%</div>
                    <div class="result-stat-label">Accuracy</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value">${timeElapsed}s</div>
                    <div class="result-stat-label">Time Taken</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value">${streak}</div>
                    <div class="result-stat-label">Best Streak</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value">${bookmarkedQuestions.length}</div>
                    <div class="result-stat-label">Bookmarked</div>
                </div>
            </div>
            
            <div class="review-section">
                <h3 class="review-title">Performance Analytics</h3>
                <div class="review-item">
                    <div class="review-answer">Average Time Per Question: ${avgTime}s</div>
                    <div class="review-answer">Difficulty Performance:
                        Easy: ${performanceMetrics.difficulties.Easy || 0},
                        Medium: ${performanceMetrics.difficulties.Medium || 0},
                        Hard: ${performanceMetrics.difficulties.Hard || 0},
                        Very Hard: ${performanceMetrics.difficulties['Very Hard'] || 0}
                    </div>
                </div>
                
                <h3 class="review-title">Review Your Answers</h3>
                ${answers.map((answer, index) => `
                    <div class="review-item ${answer.isCorrect ? 'correct' : answer.selected === 'Skipped' ? 'skipped' : 'incorrect'}">
                        <div class="review-question">Q${index + 1}: ${answer.question} (${answer.category} - ${answer.difficulty})</div>
                        <div class="review-answer">Your Answer: ${answer.selected}</div>
                        <div class="review-answer">Correct Answer: ${answer.correct}</div>
                        <div class="review-explanation">${answer.explanation}
                            ${questions[index].whyNotOtherOptions ? `
                                <br><br><strong>Why Not Other Options:</strong>
                                <ul>
                                    ${Object.entries(questions[index].whyNotOtherOptions).map(([key, value]) => `
                                        <li><strong>Option ${key.toUpperCase()}:</strong> ${value}</li>
                                    `).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    </div>
                `).join('')}
                
                ${bookmarkedQuestions.length > 0 ? `
                    <h3 class="review-title">Bookmarked Questions</h3>
                    ${bookmarkedQuestions.map(qid => {
                        const question = questions.find(q => q.id === qid);
                        if (!question) return '';
                        return `
                            <div class="review-item">
                                <div class="review-question">${question.question} (${question.category} - ${question.difficulty})</div>
                                <div class="review-answer">Correct Answer: ${question.correctAnswer}</div>
                                <div class="review-explanation">${question.explanation}
                                    ${question.whyNotOtherOptions ? `
                                        <br><br><strong>Why Not Other Options:</strong>
                                        <ul>
                                            ${Object.entries(question.whyNotOtherOptions).map(([key, value]) => `
                                                <li><strong>Option ${key.toUpperCase()}:</strong> ${value}</li>
                                            `).join('')}
                                        </ul>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                ` : ''}
            </div>
            
            <button class="btn btn-primary mt-4" id="restart-btn">
                <i class="fas fa-redo"></i> Try Again
            </button>
            <button class="btn btn-secondary mt-2" id="review-wrong-btn">
                <i class="fas fa-search"></i> Review Incorrect Answers
            </button>
        </div>
    `;
    
    // Add event listeners after DOM update
    const restartBtn = document.getElementById('restart-btn');
    const reviewWrongBtn = document.getElementById('review-wrong-btn');
    if (restartBtn) restartBtn.addEventListener('click', restartQuiz);
    if (reviewWrongBtn) reviewWrongBtn.addEventListener('click', reviewWrongAnswers);
}
function reviewWrongAnswers() {
    const wrongAnswers = answers.filter(answer => !answer.isCorrect && answer.selected !== 'Skipped');
    
    if (wrongAnswers.length === 0) {
        alert("You don't have any incorrect answers to review!");
        return;
    }
    
    const wrongQuestions = questions.filter((q, index) =>
        answers[index] && !answers[index].isCorrect && answers[index].selected !== 'Skipped'
    );
    
    questions.length = 0;
    questions.push(...wrongQuestions);
    currentQuestionIndex = 0;
    score = 0;
    streak = 0;
    timeElapsed = 0;
    answers = [];
    selectedOption = null;
    performanceMetrics = {
        categories: {},
        difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
        totalCorrect: 0,
        totalQuestions: 0,
        totalTime: 0
    };
    
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    body.setAttribute('data-progress', '0');
    
    const quizContainer = document.querySelector('.quiz-container');
    if (quizContainer) {
        quizContainer.innerHTML = `
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">MED QUIZ</h1>
                    <p class="quiz-subtitle">Reviewing Incorrect Answers</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="score">0</span>
                        <span class="stat-label">Score</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="streak">0</span>
                        <span class="stat-label">Streak</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">Review</span>
                        <span class="stat-label">Mode</span>
                    </div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>
            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">Biochemistry</span>
                    <span class="tag" id="difficulty-tag">
                        <span class="difficulty-indicator difficulty-medium"></span>
                        Medium
                    </span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">${wrongQuestions.length}</span></div>
            <div class="question-text" id="question"></div>
            <div class="options-grid" id="options-container"></div>
            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>
            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>
            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text"></div>
                </div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-danger" id="skip-btn">
                    <i class="fas fa-forward"></i> Skip
                </button>
            </div>
        `;
    }
    
    initQuiz();
}
function restartQuiz() {
    currentQuestionIndex = 0;
    score = 0;
    streak = 0;
    timeElapsed = 0;
    answers = [];
    selectedOption = null;
    performanceMetrics = {
        categories: {},
        difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
        totalCorrect: 0,
        totalQuestions: 0,
        totalTime: 0
    };
    
    questions.length = 0;
    questions.push(...originalQuestions);
    
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    body.setAttribute('data-progress', '0');
    
    const quizContainer = document.querySelector('.quiz-container');
    if (quizContainer) {
        quizContainer.innerHTML = `
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">MED QUIZ</h1>
                    <p class="quiz-subtitle">Test your medical knowledge</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="score">0</span>
                        <span class="stat-label">Score</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="streak">0</span>
                        <span class="stat-label">Streak</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">All</span>
                        <span class="stat-label">Category</span>
                    </div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>
            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">Biochemistry</span>
                    <span class="tag" id="difficulty-tag">
                        <span class="difficulty-indicator difficulty-medium"></span>
                        Medium
                    </span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">15</span></div>
            <div class="question-text" id="question"></div>
            <div class="options-grid" id="options-container"></div>
            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>
            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>
            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text"></div>
                </div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-danger" id="skip-btn">
                    <i class="fas fa-forward"></i> Skip
                </button>
            </div>
        `;
    }
    
    initQuiz();
}
function markForReview() {
    toggleBookmark();
    hideQuickActionsModal();
}
function viewExplanation() {
    if (!answers[currentQuestionIndex]) return;
    toggleExplanation();
    hideQuickActionsModal();
}
function getHint() {
    if (answers[currentQuestionIndex]) return;
    const wrongOptions = Array.from(document.querySelectorAll('.option')).filter((opt, idx) => idx !== questions[currentQuestionIndex].answer);
    const randomWrong = wrongOptions[Math.floor(Math.random() * wrongOptions.length)];
    randomWrong.style.opacity = '0.5';
    randomWrong.style.pointerEvents = 'none';
    const hintText = document.createElement('div');
    hintText.textContent = 'Hint: One wrong option eliminated!';
    hintText.classList.add('feedback', 'skipped');
    optionsContainer.before(hintText);
    setTimeout(() => hintText.remove(), 3000);
    hideQuickActionsModal();
}
function reportQuestion() {
    alert('Question reported. Thank you for your feedback!');
    hideQuickActionsModal();
}
function toggleTheme() {
    if (!body || !themeToggle) return;
    const currentTheme = body.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' :
                    currentTheme === 'light' ? 'minimal' : 'dark';
    
    body.setAttribute('data-theme', newTheme);
    themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-moon"></i>' :
                          newTheme === 'light' ? '<i class="fas fa-sun"></i>' :
                          '<i class="fas fa-paint-brush"></i>';
    
    localStorage.setItem('theme', newTheme);
}
function toggleSound() {
    if (!soundToggle) return;
    soundsEnabled = !soundsEnabled;
    soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
    
    localStorage.setItem('soundsEnabled', soundsEnabled);
}
function toggleStudyMode() {
    if (!studyModeToggle) return;
    studyMode = studyModeToggle.checked;
    if (showExplanationBtn && explanationContainer) {
        if (studyMode) {
            showExplanationBtn.style.display = 'block';
            explanationContainer.classList.add('expanded');
            showExplanationBtn.innerHTML = '<i class="fas fa-info-circle"></i> Hide Explanation';
        } else {
            showExplanationBtn.style.display = 'none';
            explanationContainer.classList.remove('expanded');
        }
    }
    localStorage.setItem('studyMode', studyMode);
}
function playSound(type) {
    if (!soundsEnabled) return;
    
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        if (type === 'correct') {
            const notes = [523.25, 659.25, 783.99];
            notes.forEach((freq, i) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime + i * 0.1);
                    oscillator.stop(audioContext.currentTime + i * 0.1 + 0.3);
                }, i * 100);
            });
        } else if (type === 'incorrect') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.type = 'sawtooth';
            gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.4);
        } else if (type === 'bookmark') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.type = 'triangle';
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.2);
        }
    } catch (e) {
        console.log('Web Audio API not supported');
    }
}
function createConfetti() {
    if (!confettiContainer) return;
    const colors = ['#4361ee', '#4cc9f0', '#f72585', '#f9c74f', '#7209b7'];
    
    for (let i = 0; i < 60; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.width = (6 + Math.random() * 12) + 'px';
        confetti.style.height = (6 + Math.random() * 12) + 'px';
        confetti.style.animation = `confettiFall ${1.5 + Math.random() * 2.5}s linear forwards`;
        confettiContainer.appendChild(confetti);
        
        setTimeout(() => {
            if (confetti.parentNode) confetti.remove();
        }, 4000);
    }
}
function showStatsModal() {
    if (!statsModal) return;
    const totalQuestions = performanceMetrics.totalQuestions;
    const correctAnswers = performanceMetrics.totalCorrect;
    const accuracy = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
    const avgTime = totalQuestions > 0 ? Math.round(performanceMetrics.totalTime / totalQuestions) : 0;
    
    const modalTotal = document.getElementById('modal-total-questions');
    const modalCorrect = document.getElementById('modal-correct-answers');
    const modalAccuracy = document.getElementById('modal-accuracy');
    const modalAvgTime = document.getElementById('modal-avg-time');
    if (modalTotal) modalTotal.textContent = totalQuestions;
    if (modalCorrect) modalCorrect.textContent = correctAnswers;
    if (modalAccuracy) modalAccuracy.textContent = `${accuracy}%`;
    if (modalAvgTime) modalAvgTime.textContent = `${avgTime}s`;
    
    const categoryStatsContainer = document.getElementById('category-stats');
    if (categoryStatsContainer) {
        categoryStatsContainer.innerHTML = `
            <table style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr><th>Category</th><th>Accuracy</th><th>Correct/Total</th></tr>
                </thead>
                <tbody>
                    ${Object.entries(performanceMetrics.categories).map(([category, stats]) => {
                        const categoryAccuracy = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
                        return `<tr><td>${category}</td><td>${categoryAccuracy}%</td><td>${stats.correct}/${stats.total}</td></tr>`;
                    }).join('')}
                </tbody>
            </table>
        `;
    }
    
    const difficultyStatsContainer = document.getElementById('difficulty-stats');
    if (difficultyStatsContainer) {
        difficultyStatsContainer.innerHTML = `
            <table style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr><th>Difficulty</th><th>Accuracy</th><th>Correct/Total</th></tr>
                </thead>
                <tbody>
                    ${Object.entries(performanceMetrics.difficulties).map(([difficulty, correctCount]) => {
                        const diffTotals = {};
                        answers.forEach(ans => {
                            if (ans.difficulty && ans.isCorrect !== undefined) {
                                if (!diffTotals[ans.difficulty]) diffTotals[ans.difficulty] = { correct: 0, total: 0 };
                                diffTotals[ans.difficulty].total++;
                                if (ans.isCorrect) diffTotals[ans.difficulty].correct++;
                            }
                        });
                        const totalForDifficulty = diffTotals[difficulty] ? diffTotals[difficulty].total : 0;
                        if (totalForDifficulty > 0) {
                            const difficultyAccuracy = Math.round((correctCount / totalForDifficulty) * 100);
                            return `<tr><td>${difficulty}</td><td>${difficultyAccuracy}%</td><td>${correctCount}/${totalForDifficulty}</td></tr>`;
                        }
                        return '';
                    }).join('')}
                </tbody>
            </table>
        `;
    }
    
    const historyContainer = document.getElementById('history-stats');
    if (historyContainer) {
        if (quizHistory.length === 0) {
            historyContainer.innerHTML = '<p>No history yet.</p>';
        } else {
            historyContainer.innerHTML = `
                <table style="width:100%; border-collapse: collapse;">
                    <thead>
                        <tr><th>Date</th><th>Score</th><th>Percentage</th><th>Time</th><th>Streak</th></tr>
                    </thead>
                    <tbody>
                        ${quizHistory.map(h => {
                            const date = new Date(h.timestamp).toLocaleString();
                            return `<tr><td>${date}</td><td>${h.score}</td><td>${h.percentage}%</td><td>${h.timeSpent}s</td><td>${h.streak}</td></tr>`;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }
    }
    
    statsModal.classList.add('active');
}
function hideStatsModal() {
    if (statsModal) statsModal.classList.remove('active');
}
function showQuickActionsModal() {
    if (quickActionsModal) quickActionsModal.classList.add('active');
}
function hideQuickActionsModal() {
    if (quickActionsModal) quickActionsModal.classList.remove('active');
}
function loadPreferences() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme && body) {
        body.setAttribute('data-theme', savedTheme);
        if (themeToggle) {
            themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-moon"></i>' :
                                  savedTheme === 'light' ? '<i class="fas fa-sun"></i>' :
                                  '<i class="fas fa-paint-brush"></i>';
        }
    }
    
    const savedSounds = localStorage.getItem('soundsEnabled');
    if (savedSounds !== null) {
        soundsEnabled = savedSounds === 'true';
        if (soundToggle) {
            soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
        }
    }
    
    const savedStudyMode = localStorage.getItem('studyMode');
    if (savedStudyMode !== null) {
        studyMode = savedStudyMode === 'true';
        if (studyModeToggle) studyModeToggle.checked = studyMode;
        if (studyMode && showExplanationBtn && explanationContainer) {
            showExplanationBtn.style.display = 'block';
            explanationContainer.classList.add('expanded');
            showExplanationBtn.innerHTML = '<i class="fas fa-info-circle"></i> Hide Explanation';
        }
    }
}
function saveBookmarks() {
    localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarkedQuestions));
}
function loadQuizHistory() {
    const saved = localStorage.getItem('quizHistory');
    if (saved) {
        try {
            quizHistory = JSON.parse(saved);
        } catch (e) {
            quizHistory = [];
        }
    }
    loadBookmarks();
}
function saveQuizHistory() {
    const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
    quizHistory.push({
        timestamp: new Date().toISOString(),
        score: score,
        percentage: ((score / maxScore) * 100).toFixed(1),
        timeSpent: timeElapsed,
        streak: streak,
        answers: answers,
        performanceMetrics: performanceMetrics
    });
    localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
}
function loadBookmarks() {
    const saved = localStorage.getItem('bookmarkedQuestions');
    if (saved) {
        try {
            bookmarkedQuestions = JSON.parse(saved);
        } catch (e) {
            bookmarkedQuestions = [];
        }
    }
}
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initQuiz);
} else {
    initQuiz();
}
</script>
</body>
</html>