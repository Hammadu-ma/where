<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedQUIZ | Advanced Medical Quiz Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        :root {
            --primary: #5A54E8;
            --primary-light: #7A74FF;
            --primary-dark: #3E38B8;
            --secondary: #FF6584;
            --success: #4ADE80;
            --warning: #FBBF24;
            --danger: #EF4444;
            --light: #F9FAFB;
            --dark: #111827;
            --gray: #6B7280;
            --gray-light: #E5E7EB;
            --border-radius: 8px;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 4px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s ease;
            --gradient-primary: linear-gradient(135deg, var(--primary-light), var(--primary));
            --glass-bg: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(255, 255, 255, 0.2);
            --background-gradient: linear-gradient(135deg, #f5f7fa 0%, #f5f7fa 100%);
            --card-gradient: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
        }

        .dark-theme {
            --primary: #7A74FF;
            --primary-light: #9D98FF;
            --primary-dark: #5A54E8;
            --light: #1F2937;
            --dark: #F3F4F6;
            --gray: #9CA3AF;
            --gray-light: #374151;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 4px 20px rgba(0, 0, 0, 0.25);
            --glass-bg: rgba(31, 41, 55, 0.8);
            --glass-border: rgba(255, 255, 255, 0.1);
            --background-gradient: linear-gradient(135deg, #1e3c72 0%, #1e3c72 100%);
            --card-gradient: linear-gradient(135deg, #2d3748 0%, #2d3748 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: var(--background-gradient);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 1rem;
            transition: var(--transition);
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Registration Modal */
        .registration-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.2s ease;
        }

        .registration-form {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            position: relative;
            animation: slideUp 0.3s ease;
            border: 1px solid var(--gray-light);
        }

        .registration-form h2 {
            color: var(--primary);
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 600;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            background: var(--light);
            color: var(--dark);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(90, 84, 232, 0.1);
        }

        .btn-submit {
            width: 100%;
            padding: 0.75rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 0.5rem;
        }

        .btn-submit:hover {
            background: var(--primary-dark);
        }

        .blurred-content {
            filter: blur(2px);
            pointer-events: none;
            transition: filter 0.3s ease;
        }

        /* Header Styles */
        header {
            text-align: center;
            padding: 1.5rem;
            background: var(--light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        h1 {
            color: var(--primary);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .subtitle {
            color: var(--gray);
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
            font-weight: 400;
        }

        .mode-selector {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 0.5rem;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .mode-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: 50px;
            background: var(--light);
            color: var(--gray);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .mode-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .mode-btn:hover {
            background: var(--gray-light);
        }

        .quiz-info {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .info-card {
            background: var(--light);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            border: 1px solid var(--gray-light);
            transition: var(--transition);
        }

        .info-card i {
            color: var(--primary);
            font-size: 1rem;
        }

        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .questions-container {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .question-section {
            margin-bottom: 2rem;
            flex-direction: column;
            padding: 1rem;
            border-radius: var(--border-radius);
            background: var(--light);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .question-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 0.75rem;
        }

        .question-number {
            background: var(--primary);
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--dark);
            line-height: 1.4;
            flex: 1;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        @media (min-width: 768px) {
            .options-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option {
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            font-size: 0.95rem;
            background: var(--light);
        }

        .option:hover {
            border-color: var(--primary);
            background: var(--gray-light);
        }

        .option.selected {
            border-color: var(--primary);
            background: var(--gray-light);
        }

        .option.correct {
            border-color: var(--success);
            background: rgba(74, 222, 128, 0.1);
        }

        .option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .option-letter {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 4px;
            background: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--danger);
            color: white;
        }

        .explanation-toggle {
            color: var(--primary);
            background: none;
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .explanation-toggle:hover {
            color: var(--primary-dark);
        }

        .explanation {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--gray-light);
            border-radius: var(--border-radius);
            display: none;
            animation: slideDown 0.3s ease;
        }

        .explanation.show {
            display: block;
        }

        .explanation-section {
            margin-bottom: 0.75rem;
        }

        .explanation-section h4 {
            margin-bottom: 0.5rem;
            color: var(--primary);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .why-not-item {
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .why-not-letter {
            font-weight: 600;
            color: var(--primary);
            min-width: 1.5rem;
        }

        /* Sidebar Styles */
        .sidebar {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 1rem;
            height: fit-content;
            transition: var(--transition);
            order: -1;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
            position: fixed;
            top: 0;
            right: -100%;
            height: 100%;
            width: 80%;
            max-width: 300px;
            z-index: 1000;
            transition: right 0.3s ease;
            box-shadow: var(--shadow-lg);
            padding-top: 3rem;
        }

        .sidebar.active {
            right: 0;
        }

        .sidebar::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: var(--gray-light);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--primary);
        }

        /* Menu Toggle */
        .menu-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 1001;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-toggle:hover {
            background: var(--primary-dark);
        }

        .hamburger {
            width: 18px;
            height: 14px;
            position: relative;
            transition: 0.3s ease;
        }

        .hamburger span {
            display: block;
            position: absolute;
            height: 2px;
            width: 100%;
            background: white;
            border-radius: 2px;
            transition: 0.2s ease;
        }

        .hamburger span:nth-child(1) {
            top: 0;
        }

        .hamburger span:nth-child(2) {
            top: 6px;
        }

        .hamburger span:nth-child(3) {
            top: 12px;
        }

        .hamburger.active span:nth-child(1) {
            top: 6px;
            transform: rotate(135deg);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
            left: -40px;
        }

        .hamburger.active span:nth-child(3) {
            top: 6px;
            transform: rotate(-135deg);
        }

        .progress-container {
            margin-bottom: 1rem;
            background: var(--light);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-light);
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .progress-bar {
            height: 6px;
            background: var(--gray-light);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        .navigation-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            flex: 1;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--gray-light);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .question-jump, .category-jump {
            margin-bottom: 1rem;
            background: var(--light);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-light);
        }

        .question-jump-header, .category-jump-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem 0;
        }

        .question-jump-header h3, .category-jump-header h3 {
            margin-bottom: 0;
            font-size: 1rem;
            font-weight: 500;
        }

        .question-jump-header i, .category-jump-header i {
            transition: var(--transition);
            color: var(--gray);
        }

        .question-jump-content, .category-jump-content {
            margin-top: 0.5rem;
            transition: var(--transition);
            overflow: hidden;
        }

        .question-jump-content.collapsed, .category-jump-content.collapsed {
            display: none;
        }

        .question-jump-content.expanded, .category-jump-content.expanded {
            display: block;
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(2rem, 1fr));
            gap: 0.5rem;
        }

        .question-indicator {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            background: var(--gray-light);
            font-size: 0.8rem;
        }

        .question-indicator:hover {
            background: var(--primary);
            color: white;
        }

        .question-indicator.answered {
            background: var(--primary);
            color: white;
        }

        .question-indicator.current {
            border: 2px solid var(--primary);
        }

        .category-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .category-item {
            padding: 0.5rem;
            background: var(--gray-light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .category-item:hover {
            background: var(--primary);
            color: white;
        }

        .timer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 0.9rem;
            background: var(--gray-light);
            margin-bottom: 0.75rem;
        }

        .timer i {
            color: var(--warning);
        }

        .results-container {
            text-align: center;
            padding: 1.5rem;
            background: var(--light);
            border-radius: var(--border-radius);
            margin-top: 1rem;
            display: none;
            box-shadow: var(--shadow);
        }

        .results-container.show {
            display: block;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: conic-gradient(var(--primary) 0% var(--p, 0%), var(--gray-light) var(--p, 0%) 100%);
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--light);
        }

        .score-text {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .score-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .results-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
        }

        @media (max-width: 600px) {
            .results-details {
                grid-template-columns: 1fr;
            }
        }

        .result-card {
            padding: 0.75rem;
            border-radius: var(--border-radius);
            background: var(--gray-light);
            transition: var(--transition);
        }

        .result-card i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .learn-progress {
            margin-bottom: 1rem;
            background: var(--light);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-light);
            display: none;
        }

        .learn-progress.show {
            display: block;
        }

        .learn-progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .quality-rate {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .quality-stars {
            display: flex;
            gap: 0.25rem;
        }

        .quality-stars i {
            color: var(--warning);
        }

        .learn-mode-container {
            display: none;
            text-align: center;
            padding: 1.5rem;
            background: var(--light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        .learn-mode-container.show {
            display: block;
        }

        .learn-question {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--dark);
            line-height: 1.4;
        }

        .learn-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        @media (min-width: 768px) {
            .learn-options {
                grid-template-columns: 1fr 1fr;
            }
        }

        .learn-option {
            padding: 0.75rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            font-size: 0.95rem;
            background: var(--light);
        }

        .learn-option:hover {
            border-color: var(--primary);
            background: var(--gray-light);
        }

        .learn-option.selected {
            border-color: var(--primary);
            background: var(--gray-light);
        }

        .learn-option.correct {
            border-color: var(--success);
            background: rgba(74, 222, 128, 0.1);
        }

        .learn-option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .learn-option-letter {
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 4px;
            background: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .learn-option.selected .learn-option-letter {
            background: var(--primary);
            color: white;
        }

        .learn-option.correct .learn-option-letter {
            background: var(--success);
            color: white;
        }

        .learn-option.incorrect .learn-option-letter {
            background: var(--danger);
            color: white;
        }

        .learn-next-btn {
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .learn-completion {
            text-align: center;
            padding: 1.5rem;
            display: none;
        }

        .learn-completion.show {
            display: block;
        }

        .completion-icon {
            font-size: 3rem;
            color: var(--success);
            margin-bottom: 0.75rem;
        }

        .floating-controls {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: row;
            gap: 0.5rem;
            z-index: 1000;
        }

        .floating-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-btn:hover {
            background: var(--primary-dark);
        }

        .mode-indicator {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 0.5rem;
            background: var(--gray-light);
            color: var(--primary);
        }

        .quiz-mode {
            background: var(--gray-light);
            color: var(--primary);
        }

        .exam-mode {
            background: var(--gray-light);
            color: var(--secondary);
        }

        .learn-mode {
            background: var(--gray-light);
            color: var(--success);
        }

        .flashcard-mode {
            background: var(--gray-light);
            color: var(--warning);
        }

        .flashcard-mode-container {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem;
            background: var(--light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        .flashcard-mode-container.show {
            display: flex;
        }

        .flashcard-categories {
            display: flex;
            overflow-x: auto;
            gap: 0.5rem;
            margin-bottom: 1rem;
            width: 100%;
            padding: 0.5rem 0;
        }

        .flashcard-category {
            padding: 0.5rem 1rem;
            background: var(--gray-light);
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .flashcard-category.active {
            background: var(--primary);
            color: white;
        }

        .flashcard-category:hover {
            background: var(--primary);
            color: white;
        }

        .flashcard-wrapper {
            width: 100%;
            max-width: 500px;
            height: 300px;
            margin-bottom: 1rem;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.5s;
            transform-style: preserve-3d;
            cursor: pointer;
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            background: var(--light);
            border-radius: var(--border-radius);
            overflow-y: auto;
        }

        .flashcard-back {
            transform: rotateY(180deg);
            background: var(--primary);
            color: white;
        }

        .flashcard-question {
            font-size: 1.25rem;
            font-weight: 500;
            text-align: center;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .flashcard-answer {
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
            margin-bottom: 0.75rem;
        }

        .flashcard-explanation {
            font-size: 0.95rem;
            text-align: center;
            line-height: 1.4;
        }

        .flashcard-controls {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            max-width: 500px;
        }

        .flashcard-controls .btn {
            padding: 0.5rem;
            font-size: 0.9rem;
            min-width: 50px;
        }

        .flashcard-controls .btn i {
            font-size: 1rem;
        }

        .flashcard-stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .flashcard-progress {
            margin-bottom: 1rem;
            background: var(--light);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-light);
            display: none;
            width: 100%;
            max-width: 500px;
        }

        .flashcard-progress.show {
            display: block;
        }

        .flashcard-progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .flashcard-completion {
            text-align: center;
            padding: 1.5rem;
            display: none;
        }

        .flashcard-completion.show {
            display: block;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            padding: 0.75rem 1rem;
            background: var(--light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 2000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast i {
            font-size: 1rem;
        }

        .toast.success i {
            color: var(--success);
        }

        .toast.error i {
            color: var(--danger);
        }

        .toast.info i {
            color: var(--primary);
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 800px; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }
            header {
                padding: 1rem;
            }
            h1 {
                font-size: 1.75rem;
            }
            .questions-container {
                padding: 1rem;
            }
            .question-text {
                font-size: 1rem;
            }
            .option {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            .question-header {
                gap: 0.5rem;
            }
            .question-number {
                width: 1.75rem;
                height: 1.75rem;
                font-size: 0.9rem;
            }
            .learn-question {
                font-size: 1.1rem;
            }
            .learn-option {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            .flashcard-wrapper {
                height: 250px;
            }
            .flashcard-question {
                font-size: 1.1rem;
            }
            .flashcard-answer {
                font-size: 1rem;
            }
            .flashcard-explanation {
                font-size: 0.9rem;
            }
            .flashcard-controls .btn {
                min-width: 40px;
                padding: 0.4rem;
                font-size: 0.8rem;
            }
            .flashcard-controls .btn i {
                font-size: 0.9rem;
            }
            .registration-form {
                padding: 1.25rem;
                width: 95%;
            }
            .form-group label {
                font-size: 0.85rem;
            }
            .form-control {
                font-size: 0.95rem;
                padding: 0.65rem;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }
            .subtitle {
                font-size: 0.85rem;
            }
            .info-card {
                font-size: 0.8rem;
                padding: 0.4rem 0.75rem;
            }
            .question-text {
                font-size: 0.95rem;
            }
            .option {
                font-size: 0.85rem;
            }
            .learn-question {
                font-size: 1rem;
            }
            .learn-option {
                font-size: 0.85rem;
            }
            .flashcard-wrapper {
                height: 220px;
            }
            .flashcard-question {
                font-size: 1rem;
            }
            .flashcard-answer {
                font-size: 0.95rem;
            }
            .flashcard-explanation {
                font-size: 0.85rem;
            }
            .flashcard-controls .btn {
                min-width: 35px;
                padding: 0.3rem;
                font-size: 0.75rem;
            }
            .flashcard-controls .btn i {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Registration Modal -->
    <div class="registration-modal" id="registrationModal">
        <div class="registration-form">
            <h2>Welcome to MedQUIZ</h2>
            <p style="text-align: center; margin-bottom: 1rem; color: var(--gray); font-size: 0.9rem;">Please register to start your medical quiz</p>
            <form id="registrationForm">
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" class="form-control" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="telegramUsername">Telegram Username</label>
                    <input type="text" id="telegramUsername" class="form-control" required placeholder="@username">
                </div>
                <button type="submit" class="btn-submit">Start Quiz</button>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Notification sent successfully</span>
    </div>

    <div class="container blurred-content" id="mainContainer">
        <header>
            <h1>MedQUIZ <span class="mode-indicator quiz-mode" id="modeIndicator">Quiz Mode</span></h1>
            <p class="subtitle">Test your medical knowledge with interactive, adaptive quizzes powered by advanced physiology insights.</p>
            <div class="mode-selector">
                <div class="mode-btn active" data-mode="quiz">Quiz Mode</div>
                <div class="mode-btn" data-mode="exam">Exam Mode</div>
                <div class="mode-btn" data-mode="learn">Learn Mode</div>
                <div class="mode-btn" data-mode="flashcard">Flashcard Mode</div>
            </div>
            <div class="quiz-info">
                <div class="info-card">
                    <i class="fas fa-book-medical"></i>
                    <span id="questionCount">3 Questions</span>
                </div>
                <div class="info-card">
                    <i class="fas fa-clock"></i>
                    <span id="timeInfo">10 Minutes</span>
                </div>
                <div class="info-card">
                    <i class="fas fa-brain"></i>
                    <span>Advanced Level</span>
                </div>
            </div>
        </header>
       
        <button class="menu-toggle" id="menuToggleBtn">
            <div class="hamburger" id="hamburgerIcon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
       
        <div class="content-wrapper">
            <div class="learn-mode-container" id="learnModeContainer">
                <div class="learn-question" id="learnQuestionText"></div>
                <div class="learn-options" id="learnOptionsContainer"></div>
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="learnPrevBtn">
                        <i class="fas fa-arrow-left"></i> Prev
                    </button>
                    <button class="btn btn-primary" id="learnNextBtn" disabled>
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <div class="learn-completion" id="learnCompletion">
                    <div class="completion-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>Learning Complete!</h2>
                    <p>You've successfully answered all questions correctly.</p>
                    <button class="btn btn-outline" id="learnRestartBtn" style="margin-top: 1rem;">
                        <i class="fas fa-redo"></i> Practice Again
                    </button>
                </div>
            </div>
           
            <div class="questions-container" id="questionsContainer"></div>
            <div class="flashcard-mode-container" id="flashcardModeContainer">
                <div class="flashcard-progress" id="flashcardProgress">
                    <div class="flashcard-progress-text">
                        <span>Flashcard Progress</span>
                        <span id="flashcardProgressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="flashcardProgressFill"></div>
                    </div>
                </div>
                <div class="flashcard-categories" id="flashcardCategories"></div>
                <div class="flashcard-stats">
                    <span id="flashcardRemaining">Remaining: 0</span>
                    <span id="flashcardKnown">Known: 0</span>
                    <span id="flashcardTotal">Total: 0</span>
                </div>
                <div class="flashcard-wrapper">
                    <div class="flashcard" id="flashcard">
                        <div class="flashcard-front">
                            <div class="flashcard-question" id="flashcardQuestion"></div>
                            <i class="fas fa-sync-alt" style="position: absolute; bottom: 0.75rem; font-size: 0.9rem; color: var(--gray);">Tap to flip</i>
                        </div>
                        <div class="flashcard-back">
                            <div class="flashcard-answer" id="flashcardAnswer"></div>
                            <div class="flashcard-explanation" id="flashcardExplanation"></div>
                        </div>
                    </div>
                </div>
                <div class="flashcard-controls">
                    <button class="btn btn-outline" id="flashcardPrevBtn" title="Previous">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button class="btn btn-primary" id="flashcardNextBtn" title="Next">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="btn btn-outline" id="flashcardShuffleBtn" title="Shuffle">
                        <i class="fas fa-random"></i>
                    </button>
                    <button class="btn btn-success" id="flashcardKnownBtn" title="I Know This">
                        <i class="fas fa-check"></i>
                    </button>
                    <button class="btn btn-danger" id="flashcardUnknownBtn" title="Review Later">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flashcard-completion" id="flashcardCompletion">
                    <div class="completion-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h2>Deck Mastered!</h2>
                    <p>You've reviewed all flashcards.</p>
                    <button class="btn btn-outline" id="flashcardRestartBtn" style="margin-top: 1rem;">
                        <i class="fas fa-redo"></i> Restart Deck
                    </button>
                </div>
            </div>
           
            <div class="sidebar" id="sidebar">
                <div class="learn-progress" id="learnProgress">
                    <div class="learn-progress-text">
                        <span>Learning Progress</span>
                        <span id="learnProgressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="learnProgressFill"></div>
                    </div>
                    <div class="quality-rate">
                        <span>Quality:</span>
                        <div class="quality-stars" id="qualityStars">
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                    </div>
                </div>
               
                <div class="progress-container" id="progressContainer">
                    <div class="progress-text">
                        <span>Progress</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
               
                <div class="navigation-buttons">
                    <button class="btn btn-outline" id="prevBtn">
                        <i class="fas fa-arrow-left"></i> Prev
                    </button>
                    <button class="btn btn-primary" id="nextBtn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
               
                <div class="category-jump">
                    <div class="category-jump-header" id="categoryJumpToggle">
                        <h3>Jump to Category</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="category-jump-content expanded" id="categoryJumpContent">
                        <div class="category-list" id="categoryList"></div>
                    </div>
                </div>
               
                <div class="question-jump">
                    <div class="question-jump-header" id="jumpToggle">
                        <h3>Jump to Question</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="question-jump-content expanded" id="jumpContent">
                        <div class="question-grid" id="questionIndicators"></div>
                    </div>
                </div>
               
                <div class="timer">
                    <i class="fas fa-clock"></i>
                    <span id="timeDisplay">10:00</span>
                </div>
               
                <button class="btn btn-primary" id="submitBtn" style="width: 100%;">
                    <i class="fas fa-check"></i> Submit
                </button>
            </div>
        </div>
       
        <div class="results-container" id="resultsContainer">
            <h2>Results</h2>
            <p>Your performance summary</p>
            <div class="score-circle" id="scoreCircle">
                <div class="score-text">
                    <div class="score-value" id="scoreValue">0%</div>
                    <div class="score-label">Correct</div>
                </div>
            </div>
            <div class="results-details">
                <div class="result-card">
                    <i class="fas fa-check-circle"></i>
                    <div class="result-value" id="correctCount">0</div>
                    <div>Correct</div>
                </div>
                <div class="result-card">
                    <i class="fas fa-times-circle"></i>
                    <div class="result-value" id="incorrectCount">0</div>
                    <div>Incorrect</div>
                </div>
                <div class="result-card">
                    <i class="fas fa-clock"></i>
                    <div class="result-value" id="timeTaken">0:00</div>
                    <div>Time Taken</div>
                </div>
            </div>
            <button class="btn btn-outline" id="restartBtn" style="margin-top: 1rem;">
                <i class="fas fa-redo"></i> Retake
            </button>
        </div>
    </div>
   
    <div class="floating-controls" id="floatingControls">
        <button class="floating-btn" id="scrollTopBtn" title="Scroll to top">
            <i class="fas fa-arrow-up"></i>
        </button>
        <button class="floating-btn" id="themeToggleBtn" title="Toggle theme">
            <i class="fas fa-moon"></i>
        </button>
        <button class="floating-btn" id="submitFloatingBtn" title="Submit">
            <i class="fas fa-check"></i>
        </button>
    </div>

    <script>
        // Telegram Bot Configuration
        const TELEGRAM_BOT_TOKEN = '8099057930:AAFXRiaWc2CV-zr-I22fSV2wQOFVww6zBHI';
        const TELEGRAM_CHAT_ID = '7897840965';
        
        // User data
        let userData = {
            fullName: '',
            telegramUsername: '',
            registrationTime: null
        };
        
        // Mode tracking
        let modeUsage = {
            quiz: { startTime: null, duration: 0 },
            exam: { startTime: null, duration: 0 },
            learn: { startTime: null, duration: 0 },
            flashcard: { startTime: null, duration: 0 }
        };
        
        // Quiz data
        const quizData = [
            {
                "id": 1,
                "question": "What is the defining physical property that distinguishes an oil from a fat?",
                "options": [
                    "Its chemical structure as an ester",
                    "Its solubility in organic solvents",
                    "Its state as a liquid at ordinary temperature",
                    "Its origin from plant sources"
                ],
                "answer": 2,
                "correctAnswer": "Its state as a liquid at ordinary temperature",
                "explanation": "Oils and fats are both triacylglycerols, but oils are liquid at room temperature due to a higher proportion of unsaturated fatty acids, which introduce kinks and lower melting points. Fats are solid due to more saturated fatty acids, allowing tighter packing.",
                "whyNotOtherOptions": {
                    "a": "Both fats and oils are esters of glycerol and fatty acids, so this is not a distinguishing property.",
                    "b": "Both fats and oils are soluble in organic solvents like chloroform due to their hydrophobic nature.",
                    "d": "Origin (plant or animal) does not determine the physical state; both can be oils or fats."
                },
                "relatedQuestions": ["12 (fatty acid melting points)", "18 (unsaturated fatty acids)"],
                "category": "Lipid Biochemistry",
                "difficulty": "Hard"
            },
            {
                "id": 2,
                "question": "Which of the following is NOT a general property of lipids?",
                "options": [
                    "Relatively insoluble in water",
                    "Polymers of repeating monomer units",
                    "Soluble in organic solvents like chloroform",
                    "Include fats, oils, and waxes"
                ],
                "answer": 1,
                "correctAnswer": "Polymers of repeating monomer units",
                "explanation": "Lipids are diverse, small molecules (e.g., fats, oils, waxes) that are not polymers. They are characterized by hydrophobicity, insolubility in water, and solubility in organic solvents like chloroform.",
                "whyNotOtherOptions": {
                    "a": "Lipids are hydrophobic, making them relatively insoluble in water.",
                    "c": "Lipids dissolve readily in organic solvents due to their non-polar nature.",
                    "d": "Fats, oils, and waxes are classic examples of lipids."
                },
                "relatedQuestions": ["1 (oil vs. fat)", "6 (simple lipids)"],
                "category": "Lipid Biochemistry",
                "difficulty": "Hard"
            },
            {
                "id": 3,
                "question": "The primary biological function of triacylglycerols is:",
                "options": [
                    "To form cell membranes",
                    "To act as chemical messengers",
                    "To store energy",
                    "To emulsify fats"
                ],
                "answer": 2,
                "correctAnswer": "To store energy",
                "explanation": "Triacylglycerols, stored in adipose tissue, are the body's primary energy storage molecules, yielding approximately 9 kcal/g when metabolized via beta-oxidation.",
                "whyNotOtherOptions": {
                    "a": "Cell membranes are primarily formed by phospholipids, not triacylglycerols.",
                    "b": "Chemical messengers include eicosanoids or hormones, not triacylglycerols.",
                    "d": "Emulsification is a function of bile salts in digestion."
                },
                "relatedQuestions": ["24 (triacylglycerol hydrolysis)", "36 (chylomicrons)"],
                "category": "Lipid Metabolism",
                "difficulty": "Hard"
            }
        ];

        // DOM Elements
        const registrationModal = document.getElementById('registrationModal');
        const registrationForm = document.getElementById('registrationForm');
        const mainContainer = document.getElementById('mainContainer');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const questionsContainer = document.getElementById('questionsContainer');
        const questionIndicators = document.getElementById('questionIndicators');
        const progressFill = document.getElementById('progressFill');
        const progressPercent = document.getElementById('progressPercent');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const resultsContainer = document.getElementById('resultsContainer');
        const scoreValue = document.getElementById('scoreValue');
        const correctCount = document.getElementById('correctCount');
        const incorrectCount = document.getElementById('incorrectCount');
        const timeTaken = document.getElementById('timeTaken');
        const scoreCircle = document.getElementById('scoreCircle');
        const restartBtn = document.getElementById('restartBtn');
        const scrollTopBtn = document.getElementById('scrollTopBtn');
        const themeToggleBtn = document.getElementById('themeToggleBtn');
        const timeDisplay = document.getElementById('timeDisplay');
        const modeIndicator = document.getElementById('modeIndicator');
        const modeButtons = document.querySelectorAll('.mode-btn');
        const jumpToggle = document.getElementById('jumpToggle');
        const jumpContent = document.getElementById('jumpContent');
        const categoryJumpToggle = document.getElementById('categoryJumpToggle');
        const categoryJumpContent = document.getElementById('categoryJumpContent');
        const categoryList = document.getElementById('categoryList');
        const menuToggleBtn = document.getElementById('menuToggleBtn');
        const hamburgerIcon = document.getElementById('hamburgerIcon');
        const sidebar = document.getElementById('sidebar');
        const questionCount = document.getElementById('questionCount');
        const timeInfo = document.getElementById('timeInfo');
        const progressContainer = document.getElementById('progressContainer');
        const floatingControls = document.getElementById('floatingControls');
        const submitFloatingBtn = document.getElementById('submitFloatingBtn');
        const learnModeContainer = document.getElementById('learnModeContainer');
        const learnQuestionText = document.getElementById('learnQuestionText');
        const learnOptionsContainer = document.getElementById('learnOptionsContainer');
        const learnNextBtn = document.getElementById('learnNextBtn');
        const learnPrevBtn = document.getElementById('learnPrevBtn');
        const learnProgress = document.getElementById('learnProgress');
        const learnProgressFill = document.getElementById('learnProgressFill');
        const learnProgressPercent = document.getElementById('learnProgressPercent');
        const qualityStars = document.getElementById('qualityStars');
        const learnCompletion = document.getElementById('learnCompletion');
        const learnRestartBtn = document.getElementById('learnRestartBtn');
        const flashcardModeContainer = document.getElementById('flashcardModeContainer');
        const flashcardCategories = document.getElementById('flashcardCategories');
        const flashcard = document.getElementById('flashcard');
        const flashcardQuestion = document.getElementById('flashcardQuestion');
        const flashcardAnswer = document.getElementById('flashcardAnswer');
        const flashcardExplanation = document.getElementById('flashcardExplanation');
        const flashcardPrevBtn = document.getElementById('flashcardPrevBtn');
        const flashcardNextBtn = document.getElementById('flashcardNextBtn');
        const flashcardShuffleBtn = document.getElementById('flashcardShuffleBtn');
        const flashcardKnownBtn = document.getElementById('flashcardKnownBtn');
        const flashcardUnknownBtn = document.getElementById('flashcardUnknownBtn');
        const flashcardRemaining = document.getElementById('flashcardRemaining');
        const flashcardKnown = document.getElementById('flashcardKnown');
        const flashcardTotal = document.getElementById('flashcardTotal');
        const flashcardProgress = document.getElementById('flashcardProgress');
        const flashcardProgressFill = document.getElementById('flashcardProgressFill');
        const flashcardProgressPercent = document.getElementById('flashcardProgressPercent');
        const flashcardCompletion = document.getElementById('flashcardCompletion');
        const flashcardRestartBtn = document.getElementById('flashcardRestartBtn');

        // Quiz state variables
        let currentQuestion = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let quizSubmitted = false;
        let startTime = new Date();
        let timerInterval;
        let currentMode = 'quiz';
        let learnQuestions = [...quizData];
        let currentLearnQuestion = 0;
        let learnAnsweredQuestions = [];
        let learnCorrectAnswers = 0;
        let learnTotalAttempts = 0;
        let learnQualityScore = 0;
        let flashcardDeck = [...quizData];
        let originalFlashcardDeck = [...quizData];
        let currentFlashcardIndex = 0;
        let knownCards = 0;
        let spacedRepetitionQueue = [];
        let isFlipped = false;
        let currentCategory = 'All';

        // Initialize the application
        function initApp() {
            // Check if user is already registered
            const savedUserData = localStorage.getItem('medquiz_user');
            if (savedUserData) {
                userData = JSON.parse(savedUserData);
                showMainContent();
            } else {
                showRegistrationModal();
            }

            // Set up event listeners for registration form
            registrationForm.addEventListener('submit', handleRegistration);
        }

        // Show registration modal
        function showRegistrationModal() {
            registrationModal.style.display = 'flex';
            mainContainer.classList.add('blurred-content');
        }

        // Show main content after registration
        function showMainContent() {
            registrationModal.style.display = 'none';
            mainContainer.classList.remove('blurred-content');
            initQuiz();
            
            // Send registration notification to Telegram
            sendTelegramNotification(
                ` New Registration\n` +
                ` Name: ${userData.fullName}\n` +
                ` Telegram: ${userData.telegramUsername}\n` +
                ` Registered at: ${new Date(userData.registrationTime).toLocaleString()}`
            );
        }

        // Handle registration form submission
        function handleRegistration(e) {
            e.preventDefault();
            
            // Get form data
            userData = {
                fullName: document.getElementById('fullName').value,
                telegramUsername: document.getElementById('telegramUsername').value,
                registrationTime: new Date().toISOString()
            };
            
            // Save to localStorage
            localStorage.setItem('medquiz_user', JSON.stringify(userData));
            
            // Show main content
            showMainContent();
            
            // Show success toast
            showToast('Registration successful! Welcome to MedQUIZ.', 'success');
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type);
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Send notification to Telegram
        async function sendTelegramNotification(message) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to send notification');
                }
                
                console.log('Notification sent successfully');
            } catch (error) {
                console.error('Error sending notification:', error);
            }
        }

        // Track mode usage
        function trackModeUsage(mode, action) {
            if (action === 'start') {
                modeUsage[mode].startTime = new Date();
            } else if (action === 'end' && modeUsage[mode].startTime) {
                const duration = Math.round((new Date() - modeUsage[mode].startTime) / 1000);
                modeUsage[mode].duration += duration;
                modeUsage[mode].startTime = null;
                
                // Send mode usage to Telegram
                sendTelegramNotification(
                    ` Mode Usage - ${userData.fullName}\n` +
                    ` Mode: ${mode}\n` +
                    ` Duration: ${formatTime(duration)}\n` +
                    ` Total time in ${mode} mode: ${formatTime(modeUsage[mode].duration)}`
                );
            }
        }

        // Format time in seconds to MM:SS
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Initialize quiz functionality
        function initQuiz() {
            updateQuizInfo();
            renderQuestions();
            renderQuestionIndicators();
            renderCategoryList();
            updateProgress();
            startTimer();
           
            jumpToggle.addEventListener('click', () => {
                toggleCollapsible(jumpContent, jumpToggle);
            });
           
            categoryJumpToggle.addEventListener('click', () => {
                toggleCollapsible(categoryJumpContent, categoryJumpToggle);
            });
           
            menuToggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                hamburgerIcon.classList.toggle('active');
                menuToggleBtn.classList.toggle('active');
            });
           
            document.addEventListener('click', (e) => {
                if (sidebar.classList.contains('active')) {
                    if (!sidebar.contains(e.target) && !menuToggleBtn.contains(e.target)) {
                        sidebar.classList.remove('active');
                        hamburgerIcon.classList.remove('active');
                        menuToggleBtn.classList.remove('active');
                    }
                }
            });
           
            let touchTimeout;
            document.addEventListener('touchstart', (e) => {
                if (!floatingControls.contains(e.target) && !menuToggleBtn.contains(e.target) && !sidebar.contains(e.target)) {
                    floatingControls.classList.add('visible');
                    clearTimeout(touchTimeout);
                    touchTimeout = setTimeout(() => {
                        floatingControls.classList.remove('visible');
                    }, 3000);
                }
            });
            prevBtn.addEventListener('click', goToPreviousQuestion);
            nextBtn.addEventListener('click', goToNextQuestion);
            submitBtn.addEventListener('click', submitQuiz);
            restartBtn.addEventListener('click', restartQuiz);
            scrollTopBtn.addEventListener('click', scrollToTop);
            themeToggleBtn.addEventListener('click', toggleTheme);
            learnNextBtn.addEventListener('click', goToNextLearnQuestion);
            learnPrevBtn.addEventListener('click', goToPrevLearnQuestion);
            learnRestartBtn.addEventListener('click', restartLearnMode);
            submitFloatingBtn.addEventListener('click', submitQuiz);
           
            modeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Track mode change
                    if (currentMode !== btn.dataset.mode) {
                        trackModeUsage(currentMode, 'end');
                        trackModeUsage(btn.dataset.mode, 'start');
                    }
                    
                    modeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentMode = btn.dataset.mode;
                    updateModeIndicator();
                    if (currentMode === 'learn') {
                        startLearnMode();
                    } else if (currentMode === 'flashcard') {
                        startFlashcardMode();
                    } else {
                        restartQuiz();
                    }
                });
            });
           
            document.addEventListener('keydown', handleKeyNavigation);
        }

        function toggleCollapsible(content, toggle) {
            const isExpanded = content.classList.contains('expanded');
            if (isExpanded) {
                content.classList.remove('expanded');
                content.classList.add('collapsed');
                toggle.querySelector('i').classList.remove('fa-chevron-up');
                toggle.querySelector('i').classList.add('fa-chevron-down');
            } else {
                content.classList.remove('collapsed');
                content.classList.add('expanded');
                toggle.querySelector('i').classList.remove('fa-chevron-down');
                toggle.querySelector('i').classList.add('fa-chevron-up');
            }
        }

        function updateQuizInfo() {
            questionCount.textContent = `${quizData.length} Questions`;
            timeInfo.textContent = currentMode === 'exam' ? `${quizData.length * 2} Minutes` : 'Unlimited';
        }

        function updateModeIndicator() {
            modeIndicator.textContent = currentMode === 'quiz' ? 'Quiz Mode' :
                                       currentMode === 'exam' ? 'Exam Mode' :
                                       currentMode === 'learn' ? 'Learn Mode' : 'Flashcard Mode';
            modeIndicator.className = 'mode-indicator ' +
                                     (currentMode === 'quiz' ? 'quiz-mode' :
                                      currentMode === 'exam' ? 'exam-mode' :
                                      currentMode === 'learn' ? 'learn-mode' : 'flashcard-mode');
        }

        function renderQuestions() {
            questionsContainer.innerHTML = '';
            quizData.forEach((questionData, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'question-section';
                questionElement.id = `question-${index}`;
                questionElement.innerHTML = `
                    <div class="question-header">
                        <div class="question-number">${index + 1}</div>
                        <div class="question-text">${questionData.question}</div>
                    </div>
                    <div class="options-container">
                        ${questionData.options.map((option, optionIndex) =>
                            `<div class="option" data-question="${index}" data-option="${optionIndex}">
                                <div class="option-letter">${String.fromCharCode(65 + optionIndex)}</div>
                                <div class="option-text">${option}</div>
                            </div>`
                        ).join('')}
                    </div>
                    <button class="explanation-toggle" disabled>
                        <i class="fas fa-lightbulb"></i> Show Explanation
                    </button>
                    <div class="explanation">
                        <div class="explanation-section">
                            <h4>Correct Answer</h4>
                            <p>${questionData.correctAnswer}</p>
                        </div>
                        <div class="explanation-section">
                            <h4>Detailed Explanation</h4>
                            <p>${questionData.explanation}</p>
                        </div>
                        <div class="explanation-section">
                            <h4>Why Others Are Incorrect</h4>
                            ${Object.entries(questionData.whyNotOtherOptions).map(([letter, reason]) =>
                                `<div class="why-not-item">
                                    <span class="why-not-letter">${letter.toUpperCase()}:</span>
                                    <span>${reason}</span>
                                </div>`
                            ).join('')}
                        </div>
                    </div>
                `;
                questionsContainer.appendChild(questionElement);
                const options = questionElement.querySelectorAll('.option');
                options.forEach(option => {
                    option.addEventListener('click', () => selectOption(option));
                });
                const explanationToggle = questionElement.querySelector('.explanation-toggle');
                const explanation = questionElement.querySelector('.explanation');
                explanationToggle.addEventListener('click', () => {
                    if (explanation.classList.contains('show')) {
                        explanation.classList.remove('show');
                        explanationToggle.innerHTML = '<i class="fas fa-lightbulb"></i> Show Explanation';
                    } else {
                        explanation.classList.add('show');
                        explanationToggle.innerHTML = '<i class="fas fa-lightbulb"></i> Hide Explanation';
                    }
                });
            });
            highlightCurrentQuestion();
        }

        function renderQuestionIndicators() {
            questionIndicators.innerHTML = '';
            quizData.forEach((_, index) => {
                const indicator = document.createElement('div');
                indicator.className = 'question-indicator';
                if (index === 0) indicator.classList.add('current');
                indicator.innerHTML = `<span>${index + 1}</span>`;
                indicator.addEventListener('click', () => jumpToQuestion(index));
                questionIndicators.appendChild(indicator);
            });
        }

        function renderCategoryList() {
            const categories = [...new Set(quizData.map(q => q.category))];
            categoryList.innerHTML = '';
            categories.forEach(category => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.textContent = category;
                categoryItem.addEventListener('click', () => jumpToCategory(category));
                categoryList.appendChild(categoryItem);
            });
        }

        function jumpToCategory(category) {
            const questionIndex = quizData.findIndex(q => q.category === category);
            if (questionIndex !== -1) {
                jumpToQuestion(questionIndex);
            }
        }

        function selectOption(optionElement) {
            if (quizSubmitted) return;
            const questionIndex = parseInt(optionElement.dataset.question);
            const optionIndex = parseInt(optionElement.dataset.option);
            const questionData = quizData[questionIndex];
            const options = document.querySelectorAll(`.option[data-question="${questionIndex}"]`);
            const explanationToggle = document.querySelector(`#question-${questionIndex} .explanation-toggle`);
            if (currentMode === 'quiz' && userAnswers[questionIndex] !== null) {
                return;
            }
            options.forEach(opt => opt.classList.remove('selected'));
            optionElement.classList.add('selected');
            userAnswers[questionIndex] = optionIndex;
            updateQuestionIndicator(questionIndex, true);
            updateProgress();
            if (currentMode === 'quiz') {
                options.forEach((opt, idx) => {
                    if (idx === questionData.answer) {
                        opt.classList.add('correct');
                    } else if (idx === optionIndex && optionIndex !== questionData.answer) {
                        opt.classList.add('incorrect');
                    }
                    opt.style.pointerEvents = 'none';
                });
                explanationToggle.disabled = false;
            }
        }

        function updateQuestionIndicator(index, answered) {
            const indicators = document.querySelectorAll('.question-indicator');
            if (indicators[index]) {
                if (answered) {
                    indicators[index].classList.add('answered');
                } else {
                    indicators[index].classList.remove('answered');
                }
                indicators.forEach(ind => ind.classList.remove('current'));
                indicators[currentQuestion].classList.add('current');
            }
        }

        function updateProgress() {
            const answeredCount = userAnswers.filter(answer => answer !== null).length;
            const progress = (answeredCount / quizData.length) * 100;
            progressFill.style.width = `${progress}%`;
            progressPercent.textContent = `${Math.round(progress)}%`;
        }

        function goToPreviousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                highlightCurrentQuestion();
            }
        }

        function goToNextQuestion() {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                highlightCurrentQuestion();
            }
        }

        function jumpToQuestion(index) {
            currentQuestion = index;
            highlightCurrentQuestion();
            sidebar.classList.remove('active');
            hamburgerIcon.classList.remove('active');
            menuToggleBtn.classList.remove('active');
        }

        function highlightCurrentQuestion() {
            document.querySelectorAll('.question-section').forEach(card => {
                card.classList.remove('current');
            });
            const currentQuestionElement = document.getElementById(`question-${currentQuestion}`);
            if (currentQuestionElement) {
                currentQuestionElement.classList.add('current');
                currentQuestionElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            document.querySelectorAll('.question-indicator').forEach((indicator, index) => {
                indicator.classList.remove('current');
                if (index === currentQuestion) {
                    indicator.classList.add('current');
                }
            });
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.disabled = currentQuestion === quizData.length - 1;
        }

        function submitQuiz() {
            quizSubmitted = true;
            clearInterval(timerInterval);
            const correctAnswers = userAnswers.filter((answer, index) =>
                answer === quizData[index].answer
            ).length;
            const score = (correctAnswers / quizData.length) * 100;
            showResults(score, correctAnswers);
            
            // Send results to Telegram
            const endTime = new Date();
            const timeDiff = (endTime - startTime) / 1000;
            const minutes = Math.floor(timeDiff / 60);
            const seconds = Math.floor(timeDiff % 60);
            
            sendTelegramNotification(
                ` Quiz Results - ${userData.fullName}\n` +
                ` Mode: ${currentMode}\n` +
                ` Correct: ${correctAnswers}/${quizData.length}\n` +
                ` Score: ${Math.round(score)}%\n` +
                ` Time: ${minutes}:${seconds.toString().padStart(2, '0')}`
            );
        }

        function showResults(score, correctAnswers) {
            scoreValue.textContent = `${Math.round(score)}%`;
            correctCount.textContent = correctAnswers;
            incorrectCount.textContent = quizData.length - correctAnswers;
            const endTime = new Date();
            const timeDiff = (endTime - startTime) / 1000;
            const minutes = Math.floor(timeDiff / 60);
            const seconds = Math.floor(timeDiff % 60);
            timeTaken.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            scoreCircle.style.setProperty('--p', `${score}%`);
            resultsContainer.classList.add('show');
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
            if (currentMode === 'exam') {
                quizData.forEach((questionData, index) => {
                    const options = document.querySelectorAll(`.option[data-question="${index}"]`);
                    const explanationToggle = document.querySelector(`#question-${index} .explanation-toggle`);
                    options.forEach((option, optionIndex) => {
                        if (optionIndex === questionData.answer) {
                            option.classList.add('correct');
                        } else if (optionIndex === userAnswers[index] && userAnswers[index] !== questionData.answer) {
                            option.classList.add('incorrect');
                        }
                        option.style.pointerEvents = 'none';
                    });
                    explanationToggle.disabled = false;
                });
            }
        }

        function restartQuiz() {
            currentQuestion = 0;
            userAnswers = new Array(quizData.length).fill(null);
            quizSubmitted = false;
            resultsContainer.classList.remove('show');
            learnModeContainer.classList.remove('show');
            flashcardModeContainer.classList.remove('show');
            progressContainer.style.display = 'block';
            learnProgress.classList.remove('show');
            flashcardProgress.classList.remove('show');
            renderQuestions();
            renderQuestionIndicators();
            renderCategoryList();
            updateProgress();
            updateQuizInfo();
            [jumpContent, categoryJumpContent].forEach(content => {
                content.classList.remove('collapsed');
                content.classList.add('expanded');
            });
            [jumpToggle, categoryJumpToggle].forEach(toggle => {
                toggle.querySelector('i').classList.remove('fa-chevron-up');
                toggle.querySelector('i').classList.add('fa-chevron-down');
            });
            startTime = new Date();
            startTimer();
            questionsContainer.style.display = 'block';
        }

        function startTimer() {
            clearInterval(timerInterval);
            if (currentMode === 'quiz' || currentMode === 'learn' || currentMode === 'flashcard') {
                timerInterval = setInterval(() => {
                    const currentTime = new Date();
                    const timeElapsed = Math.floor((currentTime - startTime) / 1000);
                    const minutes = Math.floor(timeElapsed / 60);
                    const seconds = timeElapsed % 60;
                    timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            } else {
                const timeLimit = quizData.length * 2 * 60;
                timerInterval = setInterval(() => {
                    const currentTime = new Date();
                    const timeElapsed = Math.floor((currentTime - startTime) / 1000);
                    const timeRemaining = timeLimit - timeElapsed;
                    if (timeRemaining <= 0) {
                        clearInterval(timerInterval);
                        submitQuiz();
                        return;
                    }
                    const minutes = Math.floor(timeRemaining / 60);
                    const seconds = timeRemaining % 60;
                    timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            themeToggleBtn.innerHTML = document.body.classList.contains('dark-theme') ?
                '<i class="fas fa-sun"></i>' :
                '<i class="fas fa-moon"></i>';
        }

        function handleKeyNavigation(e) {
            if (currentMode === 'learn') {
                if (e.key === 'ArrowLeft') {
                    goToPrevLearnQuestion();
                } else if (e.key === 'ArrowRight' && !learnNextBtn.disabled) {
                    goToNextLearnQuestion();
                }
            } else if (currentMode === 'flashcard') {
                if (e.key === 'ArrowLeft') {
                    goToPrevFlashcard();
                } else if (e.key === 'ArrowRight') {
                    goToNextFlashcard();
                } else if (e.key === ' ') {
                    flipFlashcard();
                } else if (e.key === 'k') {
                    markFlashcardKnown();
                } else if (e.key === 'u') {
                    markFlashcardUnknown();
                } else if (e.key === 's') {
                    shuffleFlashcardDeck();
                }
            } else {
                if (e.key === 'ArrowLeft') {
                    goToPreviousQuestion();
                } else if (e.key === 'ArrowRight') {
                    goToNextQuestion();
                } else if (e.key >= '1' && e.key <= '9' && parseInt(e.key) <= quizData.length) {
                    jumpToQuestion(parseInt(e.key) - 1);
                }
            }
        }

        function startLearnMode() {
            learnQuestions = [...quizData];
            currentLearnQuestion = 0;
            learnAnsweredQuestions = [];
            learnCorrectAnswers = 0;
            learnTotalAttempts = 0;
            learnQualityScore = 0;
            questionsContainer.style.display = 'none';
            flashcardModeContainer.classList.remove('show');
            learnModeContainer.classList.add('show');
            progressContainer.style.display = 'none';
            learnProgress.classList.add('show');
            flashcardProgress.classList.remove('show');
            learnCompletion.classList.remove('show');
            updateLearnProgress();
            displayLearnQuestion();
        }

        function displayLearnQuestion() {
            if (learnQuestions.length === 0) {
                showLearnCompletion();
                return;
            }
            const question = learnQuestions[currentLearnQuestion];
            learnQuestionText.textContent = question.question;
            learnOptionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'learn-option';
                optionElement.dataset.option = index;
                optionElement.innerHTML = `
                    <div class="learn-option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="learn-option-text">${option}</div>
                `;
                optionElement.addEventListener('click', () => selectLearnOption(optionElement, question, index));
                learnOptionsContainer.appendChild(optionElement);
            });
            learnNextBtn.disabled = true;
        }

        function selectLearnOption(optionElement, question, optionIndex) {
            if (learnNextBtn.disabled === false) return;
           
            const options = learnOptionsContainer.querySelectorAll('.learn-option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
           
            learnTotalAttempts++;
           
            if (optionIndex === question.answer) {
                optionElement.classList.add('correct');
                learnCorrectAnswers++;
                learnAnsweredQuestions.push(question.id);
               
                // Remove the question from the pool if answered correctly
                learnQuestions.splice(currentLearnQuestion, 1);
            } else {
                optionElement.classList.add('incorrect');
               
                // Highlight the correct answer
                options[question.answer].classList.add('correct');
               
                // Add the question back to the pool if answered incorrectly
                // This ensures it will appear again later
                if (learnQuestions.length > 1) {
                    const incorrectQuestion = learnQuestions.splice(currentLearnQuestion, 1)[0];
                    learnQuestions.push(incorrectQuestion);
                }
            }
           
            learnNextBtn.disabled = false;
            updateLearnProgress();
        }

        function goToNextLearnQuestion() {
            if (learnQuestions.length === 0) {
                showLearnCompletion();
                return;
            }
           
            // Move to the next question (or wrap around)
            currentLearnQuestion = (currentLearnQuestion + 1) % learnQuestions.length;
            displayLearnQuestion();
        }

        function goToPrevLearnQuestion() {
            if (learnQuestions.length === 0) return;
           
            // Move to the previous question (or wrap around)
            currentLearnQuestion = (currentLearnQuestion - 1 + learnQuestions.length) % learnQuestions.length;
            displayLearnQuestion();
        }

        function updateLearnProgress() {
            const progress = ((quizData.length - learnQuestions.length) / quizData.length) * 100;
            learnProgressFill.style.width = `${progress}%`;
            learnProgressPercent.textContent = `${Math.round(progress)}%`;
           
            // Calculate quality score (correct answers / total attempts)
            if (learnTotalAttempts > 0) {
                learnQualityScore = (learnCorrectAnswers / learnTotalAttempts) * 100;
            }
           
            // Update stars based on quality score
            const stars = qualityStars.querySelectorAll('i');
            const filledStars = Math.round((learnQualityScore / 100) * 5);
           
            stars.forEach((star, index) => {
                if (index < filledStars) {
                    star.classList.remove('far');
                    star.classList.add('fas');
                } else {
                    star.classList.remove('fas');
                    star.classList.add('far');
                }
            });
        }

        function showLearnCompletion() {
            learnModeContainer.style.display = 'none';
            learnCompletion.classList.add('show');
        }

        function restartLearnMode() {
            learnCompletion.classList.remove('show');
            startLearnMode();
            learnModeContainer.style.display = 'block';
        }

        // Flashcard Mode Functions
        function startFlashcardMode() {
            originalFlashcardDeck = [...quizData];
            flashcardDeck = [...originalFlashcardDeck];
            currentFlashcardIndex = 0;
            knownCards = 0;
            spacedRepetitionQueue = [];
            isFlipped = false;
            currentCategory = 'All';
            questionsContainer.style.display = 'none';
            learnModeContainer.classList.remove('show');
            flashcardModeContainer.classList.add('show');
            progressContainer.style.display = 'none';
            learnProgress.classList.remove('show');
            flashcardProgress.classList.add('show');
            flashcardCompletion.classList.remove('show');
            renderFlashcardCategories();
            updateFlashcardDeckByCategory();
            updateFlashcardProgress();
            displayFlashcard();
            flashcard.addEventListener('click', flipFlashcard);
            flashcardPrevBtn.addEventListener('click', goToPrevFlashcard);
            flashcardNextBtn.addEventListener('click', goToNextFlashcard);
            flashcardShuffleBtn.addEventListener('click', shuffleFlashcardDeck);
            flashcardKnownBtn.addEventListener('click', markFlashcardKnown);
            flashcardUnknownBtn.addEventListener('click', markFlashcardUnknown);
            flashcardRestartBtn.addEventListener('click', restartFlashcardMode);
        }

        function renderFlashcardCategories() {
            const categories = ['All', ...new Set(originalFlashcardDeck.map(q => q.category))];
            flashcardCategories.innerHTML = '';
            categories.forEach(cat => {
                const catElement = document.createElement('div');
                catElement.className = 'flashcard-category';
                catElement.textContent = cat;
                if (cat === currentCategory) catElement.classList.add('active');
                catElement.addEventListener('click', () => {
                    document.querySelectorAll('.flashcard-category').forEach(el => el.classList.remove('active'));
                    catElement.classList.add('active');
                    currentCategory = cat;
                    updateFlashcardDeckByCategory();
                    updateFlashcardProgress();
                    displayFlashcard();
                });
                flashcardCategories.appendChild(catElement);
            });
        }

        function updateFlashcardDeckByCategory() {
            if (currentCategory === 'All') {
                flashcardDeck = [...originalFlashcardDeck];
            } else {
                flashcardDeck = originalFlashcardDeck.filter(q => q.category === currentCategory);
            }
            currentFlashcardIndex = 0;
            knownCards = 0;
        }

        function displayFlashcard() {
            if (flashcardDeck.length === 0) {
                showFlashcardCompletion();
                return;
            }
            const card = flashcardDeck[currentFlashcardIndex];
            flashcardQuestion.textContent = card.question;
            flashcardAnswer.textContent = card.correctAnswer;
            flashcardExplanation.innerHTML = `
                <p>${card.explanation}</p>
            `;
            flashcard.classList.remove('flipped');
            isFlipped = false;
        }

        function flipFlashcard() {
            flashcard.classList.toggle('flipped');
            isFlipped = !isFlipped;
        }

        function goToNextFlashcard() {
            currentFlashcardIndex = (currentFlashcardIndex + 1) % flashcardDeck.length;
            displayFlashcard();
        }

        function goToPrevFlashcard() {
            currentFlashcardIndex = (currentFlashcardIndex - 1 + flashcardDeck.length) % flashcardDeck.length;
            displayFlashcard();
        }

        function shuffleFlashcardDeck() {
            flashcardDeck.sort(() => Math.random() - 0.5);
            currentFlashcardIndex = 0;
            displayFlashcard();
        }

        function markFlashcardKnown() {
            knownCards++;
            flashcardDeck.splice(currentFlashcardIndex, 1);
            if (currentFlashcardIndex >= flashcardDeck.length) {
                currentFlashcardIndex = 0;
            }
            updateFlashcardProgress();
            displayFlashcard();
        }

        function markFlashcardUnknown() {
            const unknownCard = flashcardDeck.splice(currentFlashcardIndex, 1)[0];
            // Add to spaced repetition queue (reappear after 3 cards or at end)
            const reinsertIndex = Math.min(currentFlashcardIndex + 3, flashcardDeck.length);
            flashcardDeck.splice(reinsertIndex, 0, unknownCard);
            if (currentFlashcardIndex >= flashcardDeck.length) {
                currentFlashcardIndex = 0;
            }
            displayFlashcard();
        }

        function updateFlashcardProgress() {
            const total = currentCategory === 'All' ? quizData.length : originalFlashcardDeck.filter(q => q.category === currentCategory).length;
            const progress = (knownCards / total) * 100;
            flashcardProgressFill.style.width = `${progress}%`;
            flashcardProgressPercent.textContent = `${Math.round(progress)}%`;
            flashcardRemaining.textContent = `Remaining: ${flashcardDeck.length}`;
            flashcardKnown.textContent = `Known: ${knownCards}`;
            flashcardTotal.textContent = `Total: ${total}`;
        }

        function showFlashcardCompletion() {
            flashcardModeContainer.style.display = 'none';
            flashcardCompletion.classList.add('show');
        }

        function restartFlashcardMode() {
            flashcardCompletion.classList.remove('show');
            startFlashcardMode();
            flashcardModeContainer.style.display = 'flex';
        }

        // Initialize the app when DOM is loaded
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>