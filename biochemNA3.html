<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MED QUIZ Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #f72585;
            --success: #4cc9f0;
            --warning: #f9c74f;
            --danger: #f94144;
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f5;
            --gray-800: #343a40;
            --gray-900: #212529;
            --bg-primary: var(--gray-900);
            --bg-secondary: #1a1d21;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --card-bg: rgba(35, 39, 47, 0.95);
            --card-border: #4cc9f0;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --transition: all 0.2s ease-in-out;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --header-height: 50px;
            --max-width: 800px;
            --side-padding: 1rem;
            --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
        }

        [data-theme="light"] {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --text-primary: #1a1d21;
            --text-secondary: rgba(26, 29, 33, 0.7);
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            line-height: 1.5;
            font-weight: 400;
            overflow-x: hidden;
            padding: 0;
        }

        /* Compact Header */
        header {
            height: var(--header-height);
            background: var(--gradient-primary);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--side-padding);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
            color: white;
        }

        .logo-icon {
            font-size: 1.25rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 1.5rem var(--side-padding);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .quiz-container {
            width: 100%;
            max-width: var(--max-width);
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 1px solid var(--card-border);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .quiz-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .quiz-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .stats-container {
            display: flex;
            gap: 0.75rem;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            min-width: 60px;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1rem;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius-md);
            overflow: hidden;
            margin: 1.5rem 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            transition: width 0.4s ease;
        }

        /* Question Meta */
        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            padding: 0.25rem 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .difficulty-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .difficulty-easy { background-color: var(--success); }
        .difficulty-medium { background-color: var(--warning); }
        .difficulty-hard { background-color: var(--danger); }

        .bookmark-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .bookmark-btn.bookmarked {
            color: var(--warning);
        }

        /* Question */
        .question-number {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            text-align: center;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
            border-color: var(--primary-light);
        }

        .option.selected {
            background: rgba(67, 97, 238, 0.15);
            border-color: var(--primary);
        }

        .option.correct {
            background: rgba(76, 201, 240, 0.15);
            border-color: var(--success);
        }

        .option.incorrect {
            background: rgba(249, 65, 68, 0.15);
            border-color: var(--danger);
        }

        .option-letter {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option.incorrect .option-letter {
            background: var(--danger);
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 0.95rem;
        }

        /* Feedback */
        .feedback {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9rem;
        }

        .feedback.correct {
            background: rgba(76, 201, 240, 0.15);
            color: var(--success);
        }

        .feedback.incorrect {
            background: rgba(249, 65, 68, 0.15);
            color: var(--danger);
        }

        .feedback.skipped {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary);
        }

        .feedback-icon {
            font-size: 1.25rem;
        }

        /* Explanation */
        .explanation-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .explanation-container.expanded {
            max-height: 500px;
        }

        .explanation {
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .explanation-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            font-size: 0.9rem;
            flex: 1;
            justify-content: center;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255,255,255,0.2);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Study Mode Toggle */
        .study-mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            justify-content: center;
            font-size: 0.9rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Results */
        .results-container {
            text-align: center;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: conic-gradient(var(--gradient-primary) 0% var(--p, 0%), var(--bg-secondary) var(--p, 0%) 100%);
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--card-bg);
        }

        .score-text {
            position: relative;
            z-index: 1;
        }

        .score-value {
            font-size: 1.75rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .result-stat {
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
        }

        .result-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .result-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .review-section {
            margin-top: 2rem;
            text-align: left;
        }

        .review-title {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary);
            text-align: center;
        }

        .review-item {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            background: rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }

        .review-item.correct {
            border-left: 3px solid var(--success);
        }

        .review-item.incorrect {
            border-left: 3px solid var(--danger);
        }

        .review-item.skipped {
            border-left: 3px solid var(--primary);
        }

        .review-question {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .review-answer {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-sm);
        }

        .review-explanation {
            color: var(--text-secondary);
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        footer {
            padding: 2rem var(--side-padding);
            background: var(--bg-secondary);
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            margin-top: auto;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal {
            background: var(--card-bg);
            border-radius: var(--radius-2xl);
            padding: 2.5rem;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: translateY(-50px) scale(0.95);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--card-border);
        }
        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-base);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            background: rgba(255,255,255,0.1);
            color: var(--primary);
        }
        .modal-body {
            margin-bottom: 2rem;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        .difficulty-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.75rem;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .difficulty-easy {
            background-color: var(--success);
            box-shadow: 0 0 10px var(--success);
        }
        .difficulty-medium {
            background-color: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }
        .difficulty-hard {
            background-color: var(--danger);
            box-shadow: 0 0 10px var(--danger);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition-base);
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .stat-card-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        .stat-card-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--gradient-primary);
            opacity: 0;
            border-radius: 2px;
        }
        @keyframes confettiFall {
            0% {
                opacity: 1;
                transform: translateY(-100px) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }
        .fab {
            position: fixed;
            bottom: 2.5rem;
            right: 2.5rem;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            box-shadow: var(--shadow-xl);
            cursor: pointer;
            z-index: 100;
            transition: var(--transition-smooth);
            border: 3px solid rgba(255,255,255,0.2);
        }
        .fab:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 20px 40px rgba(67, 97, 238, 0.3);
        }
        .study-mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-lg);
            justify-content: center;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .toggle-slider {
            background-color: var(--primary);
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.5);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(32px);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease;
        }
        .pulse {
            animation: pulse 1s infinite;
        }
        .bounce-in {
            animation: bounceIn 0.6s ease;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        .text-center {
            text-align: center;
        }
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .full-width {
            width: 100%;
        }
        @media (max-width: 768px) {
            :root {
                --side-padding: 1rem;
                --header-height: 50px;
            }
            .quiz-container {
                padding: 2rem;
                border-radius: var(--radius-xl);
            }
            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.5rem;
            }
            .stats-container {
                width: 100%;
                justify-content: space-between;
            }
            .results-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .score-circle {
                width: 140px;
                height: 140px;
            }
            .score-circle::before {
                width: 110px;
                height: 110px;
            }
            .score-value {
                font-size: 2.25rem;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .fab {
                bottom: 1.5rem;
                right: 1.5rem;
                width: 55px;
                height: 55px;
                font-size: 1.5rem;
            }
            .navigation {
                flex-direction: column;
            }
            .btn {
                width: 100%;
            }
            .options-grid {
                grid-template-columns: 1fr;
            }
            .options-grid .option:nth-child(1),
            .options-grid .option:nth-child(2),
            .options-grid .option:nth-child(3),
            .options-grid .option:nth-child(4) {
                grid-column: auto;
            }
        }
        @media (max-width: 480px) {
            .option {
                padding: 1rem;
            }
            .option-letter {
                width: 32px;
                height: 32px;
                margin-right: 1rem;
            }
            .quiz-title {
                font-size: 1.5rem;
            }
            .question-text {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body data-theme="dark" data-progress="0">
    <header>
        <div class="logo">
            <i class="fas fa-brain logo-icon"></i>
            <span>MedQuiz</span>
        </div>
        <div class="header-controls">
            <button class="control-btn" id="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="control-btn" id="sound-toggle" aria-label="Toggle sound">
                <i class="fas fa-volume-up"></i>
            </button>
            <button class="control-btn" id="stats-btn" aria-label="View statistics">
                <i class="fas fa-chart-line"></i>
                <span class="badge" id="bookmarks-count">0</span>
            </button>
        </div>
    </header>
    <main>
        <div class="quiz-container">
            <div class="quiz-header">
                <div>
                    <h1 class="quiz-title">MED QUIZ</h1>
                    <p class="quiz-subtitle">Test your medical knowledge</p>
                </div>
                <div class="stats-container">
                    <div class="stat">
                        <span class="stat-value" id="timer">00:00</span>
                        <span class="stat-label">Time</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="category">All</span>
                        <span class="stat-label">Category</span>
                    </div>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
            </div>
            <div class="question-meta">
                <div class="question-tags">
                    <span class="tag" id="category-tag">Biochemistry</span>
                    <span class="tag" id="difficulty-tag">
                        <span class="difficulty-indicator difficulty-medium"></span>
                        Medium
                    </span>
                </div>
                <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">15</span></div>
            <div class="question-text" id="question">Which part of the brain is responsible for coordinating skeletal muscle contractions?</div>
            <div class="options-grid" id="options-container">
                <div class="option">
                    <div class="option-letter">A</div>
                    <div class="option-text">Cerebrum</div>
                </div>
                <div class="option">
                    <div class="option-letter">B</div>
                    <div class="option-text">Cerebellum</div>
                </div>
                <div class="option">
                    <div class="option-letter">C</div>
                    <div class="option-text">Pons</div>
                </div>
                <div class="option">
                    <div class="option-letter">D</div>
                    <div class="option-text">Midbrain</div>
                </div>
            </div>
            <div class="feedback correct" id="feedback" style="display: none;">
                <i class="fas fa-check-circle feedback-icon"></i>
                <div class="feedback-text">Correct! Well done.</div>
            </div>
            <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                <i class="fas fa-info-circle"></i> Show Explanation
            </button>
            <div class="explanation-container" id="explanation-container">
                <div class="explanation">
                    <div class="explanation-title">Explanation:</div>
                    <div id="explanation-text">The cerebellum, located posterior to the brainstem, is the 'little brain.' It compares intended movements with actual movements to ensure smooth, coordinated skeletal muscle activity and maintain posture and balance.</div>
                </div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-danger" id="skip-btn">
                    <i class="fas fa-forward"></i> Skip
                </button>
            </div>
        </div>
    </main>
    <div class="fab" id="quick-actions-btn" style="display: none;">
        <i class="fas fa-bolt"></i>
    </div>
    <div class="confetti-container" id="confetti-container"></div>
    <div class="modal-overlay" id="stats-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Your Statistics</h2>
                <button class="modal-close" id="close-stats-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-total-questions">0</div>
                        <div class="stat-card-label">Total Questions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-correct-answers">0</div>
                        <div class="stat-card-label">Correct Answers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-accuracy">0%</div>
                        <div class="stat-card-label">Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="modal-avg-time">0s</div>
                        <div class="stat-card-label">Avg. Time</div>
                    </div>
                </div>
                <h3 class="review-title">Performance by Category</h3>
                <div id="category-stats"></div>
                <h3 class="review-title mt-2">Performance by Difficulty</h3>
                <div id="difficulty-stats"></div>
                <h3 class="review-title mt-2">Quiz History</h3>
                <div id="history-stats"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-stats-btn">Close</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="quick-actions-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Quick Actions</h2>
                <button class="modal-close" id="close-actions-modal">&times;</button>
            </div>
            <div class="modal-body">
                <button class="btn btn-primary full-width mt-1" id="mark-for-review-btn">
                    <i class="fas fa-flag"></i> Mark for Review
                </button>
                <button class="btn btn-secondary full-width mt-1" id="view-explanation-btn">
                    <i class="fas fa-info-circle"></i> View Explanation
                </button>
                <button class="btn btn-success full-width mt-1" id="hint-btn">
                    <i class="fas fa-lightbulb"></i> Get a Hint
                </button>
                <button class="btn btn-danger full-width mt-1" id="report-question-btn">
                    <i class="fas fa-exclamation-triangle"></i> Report Question
                </button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-actions-btn">Close</button>
            </div>
        </div>
    </div>
    <footer>
        &copy; 2025 MedQuiz | MED Practice Platform | All Rights Reserved
    </footer>
    <script>
        const questions = [
    {
        "id": 1,
        "question": "The critical finding of the Avery-MacLeod-McCarty experiment was that:",
        "options": ["Heat-killed smooth pneumococci could transform rough pneumococci", "The transforming principle was destroyed by proteases", "The transforming principle was destroyed by DNase", "DNA replication is semi-conservative"],
        "answer": 2,
        "correctAnswer": "The transforming principle was destroyed by DNase",
        "explanation": "The experiment showed that DNase, which degrades DNA, abolished transformation, proving DNA is the transforming principle. Other options describe unrelated findings or are incorrect. Errors can affect understanding DNA as the genetic material.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 2,
        "question": "In a left-handed Z-DNA helix, the sugar-phosphate backbone assumes a:",
        "options": ["Smooth, continuous spiral", "Zigzag pattern", "Disrupted and uneven pattern", "Linear conformation"],
        "answer": 1,
        "correctAnswer": "Zigzag pattern",
        "explanation": "Z-DNA has a zigzag sugar-phosphate backbone, distinguishing it from the smooth B-DNA helix. Other descriptions are incorrect. Errors can affect understanding alternative DNA structures.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 3,
        "question": "The unusual nucleoside pseudouridine (ψ) is characterized by:",
        "options": ["A glycosidic bond between C5 of uracil and C1' of ribose", "A methylated guanine base", "Replacement of ribose with deoxyribose", "Being found exclusively in DNA"],
        "answer": 0,
        "correctAnswer": "A glycosidic bond between C5 of uracil and C1' of ribose",
        "explanation": "Pseudouridine has a C5-C1’ carbon-carbon bond, unlike the standard N-glycosidic bond. It is RNA-specific, not DNA, and not methylated guanine. Errors can affect nucleoside modification studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 4,
        "question": "The primary function of the poly-A tail on eukaryotic mRNA is to:",
        "options": ["Initiate translation", "Protect the transcript from 3' exonuclease degradation", "Serve as the binding site for the aminoacyl-tRNA synthetase", "Facilitate the splicing of introns"],
        "answer": 1,
        "correctAnswer": "Protect the transcript from 3' exonuclease degradation",
        "explanation": "The poly-A tail stabilizes mRNA by protecting the 3’ end from exonucleases. Other functions are incorrect or unrelated. Errors can affect mRNA stability analysis.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 5,
        "question": "In a double-stranded DNA molecule, which of the following base pair ratios is always equal to 1.0 due to Chargaff's rules?",
        "options": ["(A + G) / (T + C)", "(A + T) / (G + C)", "A / G", "(A + C) / (G + T)"],
        "answer": 3,
        "correctAnswer": "(A + C) / (G + T)",
        "explanation": "Chargaff’s rules state A=T and G=C, so (A+C)=(T+G), making the ratio (A+C)/(G+T)=1.0. Other ratios vary. Errors can affect DNA composition calculations.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 6,
        "question": "The 'melting temperature' (Tm) of DNA is defined as the temperature at which:",
        "options": ["All hydrogen bonds are broken instantly", "50% of the DNA is denatured into single strands", "DNA begins to degrade", "The hyperchromic effect is no longer observable"],
        "answer": 1,
        "correctAnswer": "50% of the DNA is denatured into single strands",
        "explanation": "Tm is the temperature where half the DNA is single-stranded. Degradation or instant bond breaking are incorrect, and hyperchromicity persists post-denaturation. Errors can affect DNA stability studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 7,
        "question": "The D arm of a tRNA molecule is a primary recognition site for:",
        "options": ["The mRNA codon", "The 40S ribosomal subunit", "Aminoacyl-tRNA synthetase", "The 5' cap of mRNA"],
        "answer": 2,
        "correctAnswer": "Aminoacyl-tRNA synthetase",
        "explanation": "The D arm aids recognition by aminoacyl-tRNA synthetase for amino acid attachment. Other options are unrelated to its role. Errors can affect tRNA charging studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 8,
        "question": "The primary reason Z-DNA is a poor candidate for the physiological DNA structure is its:",
        "options": ["Inability to form hydrogen bonds", "Requirement for high salt concentrations and specific alternating base sequences to form", "Left-handedness", "Narrow diameter"],
        "answer": 1,
        "correctAnswer": "Requirement for high salt concentrations and specific alternating base sequences to form",
        "explanation": "Z-DNA requires high salt and alternating purine-pyrimidine sequences, unlike B-DNA, which is stable under physiological conditions. Errors can affect DNA conformation studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 9,
        "question": "In the context of gene regulation, what is the primary mechanism of action for siRNA?",
        "options": ["Binding to ribosomes to inhibit translation", "Forming a perfect RNA-RNA hybrid with mRNA, leading to its nucleolytic degradation", "Acting as a decoy for transcription factors", "Promoting alternative splicing of hnRNA"],
        "answer": 1,
        "correctAnswer": "Forming a perfect RNA-RNA hybrid with mRNA, leading to its nucleolytic degradation",
        "explanation": "siRNAs guide RISC to cleave perfectly complementary mRNA. Other mechanisms are incorrect or miRNA-related. Errors can affect RNA interference studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 10,
        "question": "The historical term 'nuclein,' first isolated by Friedrich Miescher, was primarily composed of:",
        "options": ["Lipids and proteins from the nucleus", "DNA and associated proteins", "Pure ribosomal RNA", "Mitochondrial DNA"],
        "answer": 1,
        "correctAnswer": "DNA and associated proteins",
        "explanation": "Nuclein was DNA complexed with proteins like histones, isolated from nuclei. Other options are incorrect. Errors can affect historical biochemistry understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 11,
        "question": "Vidarabine is an antiviral drug that is a synthetic analogue. Its mechanism likely involves:",
        "options": ["Mimicking thymidine and incorporating into DNA, causing chain termination", "Inhibiting the enzyme dihydrofolate reductase", "Mimicking adenosine and interfering with viral nucleic acid synthesis", "Blocking the action of RNA polymerase II"],
        "answer": 2,
        "correctAnswer": "Mimicking adenosine and interfering with viral nucleic acid synthesis",
        "explanation": "Vidarabine, an adenosine analogue, inhibits viral DNA polymerase after phosphorylation. Other mechanisms are incorrect. Errors can affect antiviral drug studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 12,
        "question": "The observation that led to the concept of 'junk DNA' was that:",
        "options": ["A large portion of the genome does not code for proteins", "Mitochondrial DNA is circular", "Repetitive DNA sequences are unstable", "DNA can be denatured and renatured"],
        "answer": 0,
        "correctAnswer": "A large portion of the genome does not code for proteins",
        "explanation": "Non-coding DNA (~98% of the human genome) was initially called 'junk' but includes regulatory elements. Other options are unrelated. Errors can affect genomic studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 13,
        "question": "In a classic DNA fingerprinting gel, the sample from a child should:",
        "options": ["Be identical to the mother's sample", "Be a perfect blend of both parents' bands", "Show bands that are a perfect subset of the mother's bands, with the remaining bands matching the father's", "Contain unique bands not found in either parent"],
        "answer": 2,
        "correctAnswer": "Show bands that are a perfect subset of the mother's bands, with the remaining bands matching the father's",
        "explanation": "A child’s DNA bands are inherited from either parent. Unique bands indicate non-paternity. Errors can affect forensic DNA analysis.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 14,
        "question": "The hyperchromic effect observed during DNA denaturation is a result of:",
        "options": ["The breaking of phosphodiester bonds", "The unstacking of nitrogenous bases, reducing their mutual shielding", "The hydrolysis of nucleosides", "The methylation of cytosine residues"],
        "answer": 1,
        "correctAnswer": "The unstacking of nitrogenous bases, reducing their mutual shielding",
        "explanation": "Denaturation unstacks bases, increasing UV absorbance at 260nm. Other processes are unrelated. Errors can affect DNA denaturation studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 15,
        "question": "The primary transcript (hnRNA) in eukaryotes is much larger than the mature mRNA because it contains:",
        "options": ["Multiple protein-coding sequences", "5' cap and 3' poly-A tail structures", "Introns and exons", "Ribosomal binding sites"],
        "answer": 2,
        "correctAnswer": "Introns and exons",
        "explanation": "hnRNA includes introns (removed during splicing) and exons. Caps and tails are added post-transcriptionally. Errors can affect RNA processing understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 16,
        "question": "The myostatin gene mutation in the 'Incredible Hulk of Hounds' is an example of a natural occurrence that could be replicated by:",
        "options": ["Gene therapy using viral vectors", "Transgenic technology", "Gene knockout or gene silencing techniques", "Treatment with nucleic acid analogue drugs"],
        "answer": 2,
        "correctAnswer": "Gene knockout or gene silencing techniques",
        "explanation": "The myostatin mutation eliminates functional protein, replicable by knockout or RNAi silencing. Other methods are less direct. Errors can affect genetic engineering studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 17,
        "question": "In a nucleoside, the bond between the sugar and the base is correctly described as a(n):",
        "options": ["O-glycosidic bond", "N-glycosidic bond", "Phosphoester bond", "Hydrogen bond"],
        "answer": 1,
        "correctAnswer": "N-glycosidic bond",
        "explanation": "The β-N-glycosidic bond links C1’ of the sugar to N9 (purine) or N1 (pyrimidine). Other bonds are incorrect. Errors can affect nucleoside structure understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 18,
        "question": "The A-form of DNA:",
        "options": ["Is the most common form under physiological conditions", "Is a left-handed helix", "Is dehydrated and found in DNA-RNA hybrids", "Has a wider diameter than B-DNA"],
        "answer": 2,
        "correctAnswer": "Is dehydrated and found in DNA-RNA hybrids",
        "explanation": "A-DNA is a right-handed, dehydrated helix in DNA-RNA hybrids, not common physiologically. B-DNA is wider and standard. Errors can affect DNA structure studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 19,
        "question": "The significance of LINE-1 elements within 'junk DNA' is that they:",
        "options": ["Code for essential metabolic enzymes", "Are capable of facilitating DNA repair", "Are the only type of transposable element in humans", "Are inherited exclusively from the mother"],
        "answer": 1,
        "correctAnswer": "Are capable of facilitating DNA repair",
        "explanation": "LINE-1 elements can aid DNA repair, not just act as transposons. They are not enzymes or maternally inherited. Errors can affect non-coding DNA studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 20,
        "question": "The anticodon sequence 3'-AAG-5' on a tRNA would bind to which mRNA codon?",
        "options": ["3'-AAG-5'", "5'-UUC-3'", "5'-TTC-3'", "3'-UUC-5'"],
        "answer": 1,
        "correctAnswer": "5'-UUC-3'",
        "explanation": "The anticodon 3'-AAG-5' pairs antiparallel with 5'-UUC-3' (A-U, A-U, G-C). RNA uses uracil, not thymine. Errors can affect translation codon-anticodon pairing.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 21,
        "question": "The process of reannealing or renaturation of DNA requires:",
        "options": ["High temperature and low salt concentration", "The action of the enzyme ligase", "Slow cooling and correct salt concentration to allow complementary strands to find each other", "The presence of ribosomal subunits"],
        "answer": 2,
        "correctAnswer": "Slow cooling and correct salt concentration to allow complementary strands to find each other",
        "explanation": "Renaturation needs slow cooling and optimal salt to reduce phosphate repulsion, enabling base pairing. Ligase or ribosomes are unrelated. Errors can affect DNA hybridization studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 22,
        "question": "The 5.8S rRNA is a component of the:",
        "options": ["40S small ribosomal subunit in eukaryotes", "60S large ribosomal subunit in eukaryotes", "50S large ribosomal subunit in prokaryotes", "30S small ribosomal subunit in prokaryotes"],
        "answer": 1,
        "correctAnswer": "60S large ribosomal subunit in eukaryotes",
        "explanation": "The 60S subunit contains 5S, 5.8S, and 28S rRNAs in eukaryotes. Other options are incorrect for subunit composition. Errors can affect ribosome structure studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 23,
        "question": "The term 'sense strand' in molecular biology refers to:",
        "options": ["The DNA strand that has the same sequence as the mRNA (except T for U)", "The DNA strand that is used as a template for transcription", "The strand that is continuously synthesized during replication", "The strand with the promoter sequence"],
        "answer": 0,
        "correctAnswer": "The DNA strand that has the same sequence as the mRNA (except T for U)",
        "explanation": "The sense (coding) strand matches the mRNA sequence (T replaced by U), unlike the template strand. Errors can affect transcription understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 24,
        "question": "The primary application of Allopurinol, a nucleic acid analogue, is in the treatment of:",
        "options": ["HIV/AIDS", "Cancer", "Gout", "Viral hepatitis"],
        "answer": 2,
        "correctAnswer": "Gout",
        "explanation": "Allopurinol inhibits xanthine oxidase, reducing uric acid production in purine metabolism, treating gout. Other conditions are unrelated. Errors can affect drug mechanism studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 25,
        "question": "The key evidence from the Hershey-Chase experiment was that:",
        "options": ["Radioactive sulfur (³⁵S) was found inside the infected bacterial cells", "Radioactive phosphorus (³²P) was found inside the infected bacterial cells", "Both radioactive sulfur and phosphorus were found inside the cells", "The genetic material was protein"],
        "answer": 1,
        "correctAnswer": "Radioactive phosphorus (³²P) was found inside the infected bacterial cells",
        "explanation": "³²P-labeled DNA was found inside infected cells, proving DNA is the genetic material. ³⁵S-labeled protein remained outside. Errors can affect genetic material studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 26,
        "question": "In a plasmid, the gene conferring antibiotic resistance is most useful for:",
        "options": ["Allowing the host bacterium to grow faster", "Identifying bacteria that have taken up the plasmid during genetic engineering", "Promoting conjugation between bacteria", "Replicating the plasmid DNA"],
        "answer": 1,
        "correctAnswer": "Identifying bacteria that have taken up the plasmid during genetic engineering",
        "explanation": "Antibiotic resistance genes are selectable markers to identify plasmid-containing bacteria. Other roles are secondary. Errors can affect genetic engineering techniques.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 27,
        "question": "The difference between theobromine and caffeine is:",
        "options": ["Theobromine is a pyrimidine, caffeine is a purine", "The number and position of methyl groups on the xanthine base", "The sugar moiety attached to the base", "Theobromine is found in tea, caffeine in coffee"],
        "answer": 1,
        "correctAnswer": "The number and position of methyl groups on the xanthine base",
        "explanation": "Both are purine derivatives; theobromine is 3,7-dimethylxanthine, caffeine is 1,3,7-trimethylxanthine. Other options are incorrect. Errors can affect purine chemistry.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 28,
        "question": "The role of the 7-methylguanosine cap in mRNA is NOT to:",
        "options": ["Protect the 5' end from exonucleases", "Serve as a binding site for the ribosome during translation initiation", "Facilitate the splicing of the final intron", "Enhance the export of mRNA from the nucleus"],
        "answer": 2,
        "correctAnswer": "Facilitate the splicing of the final intron",
        "explanation": "The cap aids protection, export, and translation, but splicing is primarily spliceosome-driven. Errors can affect mRNA processing understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 29,
        "question": "In DNA fingerprinting for paternity testing, a man can be excluded as the biological father if:",
        "options": ["He shares fewer than 50% of his bands with the child", "The child has bands not present in either the mother or the alleged father", "His DNA fingerprint is identical to the mother's", "The child's profile is a perfect blend of the mother's and his own"],
        "answer": 1,
        "correctAnswer": "The child has bands not present in either the mother or the alleged father",
        "explanation": "All child bands must come from either parent. Unique bands indicate non-paternity. Errors can affect forensic paternity testing.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 30,
        "question": "The central dogma exception exhibited by HIV is its use of:",
        "options": ["Reverse transcriptase to synthesize DNA from an RNA template", "RNA polymerase to make mRNA from DNA", "DNA polymerase to replicate its genome", "Ribosomes to translate protein from mRNA"],
        "answer": 0,
        "correctAnswer": "Reverse transcriptase to synthesize DNA from an RNA template",
        "explanation": "HIV’s RNA genome is reverse-transcribed into DNA, an exception to the central dogma (DNA→RNA→protein). Other processes are standard. Errors can affect retroviral studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 31,
        "question": "The 'axis of symmetry' in the DNA double helix refers to:",
        "options": ["The central axis around which the two strands coil", "The plane of symmetry within each nitrogenous base", "The point where the two strands are joined by hydrogen bonds", "The symmetrical nature of the genetic code"],
        "answer": 0,
        "correctAnswer": "The central axis around which the two strands coil",
        "explanation": "The double helix coils around a central axis, like a spiral staircase. Other options are incorrect. Errors can affect DNA structure understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 32,
        "question": "The reason mitochondrial DNA is used in evolutionary studies ('Mitochondrial Eve') is because it is:",
        "options": ["Larger and contains more information than nuclear DNA", "Inherited only from the father", "Inherited only from the mother and does not undergo recombination", "More stable and has a lower mutation rate"],
        "answer": 2,
        "correctAnswer": "Inherited only from the mother and does not undergo recombination",
        "explanation": "Maternal inheritance and lack of recombination make mtDNA ideal for tracing ancestry. It’s smaller and mutates faster. Errors can affect evolutionary genetics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 33,
        "question": "The primary driving force for the formation of the DNA double helix is:",
        "options": ["Covalent phosphodiester bonds", "Hydrophobic interactions between stacked bases", "Hydrogen bonding between complementary bases", "Ionic interactions with histones"],
        "answer": 1,
        "correctAnswer": "Hydrophobic interactions between stacked bases",
        "explanation": "Hydrophobic base stacking stabilizes the helix core, while hydrogen bonds ensure specificity. Phosphodiester bonds form the backbone, not the helix. Errors can affect DNA stability studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 34,
        "question": "In the pre-mRNA of eukaryotes, the segments that are removed by spliceosomes are called:",
        "options": ["Exons", "Introns", "Codons", "Anticodons"],
        "answer": 1,
        "correctAnswer": "Introns",
        "explanation": "Introns are non-coding sequences removed by spliceosomes; exons are retained. Codons and anticodons relate to translation. Errors can affect RNA splicing understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 35,
        "question": "The TψC arm of tRNA gets its name from the sequence:",
        "options": ["Thymine - pseudouridine - Cytosine", "Threonine - tyrosine - Cysteine", "Thymine - uracil - Cytosine", "Terminator - promoter - Coding sequence"],
        "answer": 0,
        "correctAnswer": "Thymine - pseudouridine - Cytosine",
        "explanation": "The TψC arm contains thymine, pseudouridine, and cytosine, aiding ribosome binding. Other options are incorrect. Errors can affect tRNA structure studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 36,
        "question": "A key difference between miRNA and siRNA is that siRNA typically leads to:",
        "options": ["Transcriptional silencing", "The degradation of perfectly complementary target mRNA", "Inhibition of translation without mRNA degradation", "Alternative splicing"],
        "answer": 1,
        "correctAnswer": "The degradation of perfectly complementary target mRNA",
        "explanation": "siRNAs cause mRNA cleavage via perfect base pairing, unlike miRNAs, which often inhibit translation. Errors can affect RNA interference mechanisms.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 37,
        "question": "The nucleoid of a prokaryotic cell is best described as:",
        "options": ["A membrane-bound organelle containing DNA", "A single, circular chromosome complexed with non-histone proteins", "Multiple linear chromosomes wrapped around histones", "The region where plasmid DNA is stored"],
        "answer": 1,
        "correctAnswer": "A single, circular chromosome complexed with non-histone proteins",
        "explanation": "The nucleoid is a non-membrane-bound region with a circular chromosome and non-histone proteins. Histones are eukaryotic. Errors can affect prokaryotic genome studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 38,
        "question": "The term 'gene knockout' refers to:",
        "options": ["Silencing a gene using RNA interference", "The natural mutation seen in the 'Incredible Hulk' dog", "Experimentally inactivating a specific gene to study its function", "Designing a drug that blocks a gene's product"],
        "answer": 2,
        "correctAnswer": "Experimentally inactivating a specific gene to study its function",
        "explanation": "Gene knockout inactivates a gene to study its role. RNAi is silencing, not knockout. Errors can affect genetic engineering understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 39,
        "question": "The reason uracil is not found in DNA is because:",
        "options": ["It cannot form hydrogen bonds with adenine", "Cytosine spontaneously deaminates to uracil, and its presence would make it impossible to distinguish a mutation from a normal base", "It is too large to fit into the double helix", "It is only used for energy transport in the cell"],
        "answer": 1,
        "correctAnswer": "Cytosine spontaneously deaminates to uracil, and its presence would make it impossible to distinguish a mutation from a normal base",
        "explanation": "Uracil in DNA would confuse repair systems, as cytosine deaminates to uracil. Thymine distinguishes normal bases from mutations. Errors can affect DNA repair studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 40,
        "question": "The 'p-bodies' mentioned in the context of siRNA function are:",
        "options": ["Structures in the nucleus where splicing occurs", "Cytoplasmic organelles involved in mRNA storage and decay", "The sites of ribosome assembly", "Another name for the nucleolus"],
        "answer": 1,
        "correctAnswer": "Cytoplasmic organelles involved in mRNA storage and decay",
        "explanation": "P-bodies are cytoplasmic sites for mRNA storage, decay, or silencing via siRNAs/miRNAs. Other options are incorrect. Errors can affect RNA regulation studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 41,
        "question": "The secondary structure of RNA is primarily stabilized by:",
        "options": ["Phosphodiester bonds", "Hydrophobic interactions within the sugar-phosphate backbone", "Intra-chain hydrogen bonds, often forming hairpin loops", "Covalent disulfide bridges"],
        "answer": 2,
        "correctAnswer": "Intra-chain hydrogen bonds, often forming hairpin loops",
        "explanation": "RNA secondary structure forms via intramolecular hydrogen bonds, creating hairpins. Phosphodiester bonds form the backbone, and disulfide bridges are protein-specific. Errors can affect RNA folding studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 42,
        "question": "In a nucleoside, the sugar is always in the:",
        "options": ["Open-chain form", "α-furanose form", "β-furanose form", "Pyranose form"],
        "answer": 2,
        "correctAnswer": "β-furanose form",
        "explanation": "Nucleoside sugars (ribose/deoxyribose) are in the β-furanose (5-membered ring) form. Other forms are incorrect. Errors can affect nucleoside structure understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 43,
        "question": "The primary application of DNA fingerprinting in a rape case would be to:",
        "options": ["Diagnose a genetic disease in the suspect", "Determine if the suspect was at the crime scene by matching their DNA to evidence", "Identify the father of a child", "Design a drug based on the suspect's genome"],
        "answer": 1,
        "correctAnswer": "Determine if the suspect was at the crime scene by matching their DNA to evidence",
        "explanation": "DNA fingerprinting matches crime scene evidence to a suspect’s DNA profile. Other applications are unrelated. Errors can affect forensic DNA analysis.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 44,
        "question": "The component that differentiates a nucleoside from a nucleotide is the presence of a:",
        "options": ["Nitrogenous base", "Pentose sugar", "Phosphate group", "Hydrogen bond"],
        "answer": 2,
        "correctAnswer": "Phosphate group",
        "explanation": "A nucleotide is a nucleoside (base + sugar) plus a phosphate group. Other components are in both. Errors can affect nucleotide structure understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 45,
        "question": "The 'wobble hypothesis' explains:",
        "options": ["The flexibility of the DNA double helix", "Why some tRNAs can recognize more than one codon", "The mechanism of DNA denaturation", "The imprecise splicing of introns"],
        "answer": 1,
        "correctAnswer": "Why some tRNAs can recognize more than one codon",
        "explanation": "The wobble hypothesis explains non-standard base pairing at the third codon position, allowing one tRNA to bind multiple codons. Errors can affect translation accuracy studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 46,
        "question": "The reason bacteria can be used to produce human insulin is because:",
        "options": ["They naturally have the human insulin gene", "The genetic code is universal", "They can splice out introns from human genes", "They possess reverse transcriptase"],
        "answer": 1,
        "correctAnswer": "The genetic code is universal",
        "explanation": "The universal genetic code allows bacteria to translate human insulin mRNA correctly. Bacteria lack introns or reverse transcriptase. Errors can affect recombinant protein production.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 47,
        "question": "The term 'antiparallel' in the DNA double helix means that:",
        "options": ["The two strands are mirror images of each other", "One strand runs 5' to 3' while the other runs 3' to 5'", "The bases are perpendicular to the sugar-phosphate backbone", "The strands are held together by opposite charges"],
        "answer": 1,
        "correctAnswer": "One strand runs 5' to 3' while the other runs 3' to 5'",
        "explanation": "Antiparallel strands run in opposite directions, enabling base pairing and replication. Other descriptions are incorrect. Errors can affect DNA structure understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 48,
        "question": "The primary role of snRNPs (snurps) is to:",
        "options": ["Carry amino acids to the ribosome", "Form the structure of the ribosome", "Catalyze the splicing of introns from hnRNA", "Add the poly-A tail to mRNA"],
        "answer": 2,
        "correctAnswer": "Catalyze the splicing of introns from hnRNA",
        "explanation": "snRNPs form the spliceosome, removing introns from hnRNA. Other roles are incorrect. Errors can affect RNA splicing studies.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 49,
        "question": "A plasmid used in genetic engineering typically must contain:",
        "options": ["A centromere and telomeres", "An origin of replication", "Histone genes", "A nuclear localization signal"],
        "answer": 1,
        "correctAnswer": "An origin of replication",
        "explanation": "The origin of replication allows plasmid replication in the host. Other features are eukaryotic or unrelated. Errors can affect plasmid design understanding.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    },
    {
        "id": 50,
        "question": "The observation that led to the concept of the 'antifreeze protein gene' evolving from junk DNA is that:",
        "options": ["The gene has no introns", "The gene sequence is identical to a known transposon", "The gene was created de novo from a non-coding DNA sequence", "The gene is found in all fish species"],
        "answer": 2,
        "correctAnswer": "The gene was created de novo from a non-coding DNA sequence",
        "explanation": "The antifreeze protein gene evolved from non-coding DNA, demonstrating junk DNA’s role in innovation. It’s not universal or transposon-identical. Errors can affect evolutionary genetics.",
        "category": "Biochemistry",
        "difficulty": "Hard"
    }
]
        ;
        // Store original questions for restart functionality (moved to global scope for cross-browser compatibility)
        const originalQuestions = [...questions];
        // DOM Elements (global for cross-browser)
        let body = document.body;
        let questionElement, optionsContainer, currentQuestionElement, totalQuestionsElement, progressBar, prevButton, nextButton, skipButton, feedbackElement, timerElement, scoreElement, streakElement, categoryElement, explanationContainer, explanationTextElement, themeToggle, soundToggle, bookmarkBtn, bookmarksCount, categoryTag, difficultyTag, showExplanationBtn, statsBtn, statsModal, closeStatsModal, closeStatsBtn, quickActionsBtn, quickActionsModal, closeActionsModal, closeActionsBtn, studyModeToggle, confettiContainer;
        // Quiz state
        let currentQuestionIndex = 0;
        let score = 0;
        let streak = 0;
        let selectedOption = null;
        let timeStarted = null;
        let timerInterval = null;
        let timeElapsed = 0;
        let answers = [];
        let soundsEnabled = true;
        let bookmarkedQuestions = [];
        let quizHistory = [];
        let studyMode = false;
        let performanceMetrics = {
            categories: {},
            difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
            totalCorrect: 0,
            totalQuestions: 0,
            totalTime: 0
        };
        function initQuiz() {
            try {
            // Assign DOM elements safely
            questionElement = document.getElementById('question') || questionElement;
            optionsContainer = document.getElementById('options-container') || optionsContainer;
            currentQuestionElement = document.getElementById('current-question') || currentQuestionElement;
            totalQuestionsElement = document.getElementById('total-questions') || totalQuestionsElement;
            progressBar = document.getElementById('progress-bar') || progressBar;
            prevButton = document.getElementById('prev-btn') || prevButton;
            nextButton = document.getElementById('next-btn') || nextButton;
            skipButton = document.getElementById('skip-btn') || skipButton;
            feedbackElement = document.getElementById('feedback') || feedbackElement;
            timerElement = document.getElementById('timer') || timerElement;
            scoreElement = document.getElementById('score') || scoreElement;
            streakElement = document.getElementById('streak') || streakElement;
            categoryElement = document.getElementById('category') || categoryElement;
            explanationContainer = document.getElementById('explanation-container') || explanationContainer;
            explanationTextElement = document.getElementById('explanation-text') || explanationTextElement;
            themeToggle = document.getElementById('theme-toggle') || themeToggle;
            soundToggle = document.getElementById('sound-toggle') || soundToggle;
            bookmarkBtn = document.getElementById('bookmark-btn') || bookmarkBtn;
            bookmarksCount = document.getElementById('bookmarks-count') || bookmarksCount;
            categoryTag = document.getElementById('category-tag') || categoryTag;
            difficultyTag = document.getElementById('difficulty-tag') || difficultyTag;
            showExplanationBtn = document.getElementById('show-explanation-btn') || showExplanationBtn;
            statsBtn = document.getElementById('stats-btn') || statsBtn;
            statsModal = document.getElementById('stats-modal') || statsModal;
            closeStatsModal = document.getElementById('close-stats-modal') || closeStatsModal;
            closeStatsBtn = document.getElementById('close-stats-btn') || closeStatsBtn;
            quickActionsBtn = document.getElementById('quick-actions-btn') || quickActionsBtn;
            quickActionsModal = document.getElementById('quick-actions-modal') || quickActionsModal;
            closeActionsModal = document.getElementById('close-actions-modal') || closeActionsModal;
            closeActionsBtn = document.getElementById('close-actions-btn') || closeActionsBtn;
            studyModeToggle = document.getElementById('study-mode-toggle') || studyModeToggle;
            confettiContainer = document.getElementById('confetti-container') || confettiContainer;
            // Reset DOM elements
            if (scoreElement) scoreElement.textContent = score;
            if (streakElement) streakElement.textContent = streak;
            if (timerElement) timerElement.textContent = '00:00';
            if (totalQuestionsElement) totalQuestionsElement.textContent = questions.length;
           
            loadQuestion();
            startTimer();
           
            // Clone elements to remove old listeners (cross-browser safe)
            if (prevButton) {
                const prevBtnClone = prevButton.cloneNode(true);
                prevButton.parentNode.replaceChild(prevBtnClone, prevButton);
                prevButton = prevBtnClone;
            }
            if (nextButton) {
                const nextBtnClone = nextButton.cloneNode(true);
                nextButton.parentNode.replaceChild(nextBtnClone, nextButton);
                nextButton = nextBtnClone;
            }
            if (skipButton) {
                const skipBtnClone = skipButton.cloneNode(true);
                skipButton.parentNode.replaceChild(skipBtnClone, skipButton);
                skipButton = skipBtnClone;
            }
            if (themeToggle) {
                const themeToggleClone = themeToggle.cloneNode(true);
                themeToggle.parentNode.replaceChild(themeToggleClone, themeToggle);
                themeToggle = themeToggleClone;
            }
            if (soundToggle) {
                const soundToggleClone = soundToggle.cloneNode(true);
                soundToggle.parentNode.replaceChild(soundToggleClone, soundToggle);
                soundToggle = soundToggleClone;
            }
            if (bookmarkBtn) {
                const bookmarkBtnClone = bookmarkBtn.cloneNode(true);
                bookmarkBtn.parentNode.replaceChild(bookmarkBtnClone, bookmarkBtn);
                bookmarkBtn = bookmarkBtnClone;
            }
            if (showExplanationBtn) {
                const showExplanationBtnClone = showExplanationBtn.cloneNode(true);
                showExplanationBtn.parentNode.replaceChild(showExplanationBtnClone, showExplanationBtn);
                showExplanationBtn = showExplanationBtnClone;
            }
            if (statsBtn) {
                const statsBtnClone = statsBtn.cloneNode(true);
                statsBtn.parentNode.replaceChild(statsBtnClone, statsBtn);
                statsBtn = statsBtnClone;
            }
            // Add event listeners safely
            if (prevButton) prevButton.addEventListener('click', goToPreviousQuestion);
            if (nextButton) nextButton.addEventListener('click', goToNextQuestion);
            if (skipButton) skipButton.addEventListener('click', skipQuestion);
            if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
            if (soundToggle) soundToggle.addEventListener('click', toggleSound);
            if (bookmarkBtn) bookmarkBtn.addEventListener('click', toggleBookmark);
            if (showExplanationBtn) showExplanationBtn.addEventListener('click', toggleExplanation);
            if (statsBtn) statsBtn.addEventListener('click', showStatsModal);
            if (closeStatsModal) closeStatsModal.addEventListener('click', hideStatsModal);
            if (closeStatsBtn) closeStatsBtn.addEventListener('click', hideStatsModal);
            if (quickActionsBtn) quickActionsBtn.addEventListener('click', showQuickActionsModal);
            if (closeActionsModal) closeActionsModal.addEventListener('click', hideQuickActionsModal);
            if (closeActionsBtn) closeActionsBtn.addEventListener('click', hideQuickActionsModal);
            if (studyModeToggle) studyModeToggle.addEventListener('change', toggleStudyMode);
           
            const markForReviewBtn = document.getElementById('mark-for-review-btn');
            if (markForReviewBtn) markForReviewBtn.addEventListener('click', markForReview);
            const viewExplanationBtn = document.getElementById('view-explanation-btn');
            if (viewExplanationBtn) viewExplanationBtn.addEventListener('click', viewExplanation);
            const hintBtn = document.getElementById('hint-btn');
            if (hintBtn) hintBtn.addEventListener('click', getHint);
            const reportBtn = document.getElementById('report-question-btn');
            if (reportBtn) reportBtn.addEventListener('click', reportQuestion);
           
            // Keyboard navigation
            document.removeEventListener('keydown', handleKeydown);
            document.addEventListener('keydown', handleKeydown);
           
            loadPreferences();
            loadQuizHistory();
            updateBookmarksCount();
            } catch (e) {
                console.error('Error initializing quiz:', e);
            }
        }
        function handleKeydown(e) {
            if (e.key === 'ArrowRight') {
                goToNextQuestion();
            } else if (e.key === 'ArrowLeft') {
                goToPreviousQuestion();
            } else if (e.key.toLowerCase() === 'a' || e.key === '1') {
                selectOption(0);
            } else if (e.key.toLowerCase() === 'b' || e.key === '2') {
                selectOption(1);
            } else if (e.key.toLowerCase() === 'c' || e.key === '3') {
                selectOption(2);
            } else if (e.key.toLowerCase() === 'd' || e.key === '4') {
                selectOption(3);
            } else if (e.key === 'Enter') {
                if (showExplanationBtn && showExplanationBtn.style.display !== 'none') {
                    toggleExplanation();
                }
            } else if (e.key === 's' || e.key === '5') {
                skipQuestion();
            }
        }
        function loadQuestion() {
            if (!questionElement || !optionsContainer) return; // Safety check
            const question = questions[currentQuestionIndex];
            if (!question) return;
            questionElement.textContent = question.question;
            currentQuestionElement.textContent = currentQuestionIndex + 1;
            if (categoryTag) categoryTag.textContent = question.category || 'Unknown';
           
            // Update difficulty tag with indicator
            if (difficultyTag) {
                difficultyTag.innerHTML = `
                    <span class="difficulty-indicator difficulty-${question.difficulty.toLowerCase().replace(' ', '-')}"></span>
                    ${question.difficulty}
                `;
            }
           
            if (categoryElement) categoryElement.textContent = question.category || 'All';
           
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            if (progressBar) progressBar.style.width = `${progress}%`;
           
            // Update progress level for appearance change
            let progressLevel = 0;
            if (progress > 75) progressLevel = 75;
            else if (progress > 50) progressLevel = 50;
            else if (progress > 25) progressLevel = 25;
            body.setAttribute('data-progress', progressLevel);
           
            optionsContainer.innerHTML = '';
           
            const optionLetters = ['A', 'B', 'C', 'D'];
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option', 'fade-in');
                optionElement.setAttribute('role', 'button');
                optionElement.setAttribute('tabindex', '0');
                optionElement.setAttribute('aria-label', `Option ${optionLetters[index]}: ${option}`);
               
                const optionLetter = document.createElement('div');
                optionLetter.classList.add('option-letter');
                optionLetter.textContent = optionLetters[index];
               
                const optionText = document.createElement('div');
                optionText.classList.add('option-text');
                optionText.textContent = option;
               
                optionElement.appendChild(optionLetter);
                optionElement.appendChild(optionText);
               
                optionElement.addEventListener('click', () => selectOption(index));
                optionElement.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectOption(index);
                    }
                });
               
                optionsContainer.appendChild(optionElement);
            });
           
            if (prevButton) prevButton.disabled = currentQuestionIndex === 0;
            if (nextButton) nextButton.textContent = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz' : 'Next Question';
            if (nextButton) nextButton.innerHTML = currentQuestionIndex === questions.length - 1 ? 'Finish Quiz <i class="fas fa-flag-checkered"></i>' : 'Next Question <i class="fas fa-arrow-right"></i>';
           
            if (feedbackElement) feedbackElement.style.display = 'none';
            if (showExplanationBtn) showExplanationBtn.style.display = 'none';
            if (explanationContainer) explanationContainer.classList.remove('expanded');
           
            selectedOption = null;
           
            // Show quick actions button
            if (quickActionsBtn) quickActionsBtn.style.display = 'flex';
           
            // If the question was previously answered or skipped, display the feedback
            if (answers[currentQuestionIndex]) {
                const ans = answers[currentQuestionIndex];
                const options = document.querySelectorAll('.option');
                if (feedbackElement) feedbackElement.style.display = 'flex';
                if (showExplanationBtn) showExplanationBtn.style.display = 'block';
                if (explanationTextElement) explanationTextElement.textContent = question.explanation;
                options.forEach(option => option.style.pointerEvents = 'none');
               
                if (ans.selected === 'Skipped') {
                    selectedOption = null;
                    if (feedbackElement) {
                        feedbackElement.classList.add('skipped');
                        feedbackElement.innerHTML = '<i class="fas fa-forward feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
                    }
                    options[question.answer].classList.add('correct');
                } else {
                    const optIndex = question.options.findIndex(opt => opt === ans.selected);
                    if (optIndex !== -1) {
                        selectedOption = optIndex;
                        options[optIndex].classList.add('selected');
                        if (ans.isCorrect) {
                            if (feedbackElement) {
                                feedbackElement.classList.add('correct');
                                feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                            }
                        } else {
                            if (feedbackElement) {
                                feedbackElement.classList.add('incorrect');
                                feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                            }
                            options[question.answer].classList.add('correct');
                            options[optIndex].classList.add('incorrect'); // Highlight selected as incorrect
                        }
                    }
                }
            }
           
            updateBookmarkStatus();
        }
        function selectOption(index) {
            if (selectedOption !== null || answers[currentQuestionIndex]) return;
           
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected', 'incorrect'));
            options[index].classList.add('selected');
            selectedOption = index;
           
            const question = questions[currentQuestionIndex];
            const isCorrect = index === question.answer;
           
            if (feedbackElement) feedbackElement.style.display = 'flex';
            if (isCorrect) {
                if (feedbackElement) {
                    feedbackElement.classList.remove('incorrect');
                    feedbackElement.classList.add('correct');
                    feedbackElement.innerHTML = '<i class="fas fa-check-circle feedback-icon"></i><div class="feedback-text">Correct! Well done.</div>';
                }
                score += getScoreForDifficulty(question.difficulty);
                streak++;
                playSound('correct');
               
                // Show confetti for correct answers on hard questions
                if (question.difficulty === 'Hard' || question.difficulty === 'Very Hard') {
                    createConfetti();
                }
            } else {
                if (feedbackElement) {
                    feedbackElement.classList.remove('correct');
                    feedbackElement.classList.add('incorrect');
                    feedbackElement.innerHTML = '<i class="fas fa-times-circle feedback-icon"></i><div class="feedback-text">Incorrect. The right answer is highlighted.</div>';
                }
                options[question.answer].classList.add('correct');
                options[index].classList.add('incorrect'); // Highlight selected as incorrect
                streak = 0;
                playSound('incorrect');
            }
           
            if (scoreElement) scoreElement.textContent = score;
            if (streakElement) streakElement.textContent = streak;
           
            if (explanationTextElement) explanationTextElement.textContent = question.explanation;
            if (showExplanationBtn) showExplanationBtn.style.display = 'block';
           
            answers[currentQuestionIndex] = {
                question: question.question,
                selected: question.options[index],
                correct: question.options[question.answer],
                isCorrect: isCorrect,
                explanation: question.explanation,
                category: question.category,
                difficulty: question.difficulty
            };
           
            updatePerformanceMetrics(isCorrect, question);
           
            options.forEach(option => option.style.pointerEvents = 'none');
        }
        function skipQuestion() {
            if (answers[currentQuestionIndex]) return;
           
            const question = questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');
           
            if (feedbackElement) {
                feedbackElement.style.display = 'flex';
                feedbackElement.classList.add('skipped');
                feedbackElement.innerHTML = '<i class="fas fa-forward feedback-icon"></i><div class="feedback-text">Skipped. The right answer is highlighted.</div>';
            }
           
            options[question.answer].classList.add('correct');
            if (showExplanationBtn) showExplanationBtn.style.display = 'block';
            if (explanationTextElement) explanationTextElement.textContent = question.explanation;
           
            answers[currentQuestionIndex] = {
                question: question.question,
                selected: 'Skipped',
                correct: question.options[question.answer],
                isCorrect: false,
                explanation: question.explanation,
                category: question.category,
                difficulty: question.difficulty
            };
           
            updatePerformanceMetrics(false, question);
            streak = 0;
            if (streakElement) streakElement.textContent = streak;
           
            options.forEach(option => option.style.pointerEvents = 'none');
        }
        function maybeHandleSkip() {
            if (!answers[currentQuestionIndex] && selectedOption === null) {
                skipQuestion();
            }
        }
        function toggleExplanation() {
            if (!explanationContainer) return;
            explanationContainer.classList.toggle('expanded');
            if (!showExplanationBtn) return;
            showExplanationBtn.innerHTML = explanationContainer.classList.contains('expanded') ?
                '<i class="fas fa-info-circle"></i> Hide Explanation' :
                '<i class="fas fa-info-circle"></i> Show Explanation';
        }
        function getScoreForDifficulty(difficulty) {
            switch (difficulty) {
                case 'Easy': return 5;
                case 'Medium': return 10;
                case 'Hard': return 15;
                case 'Very Hard': return 20;
                default: return 10;
            }
        }
        function updatePerformanceMetrics(isCorrect, question) {
            performanceMetrics.totalQuestions++;
            performanceMetrics.totalTime += timeElapsed;
            if (isCorrect) performanceMetrics.totalCorrect++;
           
            performanceMetrics.categories[question.category] = performanceMetrics.categories[question.category] || { correct: 0, total: 0 };
            performanceMetrics.categories[question.category].total++;
            if (isCorrect) performanceMetrics.categories[question.category].correct++;
           
            if (!performanceMetrics.difficulties[question.difficulty]) performanceMetrics.difficulties[question.difficulty] = 0;
            if (isCorrect) performanceMetrics.difficulties[question.difficulty]++;
        }
        function toggleBookmark() {
            if (!bookmarkBtn) return;
            const questionId = questions[currentQuestionIndex].id;
            const index = bookmarkedQuestions.indexOf(questionId);
            if (index === -1) {
                bookmarkedQuestions.push(questionId);
                bookmarkBtn.classList.add('bookmarked');
                playSound('bookmark');
            } else {
                bookmarkedQuestions.splice(index, 1);
                bookmarkBtn.classList.remove('bookmarked');
            }
            updateBookmarksCount();
            saveBookmarks();
        }
        function updateBookmarkStatus() {
            if (!bookmarkBtn) return;
            const questionId = questions[currentQuestionIndex].id;
            bookmarkBtn.classList.toggle('bookmarked', bookmarkedQuestions.includes(questionId));
        }
        function updateBookmarksCount() {
            if (!bookmarksCount) return;
            bookmarksCount.textContent = bookmarkedQuestions.length;
        }
        function goToNextQuestion() {
            maybeHandleSkip();
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                body.setAttribute('data-progress', '100');
                showResults();
                saveQuizHistory();
            }
        }
        function goToPreviousQuestion() {
            maybeHandleSkip();
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }
        function startTimer() {
            timeStarted = new Date();
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
        }
        function updateTimer() {
            timeElapsed++;
           
            const minutes = Math.floor(timeElapsed / 60).toString().padStart(2, '0');
            const seconds = (timeElapsed % 60).toString().padStart(2, '0');
            if (timerElement) timerElement.textContent = `${minutes}:${seconds}`;
           
            // Optional: Add warning color for long durations (e.g., after 5 minutes)
            if (timeElapsed >= 300) {
                if (timerElement) {
                    timerElement.style.color = 'var(--danger)';
                    timerElement.classList.add('pulse');
                }
            } else {
                if (timerElement) {
                    timerElement.style.color = 'var(--primary)';
                    timerElement.classList.remove('pulse');
                }
            }
        }
        function showResults() {
            if (timerInterval) clearInterval(timerInterval);
            if (quickActionsBtn) quickActionsBtn.style.display = 'none';
           
            const quizContainer = document.querySelector('.quiz-container');
            if (!quizContainer) return;
            const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
            const percentage = ((score / maxScore) * 100).toFixed(1);
            const accuracy = ((performanceMetrics.totalCorrect / performanceMetrics.totalQuestions) * 100).toFixed(1);
            const avgTime = Math.round(performanceMetrics.totalTime / performanceMetrics.totalQuestions);
           
            quizContainer.innerHTML = `
                <div class="results-container">
                    <h2 class="quiz-title">Quiz Completed!</h2>
                    <p class="quiz-subtitle">You've finished the MED QUIZ</p>
                   
                    <div class="score-circle" style="--p: ${percentage}%">
                        <div class="score-text">
                            <div class="score-value">${score}</div>
                            <div class="score-label">Points</div>
                        </div>
                    </div>
                   
                    <div class="results-stats">
                        <div class="result-stat">
                            <div class="result-stat-value">${accuracy}%</div>
                            <div class="result-stat-label">Accuracy</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${timeElapsed}s</div>
                            <div class="result-stat-label">Time Taken</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${streak}</div>
                            <div class="result-stat-label">Best Streak</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${bookmarkedQuestions.length}</div>
                            <div class="result-stat-label">Bookmarked</div>
                        </div>
                    </div>
                   
                    <div class="review-section">
                        <h3 class="review-title">Performance Analytics</h3>
                        <div class="review-item">
                            <div class="review-answer">Average Time Per Question: ${avgTime}s</div>
                            <div class="review-answer">Difficulty Performance:
                                Easy: ${performanceMetrics.difficulties.Easy || 0},
                                Medium: ${performanceMetrics.difficulties.Medium || 0},
                                Hard: ${performanceMetrics.difficulties.Hard || 0},
                                Very Hard: ${performanceMetrics.difficulties['Very Hard'] || 0}
                            </div>
                        </div>
                       
                        <h3 class="review-title">Review Your Answers</h3>
                        ${answers.map((answer, index) => `
                            <div class="review-item ${answer.isCorrect ? 'correct' : answer.selected === 'Skipped' ? 'skipped' : 'incorrect'}">
                                <div class="review-question">Q${index + 1}: ${answer.question} (${answer.category} - ${answer.difficulty})</div>
                                <div class="review-answer">Your Answer: ${answer.selected}</div>
                                <div class="review-answer">Correct Answer: ${answer.correct}</div>
                                <div class="review-explanation">${answer.explanation}</div>
                            </div>
                        `).join('')}
                       
                        ${bookmarkedQuestions.length > 0 ? `
                            <h3 class="review-title">Bookmarked Questions</h3>
                            ${bookmarkedQuestions.map(qid => {
                                const question = questions.find(q => q.id === qid);
                                if (!question) return '';
                                return `
                                    <div class="review-item">
                                        <div class="review-question">${question.question} (${question.category} - ${question.difficulty})</div>
                                        <div class="review-answer">Correct Answer: ${question.correctAnswer}</div>
                                        <div class="review-explanation">${question.explanation}</div>
                                    </div>
                                `;
                            }).join('')}
                        ` : ''}
                    </div>
                   
                    <button class="btn btn-primary mt-4" id="restart-btn">
                        <i class="fas fa-redo"></i> Try Again
                    </button>
                    <button class="btn btn-secondary mt-2" id="review-wrong-btn">
                        <i class="fas fa-search"></i> Review Incorrect Answers
                    </button>
                </div>
            `;
           
            // Add event listeners after DOM update
            const restartBtn = document.getElementById('restart-btn');
            const reviewWrongBtn = document.getElementById('review-wrong-btn');
            if (restartBtn) restartBtn.addEventListener('click', restartQuiz);
            if (reviewWrongBtn) reviewWrongBtn.addEventListener('click', reviewWrongAnswers);
        }
        function reviewWrongAnswers() {
            const wrongAnswers = answers.filter(answer => !answer.isCorrect && answer.selected !== 'Skipped');
           
            if (wrongAnswers.length === 0) {
                alert("You don't have any incorrect answers to review!");
                return;
            }
           
            // Filter questions to only include wrong answers
            const wrongQuestions = questions.filter((q, index) =>
                answers[index] && !answers[index].isCorrect && answers[index].selected !== 'Skipped'
            );
           
            // Reset quiz state for review mode
            questions.length = 0; // Clear array
            questions.push(...wrongQuestions); // Add wrong ones
            currentQuestionIndex = 0;
            score = 0;
            streak = 0;
            timeElapsed = 0;
            answers = [];
            selectedOption = null;
            performanceMetrics = {
                categories: {},
                difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
                totalCorrect: 0,
                totalQuestions: 0,
                totalTime: 0
            };
           
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
            }
           
            body.setAttribute('data-progress', '0');
           
            // Rebuild HTML with dynamic category (fix hardcoded "Neuro")
            const quizContainer = document.querySelector('.quiz-container');
            if (quizContainer) {
                quizContainer.innerHTML = `
                    <div class="quiz-header">
                        <div>
                            <h1 class="quiz-title">MED QUIZ</h1>
                            <p class="quiz-subtitle">Reviewing Incorrect Answers</p>
                        </div>
                        <div class="stats-container">
                            <div class="stat">
                                <span class="stat-value" id="score">0</span>
                                <span class="stat-label">Score</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="timer">00:00</span>
                                <span class="stat-label">Time</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="streak">0</span>
                                <span class="stat-label">Streak</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="category">Review</span>
                                <span class="stat-label">Mode</span>
                            </div>
                        </div>
                    </div>
                  
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
                    </div>
                    <div class="question-meta">
                        <div class="question-tags">
                            <span class="tag" id="category-tag">Biochemistry</span>
                            <span class="tag" id="difficulty-tag">
                                <span class="difficulty-indicator difficulty-medium"></span>
                                Medium
                            </span>
                        </div>
                        <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                            <i class="fas fa-bookmark"></i>
                        </button>
                    </div>
                    <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">${wrongQuestions.length}</span></div>
                    <div class="question-text" id="question"></div>
                    <div class="options-grid" id="options-container"></div>
                    <div class="feedback correct" id="feedback" style="display: none;">
                        <i class="fas fa-check-circle feedback-icon"></i>
                        <div class="feedback-text">Correct! Well done.</div>
                    </div>
                    <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                        <i class="fas fa-info-circle"></i> Show Explanation
                    </button>
                    <div class="explanation-container" id="explanation-container">
                        <div class="explanation">
                            <div class="explanation-title">Explanation:</div>
                            <div id="explanation-text"></div>
                        </div>
                    </div>
                    <div class="navigation">
                        <button class="btn btn-secondary" id="prev-btn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="next-btn">
                            Next Question <i class="fas fa-arrow-right"></i>
                        </button>
                        <button class="btn btn-danger" id="skip-btn">
                            <i class="fas fa-forward"></i> Skip
                        </button>
                    </div>
                `;
            }
           
            // Reinitialize after DOM update
            initQuiz();
        }
        function restartQuiz() {
            // Reset quiz state
            currentQuestionIndex = 0;
            score = 0;
            streak = 0;
            timeElapsed = 0;
            answers = [];
            selectedOption = null;
            performanceMetrics = {
                categories: {},
                difficulties: { Easy: 0, Medium: 0, Hard: 0, "Very Hard": 0 },
                totalCorrect: 0,
                totalQuestions: 0,
                totalTime: 0
            };
           
            // Reset questions to original set (use length = 0 for cross-browser)
            questions.length = 0;
            questions.push(...originalQuestions);
           
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
            }
           
            body.setAttribute('data-progress', '0');
           
            // Rebuild HTML
            const quizContainer = document.querySelector('.quiz-container');
            if (quizContainer) {
                quizContainer.innerHTML = `
                    <div class="quiz-header">
                        <div>
                            <h1 class="quiz-title">MED QUIZ</h1>
                            <p class="quiz-subtitle">Test your medical knowledge</p>
                        </div>
                        <div class="stats-container">
                            <div class="stat">
                                <span class="stat-value" id="score">0</span>
                                <span class="stat-label">Score</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="timer">00:00</span>
                                <span class="stat-label">Time</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="streak">0</span>
                                <span class="stat-label">Streak</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="category">All</span>
                                <span class="stat-label">Category</span>
                            </div>
                        </div>
                    </div>
                
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar" style="width: 10%"></div>
                    </div>
                    <div class="question-meta">
                        <div class="question-tags">
                            <span class="tag" id="category-tag">Biochemistry</span>
                            <span class="tag" id="difficulty-tag">
                                <span class="difficulty-indicator difficulty-medium"></span>
                                Medium
                            </span>
                        </div>
                        <button class="bookmark-btn" id="bookmark-btn" aria-label="Bookmark question">
                            <i class="fas fa-bookmark"></i>
                        </button>
                    </div>
                    <div class="question-number">Question <span id="current-question">1</span> of <span id="total-questions">15</span></div>
                    <div class="question-text" id="question"></div>
                    <div class="options-grid" id="options-container"></div>
                    <div class="feedback correct" id="feedback" style="display: none;">
                        <i class="fas fa-check-circle feedback-icon"></i>
                        <div class="feedback-text">Correct! Well done.</div>
                    </div>
                    <button class="btn btn-secondary" id="show-explanation-btn" style="display: none;">
                        <i class="fas fa-info-circle"></i> Show Explanation
                    </button>
                    <div class="explanation-container" id="explanation-container">
                        <div class="explanation">
                            <div class="explanation-title">Explanation:</div>
                            <div id="explanation-text"></div>
                        </div>
                    </div>
                    <div class="navigation">
                        <button class="btn btn-secondary" id="prev-btn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="next-btn">
                            Next Question <i class="fas fa-arrow-right"></i>
                        </button>
                        <button class="btn btn-danger" id="skip-btn">
                            <i class="fas fa-forward"></i> Skip
                        </button>
                    </div>
                `;
            }
           
            // Reinitialize after DOM update
            initQuiz();
        }
        function markForReview() {
            toggleBookmark();
            hideQuickActionsModal();
        }
        function viewExplanation() {
            if (!answers[currentQuestionIndex]) return;
            toggleExplanation();
            hideQuickActionsModal();
        }
        function getHint() {
            if (answers[currentQuestionIndex]) return;
            const wrongOptions = Array.from(document.querySelectorAll('.option')).filter((opt, idx) => idx !== questions[currentQuestionIndex].answer);
            const randomWrong = wrongOptions[Math.floor(Math.random() * wrongOptions.length)];
            randomWrong.style.opacity = '0.5';
            randomWrong.style.pointerEvents = 'none';
            const hintText = document.createElement('div');
            hintText.textContent = 'Hint: One wrong option eliminated!';
            hintText.classList.add('feedback', 'skipped');
            optionsContainer.before(hintText);
            setTimeout(() => hintText.remove(), 3000);
            hideQuickActionsModal();
        }
        function reportQuestion() {
            alert('Question reported. Thank you for your feedback!');
            hideQuickActionsModal();
        }
        function toggleTheme() {
            if (!body || !themeToggle) return;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' :
                            currentTheme === 'light' ? 'minimal' : 'dark';
           
            body.setAttribute('data-theme', newTheme);
            themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-moon"></i>' :
                                  newTheme === 'light' ? '<i class="fas fa-sun"></i>' :
                                  '<i class="fas fa-paint-brush"></i>';
           
            localStorage.setItem('theme', newTheme);
        }
        function toggleSound() {
            if (!soundToggle) return;
            soundsEnabled = !soundsEnabled;
            soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
           
            localStorage.setItem('soundsEnabled', soundsEnabled);
        }
        function toggleStudyMode() {
            if (!studyModeToggle) return;
            studyMode = studyModeToggle.checked;
            if (showExplanationBtn && explanationContainer) {
                if (studyMode) {
                    showExplanationBtn.style.display = 'block';
                    explanationContainer.classList.add('expanded');
                    showExplanationBtn.innerHTML = '<i class="fas fa-info-circle"></i> Hide Explanation';
                } else {
                    showExplanationBtn.style.display = 'none';
                    explanationContainer.classList.remove('expanded');
                }
            }
            localStorage.setItem('studyMode', studyMode);
        }
        function playSound(type) {
            if (!soundsEnabled) return;
           
            // Enhanced Web Audio for better sounds (reward chime for correct, buzz for incorrect)
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
               
                if (type === 'correct') {
                    // Rising chime for reward
                    const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
                    notes.forEach((freq, i) => {
                        setTimeout(() => {
                            const oscillator = audioContext.createOscillator();
                            const gainNode = audioContext.createGain();
                            oscillator.connect(gainNode);
                            gainNode.connect(audioContext.destination);
                            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                            oscillator.type = 'sine';
                            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                            oscillator.start(audioContext.currentTime + i * 0.1);
                            oscillator.stop(audioContext.currentTime + i * 0.1 + 0.3);
                        }, i * 100);
                    });
                } else if (type === 'incorrect') {
                    // Low buzz for wrong
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.type = 'sawtooth';
                    gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.4);
                } else if (type === 'bookmark') {
                    // Short ding
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.type = 'triangle';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                }
            } catch (e) {
                console.log('Web Audio API not supported');
            }
        }
        function createConfetti() {
            if (!confettiContainer) return;
            const colors = ['#4361ee', '#4cc9f0', '#f72585', '#f9c74f', '#7209b7'];
           
            for (let i = 0; i < 60; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = (6 + Math.random() * 12) + 'px';
                confetti.style.height = (6 + Math.random() * 12) + 'px';
                confetti.style.animation = `confettiFall ${1.5 + Math.random() * 2.5}s linear forwards`;
                confettiContainer.appendChild(confetti);
               
                // Remove confetti after animation
                setTimeout(() => {
                    if (confetti.parentNode) confetti.remove();
                }, 4000);
            }
        }
        function showStatsModal() {
            if (!statsModal) return;
            // Calculate stats
            const totalQuestions = performanceMetrics.totalQuestions;
            const correctAnswers = performanceMetrics.totalCorrect;
            const accuracy = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            const avgTime = totalQuestions > 0 ? Math.round(performanceMetrics.totalTime / totalQuestions) : 0;
           
            // Update modal stats safely
            const modalTotal = document.getElementById('modal-total-questions');
            const modalCorrect = document.getElementById('modal-correct-answers');
            const modalAccuracy = document.getElementById('modal-accuracy');
            const modalAvgTime = document.getElementById('modal-avg-time');
            if (modalTotal) modalTotal.textContent = totalQuestions;
            if (modalCorrect) modalCorrect.textContent = correctAnswers;
            if (modalAccuracy) modalAccuracy.textContent = `${accuracy}%`;
            if (modalAvgTime) modalAvgTime.textContent = `${avgTime}s`;
           
            // Update category stats
            const categoryStatsContainer = document.getElementById('category-stats');
            if (categoryStatsContainer) {
                categoryStatsContainer.innerHTML = `
                    <table style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr><th>Category</th><th>Accuracy</th><th>Correct/Total</th></tr>
                        </thead>
                        <tbody>
                            ${Object.entries(performanceMetrics.categories).map(([category, stats]) => {
                                const categoryAccuracy = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
                                return `<tr><td>${category}</td><td>${categoryAccuracy}%</td><td>${stats.correct}/${stats.total}</td></tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                `;
            }
           
            // Update difficulty stats (fix calculation - use per-difficulty total)
            const difficultyStatsContainer = document.getElementById('difficulty-stats');
            if (difficultyStatsContainer) {
                difficultyStatsContainer.innerHTML = `
                    <table style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr><th>Difficulty</th><th>Accuracy</th><th>Correct/Total</th></tr>
                        </thead>
                        <tbody>
                            ${Object.entries(performanceMetrics.difficulties).map(([difficulty, correctCount]) => {
                                const diffTotals = {};
                                answers.forEach(ans => {
                                    if (ans.difficulty && ans.isCorrect !== undefined) {
                                        if (!diffTotals[ans.difficulty]) diffTotals[ans.difficulty] = { correct: 0, total: 0 };
                                        diffTotals[ans.difficulty].total++;
                                        if (ans.isCorrect) diffTotals[ans.difficulty].correct++;
                                    }
                                });
                                const totalForDifficulty = diffTotals[difficulty] ? diffTotals[difficulty].total : 0;
                                if (totalForDifficulty > 0) {
                                    const difficultyAccuracy = Math.round((correctCount / totalForDifficulty) * 100);
                                    return `<tr><td>${difficulty}</td><td>${difficultyAccuracy}%</td><td>${correctCount}/${totalForDifficulty}</td></tr>`;
                                }
                                return '';
                            }).join('')}
                        </tbody>
                    </table>
                `;
            }
           
            // Update history
            const historyContainer = document.getElementById('history-stats');
            if (historyContainer) {
              if (quizHistory.length === 0) {
                historyContainer.innerHTML = '<p>No history yet.</p>';
              } else {
                historyContainer.innerHTML = `
                  <table style="width:100%; border-collapse: collapse;">
                    <thead>
                      <tr><th>Date</th><th>Score</th><th>Percentage</th><th>Time</th><th>Streak</th></tr>
                    </thead>
                    <tbody>
                      ${quizHistory.map(h => {
                        const date = new Date(h.timestamp).toLocaleString();
                        return `<tr><td>${date}</td><td>${h.score}</td><td>${h.percentage}%</td><td>${h.timeSpent}s</td><td>${h.streak}</td></tr>`;
                      }).join('')}
                    </tbody>
                  </table>
                `;
              }
            }
           
            statsModal.classList.add('active');
        }
        function hideStatsModal() {
            if (statsModal) statsModal.classList.remove('active');
        }
        function showQuickActionsModal() {
            if (quickActionsModal) quickActionsModal.classList.add('active');
        }
        function hideQuickActionsModal() {
            if (quickActionsModal) quickActionsModal.classList.remove('active');
        }
        function loadPreferences() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme && body) {
                body.setAttribute('data-theme', savedTheme);
                if (themeToggle) {
                    themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-moon"></i>' :
                                          savedTheme === 'light' ? '<i class="fas fa-sun"></i>' :
                                          '<i class="fas fa-paint-brush"></i>';
                }
            }
           
            const savedSounds = localStorage.getItem('soundsEnabled');
            if (savedSounds !== null) {
                soundsEnabled = savedSounds === 'true';
                if (soundToggle) {
                    soundToggle.innerHTML = soundsEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
                }
            }
           
            const savedStudyMode = localStorage.getItem('studyMode');
            if (savedStudyMode !== null) {
                studyMode = savedStudyMode === 'true';
                if (studyModeToggle) studyModeToggle.checked = studyMode;
                if (studyMode && showExplanationBtn && explanationContainer) {
                    showExplanationBtn.style.display = 'block';
                    explanationContainer.classList.add('expanded');
                    showExplanationBtn.innerHTML = '<i class="fas fa-info-circle"></i> Hide Explanation';
                }
            }
        }
        function saveBookmarks() {
            localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarkedQuestions));
        }
        function loadQuizHistory() {
            const saved = localStorage.getItem('quizHistory');
            if (saved) {
                try {
                    quizHistory = JSON.parse(saved);
                } catch (e) {
                    quizHistory = [];
                }
            }
            loadBookmarks();
        }
        function saveQuizHistory() {
            const maxScore = questions.reduce((sum, q) => sum + getScoreForDifficulty(q.difficulty), 0);
            quizHistory.push({
                timestamp: new Date().toISOString(),
                score: score,
                percentage: ((score / maxScore) * 100).toFixed(1),
                timeSpent: timeElapsed,
                streak: streak,
                answers: answers,
                performanceMetrics: performanceMetrics
            });
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
        }
        function loadBookmarks() {
            const saved = localStorage.getItem('bookmarkedQuestions');
            if (saved) {
                try {
                    bookmarkedQuestions = JSON.parse(saved);
                } catch (e) {
                    bookmarkedQuestions = [];
                }
            }
        }
        // Initialize on DOM load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initQuiz);
        } else {
            initQuiz();
        }
    </script>
</body>
</html>